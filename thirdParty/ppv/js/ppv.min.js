!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.proj4=t()}}(function(){return function t(e,i,n){function r(o,s){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({"./includedProjections":[function(t,e,i){var n=[t("./lib/projections/tmerc"),t("./lib/projections/utm"),t("./lib/projections/sterea"),t("./lib/projections/stere"),t("./lib/projections/somerc"),t("./lib/projections/omerc"),t("./lib/projections/lcc"),t("./lib/projections/krovak"),t("./lib/projections/cass"),t("./lib/projections/laea"),t("./lib/projections/aea"),t("./lib/projections/gnom"),t("./lib/projections/cea"),t("./lib/projections/eqc"),t("./lib/projections/poly"),t("./lib/projections/nzmg"),t("./lib/projections/mill"),t("./lib/projections/sinu"),t("./lib/projections/moll"),t("./lib/projections/eqdc"),t("./lib/projections/vandg"),t("./lib/projections/aeqd"),t("./lib/projections/ortho")];e.exports=function(t){n.forEach(function(e){t.Proj.projections.add(e)})}},{"./lib/projections/aea":42,"./lib/projections/aeqd":43,"./lib/projections/cass":44,"./lib/projections/cea":45,"./lib/projections/eqc":46,"./lib/projections/eqdc":47,"./lib/projections/gnom":49,"./lib/projections/krovak":50,"./lib/projections/laea":51,"./lib/projections/lcc":52,"./lib/projections/mill":55,"./lib/projections/moll":56,"./lib/projections/nzmg":57,"./lib/projections/omerc":58,"./lib/projections/ortho":59,"./lib/projections/poly":60,"./lib/projections/sinu":61,"./lib/projections/somerc":62,"./lib/projections/stere":63,"./lib/projections/sterea":64,"./lib/projections/tmerc":65,"./lib/projections/utm":66,"./lib/projections/vandg":67}],"./lib/version":[function(t,e,i){e.exports="2.3.16"},{}],1:[function(t,e,i){function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var r=t("mgrs");n.fromMGRS=function(t){return new n(r.toPoint(t))},n.prototype.toMGRS=function(t){return r.forward([this.x,this.y],t)},e.exports=n},{mgrs:70}],2:[function(t,e,i){function n(t,e){if(!(this instanceof n))return new n(t);e=e||function(t){if(t)throw t};var i=r(t);if("object"!=typeof i)return void e(t);var o=n.projections.get(i.projName);if(!o)return void e(t);if(i.datumCode&&"none"!==i.datumCode){var l=h[i.datumCode];l&&(i.datum_params=l.towgs84?l.towgs84.split(","):null,i.ellps=l.ellipse,i.datumName=l.datumName?l.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu";var u=s.sphere(i.a,i.b,i.rf,i.ellps,i.sphere),p=s.eccentricity(u.a,u.b,u.rf,i.R_A),d=i.datum||c(i.datumCode,i.datum_params,u.a,u.b,p.es,p.ep2);a(this,i),a(this,o),this.a=u.a,this.b=u.b,this.rf=u.rf,this.sphere=u.sphere,this.es=p.es,this.e=p.e,this.ep2=p.ep2,this.datum=d,this.init(),e(null,this)}var r=t("./parseCode"),a=t("./extend"),o=t("./projections"),s=t("./deriveConstants"),h=t("./constants/Datum"),c=t("./datum");n.projections=o,n.projections.start(),e.exports=n},{"./constants/Datum":26,"./datum":31,"./deriveConstants":35,"./extend":36,"./parseCode":39,"./projections":41}],3:[function(t,e,i){e.exports=function(t,e,i){var n,r,a,o=i.x,s=i.y,h=i.z||0,c={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==i.z)switch(0===a?(n=o,r="x"):1===a?(n=s,r="y"):(n=h,r="z"),t.axis[a]){case"e":c[r]=n;break;case"w":c[r]=-n;break;case"n":c[r]=n;break;case"s":c[r]=-n;break;case"u":void 0!==i[r]&&(c.z=n);break;case"d":void 0!==i[r]&&(c.z=-n);break;default:return null}return c}},{}],4:[function(t,e,i){var n=Math.PI/2,r=t("./sign");e.exports=function(t){return Math.abs(t)<n?t:t-r(t)*Math.PI}},{"./sign":22}],5:[function(t,e,i){var n=2*Math.PI,r=3.14159265359,a=t("./sign");e.exports=function(t){return Math.abs(t)<=r?t:t-a(t)*n}},{"./sign":22}],6:[function(t,e,i){var n=t("./adjust_lon");e.exports=function(t,e){if(t){if(t>0&&t<=60)return t-1}else{if(t=Math.floor(30*(n(e)+Math.PI)/Math.PI),t<0)return 0;if(t>=60)return 59}}},{"./adjust_lon":5}],7:[function(t,e,i){e.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},{}],8:[function(t,e,i){e.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},{}],9:[function(t,e,i){e.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},{}],10:[function(t,e,i){e.exports=function(t){return.05859375*t*t*(1+.75*t)}},{}],11:[function(t,e,i){e.exports=function(t){return t*t*t*(35/3072)}},{}],12:[function(t,e,i){e.exports=function(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)}},{}],13:[function(t,e,i){e.exports=function(t,e,i,n,r){var a,o;a=t/e;for(var s=0;s<15;s++)if(o=(t-(e*a-i*Math.sin(2*a)+n*Math.sin(4*a)-r*Math.sin(6*a)))/(e-2*i*Math.cos(2*a)+4*n*Math.cos(4*a)-6*r*Math.cos(6*a)),a+=o,Math.abs(o)<=1e-10)return a;return NaN}},{}],14:[function(t,e,i){var n=Math.PI/2;e.exports=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*n:n;for(var r,a,o,s,h=Math.asin(.5*e),c=0;c<30;c++)if(a=Math.sin(h),o=Math.cos(h),s=t*a,r=Math.pow(1-s*s,2)/(2*o)*(e/(1-t*t)-a/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),h+=r,Math.abs(r)<=1e-10)return h;return NaN}},{}],15:[function(t,e,i){e.exports=function(t,e,i,n,r){return t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)}},{}],16:[function(t,e,i){e.exports=function(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)}},{}],17:[function(t,e,i){var n=Math.PI/2;e.exports=function(t,e){for(var i,r,a=.5*t,o=n-2*Math.atan(e),s=0;s<=15;s++)if(i=t*Math.sin(o),r=n-2*Math.atan(e*Math.pow((1-i)/(1+i),a))-o,o+=r,Math.abs(r)<=1e-10)return o;return-9999}},{}],18:[function(t,e,i){var n=1,r=.25,a=.046875,o=.01953125,s=.01068115234375,h=.75,c=.46875,l=.013020833333333334,u=.007120768229166667,p=.3645833333333333,d=.005696614583333333,f=.3076171875;e.exports=function(t){var e=[];e[0]=n-t*(r+t*(a+t*(o+t*s))),e[1]=t*(h-t*(a+t*(o+t*s)));var i=t*t;return e[2]=i*(c-t*(l+t*u)),i*=t,e[3]=i*(p-t*d),e[4]=i*t*f,e}},{}],19:[function(t,e,i){var n=t("./pj_mlfn"),r=1e-10,a=20;e.exports=function(t,e,i){for(var o=1/(1-e),s=t,h=a;h;--h){var c=Math.sin(s),l=1-e*c*c;if(l=(n(s,c,Math.cos(s),i)-t)*(l*Math.sqrt(l))*o,s-=l,Math.abs(l)<r)return s}return s}},{"./pj_mlfn":20}],20:[function(t,e,i){e.exports=function(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}},{}],21:[function(t,e,i){e.exports=function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}},{}],22:[function(t,e,i){e.exports=function(t){return t<0?-1:1}},{}],23:[function(t,e,i){e.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},{}],24:[function(t,e,i){e.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},{}],25:[function(t,e,i){var n=Math.PI/2;e.exports=function(t,e,i){var r=t*i,a=.5*t;return r=Math.pow((1-r)/(1+r),a),Math.tan(.5*(n-e))/r}},{}],26:[function(t,e,i){i.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},i.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},i.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},i.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},i.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},i.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},i.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},i.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},i.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},i.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},i.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},i.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},i.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},i.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},i.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},i.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],27:[function(t,e,i){i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},i.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},i.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},i.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},i.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},i.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},i.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},i.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},i.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},i.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},i.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},i.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},i.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},i.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},i.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},i.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},i.hough={a:6378270,rf:297,ellipseName:"Hough"},i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},i.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},i.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},i.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],28:[function(t,e,i){i.greenwich=0,i.lisbon=-9.131906111111,i.paris=2.337229166667,i.bogota=-74.080916666667,i.madrid=-3.687938888889,i.rome=12.452333333333,i.bern=7.439583333333,i.jakarta=106.807719444444,i.ferro=-17.666666666667,i.brussels=4.367975,i.stockholm=18.058277777778,i.athens=23.7163375,i.oslo=10.722916666667},{}],29:[function(t,e,i){i.ft={to_meter:.3048},i["us-ft"]={to_meter:1200/3937}},{}],30:[function(t,e,i){function n(t,e,i){var n;return Array.isArray(i)?(n=s(t,e,i),3===i.length?[n.x,n.y,n.z]:[n.x,n.y]):s(t,e,i)}function r(t){return t instanceof o?t:t.oProj?t.oProj:o(t)}function a(t,e,i){t=r(t);var a,o=!1;return"undefined"==typeof e?(e=t,t=h,o=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(i=e,e=t,t=h,o=!0),e=r(e),i?n(t,e,i):(a={forward:function(i){return n(t,e,i)},inverse:function(i){return n(e,t,i)}},o&&(a.oProj=e),a)}var o=t("./Proj"),s=t("./transform"),h=o("WGS84");e.exports=a},{"./Proj":2,"./transform":68}],31:[function(t,e,i){function n(t,e,i,n,c,l){var u={};return u.datum_type=o,t&&"none"===t&&(u.datum_type=s),e&&(u.datum_params=e.map(parseFloat),0===u.datum_params[0]&&0===u.datum_params[1]&&0===u.datum_params[2]||(u.datum_type=r),u.datum_params.length>3&&(0===u.datum_params[3]&&0===u.datum_params[4]&&0===u.datum_params[5]&&0===u.datum_params[6]||(u.datum_type=a,u.datum_params[3]*=h,u.datum_params[4]*=h,u.datum_params[5]*=h,u.datum_params[6]=u.datum_params[6]/1e6+1))),u.a=i,u.b=n,u.es=c,u.ep2=l,u}var r=1,a=2,o=4,s=5,h=484813681109536e-20;e.exports=n},{}],32:[function(t,e,i){"use strict";var n=1,r=2,a=Math.PI/2;i.compareDatums=function(t,e){return t.datum_type===e.datum_type&&(!(t.a!==e.a||Math.abs(this.es-e.es)>5e-11)&&(t.datum_type===n?this.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==r||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]))},i.geodeticToGeocentric=function(t,e,i){var n,r,o,s,h=t.x,c=t.y,l=t.z?t.z:0;if(c<-a&&c>-1.001*a)c=-a;else if(c>a&&c<1.001*a)c=a;else if(c<-a||c>a)return null;return h>Math.PI&&(h-=2*Math.PI),r=Math.sin(c),s=Math.cos(c),o=r*r,n=i/Math.sqrt(1-e*o),{x:(n+l)*s*Math.cos(h),y:(n+l)*s*Math.sin(h),z:(n*(1-e)+l)*r}},i.geocentricToGeodetic=function(t,e,i,n){var r,o,s,h,c,l,u,p,d,f,m,v,g,y,x,b,M=1e-12,_=M*M,w=30,E=t.x,T=t.y,S=t.z?t.z:0;if(r=Math.sqrt(E*E+T*T),o=Math.sqrt(E*E+T*T+S*S),r/i<M){if(y=0,o/i<M)return x=a,b=-n,{x:t.x,y:t.y,z:t.z}}else y=Math.atan2(T,E);s=S/o,h=r/o,c=1/Math.sqrt(1-e*(2-e)*h*h),p=h*(1-e)*c,d=s*c,g=0;do{g++,u=i/Math.sqrt(1-e*d*d),b=r*p+S*d-u*(1-e*d*d),l=e*u/(u+b),c=1/Math.sqrt(1-l*(2-l)*h*h),f=h*(1-l)*c,m=s*c,v=m*p-f*d,p=f,d=m}while(v*v>_&&g<w);return x=Math.atan(m/Math.abs(f)),{x:y,y:x,z:b}},i.geocentricToWgs84=function(t,e,i){if(e===n)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===r){var a=i[0],o=i[1],s=i[2],h=i[3],c=i[4],l=i[5],u=i[6];return{x:u*(t.x-l*t.y+c*t.z)+a,y:u*(l*t.x+t.y-h*t.z)+o,z:u*(-c*t.x+h*t.y+t.z)+s}}},i.geocentricFromWgs84=function(t,e,i){if(e===n)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===r){var a=i[0],o=i[1],s=i[2],h=i[3],c=i[4],l=i[5],u=i[6],p=(t.x-a)/u,d=(t.y-o)/u,f=(t.z-s)/u;return{x:p+l*d-c*f,y:-l*p+d+h*f,z:c*p-h*d+f}}}},{}],33:[function(t,e,i){function n(t){return t===r||t===a}var r=1,a=2,o=5,s=t("./datumUtils");e.exports=function(t,e,i){return s.compareDatums(t,e)?i:t.datum_type===o||e.datum_type===o?i:t.es!==e.es||t.a!==e.a||n(t.datum_type)||n(e.datum_type)?(i=s.geodeticToGeocentric(i,t.es,t.a),n(t.datum_type)&&(i=s.geocentricToWgs84(i,t.datum_type,t.datum_params)),n(e.datum_type)&&(i=s.geocentricFromWgs84(i,e.datum_type,e.datum_params)),s.geocentricToGeodetic(i,e.es,e.a,e.b)):i}},{"./datumUtils":32}],34:[function(t,e,i){function n(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?n[t]=a(arguments[1]):n[t]=o(arguments[1]):n[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?n.apply(e,t):n(t)});if("string"==typeof t){if(t in n)return n[t]}else"EPSG"in t?n["EPSG:"+t.EPSG]=t:"ESRI"in t?n["ESRI:"+t.ESRI]=t:"IAU2000"in t?n["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var r=t("./global"),a=t("./projString"),o=t("./wkt");r(n),e.exports=n},{"./global":37,"./projString":40,"./wkt":69}],35:[function(t,e,i){var n=.16666666666666666,r=.04722222222222222,a=.022156084656084655,o=1e-10,s=t("./constants/Ellipsoid");i.eccentricity=function(t,e,i,o){var s=t*t,h=e*e,c=(s-h)/s,l=0;o?(t*=1-c*(n+c*(r+c*a)),s=t*t,c=0):l=Math.sqrt(c);var u=(s-h)/h;return{es:c,e:l,ep2:u}},i.sphere=function(t,e,i,n,r){if(!t){var a=s[n];a||(a=s.WGS84),t=a.a,e=a.b,i=a.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<o)&&(r=!0,e=t),{a:t,b:e,rf:i,sphere:r}}},{"./constants/Ellipsoid":27}],36:[function(t,e,i){e.exports=function(t,e){t=t||{};var i,n;if(!e)return t;for(n in e)i=e[n],void 0!==i&&(t[n]=i);return t}},{}],37:[function(t,e,i){e.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},{}],38:[function(t,e,i){var n=t("./core");n.defaultDatum="WGS84",n.Proj=t("./Proj"),n.WGS84=new n.Proj("WGS84"),n.Point=t("./Point"),n.toPoint=t("./common/toPoint"),n.defs=t("./defs"),n.transform=t("./transform"),n.mgrs=t("mgrs"),n.version=t("./version"),t("./includedProjections")(n),e.exports=n},{"./Point":1,"./Proj":2,"./common/toPoint":24,"./core":30,"./defs":34,"./includedProjections":"./includedProjections","./transform":68,"./version":"./lib/version",mgrs:70}],39:[function(t,e,i){function n(t){return"string"==typeof t}function r(t){return t in h}function a(t){return u.some(function(e){return t.indexOf(e)>-1})}function o(t){return"+"===t[0]}function s(t){return n(t)?r(t)?h[t]:a(t)?c(t):o(t)?l(t):void 0:t}var h=t("./defs"),c=t("./wkt"),l=t("./projString"),u=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];e.exports=s},{"./defs":34,"./projString":40,"./wkt":69}],40:[function(t,e,i){var n=.017453292519943295,r=t("./constants/PrimeMeridian"),a=t("./constants/units");e.exports=function(t){var e,i,o,s={},h=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),c={proj:"projName",datum:"datumCode",rf:function(t){s.rf=parseFloat(t)},lat_0:function(t){s.lat0=t*n},lat_1:function(t){s.lat1=t*n},lat_2:function(t){s.lat2=t*n},lat_ts:function(t){s.lat_ts=t*n},lon_0:function(t){s.long0=t*n},lon_1:function(t){s.long1=t*n},lon_2:function(t){s.long2=t*n},alpha:function(t){s.alpha=parseFloat(t)*n},lonc:function(t){s.longc=t*n},x_0:function(t){s.x0=parseFloat(t)},y_0:function(t){s.y0=parseFloat(t)},k_0:function(t){s.k0=parseFloat(t)},k:function(t){s.k0=parseFloat(t)},a:function(t){s.a=parseFloat(t)},b:function(t){s.b=parseFloat(t)},r_a:function(){s.R_A=!0},zone:function(t){s.zone=parseInt(t,10)},south:function(){s.utmSouth=!0},towgs84:function(t){s.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){s.to_meter=parseFloat(t)},units:function(t){s.units=t,a[t]&&(s.to_meter=a[t].to_meter)},from_greenwich:function(t){s.from_greenwich=t*n},pm:function(t){s.from_greenwich=(r[t]?r[t]:parseFloat(t))*n},nadgrids:function(t){"@null"===t?s.datumCode="none":s.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&e.indexOf(t.substr(0,1))!==-1&&e.indexOf(t.substr(1,1))!==-1&&e.indexOf(t.substr(2,1))!==-1&&(s.axis=t)}};for(e in h)i=h[e],e in c?(o=c[e],"function"==typeof o?o(i):s[o]=i):s[e]=i;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s}},{"./constants/PrimeMeridian":28,"./constants/units":29}],41:[function(t,e,i){function n(t,e){var i=o.length;return t.names?(o[i]=t,t.names.forEach(function(t){a[t.toLowerCase()]=i}),this):(console.log(e),!0)}var r=[t("./projections/merc"),t("./projections/longlat")],a={},o=[];i.add=n,i.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof a[e]&&o[a[e]]?o[a[e]]:void 0},i.start=function(){r.forEach(n)}},{"./projections/longlat":53,"./projections/merc":54}],42:[function(t,e,i){var n=1e-10,r=t("../common/msfnz"),a=t("../common/qsfnz"),o=t("../common/adjust_lon"),s=t("../common/asinz");i.init=function(){Math.abs(this.lat1+this.lat2)<n||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r(this.e3,this.sin_po,this.cos_po),this.qs1=a(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r(this.e3,this.sin_po,this.cos_po),this.qs2=a(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=a(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>n?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},i.forward=function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=a(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*o(e-this.long0),h=r*Math.sin(s)+this.x0,c=this.rh-r*Math.cos(s)+this.y0;return t.x=h,t.y=c,t},i.inverse=function(t){var e,i,n,r,a,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),r=0,0!==e&&(r=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),a=o(r/this.ns0+this.long0),t.x=a,t.y=s,t},i.phi1z=function(t,e){var i,r,a,o,h,c=s(.5*e);if(t<n)return c;for(var l=t*t,u=1;u<=25;u++)if(i=Math.sin(c),r=Math.cos(c),a=t*i,o=1-a*a,h=.5*o*o/r*(e/(1-l)-i/o+.5/t*Math.log((1-a)/(1+a))),c+=h,Math.abs(h)<=1e-7)return c;return null},i.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":7,"../common/msfnz":16,"../common/qsfnz":21}],43:[function(t,e,i){var n=t("../common/adjust_lon"),r=Math.PI/2,a=1e-10,o=t("../common/mlfn"),s=t("../common/e0fn"),h=t("../common/e1fn"),c=t("../common/e2fn"),l=t("../common/e3fn"),u=t("../common/gN"),p=t("../common/asinz"),d=t("../common/imlfn");i.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},i.forward=function(t){var e,i,p,d,f,m,v,g,y,x,b,M,_,w,E,T,S,R,A,L,P,C,I,N=t.x,z=t.y,U=Math.sin(t.y),D=Math.cos(t.y),O=n(N-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=a?(t.x=this.x0+this.a*(r-z)*Math.sin(O),t.y=this.y0-this.a*(r-z)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=a?(t.x=this.x0+this.a*(r+z)*Math.sin(O),t.y=this.y0+this.a*(r+z)*Math.cos(O),t):(R=this.sin_p12*U+this.cos_p12*D*Math.cos(O),T=Math.acos(R),S=T/Math.sin(T),t.x=this.x0+this.a*S*D*Math.sin(O),t.y=this.y0+this.a*S*(this.cos_p12*U-this.sin_p12*D*Math.cos(O)),t):(e=s(this.es),i=h(this.es),p=c(this.es),d=l(this.es),Math.abs(this.sin_p12-1)<=a?(f=this.a*o(e,i,p,d,r),m=this.a*o(e,i,p,d,z),t.x=this.x0+(f-m)*Math.sin(O),t.y=this.y0-(f-m)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=a?(f=this.a*o(e,i,p,d,r),m=this.a*o(e,i,p,d,z),t.x=this.x0+(f+m)*Math.sin(O),t.y=this.y0+(f+m)*Math.cos(O),t):(v=U/D,g=u(this.a,this.e,this.sin_p12),y=u(this.a,this.e,U),x=Math.atan((1-this.es)*v+this.es*g*this.sin_p12/(y*D)),b=Math.atan2(Math.sin(O),this.cos_p12*Math.tan(x)-this.sin_p12*Math.cos(O)),A=0===b?Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.abs(Math.abs(b)-Math.PI)<=a?-Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.asin(Math.sin(O)*Math.cos(x)/Math.sin(b)),M=this.e*this.sin_p12/Math.sqrt(1-this.es),_=this.e*this.cos_p12*Math.cos(b)/Math.sqrt(1-this.es),w=M*_,E=_*_,L=A*A,P=L*A,C=P*A,I=C*A,T=g*A*(1-L*E*(1-E)/6+P/8*w*(1-2*E)+C/120*(E*(4-7*E)-3*M*M*(1-7*E))-I/48*w),t.x=this.x0+T*Math.sin(b),t.y=this.y0+T*Math.cos(b),t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,f,m,v,g,y,x,b,M,_,w,E,T,S,R,A,L,P,C,I,N,z;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*r*this.a)return;return i=e/this.a,f=Math.sin(i),m=Math.cos(i),v=this.long0,Math.abs(e)<=a?g=this.lat0:(g=p(m*this.sin_p12+t.y*f*this.cos_p12/e),y=Math.abs(this.lat0)-r,v=n(Math.abs(y)<=a?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*f,e*this.cos_p12*m-t.y*this.sin_p12*f))),t.x=v,t.y=g,t}return x=s(this.es),b=h(this.es),M=c(this.es),_=l(this.es),Math.abs(this.sin_p12-1)<=a?(w=this.a*o(x,b,M,_,r),e=Math.sqrt(t.x*t.x+t.y*t.y),E=w-e,g=d(E/this.a,x,b,M,_),v=n(this.long0+Math.atan2(t.x,-1*t.y)),t.x=v,t.y=g,t):Math.abs(this.sin_p12+1)<=a?(w=this.a*o(x,b,M,_,r),e=Math.sqrt(t.x*t.x+t.y*t.y),E=e-w,g=d(E/this.a,x,b,M,_),v=n(this.long0+Math.atan2(t.x,t.y)),t.x=v,t.y=g,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),R=Math.atan2(t.x,t.y),T=u(this.a,this.e,this.sin_p12),A=Math.cos(R),L=this.e*this.cos_p12*A,P=-L*L/(1-this.es),C=3*this.es*(1-P)*this.sin_p12*this.cos_p12*A/(1-this.es),I=e/T,N=I-P*(1+P)*Math.pow(I,3)/6-C*(1+3*P)*Math.pow(I,4)/24,z=1-P*N*N/2-I*N*N*N/6,S=Math.asin(this.sin_p12*Math.cos(N)+this.cos_p12*Math.sin(N)*A),v=n(this.long0+Math.asin(Math.sin(R)*Math.sin(N)/Math.cos(S))),g=Math.atan((1-this.es*z*this.sin_p12/Math.sin(S))*Math.tan(S)/(1-this.es)),t.x=v,t.y=g,t)},i.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":7,"../common/e0fn":8,"../common/e1fn":9,"../common/e2fn":10,"../common/e3fn":11,"../common/gN":12,"../common/imlfn":13,"../common/mlfn":15}],44:[function(t,e,i){var n=t("../common/mlfn"),r=t("../common/e0fn"),a=t("../common/e1fn"),o=t("../common/e2fn"),s=t("../common/e3fn"),h=t("../common/gN"),c=t("../common/adjust_lon"),l=t("../common/adjust_lat"),u=t("../common/imlfn"),p=Math.PI/2,d=1e-10;i.init=function(){this.sphere||(this.e0=r(this.es),this.e1=a(this.es),this.e2=o(this.es),this.e3=s(this.es),this.ml0=this.a*n(this.e0,this.e1,this.e2,this.e3,this.lat0))},i.forward=function(t){var e,i,r=t.x,a=t.y;if(r=c(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(a)*Math.sin(r)),i=this.a*(Math.atan2(Math.tan(a),Math.cos(r))-this.lat0);else{var o=Math.sin(a),s=Math.cos(a),l=h(this.a,this.e,o),u=Math.tan(a)*Math.tan(a),p=r*Math.cos(a),d=p*p,f=this.es*s*s/(1-this.es),m=this.a*n(this.e0,this.e1,this.e2,this.e3,a);e=l*p*(1-d*u*(1/6-(8-u+8*f)*d/120)),i=m-this.ml0+l*o/s*d*(.5+(5-u+6*f)*d/24)}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,r=t.y/this.a;if(this.sphere){var a=r+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(a))}else{var o=this.ml0/this.a+r,s=u(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-p)<=d)return t.x=this.long0,t.y=p,r<0&&(t.y*=-1),t;var f=h(this.a,this.e,Math.sin(s)),m=f*f*f/this.a/this.a*(1-this.es),v=Math.pow(Math.tan(s),2),g=n*this.a/f,y=g*g;e=s-f*Math.tan(s)/m*g*g*(.5-(1+3*v)*g*g/24),i=g*(1-y*(v/3+(1+3*v)*v*y/15))/Math.cos(s)}return t.x=c(i+this.long0),t.y=l(e),t},i.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":8,"../common/e1fn":9,"../common/e2fn":10,"../common/e3fn":11,"../common/gN":12,"../common/imlfn":13,"../common/mlfn":15}],45:[function(t,e,i){var n=t("../common/adjust_lon"),r=t("../common/qsfnz"),a=t("../common/msfnz"),o=t("../common/iqsfnz");i.init=function(){this.sphere||(this.k0=a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},i.forward=function(t){var e,i,a=t.x,o=t.y,s=n(a-this.long0);if(this.sphere)e=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(o)/Math.cos(this.lat_ts);else{var h=r(this.e,Math.sin(o));e=this.x0+this.a*this.k0*s,i=this.y0+this.a*h*.5/this.k0}return t.x=e,t.y=i,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=n(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=o(this.e,2*t.y*this.k0/this.a),e=n(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},i.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":14,"../common/msfnz":16,"../common/qsfnz":21}],46:[function(t,e,i){var n=t("../common/adjust_lon"),r=t("../common/adjust_lat");i.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},i.forward=function(t){var e=t.x,i=t.y,a=n(e-this.long0),o=r(i-this.lat0);return t.x=this.x0+this.a*a*this.rc,t.y=this.y0+this.a*o,t},i.inverse=function(t){var e=t.x,i=t.y;return t.x=n(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=r(this.lat0+(i-this.y0)/this.a),t},i.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],47:[function(t,e,i){var n=t("../common/e0fn"),r=t("../common/e1fn"),a=t("../common/e2fn"),o=t("../common/e3fn"),s=t("../common/msfnz"),h=t("../common/mlfn"),c=t("../common/adjust_lon"),l=t("../common/adjust_lat"),u=t("../common/imlfn"),p=1e-10;i.init=function(){Math.abs(this.lat1+this.lat2)<p||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=n(this.es),this.e1=r(this.es),this.e2=a(this.es),this.e3=o(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=s(this.e,this.sinphi,this.cosphi),this.ml1=h(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<p?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=s(this.e,this.sinphi,this.cosphi),this.ml2=h(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=h(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},i.forward=function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var r=h(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-r)}var a=this.ns*c(i-this.long0),o=this.x0+e*Math.sin(a),s=this.y0+this.rh-e*Math.cos(a);return t.x=o,t.y=s,t},i.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,n,r;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;if(0!==i&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere)return r=c(this.long0+a/this.ns),n=l(this.g-i/this.a),t.x=r,t.y=n,t;var o=this.g-i/this.a;return n=u(o,this.e0,this.e1,this.e2,this.e3),r=c(this.long0+a/this.ns),t.x=r,t.y=n,t},i.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":8,"../common/e1fn":9,"../common/e2fn":10,"../common/e3fn":11,"../common/imlfn":13,"../common/mlfn":15,"../common/msfnz":16}],48:[function(t,e,i){var n=Math.PI/4,r=t("../common/srat"),a=Math.PI/2,o=20;i.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+n)/(Math.pow(Math.tan(.5*this.lat0+n),this.C)*r(this.e*t,this.ratexp))},i.forward=function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+n),this.C)*r(this.e*Math.sin(i),this.ratexp))-a,t.x=this.C*e,t},i.inverse=function(t){for(var e=1e-14,i=t.x/this.C,s=t.y,h=Math.pow(Math.tan(.5*s+n)/this.K,1/this.C),c=o;c>0&&(s=2*Math.atan(h*r(this.e*Math.sin(t.y),-.5*this.e))-a,!(Math.abs(s-t.y)<e));--c)t.y=s;return c?(t.x=i,t.y=s,t):null},i.names=["gauss"]},{"../common/srat":23}],49:[function(t,e,i){var n=t("../common/adjust_lon"),r=1e-10,a=t("../common/asinz");i.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},i.forward=function(t){var e,i,a,o,s,h,c,l,u=t.x,p=t.y;return a=n(u-this.long0),e=Math.sin(p),i=Math.cos(p),o=Math.cos(a),h=this.sin_p14*e+this.cos_p14*i*o,s=1,h>0||Math.abs(h)<=r?(c=this.x0+this.a*s*i*Math.sin(a)/h,l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*i*o)/h):(c=this.x0+this.infinity_dist*i*Math.sin(a),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*o)),t.x=c,t.y=l,t},i.inverse=function(t){var e,i,r,o,s,h;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(o=Math.atan2(e,this.rc),i=Math.sin(o),r=Math.cos(o),h=a(r*this.sin_p14+t.y*i*this.cos_p14/e),s=Math.atan2(t.x*i,e*this.cos_p14*r-t.y*this.sin_p14*i),s=n(this.long0+s)):(h=this.phic0,s=0),t.x=s,t.y=h,t},i.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":7}],50:[function(t,e,i){var n=t("../common/adjust_lon");i.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},i.forward=function(t){var e,i,r,a,o,s,h,c=t.x,l=t.y,u=n(c-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),r=-u*this.alfa,a=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),o=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(a)),s=this.n*o,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(a/2+this.s45),this.n),t.y=h*Math.cos(s)/1,t.x=h*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},i.inverse=function(t){var e,i,n,r,a,o,s,h,c=t.x;t.x=t.y,t.y=c,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),a=Math.atan2(t.y,t.x),r=a/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,h=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(h=1),s=t.y,l+=1}while(0===h&&l<15);return l>=15?null:t},i.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],51:[function(t,e,i){var n=Math.PI/2,r=Math.PI/4,a=1e-10,o=t("../common/qsfnz"),s=t("../common/adjust_lon");i.S_POLE=1,i.N_POLE=2,i.EQUIT=3,i.OBLIQ=4,i.init=function(){var t=Math.abs(this.lat0);if(Math.abs(t-n)<a?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<a?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=o(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=o(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},i.forward=function(t){var e,i,h,c,l,u,p,d,f,m,v=t.x,g=t.y;if(v=s(v-this.long0),this.sphere){if(l=Math.sin(g),m=Math.cos(g),h=Math.cos(v),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+m*h:1+this.sinph0*l+this.cosph0*m*h,i<=a)return null;i=Math.sqrt(2/i),e=i*m*Math.sin(v),i*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*m*h}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),Math.abs(g+this.phi0)<a)return null;i=r-.5*g,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(v),i*=h}}else{switch(p=0,d=0,f=0,h=Math.cos(v),c=Math.sin(v),l=Math.sin(g),u=o(this.e,l),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=u/this.qp,d=Math.sqrt(1-p*p)),this.mode){case this.OBLIQ:f=1+this.sinb1*p+this.cosb1*d*h;break;case this.EQUIT:f=1+d*h;break;case this.N_POLE:f=n+g,u=this.qp-u;break;case this.S_POLE:f=g-n,u=this.qp+u}if(Math.abs(f)<a)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:f=Math.sqrt(2/f),i=this.mode===this.OBLIQ?this.ymf*f*(this.cosb1*p-this.sinb1*d*h):(f=Math.sqrt(2/(1+d*h)))*p*this.ymf,e=this.xmf*f*d*c;break;case this.N_POLE:case this.S_POLE:u>=0?(e=(f=Math.sqrt(u))*c,i=h*(this.mode===this.S_POLE?f:-f)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r,o,h,c,l,u=t.x/this.a,p=t.y/this.a;if(this.sphere){var d,f=0,m=0;if(d=Math.sqrt(u*u+p*p),i=.5*d,i>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(i),f=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(d)<=a?0:Math.asin(p*m/d),u*=m,p=f*d;break;case this.OBLIQ:i=Math.abs(d)<=a?this.phi0:Math.asin(f*this.sinph0+p*m*this.cosph0/d),u*=m*this.cosph0,p=(f-Math.sin(i)*this.sinph0)*d;break;case this.N_POLE:p=-p,i=n-i;break;case this.S_POLE:i-=n}e=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,p):0}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,p*=this.dd,c=Math.sqrt(u*u+p*p),c<a)return t.x=0,t.y=this.phi0,t;o=2*Math.asin(.5*c/this.rq),r=Math.cos(o),u*=o=Math.sin(o),this.mode===this.OBLIQ?(l=r*this.sinb1+p*o*this.cosb1/c,h=this.qp*l,p=c*this.cosb1*r-p*this.sinb1*o):(l=p*o/c,h=this.qp*l,p=c*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),h=u*u+p*p,!h)return t.x=0,t.y=this.phi0,t;l=1-h/this.qp,this.mode===this.S_POLE&&(l=-l)}e=Math.atan2(u,p),i=this.authlat(Math.asin(l),this.apa)}return t.x=s(this.long0+e),t.y=i,t},i.P00=.3333333333333333,i.P01=.17222222222222222,i.P02=.10257936507936508,i.P10=.06388888888888888,i.P11=.0664021164021164,i.P20=.016415012942191543,i.authset=function(t){var e,i=[];return i[0]=t*this.P00,e=t*t,i[0]+=e*this.P01,i[1]=e*this.P10,e*=t,i[0]+=e*this.P02,i[1]+=e*this.P11,i[2]=e*this.P20,i},i.authlat=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)},i.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":21}],52:[function(t,e,i){var n=1e-10,r=t("../common/msfnz"),a=t("../common/tsfnz"),o=Math.PI/2,s=t("../common/sign"),h=t("../common/adjust_lon"),c=t("../common/phi2z");i.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<n)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),o=r(this.e,e,i),s=a(this.e,this.lat1,e),h=Math.sin(this.lat2),c=Math.cos(this.lat2),l=r(this.e,h,c),u=a(this.e,this.lat2,h),p=a(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>n?this.ns=Math.log(o/l)/Math.log(s/u):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=o/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}},i.forward=function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=n&&(i=s(i)*(o-2*n));var r,c,l=Math.abs(Math.abs(i)-o);if(l>n)r=a(this.e,i,Math.sin(i)),c=this.a*this.f0*Math.pow(r,this.ns);else{if(l=i*this.ns,l<=0)return null;c=0}var u=this.ns*h(e-this.long0);return t.x=this.k0*(c*Math.sin(u))+this.x0,t.y=this.k0*(this.rh-c*Math.cos(u))+this.y0,t},i.inverse=function(t){var e,i,n,r,a,s=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+l*l),i=1):(e=-Math.sqrt(s*s+l*l),i=-1);var u=0;if(0!==e&&(u=Math.atan2(i*s,i*l)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),r=c(this.e,n),r===-9999)return null}else r=-o;return a=h(u/this.ns+this.long0),t.x=a,t.y=r,t},i.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":16,"../common/phi2z":17,"../common/sign":22,"../common/tsfnz":25}],53:[function(t,e,i){function n(t){return t}i.init=function(){},i.forward=n,i.inverse=n,i.names=["longlat","identity"]},{}],54:[function(t,e,i){var n=t("../common/msfnz"),r=Math.PI/2,a=1e-10,o=57.29577951308232,s=t("../common/adjust_lon"),h=Math.PI/4,c=t("../common/tsfnz"),l=t("../common/phi2z");i.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=n(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},i.forward=function(t){var e=t.x,i=t.y;if(i*o>90&&i*o<-90&&e*o>180&&e*o<-180)return null;var n,l;if(Math.abs(Math.abs(i)-r)<=a)return null;if(this.sphere)n=this.x0+this.a*this.k0*s(e-this.long0),l=this.y0+this.a*this.k0*Math.log(Math.tan(h+.5*i));else{var u=Math.sin(i),p=c(this.e,i,u);n=this.x0+this.a*this.k0*s(e-this.long0),l=this.y0-this.a*this.k0*Math.log(p)}return t.x=n,t.y=l,t},i.inverse=function(t){var e,i,n=t.x-this.x0,a=t.y-this.y0;if(this.sphere)i=r-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var o=Math.exp(-a/(this.a*this.k0));if(i=l(this.e,o),i===-9999)return null}return e=s(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},i.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":16,"../common/phi2z":17,"../common/tsfnz":25}],55:[function(t,e,i){var n=t("../common/adjust_lon");i.init=function(){},i.forward=function(t){var e=t.x,i=t.y,r=n(e-this.long0),a=this.x0+this.a*r,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=a,t.y=o,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=n(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},i.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],56:[function(t,e,i){var n=t("../common/adjust_lon"),r=1e-10;i.init=function(){},i.forward=function(t){for(var e=t.x,i=t.y,a=n(e-this.long0),o=i,s=Math.PI*Math.sin(i),h=0;!0;h++){var c=-(o+Math.sin(o)-s)/(1+Math.cos(o));if(o+=c,Math.abs(c)<r)break}o/=2,Math.PI/2-Math.abs(i)<r&&(a=0);var l=.900316316158*this.a*a*Math.cos(o)+this.x0,u=1.4142135623731*this.a*Math.sin(o)+this.y0;return t.x=l,t.y=u,t},i.inverse=function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var r=n(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var a=Math.asin(i);return t.x=r,t.y=a,t},i.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],57:[function(t,e,i){var n=484813681109536e-20;i.iterations=1,i.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},i.forward=function(t){var e,i=t.x,r=t.y,a=r-this.lat0,o=i-this.long0,s=a/n*1e-5,h=o,c=1,l=0;for(e=1;e<=10;e++)c*=s,l+=this.A[e]*c;var u,p,d=l,f=h,m=1,v=0,g=0,y=0;for(e=1;e<=6;e++)u=m*d-v*f,p=v*d+m*f,m=u,v=p,g=g+this.B_re[e]*m-this.B_im[e]*v,y=y+this.B_im[e]*m+this.B_re[e]*v;return t.x=y*this.a+this.x0,t.y=g*this.a+this.y0,t},i.inverse=function(t){var e,i,r,a=t.x,o=t.y,s=a-this.x0,h=o-this.y0,c=h/this.a,l=s/this.a,u=1,p=0,d=0,f=0;for(e=1;e<=6;e++)i=u*c-p*l,r=p*c+u*l,u=i,p=r,d=d+this.C_re[e]*u-this.C_im[e]*p,f=f+this.C_im[e]*u+this.C_re[e]*p;for(var m=0;m<this.iterations;m++){var v,g,y=d,x=f,b=c,M=l;for(e=2;e<=6;e++)v=y*d-x*f,g=x*d+y*f,y=v,x=g,b+=(e-1)*(this.B_re[e]*y-this.B_im[e]*x),M+=(e-1)*(this.B_im[e]*y+this.B_re[e]*x);y=1,x=0;var _=this.B_re[1],w=this.B_im[1];for(e=2;e<=6;e++)v=y*d-x*f,g=x*d+y*f,y=v,x=g,_+=e*(this.B_re[e]*y-this.B_im[e]*x),w+=e*(this.B_im[e]*y+this.B_re[e]*x);var E=_*_+w*w;d=(b*_+M*w)/E,f=(M*_-b*w)/E}var T=d,S=f,R=1,A=0;for(e=1;e<=9;e++)R*=T,A+=this.D[e]*R;var L=this.lat0+A*n*1e5,P=this.long0+S;return t.x=P,t.y=L,t},i.names=["New_Zealand_Map_Grid","nzmg"]},{}],58:[function(t,e,i){var n=t("../common/tsfnz"),r=t("../common/adjust_lon"),a=t("../common/phi2z"),o=Math.PI/2,s=Math.PI/4,h=1e-10;i.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var a=n(this.e,this.lat0,t),o=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));o*o<1&&(o=1);var s,h;if(isNaN(this.longc)){var c=n(this.e,this.lat1,Math.sin(this.lat1)),l=n(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(o+Math.sqrt(o*o-1))*Math.pow(a,this.bl):this.el=(o-Math.sqrt(o*o-1))*Math.pow(a,this.bl);var u=Math.pow(c,this.bl),p=Math.pow(l,this.bl);s=this.el/u,h=.5*(s-1/s);var d=(this.el*this.el-p*u)/(this.el*this.el+p*u),f=(p-u)/(p+u),m=r(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(d*Math.tan(.5*this.bl*m)/f)/this.bl,this.long0=r(this.long0);var v=r(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*v)/h),this.alpha=Math.asin(o*Math.sin(this.gamma0))}else s=this.lat0>=0?o+Math.sqrt(o*o-1):o-Math.sqrt(o*o-1),this.el=s*Math.pow(a,this.bl),h=.5*(s-1/s),this.gamma0=Math.asin(Math.sin(this.alpha)/o),this.long0=this.longc-Math.asin(h*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha))},i.forward=function(t){var e,i,a,c=t.x,l=t.y,u=r(c-this.long0);if(Math.abs(Math.abs(l)-o)<=h)a=l>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(s+a*this.gamma0*.5)),e=-1*a*o*this.al/this.bl;else{var p=n(this.e,l,Math.sin(l)),d=this.el/Math.pow(p,this.bl),f=.5*(d-1/d),m=.5*(d+1/d),v=Math.sin(this.bl*u),g=(f*Math.sin(this.gamma0)-v*Math.cos(this.gamma0))/m;i=Math.abs(Math.abs(g)-1)<=h?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,e=Math.abs(Math.cos(this.bl*u))<=h?this.al*this.bl*u:this.al*Math.atan2(f*Math.cos(this.gamma0)+v*Math.sin(this.gamma0),Math.cos(this.bl*u))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},i.inverse=function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*i/this.al),s=.5*(n-1/n),c=.5*(n+1/n),l=Math.sin(this.bl*e/this.al),u=(l*Math.cos(this.gamma0)+s*Math.sin(this.gamma0))/c,p=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),1/this.bl);return Math.abs(u-1)<h?(t.x=this.long0,t.y=o):Math.abs(u+1)<h?(t.x=this.long0,t.y=-1*o):(t.y=a(this.e,p),t.x=r(this.long0-Math.atan2(s*Math.cos(this.gamma0)-l*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},i.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":17,"../common/tsfnz":25}],59:[function(t,e,i){var n=t("../common/adjust_lon"),r=1e-10,a=t("../common/asinz"),o=Math.PI/2;i.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},i.forward=function(t){var e,i,a,o,s,h,c,l,u=t.x,p=t.y;return a=n(u-this.long0),e=Math.sin(p),i=Math.cos(p),o=Math.cos(a),h=this.sin_p14*e+this.cos_p14*i*o,s=1,(h>0||Math.abs(h)<=r)&&(c=this.a*s*i*Math.sin(a),l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*i*o)),t.x=c,t.y=l,t},i.inverse=function(t){var e,i,s,h,c,l,u;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),i=a(e/this.a),s=Math.sin(i),h=Math.cos(i),l=this.long0,Math.abs(e)<=r?(u=this.lat0,t.x=l,t.y=u,t):(u=a(h*this.sin_p14+t.y*s*this.cos_p14/e),c=Math.abs(this.lat0)-o,Math.abs(c)<=r?(l=n(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=l,t.y=u,t):(l=n(this.long0+Math.atan2(t.x*s,e*this.cos_p14*h-t.y*this.sin_p14*s)),t.x=l,t.y=u,t))},i.names=["ortho"]},{"../common/adjust_lon":5,"../common/asinz":7}],60:[function(t,e,i){var n=t("../common/e0fn"),r=t("../common/e1fn"),a=t("../common/e2fn"),o=t("../common/e3fn"),s=t("../common/adjust_lon"),h=t("../common/adjust_lat"),c=t("../common/mlfn"),l=1e-10,u=t("../common/gN"),p=20;i.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=n(this.es),this.e1=r(this.es),this.e2=a(this.es),this.e3=o(this.es),this.ml0=this.a*c(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(t){var e,i,n,r=t.x,a=t.y,o=s(r-this.long0);if(n=o*Math.sin(a),this.sphere)Math.abs(a)<=l?(e=this.a*o,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(a),i=this.a*(h(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=l)e=this.a*o,i=-1*this.ml0;else{var p=u(this.a,this.e,Math.sin(a))/Math.tan(a);e=p*Math.sin(n),i=this.a*c(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+p*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){var e,i,n,r,a,o,h,u,d;if(n=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=l)e=s(n/this.a+this.long0),i=0;else{o=this.lat0+r/this.a,h=n*n/this.a/this.a+o*o,u=o;var f;for(a=p;a;--a)if(f=Math.tan(u),d=-1*(o*(u*f+1)-u-.5*(u*u+h)*f)/((u-o)/f-1),u+=d,Math.abs(d)<=l){i=u;break}e=s(this.long0+Math.asin(n*Math.tan(u)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=l)i=0,e=s(this.long0+n/this.a);else{o=(this.ml0+r)/this.a,h=n*n/this.a/this.a+o*o,u=o;var m,v,g,y,x;for(a=p;a;--a)if(x=this.e*Math.sin(u),m=Math.sqrt(1-x*x)*Math.tan(u),v=this.a*c(this.e0,this.e1,this.e2,this.e3,u),g=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),y=v/this.a,d=(o*(m*y+1)-y-.5*m*(y*y+h))/(this.es*Math.sin(2*u)*(y*y+h-2*o*y)/(4*m)+(o-y)*(m*g-2/Math.sin(2*u))-g),u-=d,Math.abs(d)<=l){i=u;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=s(this.long0+Math.asin(n*m/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},i.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":8,"../common/e1fn":9,"../common/e2fn":10,"../common/e3fn":11,"../common/gN":12,"../common/mlfn":15}],61:[function(t,e,i){var n=t("../common/adjust_lon"),r=t("../common/adjust_lat"),a=t("../common/pj_enfn"),o=20,s=t("../common/pj_mlfn"),h=t("../common/pj_inv_mlfn"),c=Math.PI/2,l=1e-10,u=t("../common/asinz");i.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=a(this.es)},i.forward=function(t){var e,i,r=t.x,a=t.y;if(r=n(r-this.long0),this.sphere){if(this.m)for(var h=this.n*Math.sin(a),c=o;c;--c){var u=(this.m*a+Math.sin(a)-h)/(this.m+Math.cos(a));if(a-=u,Math.abs(u)<l)break}else a=1!==this.n?Math.asin(this.n*Math.sin(a)):a;e=this.a*this.C_x*r*(this.m+Math.cos(a)),i=this.a*this.C_y*a}else{var p=Math.sin(a),d=Math.cos(a);i=this.a*s(a,p,d,this.en),e=this.a*r*d/Math.sqrt(1-this.es*p*p)}return t.x=e,t.y=i,t},i.inverse=function(t){var e,i,a,o;return t.x-=this.x0,a=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,a/=this.C_x*(this.m+Math.cos(e)),this.m?e=u((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=u(Math.sin(e)/this.n)),a=n(a+this.long0),e=r(e)):(e=h(t.y/this.a,this.es,this.en),o=Math.abs(e),o<c?(o=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(e)),a=n(i)):o-l<c&&(a=this.long0)),t.x=a,t.y=e,t},i.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":7,"../common/pj_enfn":18,"../common/pj_inv_mlfn":19,"../common/pj_mlfn":20}],62:[function(t,e,i){i.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=this.rf,r=1/n,a=2*r-Math.pow(r,2),o=this.e=Math.sqrt(a);this.R=this.k0*i*Math.sqrt(1-a)/(1-a*Math.pow(e,2)),this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+t/2)),c=Math.log((1+o*e)/(1-o*e));this.K=s-this.alpha*h+this.alpha*o/2*c},i.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),s=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*o+this.x0,t},i.inverse=function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),s=this.lambda0+o/this.alpha,h=0,c=a,l=-1e3,u=0;Math.abs(c-l)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),l=c,c=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=s,t.y=c,t},i.names=["somerc"]},{}],63:[function(t,e,i){var n=Math.PI/2,r=1e-10,a=t("../common/sign"),o=t("../common/msfnz"),s=t("../common/tsfnz"),h=t("../common/phi2z"),c=t("../common/adjust_lon");i.ssfn_=function(t,e,i){return e*=i,Math.tan(.5*(n+t))*Math.pow((1-e)/(1+e),.5*i)},i.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r&&(this.k0=.5*(1+a(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=r&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r&&(this.k0=.5*this.cons*o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/s(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=o(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-n,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},i.forward=function(t){var e,i,a,o,h,l,u=t.x,p=t.y,d=Math.sin(p),f=Math.cos(p),m=c(u-this.long0);return Math.abs(Math.abs(u-this.long0)-Math.PI)<=r&&Math.abs(p+this.lat0)<=r?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*d+this.coslat0*f*Math.cos(m)),t.x=this.a*e*f*Math.sin(m)+this.x0,t.y=this.a*e*(this.coslat0*d-this.sinlat0*f*Math.cos(m))+this.y0,t):(i=2*Math.atan(this.ssfn_(p,d,this.e))-n,o=Math.cos(i),a=Math.sin(i),Math.abs(this.coslat0)<=r?(h=s(this.e,p*this.con,this.con*d),l=2*this.a*this.k0*h/this.cons,t.x=this.x0+l*Math.sin(u-this.long0),t.y=this.y0-this.con*l*Math.cos(u-this.long0),t):(Math.abs(this.sinlat0)<r?(e=2*this.a*this.k0/(1+o*Math.cos(m)),t.y=e*a):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*o*Math.cos(m))),t.y=e*(this.cosX0*a-this.sinX0*o*Math.cos(m))+this.y0),t.x=e*o*Math.sin(m)+this.x0,t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,a,o,s,l=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var u=2*Math.atan(l/(.5*this.a*this.k0));return e=this.long0,i=this.lat0,l<=r?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(u)*this.sinlat0+t.y*Math.sin(u)*this.coslat0/l),e=c(Math.abs(this.coslat0)<r?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(u),l*this.coslat0*Math.cos(u)-t.y*this.sinlat0*Math.sin(u))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=r){if(l<=r)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,a=l*this.cons/(2*this.a*this.k0),i=this.con*h(this.e,a),e=this.con*c(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else o=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,l<=r?s=this.X0:(s=Math.asin(Math.cos(o)*this.sinX0+t.y*Math.sin(o)*this.cosX0/l),e=c(this.long0+Math.atan2(t.x*Math.sin(o),l*this.cosX0*Math.cos(o)-t.y*this.sinX0*Math.sin(o)))),i=-1*h(this.e,Math.tan(.5*(n+s)));return t.x=e,t.y=i,t},i.names=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"]},{"../common/adjust_lon":5,"../common/msfnz":16,"../common/phi2z":17,"../common/sign":22,"../common/tsfnz":25}],64:[function(t,e,i){var n=t("./gauss"),r=t("../common/adjust_lon");i.init=function(){n.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},i.forward=function(t){var e,i,a,o;return t.x=r(t.x-this.long0),n.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),a=Math.cos(t.x),o=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*a),t.x=o*i*Math.sin(t.x),t.y=o*(this.cosc0*e-this.sinc0*i*a),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},i.inverse=function(t){var e,i,a,o,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=Math.sqrt(t.x*t.x+t.y*t.y)){var h=2*Math.atan2(s,this.R2);e=Math.sin(h),i=Math.cos(h),o=Math.asin(i*this.sinc0+t.y*e*this.cosc0/s),a=Math.atan2(t.x*e,s*this.cosc0*i-t.y*this.sinc0*e)}else o=this.phic0,a=0;return t.x=a,t.y=o,n.inverse.apply(this,[t]),t.x=r(t.x+this.long0),t},i.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":48}],65:[function(t,e,i){var n=t("../common/pj_enfn"),r=t("../common/pj_mlfn"),a=t("../common/pj_inv_mlfn"),o=t("../common/adjust_lon"),s=Math.PI/2,h=1e-10,c=t("../common/sign");i.init=function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=n(this.es),this.ml0=r(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},i.forward=function(t){var e,i,n,a=t.x,s=t.y,c=o(a-this.long0),l=Math.sin(s),u=Math.cos(s);if(this.es){var p=u*c,d=Math.pow(p,2),f=this.ep2*Math.pow(u,2),m=Math.pow(f,2),v=Math.abs(u)>h?Math.tan(s):0,g=Math.pow(v,2),y=Math.pow(g,2);e=1-this.es*Math.pow(l,2),p/=Math.sqrt(e);var x=r(s,l,u,this.en);i=this.a*(this.k0*p*(1+d/6*(1-g+f+d/20*(5-18*g+y+14*f-58*g*f+d/42*(61+179*y-y*g-479*g)))))+this.x0,n=this.a*(this.k0*(x-this.ml0+l*c*p/2*(1+d/12*(5-g+9*f+4*m+d/30*(61+y-58*g+270*f-330*g*f+d/56*(1385+543*y-y*g-3111*g))))))+this.y0}else{var b=u*Math.sin(c);if(Math.abs(Math.abs(b)-1)<h)return 93;if(i=.5*this.a*this.k0*Math.log((1+b)/(1-b))+this.x0,n=u*Math.cos(c)/Math.sqrt(1-Math.pow(b,2)),b=Math.abs(n),b>=1){if(b-1>h)return 93;n=0}else n=Math.acos(n);s<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},i.inverse=function(t){var e,i,n,r,l=(t.x-this.x0)*(1/this.a),u=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+u/this.k0,i=a(e,this.es,this.en),Math.abs(i)<s){var p=Math.sin(i),d=Math.cos(i),f=Math.abs(d)>h?Math.tan(i):0,m=this.ep2*Math.pow(d,2),v=Math.pow(m,2),g=Math.pow(f,2),y=Math.pow(g,2);e=1-this.es*Math.pow(p,2);var x=l*Math.sqrt(e)/this.k0,b=Math.pow(x,2);e*=f,n=i-e*b/(1-this.es)*.5*(1-b/12*(5+3*g-9*m*g+m-4*v-b/30*(61+90*g-252*m*g+45*y+46*m-b/56*(1385+3633*g+4095*y+1574*y*g)))),r=o(this.long0+x*(1-b/6*(1+2*g+m-b/20*(5+28*g+24*y+8*m*g+6*m-b/42*(61+662*g+1320*y+720*y*g))))/d)}else n=s*c(u),r=0;else{var M=Math.exp(l/this.k0),_=.5*(M-1/M),w=this.lat0+u/this.k0,E=Math.cos(w);e=Math.sqrt((1-Math.pow(E,2))/(1+Math.pow(_,2))),n=Math.asin(e),u<0&&(n=-n),r=0===_&&0===E?0:o(Math.atan2(_,E)+this.long0)}return t.x=r,t.y=n,t},i.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/pj_enfn":18,"../common/pj_inv_mlfn":19,"../common/pj_mlfn":20,"../common/sign":22}],66:[function(t,e,i){var n=t("../common/adjust_zone"),r=t("./tmerc");i.dependsOn="tmerc",i.init=function(){var t=n(this.zone,this.long0);t&&(this.lat0=0,this.long0=(t+.5)*Math.PI/30-Math.PI,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,r.init.apply(this),this.forward=r.forward,this.inverse=r.inverse)},i.names=["Universal Transverse Mercator System","utm"]},{"../common/adjust_zone":6,"./tmerc":65}],67:[function(t,e,i){var n=t("../common/adjust_lon"),r=Math.PI/2,a=1e-10,o=t("../common/asinz");i.init=function(){this.R=this.a},i.forward=function(t){var e,i,s=t.x,h=t.y,c=n(s-this.long0);Math.abs(h)<=a&&(e=this.x0+this.R*c,i=this.y0);var l=o(2*Math.abs(h/Math.PI));(Math.abs(c)<=a||Math.abs(Math.abs(h)-r)<=a)&&(e=this.x0,i=h>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var u=.5*Math.abs(Math.PI/c-c/Math.PI),p=u*u,d=Math.sin(l),f=Math.cos(l),m=f/(d+f-1),v=m*m,g=m*(2/d-1),y=g*g,x=Math.PI*this.R*(u*(m-y)+Math.sqrt(p*(m-y)*(m-y)-(y+p)*(v-y)))/(y+p);c<0&&(x=-x),e=this.x0+x;var b=p+m;return x=Math.PI*this.R*(g*b-u*Math.sqrt((y+p)*(p+1)-b*b))/(y+p),i=h>=0?this.y0+x:this.y0-x,t.x=e,t.y=i,t},i.inverse=function(t){var e,i,r,o,s,h,c,l,u,p,d,f,m;return t.x-=this.x0,t.y-=this.y0,d=Math.PI*this.R,r=t.x/d,o=t.y/d,s=r*r+o*o,h=-Math.abs(o)*(1+s),c=h-2*o*o+r*r,l=-2*h+1+2*o*o+s*s,m=o*o/l+(2*c*c*c/l/l/l-9*h*c/l/l)/27,u=(h-c*c/3/l)/l,p=2*Math.sqrt(-u/3),d=3*m/u/p,Math.abs(d)>1&&(d=d>=0?1:-1),f=Math.acos(d)/3,i=t.y>=0?(-p*Math.cos(f+Math.PI/3)-c/3/l)*Math.PI:-(-p*Math.cos(f+Math.PI/3)-c/3/l)*Math.PI,e=Math.abs(r)<a?this.long0:n(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(r*r-o*o)+s*s))/2/r),t.x=e,t.y=i,t},i.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":7}],68:[function(t,e,i){function n(t,e){return(t.datum.datum_type===o||t.datum.datum_type===s)&&"WGS84"!==e.datumCode||(e.datum.datum_type===o||e.datum.datum_type===s)&&"WGS84"!==t.datumCode}var r=.017453292519943295,a=57.29577951308232,o=1,s=2,h=t("./datum_transform"),c=t("./adjust_axis"),l=t("./Proj"),u=t("./common/toPoint");e.exports=function t(e,i,o){var s;return Array.isArray(o)&&(o=u(o)),e.datum&&i.datum&&n(e,i)&&(s=new l("WGS84"),o=t(e,s,o),e=s),"enu"!==e.axis&&(o=c(e,!1,o)),"longlat"===e.projName?o={x:o.x*r,y:o.y*r}:(e.to_meter&&(o={x:o.x*e.to_meter,y:o.y*e.to_meter}),o=e.inverse(o)),e.from_greenwich&&(o.x+=e.from_greenwich),o=h(e.datum,i.datum,o),i.from_greenwich&&(o={x:o.x-i.grom_greenwich,y:o.y}),"longlat"===i.projName?o={x:o.x*a,y:o.y*a}:(o=i.forward(o),i.to_meter&&(o={x:o.x/i.to_meter,y:o.y/i.to_meter})),"enu"!==i.axis?c(i,!0,o):o}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":24,"./datum_transform":33}],69:[function(t,e,i){function n(t,e,i){t[e]=i.map(function(t){var e={};return r(t,e),e}).reduce(function(t,e){return c(t,e)},{})}function r(t,e){var i;return Array.isArray(t)?(i=t.shift(),"PARAMETER"===i&&(i=t.shift()),1===t.length?Array.isArray(t[0])?(e[i]={},r(t[0],e[i])):e[i]=t[0]:t.length?"TOWGS84"===i?e[i]=t:(e[i]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(i)>-1?(e[i]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[i].auth=t[2])):"SPHEROID"===i?(e[i]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[i].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(i)>-1?(t[0]=["name",t[0]],n(e,i,t)):t.every(function(t){return Array.isArray(t)})?n(e,i,t):r(t,e[i])):e[i]=!0,void 0):void(e[t]=!0)}function a(t,e){var i=e[0],n=e[1];!(i in t)&&n in t&&(t[i]=t[n],3===e.length&&(t[i]=e[2](t[i])))}function o(t){return t*h}function s(t){function e(e){var i=t.to_meter||1;return parseFloat(e,10)*i}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=parseFloat(t.UNIT.convert,10)*t.DATUM.SPHEROID.a):t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.GEOGCS.DATUM?t.datumCode=t.GEOGCS.DATUM.name.toLowerCase():t.datumCode=t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var i=function(e){return a(t,e)},n=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",o],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["alpha","azimuth",o],["srsCode","name"]];n.forEach(i),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=o(t.lat1>0?90:-90),t.lat_ts=t.lat1)}var h=.017453292519943295,c=t("./extend");e.exports=function(t,e){var i=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),n=i.shift(),a=i.shift();i.unshift(["name",a]),i.unshift(["type",n]),i.unshift("output");var o={};return r(i,o),s(o.output),c(e,o.output)}},{"./extend":36}],70:[function(t,e,i){function n(t){return t*(Math.PI/180)}function r(t){return 180*(t/Math.PI)}function a(t){var e,i,r,a,o,h,c,l,u,p=t.lat,d=t.lon,f=6378137,m=.00669438,v=.9996,g=n(p),y=n(d);u=Math.floor((d+180)/6)+1,180===d&&(u=60),p>=56&&p<64&&d>=3&&d<12&&(u=32),p>=72&&p<84&&(d>=0&&d<9?u=31:d>=9&&d<21?u=33:d>=21&&d<33?u=35:d>=33&&d<42&&(u=37)),e=6*(u-1)-180+3,l=n(e),i=m/(1-m),r=f/Math.sqrt(1-m*Math.sin(g)*Math.sin(g)),a=Math.tan(g)*Math.tan(g),o=i*Math.cos(g)*Math.cos(g),h=Math.cos(g)*(y-l),c=f*((1-m/4-3*m*m/64-5*m*m*m/256)*g-(3*m/8+3*m*m/32+45*m*m*m/1024)*Math.sin(2*g)+(15*m*m/256+45*m*m*m/1024)*Math.sin(4*g)-35*m*m*m/3072*Math.sin(6*g));var x=v*r*(h+(1-a+o)*h*h*h/6+(5-18*a+a*a+72*o-58*i)*h*h*h*h*h/120)+5e5,b=v*(c+r*Math.tan(g)*(h*h/2+(5-a+9*o+4*o*o)*h*h*h*h/24+(61-58*a+a*a+600*o-330*i)*h*h*h*h*h*h/720));return p<0&&(b+=1e7),{northing:Math.round(b),easting:Math.round(x),zoneNumber:u,zoneLetter:s(p)}}function o(t){var e=t.northing,i=t.easting,n=t.zoneLetter,a=t.zoneNumber;if(a<0||a>60)return null;var s,h,c,l,u,p,d,f,m,v,g=.9996,y=6378137,x=.00669438,b=(1-Math.sqrt(1-x))/(1+Math.sqrt(1-x)),M=i-5e5,_=e;n<"N"&&(_-=1e7),f=6*(a-1)-180+3,s=x/(1-x),d=_/g,m=d/(y*(1-x/4-3*x*x/64-5*x*x*x/256)),v=m+(3*b/2-27*b*b*b/32)*Math.sin(2*m)+(21*b*b/16-55*b*b*b*b/32)*Math.sin(4*m)+151*b*b*b/96*Math.sin(6*m),h=y/Math.sqrt(1-x*Math.sin(v)*Math.sin(v)),c=Math.tan(v)*Math.tan(v),l=s*Math.cos(v)*Math.cos(v),u=y*(1-x)/Math.pow(1-x*Math.sin(v)*Math.sin(v),1.5),p=M/(h*g);var w=v-h*Math.tan(v)/u*(p*p/2-(5+3*c+10*l-4*l*l-9*s)*p*p*p*p/24+(61+90*c+298*l+45*c*c-252*s-3*l*l)*p*p*p*p*p*p/720);w=r(w);var E=(p-(1+2*c+l)*p*p*p/6+(5-2*l+28*c-3*l*l+8*s+24*c*c)*p*p*p*p*p/120)/Math.cos(v);E=f+r(E);var T;if(t.accuracy){var S=o({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});T={top:S.lat,right:S.lon,bottom:w,left:E}}else T={lat:w,lon:E};return T}function s(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function h(t,e){var i="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+c(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+n.substr(n.length-5,e)}function c(t,e,i){var n=l(i),r=Math.floor(t/1e5),a=Math.floor(e/1e5)%20;return u(r,a,n)}function l(t){var e=t%v;return 0===e&&(e=v),e}function u(t,e,i){var n=i-1,r=g.charCodeAt(n),a=y.charCodeAt(n),o=r+t-1,s=a+e,h=!1;o>w&&(o=o-w+x-1,h=!0),(o===b||r<b&&o>b||(o>b||r<b)&&h)&&o++,(o===M||r<M&&o>M||(o>M||r<M)&&h)&&(o++,o===b&&o++),o>w&&(o=o-w+x-1),s>_?(s=s-_+x-1,h=!0):h=!1,(s===b||a<b&&s>b||(s>b||a<b)&&h)&&s++,(s===M||a<M&&s>M||(s>M||a<M)&&h)&&(s++,s===b&&s++),s>_&&(s=s-_+x-1);var c=String.fromCharCode(o)+String.fromCharCode(s);return c}function p(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,r="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,a++}var o=parseInt(r,10);if(0===a||a+3>i)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(a,a+=2);for(var h=l(o),c=d(n.charAt(0),h),u=f(n.charAt(1),h);u<m(s);)u+=2e6;var p=i-a;if(p%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var v,g,y,x,b,M=p/2,_=0,w=0;return M>0&&(v=1e5/Math.pow(10,M),g=t.substring(a,a+M),_=parseFloat(g)*v,y=t.substring(a+M),w=parseFloat(y)*v),x=_+c,b=w+u,{easting:x,northing:b,zoneLetter:s,zoneNumber:o,accuracy:v}}function d(t,e){for(var i=g.charCodeAt(e-1),n=1e5,r=!1;i!==t.charCodeAt(0);){if(i++,i===b&&i++,i===M&&i++,i>w){if(r)throw"Bad character: "+t;i=x,r=!0}n+=1e5}return n}function f(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=y.charCodeAt(e-1),n=0,r=!1;i!==t.charCodeAt(0);){if(i++,i===b&&i++,i===M&&i++,i>_){if(r)throw"Bad character: "+t;i=x,r=!0}n+=1e5}return n}function m(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var v=6,g="AJSAJS",y="AFAFAF",x=65,b=73,M=79,_=86,w=90;i.forward=function(t,e){return e=e||5,h(a({lat:t[1],lon:t[0]}),e)},i.inverse=function(t){var e=o(p(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},i.toPoint=function(t){var e=o(p(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}},{}]},{},[38])(38)});(function(t,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):e(t.THREE=t.THREE||{})})(this,function(t){function e(){}function i(t,e){this.x=t||0;this.y=e||0}function n(t,e,r,a,o,s,h,c,l,u){Object.defineProperty(this,"id",{value:lr++});this.uuid=cr.generateUUID();this.name="";this.image=void 0!==t?t:n.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==e?e:n.DEFAULT_MAPPING;this.wrapS=void 0!==r?r:1001;this.wrapT=void 0!==a?a:1001;this.magFilter=void 0!==o?o:1006;this.minFilter=void 0!==s?s:1008;this.anisotropy=void 0!==l?l:1;this.format=void 0!==h?h:1023;this.type=void 0!==c?c:1009;this.offset=new i(0,0);this.repeat=new i(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==u?u:3e3;this.version=0;this.onUpdate=null}function r(t,e,i,n){this.x=t||0;this.y=e||0;this.z=i||0;this.w=void 0!==n?n:1}function a(t,e,i){this.uuid=cr.generateUUID();this.width=t;this.height=e;this.scissor=new r(0,0,t,e);this.scissorTest=!1;this.viewport=new r(0,0,t,e);i=i||{};void 0===i.minFilter&&(i.minFilter=1006);this.texture=new n(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding);this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0;this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0;this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function o(t,e,i){a.call(this,t,e,i);this.activeMipMapLevel=this.activeCubeFace=0}function s(t,e,i,n){this._x=t||0;this._y=e||0;this._z=i||0;this._w=void 0!==n?n:1}function h(t,e,i){this.x=t||0;this.y=e||0;this.z=i||0}function c(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function l(t,e,i,r,a,o,s,h,c,l){t=void 0!==t?t:[];n.call(this,t,void 0!==e?e:301,i,r,a,o,s,h,c,l);this.flipY=!1}function u(t,e,i){var n=t[0];if(0>=n||0<n)return t;var r=e*i,a=dr[r];void 0===a&&(a=new Float32Array(r),dr[r]=a);if(0!==e)for(n.toArray(a,0),n=1,r=0;n!==e;++n)r+=i,t[n].toArray(a,r);return a}function p(t,e){var i=fr[e];void 0===i&&(i=new Int32Array(e),fr[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function d(t,e){t.uniform1f(this.addr,e)}function f(t,e){t.uniform1i(this.addr,e)}function m(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function v(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function g(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function y(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function x(t,e){t.uniformMatrix3fv(this.addr,!1,e.elements||e)}function b(t,e){t.uniformMatrix4fv(this.addr,!1,e.elements||e)}function M(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n);i.setTexture2D(e||ur,n)}function _(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n);i.setTextureCube(e||pr,n)}function w(t,e){t.uniform2iv(this.addr,e)}function E(t,e){t.uniform3iv(this.addr,e)}function T(t,e){t.uniform4iv(this.addr,e)}function S(t){switch(t){case 5126:return d;case 35664:return m;case 35665:return v;case 35666:return g;case 35674:return y;case 35675:return x;case 35676:return b;case 35678:return M;case 35680:return _;case 5124:case 35670:return f;case 35667:case 35671:return w;case 35668:case 35672:return E;case 35669:case 35673:return T}}function R(t,e){t.uniform1fv(this.addr,e)}function A(t,e){t.uniform1iv(this.addr,e)}function L(t,e){t.uniform2fv(this.addr,u(e,this.size,2))}function P(t,e){t.uniform3fv(this.addr,u(e,this.size,3))}function C(t,e){t.uniform4fv(this.addr,u(e,this.size,4))}function I(t,e){t.uniformMatrix2fv(this.addr,!1,u(e,this.size,4))}function N(t,e){t.uniformMatrix3fv(this.addr,!1,u(e,this.size,9))}function z(t,e){t.uniformMatrix4fv(this.addr,!1,u(e,this.size,16))}function U(t,e,i){var n=e.length,r=p(i,n);t.uniform1iv(this.addr,r);for(t=0;t!==n;++t)i.setTexture2D(e[t]||ur,r[t])}function D(t,e,i){var n=e.length,r=p(i,n);t.uniform1iv(this.addr,r);for(t=0;t!==n;++t)i.setTextureCube(e[t]||pr,r[t])}function O(t){switch(t){case 5126:return R;case 35664:return L;case 35665:return P;case 35666:return C;case 35674:return I;case 35675:return N;case 35676:return z;case 35678:return U;case 35680:return D;case 5124:case 35670:return A;case 35667:case 35671:return w;case 35668:case 35672:return E;case 35669:case 35673:return T}}function H(t,e,i){this.id=t;this.addr=i;this.setValue=S(e.type)}function F(t,e,i){this.id=t;this.addr=i;this.size=e.size;this.setValue=O(e.type)}function B(t){this.id=t;this.seq=[];this.map={}}function k(t,e,i){this.seq=[];this.map={};this.renderer=i;i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(var n=0;n<i;++n){var r=t.getActiveUniform(e,n),a=t.getUniformLocation(e,r.name),o=this,s=r.name,h=s.length;for(mr.lastIndex=0;;){var c=mr.exec(s),l=mr.lastIndex,u=c[1],p=c[3];"]"===c[2]&&(u|=0);if(void 0===p||"["===p&&l+2===h){s=o;r=void 0===p?new H(u,r,a):new F(u,r,a);s.seq.push(r);s.map[r.id]=r;break}else p=o.map[u],void 0===p&&(p=new B(u),u=o,o=p,u.seq.push(o),u.map[o.id]=o),o=p}}}function G(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}function V(t,e,i,r,a,o,s,h,c,l,u,p){n.call(this,null,o,s,h,c,l,r,a,u,p);this.image={data:t,width:e,height:i};this.magFilter=void 0!==c?c:1003;this.minFilter=void 0!==l?l:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}function j(t,e){this.min=void 0!==t?t:new i(Infinity,Infinity);this.max=void 0!==e?e:new i(-Infinity,-Infinity)}function W(t,e){var n,r,a,o,s,c,l,u,p,d,f=t.context,m=t.state,v,g,y,x,b,M;this.render=function(_,w,E){if(0!==e.length){_=new h;var T=E.w/E.z,S=.5*E.z,R=.5*E.w,A=16/E.w,L=new i(A*T,A),P=new h(1,1,0),C=new i(1,1),I=new j;I.min.set(E.x,E.y);I.max.set(E.x+(E.z-16),E.y+(E.w-16));if(void 0===x){var A=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),N=new Uint16Array([0,1,2,0,2,3]);v=f.createBuffer();g=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,v);f.bufferData(f.ARRAY_BUFFER,A,f.STATIC_DRAW);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,g);f.bufferData(f.ELEMENT_ARRAY_BUFFER,N,f.STATIC_DRAW);b=f.createTexture();M=f.createTexture();m.bindTexture(f.TEXTURE_2D,b);f.texImage2D(f.TEXTURE_2D,0,f.RGB,16,16,0,f.RGB,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);m.bindTexture(f.TEXTURE_2D,M);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,16,16,0,f.RGBA,f.UNSIGNED_BYTE,null);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);var A=y={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},N=f.createProgram(),z=f.createShader(f.FRAGMENT_SHADER),U=f.createShader(f.VERTEX_SHADER),D="precision "+t.getPrecision()+" float;\n";f.shaderSource(z,D+A.fragmentShader);f.shaderSource(U,D+A.vertexShader);f.compileShader(z);f.compileShader(U);f.attachShader(N,z);f.attachShader(N,U);f.linkProgram(N);x=N;p=f.getAttribLocation(x,"position");d=f.getAttribLocation(x,"uv");n=f.getUniformLocation(x,"renderType");r=f.getUniformLocation(x,"map");a=f.getUniformLocation(x,"occlusionMap");o=f.getUniformLocation(x,"opacity");s=f.getUniformLocation(x,"color");c=f.getUniformLocation(x,"scale");l=f.getUniformLocation(x,"rotation");u=f.getUniformLocation(x,"screenPosition")}f.useProgram(x);m.initAttributes();m.enableAttribute(p);m.enableAttribute(d);m.disableUnusedAttributes();f.uniform1i(a,0);f.uniform1i(r,1);f.bindBuffer(f.ARRAY_BUFFER,v);f.vertexAttribPointer(p,2,f.FLOAT,!1,16,0);f.vertexAttribPointer(d,2,f.FLOAT,!1,16,8);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,g);m.disable(f.CULL_FACE);m.setDepthWrite(!1);N=0;for(z=e.length;N<z;N++)if(A=16/E.w,L.set(A*T,A),U=e[N],_.set(U.matrixWorld.elements[12],U.matrixWorld.elements[13],U.matrixWorld.elements[14]),_.applyMatrix4(w.matrixWorldInverse),_.applyMatrix4(w.projectionMatrix),P.copy(_),C.x=E.x+P.x*S+S-8,C.y=E.y+P.y*R+R-8,!0===I.containsPoint(C)){m.activeTexture(f.TEXTURE0);m.bindTexture(f.TEXTURE_2D,null);m.activeTexture(f.TEXTURE1);m.bindTexture(f.TEXTURE_2D,b);f.copyTexImage2D(f.TEXTURE_2D,0,f.RGB,C.x,C.y,16,16,0);f.uniform1i(n,0);f.uniform2f(c,L.x,L.y);f.uniform3f(u,P.x,P.y,P.z);m.disable(f.BLEND);m.enable(f.DEPTH_TEST);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);m.activeTexture(f.TEXTURE0);m.bindTexture(f.TEXTURE_2D,M);f.copyTexImage2D(f.TEXTURE_2D,0,f.RGBA,C.x,C.y,16,16,0);f.uniform1i(n,1);m.disable(f.DEPTH_TEST);m.activeTexture(f.TEXTURE1);m.bindTexture(f.TEXTURE_2D,b);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);U.positionScreen.copy(P);U.customUpdateCallback?U.customUpdateCallback(U):U.updateLensFlares();f.uniform1i(n,2);m.enable(f.BLEND);for(var D=0,O=U.lensFlares.length;D<O;D++){var H=U.lensFlares[D];.001<H.opacity&&.001<H.scale&&(P.x=H.x,P.y=H.y,P.z=H.z,A=H.size*H.scale/E.w,L.x=A*T,L.y=A,f.uniform3f(u,P.x,P.y,P.z),f.uniform2f(c,L.x,L.y),f.uniform1f(l,H.rotation),f.uniform1f(o,H.opacity),f.uniform3f(s,H.color.r,H.color.g,H.color.b),m.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),t.setTexture2D(H.texture,1),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0))}}m.enable(f.CULL_FACE);m.enable(f.DEPTH_TEST);m.setDepthWrite(!0);t.resetGLState()}}}function q(t,e){var i,r,a,o,c,l,u,p,d,f,m,v,g,y,x,b,M;function _(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}var w=t.context,E=t.state,T,S,R,A,L=new h,P=new s,C=new h;this.render=function(s,h){if(0!==e.length){if(void 0===R){var I=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),N=new Uint16Array([0,1,2,0,2,3]);T=w.createBuffer();S=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,T);w.bufferData(w.ARRAY_BUFFER,I,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,S);w.bufferData(w.ELEMENT_ARRAY_BUFFER,N,w.STATIC_DRAW);var I=w.createProgram(),N=w.createShader(w.VERTEX_SHADER),z=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(N,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));w.shaderSource(z,["precision "+t.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));w.compileShader(N);w.compileShader(z);w.attachShader(I,N);w.attachShader(I,z);w.linkProgram(I);R=I;b=w.getAttribLocation(R,"position");M=w.getAttribLocation(R,"uv");i=w.getUniformLocation(R,"uvOffset");r=w.getUniformLocation(R,"uvScale");a=w.getUniformLocation(R,"rotation");o=w.getUniformLocation(R,"scale");c=w.getUniformLocation(R,"color");l=w.getUniformLocation(R,"map");u=w.getUniformLocation(R,"opacity");p=w.getUniformLocation(R,"modelViewMatrix");d=w.getUniformLocation(R,"projectionMatrix");f=w.getUniformLocation(R,"fogType");m=w.getUniformLocation(R,"fogDensity");v=w.getUniformLocation(R,"fogNear");g=w.getUniformLocation(R,"fogFar");y=w.getUniformLocation(R,"fogColor");x=w.getUniformLocation(R,"alphaTest");I=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");I.width=8;I.height=8;N=I.getContext("2d");N.fillStyle="white";N.fillRect(0,0,8,8);A=new n(I);A.needsUpdate=!0}w.useProgram(R);E.initAttributes();E.enableAttribute(b);E.enableAttribute(M);E.disableUnusedAttributes();E.disable(w.CULL_FACE);E.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,T);w.vertexAttribPointer(b,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(M,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,S);w.uniformMatrix4fv(d,!1,h.projectionMatrix.elements);E.activeTexture(w.TEXTURE0);w.uniform1i(l,0);N=I=0;(z=s.fog)?(w.uniform3f(y,z.color.r,z.color.g,z.color.b),z.isFog?(w.uniform1f(v,z.near),w.uniform1f(g,z.far),w.uniform1i(f,1),N=I=1):z.isFogExp2&&(w.uniform1f(m,z.density),w.uniform1i(f,2),N=I=2)):(w.uniform1i(f,0),N=I=0);for(var z=0,U=e.length;z<U;z++){var D=e[z];D.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,D.matrixWorld);D.z=-D.modelViewMatrix.elements[14]}e.sort(_);for(var O=[],z=0,U=e.length;z<U;z++){var D=e[z],H=D.material;!1!==H.visible&&(w.uniform1f(x,H.alphaTest),w.uniformMatrix4fv(p,!1,D.modelViewMatrix.elements),D.matrixWorld.decompose(L,P,C),O[0]=C.x,O[1]=C.y,D=0,s.fog&&H.fog&&(D=N),I!==D&&(w.uniform1i(f,D),I=D),null!==H.map?(w.uniform2f(i,H.map.offset.x,H.map.offset.y),w.uniform2f(r,H.map.repeat.x,H.map.repeat.y)):(w.uniform2f(i,0,0),w.uniform2f(r,1,1)),w.uniform1f(u,H.opacity),w.uniform3f(c,H.color.r,H.color.g,H.color.b),w.uniform1f(a,H.rotation),w.uniform2fv(o,O),E.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),E.setDepthTest(H.depthTest),E.setDepthWrite(H.depthWrite),H.map?t.setTexture2D(H.map,0):t.setTexture2D(A,0),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0))}E.enable(w.CULL_FACE);t.resetGLState()}}}function X(){Object.defineProperty(this,"id",{value:Mr++});this.uuid=cr.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Y(t){X.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Z(t){X.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(t)}function Q(t,e){this.min=void 0!==t?t:new h(Infinity,Infinity,Infinity);this.max=void 0!==e?e:new h(-Infinity,-Infinity,-Infinity)}function J(t,e){this.center=void 0!==t?t:new h;this.radius=void 0!==e?e:0}function K(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function $(t,e){this.normal=void 0!==t?t:new h(1,0,0);this.constant=void 0!==e?e:0}function tt(t,e,i,n,r,a){this.planes=[void 0!==t?t:new $,void 0!==e?e:new $,void 0!==i?i:new $,void 0!==n?n:new $,void 0!==r?r:new $,void 0!==a?a:new $]}function et(t,e,n,o){function s(e,i,n,r){var a=e.geometry,o;o=M;var s=e.customDepthMaterial;n&&(o=_,s=e.customDistanceMaterial);s?o=s:(s=!1,i.morphTargets&&(a&&a.isBufferGeometry?s=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(s=a.morphTargets&&0<a.morphTargets.length)),e=e.isSkinnedMesh&&i.skinning,a=0,s&&(a|=1),e&&(a|=2),o=o[a]);t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length&&(a=o.uuid,s=i.uuid,e=w[a],void 0===e&&(e={},w[a]=e),a=e[s],void 0===a&&(a=o.clone(),e[s]=a),o=a);o.visible=i.visible;o.wireframe=i.wireframe;s=i.side;I.renderSingleSided&&2==s&&(s=0);I.renderReverseSided&&(0===s?s=1:1===s&&(s=0));o.side=s;o.clipShadows=i.clipShadows;o.clippingPlanes=i.clippingPlanes;o.wireframeLinewidth=i.wireframeLinewidth;o.linewidth=i.linewidth;n&&void 0!==o.uniforms.lightPos&&o.uniforms.lightPos.value.copy(r);return o}function l(t,e,i){if(!1!==t.visible){0!==(t.layers.mask&e.layers.mask)&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(!1===t.frustumCulled||!0===d.intersectsObject(t))&&!0===t.material.visible&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),b.push(t));t=t.children;for(var n=0,r=t.length;n<r;n++)l(t[n],e,i)}}var u=t.context,p=t.state,d=new tt,f=new c,m=e.shadows,v=new i,g=new i(o.maxTextureSize,o.maxTextureSize),y=new h,x=new h,b=[],M=Array(4),_=Array(4),w={},E=[new h(1,0,0),new h(-1,0,0),new h(0,0,1),new h(0,0,-1),new h(0,1,0),new h(0,-1,0)],T=[new h(0,1,0),new h(0,1,0),new h(0,1,0),new h(0,1,0),new h(0,0,1),new h(0,0,-1)],S=[new r,new r,new r,new r,new r,new r];e=new Z;e.depthPacking=3201;e.clipping=!0;o=br.distanceRGBA;for(var R=vr.clone(o.uniforms),A=0;4!==A;++A){var L=0!==(A&1),P=0!==(A&2),C=e.clone();C.morphTargets=L;C.skinning=P;M[A]=C;L=new Y({defines:{USE_SHADOWMAP:""},uniforms:R,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,morphTargets:L,skinning:P,clipping:!0});_[A]=L}var I=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(e,i){if(!1!==I.enabled&&(!1!==I.autoUpdate||!1!==I.needsUpdate)&&0!==m.length){p.buffers.color.setClear(1,1,1,1);p.disable(u.BLEND);p.setDepthTest(!0);p.setScissorTest(!1);for(var r,o,h=0,c=m.length;h<c;h++){var M=m[h],_=M.shadow;if(void 0===_)console.warn("THREE.WebGLShadowMap:",M,"has no shadow.");else{var w=_.camera;v.copy(_.mapSize);v.min(g);if(M&&M.isPointLight){r=6;o=!0;var R=v.x,A=v.y;S[0].set(2*R,A,R,A);S[1].set(0,A,R,A);S[2].set(3*R,A,R,A);S[3].set(R,A,R,A);S[4].set(3*R,0,R,A);S[5].set(R,0,R,A);v.x*=4;v.y*=2}else r=1,o=!1;null===_.map&&(_.map=new a(v.x,v.y,{minFilter:1003,magFilter:1003,format:1023}),w.updateProjectionMatrix());_.isSpotLightShadow&&_.update(M);_&&_.isRectAreaLightShadow&&_.update(M);R=_.map;_=_.matrix;x.setFromMatrixPosition(M.matrixWorld);w.position.copy(x);t.setRenderTarget(R);t.clear();for(R=0;R<r;R++){o?(y.copy(w.position),y.add(E[R]),w.up.copy(T[R]),w.lookAt(y),p.viewport(S[R])):(y.setFromMatrixPosition(M.target.matrixWorld),w.lookAt(y));w.updateMatrixWorld();w.matrixWorldInverse.getInverse(w.matrixWorld);_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);_.multiply(w.projectionMatrix);_.multiply(w.matrixWorldInverse);f.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse);d.setFromMatrix(f);b.length=0;l(e,i,w);for(var A=0,L=b.length;A<L;A++){var P=b[A],C=n.update(P),N=P.material;if(N&&N.isMultiMaterial)for(var z=C.groups,N=N.materials,U=0,D=z.length;U<D;U++){var O=z[U],H=N[O.materialIndex];!0===H.visible&&(H=s(P,H,o,x),t.renderBufferDirect(w,null,C,H,P,O))}else H=s(P,N,o,x),t.renderBufferDirect(w,null,C,H,P,null)}}}}r=t.getClearColor();o=t.getClearAlpha();t.setClearColor(r,o);I.needsUpdate=!1}}}function it(t,e){this.origin=void 0!==t?t:new h;this.direction=void 0!==e?e:new h}function nt(t,e,i,n){this._x=t||0;this._y=e||0;this._z=i||0;this._order=n||nt.DefaultOrder}function rt(){this.mask=1}function at(){Object.defineProperty(this,"id",{value:_r++});this.uuid=cr.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=at.DefaultUp.clone();var t=new h,e=new nt,i=new s,n=new h(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)});i.onChange(function(){e.setFromQuaternion(i,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new c},normalMatrix:{value:new K}});this.matrix=new c;this.matrixWorld=new c;this.matrixAutoUpdate=at.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new rt;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=function(){};this.onAfterRender=function(){}}function ot(t,e){this.start=void 0!==t?t:new h;this.end=void 0!==e?e:new h}function st(t,e,i){this.a=void 0!==t?t:new h;this.b=void 0!==e?e:new h;this.c=void 0!==i?i:new h}function ht(t,e,i,n,r,a){this.a=t;this.b=e;this.c=i;this.normal=n&&n.isVector3?n:new h;this.vertexNormals=Array.isArray(n)?n:[];this.color=r&&r.isColor?r:new G;this.vertexColors=Array.isArray(r)?r:[];this.materialIndex=void 0!==a?a:0}function ct(t){X.call(this);this.type="MeshBasicMaterial";this.color=new G(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(t)}function lt(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=cr.generateUUID();this.array=t;this.itemSize=e;this.count=void 0!==t?t.length/e:0;this.normalized=!0===i;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function ut(t,e){lt.call(this,new Int8Array(t),e)}function pt(t,e){lt.call(this,new Uint8Array(t),e)}function dt(t,e){lt.call(this,new Uint8ClampedArray(t),e)}function ft(t,e){lt.call(this,new Int16Array(t),e)}function mt(t,e){lt.call(this,new Uint16Array(t),e)}function vt(t,e){lt.call(this,new Int32Array(t),e)}function gt(t,e){lt.call(this,new Uint32Array(t),e)}function yt(t,e){lt.call(this,new Float32Array(t),e)}function xt(t,e){lt.call(this,new Float64Array(t),e)}function bt(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function Mt(t){for(var e=t.length,i=-Infinity;e--;)t[e]>i&&(i=t[e]);return i}function _t(){Object.defineProperty(this,"id",{value:wr++});this.uuid=cr.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function wt(){Object.defineProperty(this,"id",{value:wr++});this.uuid=cr.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Et(t,e){at.call(this);this.type="Mesh";this.geometry=void 0!==t?t:new wt;this.material=void 0!==e?e:new ct({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Tt(t,e,i,n,r,a){_t.call(this);this.type="BoxGeometry";this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};this.fromBufferGeometry(new St(t,e,i,n,r,a));this.mergeVertices()}function St(t,e,i,n,r,a){function o(t,e,i,n,r,a,o,m,v,g,y){var x=a/v,b=o/g,M=a/2,_=o/2,w=m/2;o=v+1;var E=g+1,T=a=0,S,R,A=new h;for(R=0;R<E;R++){var L=R*b-_;for(S=0;S<o;S++)A[t]=(S*x-M)*n,A[e]=L*r,A[i]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=0<m?1:-1,u.push(A.x,A.y,A.z),p.push(S/v),p.push(1-R/g),a+=1}for(R=0;R<g;R++)for(S=0;S<v;S++)t=d+S+o*(R+1),e=d+(S+1)+o*(R+1),i=d+(S+1)+o*R,c.push(d+S+o*R,t,i),c.push(t,e,i),T+=6;s.addGroup(f,T,y);f+=T;d+=a}wt.call(this);this.type="BoxBufferGeometry";this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};var s=this;n=Math.floor(n)||1;r=Math.floor(r)||1;a=Math.floor(a)||1;var c=[],l=[],u=[],p=[],d=0,f=0;o("z","y","x",-1,-1,i,e,t,a,r,0);o("z","y","x",1,-1,i,e,-t,a,r,1);o("x","z","y",1,1,t,i,e,n,a,2);o("x","z","y",1,-1,t,i,-e,n,a,3);o("x","y","z",1,-1,t,e,i,n,r,4);o("x","y","z",-1,-1,t,e,-i,n,r,5);this.setIndex(c);this.addAttribute("position",new yt(l,3));this.addAttribute("normal",new yt(u,3));this.addAttribute("uv",new yt(p,2))}function Rt(t,e,i,n){_t.call(this);this.type="PlaneGeometry";this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};this.fromBufferGeometry(new At(t,e,i,n))}function At(t,e,i,n){wt.call(this);this.type="PlaneBufferGeometry";this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r=t/2,a=e/2;i=Math.floor(i)||1;n=Math.floor(n)||1;var o=i+1,s=n+1,h=t/i,c=e/n,l=[],u=[],p=[],d=[];for(t=0;t<s;t++){var f=t*c-a;for(e=0;e<o;e++)u.push(e*h-r,-f,0),p.push(0,0,1),d.push(e/i),d.push(1-t/n)}for(t=0;t<n;t++)for(e=0;e<i;e++)r=e+o*(t+1),a=e+1+o*(t+1),s=e+1+o*t,l.push(e+o*t,r,s),l.push(r,a,s);this.setIndex(l);this.addAttribute("position",new yt(u,3));this.addAttribute("normal",new yt(p,3));this.addAttribute("uv",new yt(d,2))}function Lt(){at.call(this);this.type="Camera";this.matrixWorldInverse=new c;this.projectionMatrix=new c}function Pt(t,e,i,n){Lt.call(this);this.type="PerspectiveCamera";this.fov=void 0!==t?t:50;this.zoom=1;this.near=void 0!==i?i:.1;this.far=void 0!==n?n:2e3;this.focus=10;this.aspect=void 0!==e?e:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Ct(t,e,i,n,r,a){Lt.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=t;this.right=e;this.top=i;this.bottom=n;this.near=void 0!==r?r:.1;this.far=void 0!==a?a:2e3;this.updateProjectionMatrix()}function It(t,e,i){var n,r,a;return{setMode:function(t){n=t},setIndex:function(i){i.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(r=t.UNSIGNED_INT,a=4):i.array instanceof Uint16Array?(r=t.UNSIGNED_SHORT,a=2):(r=t.UNSIGNED_BYTE,a=1)},render:function(e,o){t.drawElements(n,o,r,e*a);i.calls++;i.vertices+=o;n===t.TRIANGLES&&(i.faces+=o/3)},renderInstances:function(o,s,h){var c=e.get("ANGLE_instanced_arrays");null===c?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(c.drawElementsInstancedANGLE(n,h,r,s*a,o.maxInstancedCount),i.calls++,i.vertices+=h*o.maxInstancedCount,n===t.TRIANGLES&&(i.faces+=o.maxInstancedCount*h/3))}}}function Nt(t,e,i){var n;return{setMode:function(t){n=t},render:function(e,r){t.drawArrays(n,e,r);i.calls++;i.vertices+=r;n===t.TRIANGLES&&(i.faces+=r/3)},renderInstances:function(r){var a=e.get("ANGLE_instanced_arrays");if(null===a)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var o=r.attributes.position,o=o.isInterleavedBufferAttribute?o.data.count:o.count;a.drawArraysInstancedANGLE(n,0,o,r.maxInstancedCount);i.calls++;i.vertices+=o*r.maxInstancedCount;n===t.TRIANGLES&&(i.faces+=r.maxInstancedCount*o/3)}}}}function zt(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new h,color:new G,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":n={position:new h,direction:new h,color:new G,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":n={position:new h,color:new G,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"HemisphereLight":n={direction:new h,skyColor:new G,groundColor:new G};break;case"RectAreaLight":n={color:new G,position:new h,halfWidth:new h,halfHeight:new h}}return t[e.id]=n}}}function Ut(t){t=t.split("\n");for(var e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function Dt(t,e,i){var n=t.createShader(e);t.shaderSource(n,i);t.compileShader(n);!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),Ut(i));return n}function Ot(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+t)}}function Ht(t,e){var i=Ot(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Ft(t,e){var i=Ot(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Bt(t,e){var i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="Uncharted2";break;case 4:i="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function kt(t,e,i){t=t||{};return[t.derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vt).join("\n")}function Gt(t){var e=[],i;for(i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}function Vt(t){return""!==t}function jt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Wt(t){return t.replace(/#include +<([\w\d.]+)>/g,function(t,e){var i=gr[e];if(void 0===i)throw Error("Can not resolve #include <"+e+">");return Wt(i)})}function qt(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){t="";for(e=parseInt(e);e<parseInt(i);e++)t+=n.replace(/\[ i \]/g,"[ "+e+" ]");return t})}function Xt(t,e,i,n){var r=t.context,a=i.extensions,o=i.defines,s=i.__webglShader.vertexShader,h=i.__webglShader.fragmentShader,c="SHADOWMAP_TYPE_BASIC";1===n.shadowMapType?c="SHADOWMAP_TYPE_PCF":2===n.shadowMapType&&(c="SHADOWMAP_TYPE_PCF_SOFT");var l="ENVMAP_TYPE_CUBE",u="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(i.envMap.mapping){case 301:case 302:l="ENVMAP_TYPE_CUBE";break;case 306:case 307:l="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:l="ENVMAP_TYPE_EQUIREC";break;case 305:l="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case 302:case 304:u="ENVMAP_MODE_REFRACTION"}switch(i.combine){case 0:p="ENVMAP_BLENDING_MULTIPLY";break;case 1:p="ENVMAP_BLENDING_MIX";break;case 2:p="ENVMAP_BLENDING_ADD"}}var d=0<t.gammaFactor?t.gammaFactor:1,a=kt(a,n,t.extensions),f=Gt(o),m=r.createProgram();i.isRawShaderMaterial?(o=[f,"\n"].filter(Vt).join("\n"),c=[a,f,"\n"].filter(Vt).join("\n")):(o=["precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,f,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Vt).join("\n"),c=[a,"precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(n.numClippingPlanes-n.numClipIntersection),n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",n.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?gr.tonemapping_pars_fragment:"",0!==n.toneMapping?Bt("toneMapping",n.toneMapping):"",n.outputEncoding||n.mapEncoding||n.envMapEncoding||n.emissiveMapEncoding?gr.encodings_pars_fragment:"",n.mapEncoding?Ht("mapTexelToLinear",n.mapEncoding):"",n.envMapEncoding?Ht("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?Ht("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?Ft("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Vt).join("\n"));s=Wt(s,n);s=jt(s,n);h=Wt(h,n);h=jt(h,n);i.isShaderMaterial||(s=qt(s),h=qt(h));h=c+h;s=Dt(r,r.VERTEX_SHADER,o+s);h=Dt(r,r.FRAGMENT_SHADER,h);r.attachShader(m,s);r.attachShader(m,h);void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position");r.linkProgram(m);n=r.getProgramInfoLog(m);l=r.getShaderInfoLog(s);u=r.getShaderInfoLog(h);d=p=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))p=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(m,r.VALIDATE_STATUS),"gl.getProgramInfoLog",n,l,u);else if(""!==n)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",n);else if(""===l||""===u)d=!1;d&&(this.diagnostics={runnable:p,material:i,programLog:n,vertexShader:{log:l,prefix:o},fragmentShader:{log:u,prefix:c}});r.deleteShader(s);r.deleteShader(h);var v;this.getUniforms=function(){void 0===v&&(v=new k(r,m,t));return v};var g;this.getAttributes=function(){if(void 0===g){for(var t={},e=r.getProgramParameter(m,r.ACTIVE_ATTRIBUTES),i=0;i<e;i++){var n=r.getActiveAttrib(m,i).name;t[n]=r.getAttribLocation(m,n)}g=t}return g};this.destroy=function(){r.deleteProgram(m);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=Er++;this.code=e;this.usedTimes=1;this.program=m;this.vertexShader=s;this.fragmentShader=h;return this}function Yt(t,e){function i(t,e){var i;t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=t.texture.encoding):i=3e3;3e3===i&&e&&(i=3007);return i}var n=[],r={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking".split(" ");this.getParameters=function(n,a,o,s,h,c){var l=r[n.type],u;e.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture?u=1024:(u=Math.floor((e.maxVertexUniforms-20)/4),void 0!==c&&c&&c.isSkinnedMesh&&(u=Math.min(c.skeleton.bones.length,u),u<c.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+c.skeleton.bones.length+", this GPU supports just "+u+" (try OpenGL instead of ANGLE)")));var p=t.getPrecision();null!==n.precision&&(p=e.getMaxPrecision(n.precision),p!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",p,"instead."));var d=t.getCurrentRenderTarget();return{shaderID:l,precision:p,supportsVertexTextures:e.vertexTextures,outputEncoding:i(d?d.texture:null,t.gammaOutput),map:!!n.map,mapEncoding:i(n.map,t.gammaInput),envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,envMapEncoding:i(n.envMap,t.gammaInput),envMapCubeUV:!!n.envMap&&(306===n.envMap.mapping||307===n.envMap.mapping),lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:i(n.emissiveMap,t.gammaInput),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,combine:n.combine,vertexColors:n.vertexColors,fog:!!o,useFog:n.fog,fogExp:o&&o.isFogExp2,flatShading:1===n.shading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:n.skinning,maxBones:u,useVertexTexture:e.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numClippingPlanes:s,numClipIntersection:h,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&0<a.shadows.length,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:2===n.side,flipSided:1===n.side,depthPacking:void 0!==n.depthPacking?n.depthPacking:!1}};this.getProgramCode=function(t,e){var i=[];e.shaderID?i.push(e.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader));if(void 0!==t.defines)for(var n in t.defines)i.push(n),i.push(t.defines[n]);for(n=0;n<a.length;n++)i.push(e[a[n]]);return i.join()};this.acquireProgram=function(e,i,r){for(var a,o=0,s=n.length;o<s;o++){var h=n[o];if(h.code===r){a=h;++a.usedTimes;break}}void 0===a&&(a=new Xt(t,r,e,i),n.push(a));return a};this.releaseProgram=function(t){if(0===--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1];n.pop();t.destroy()}};this.programs=n}function Zt(t,e,i){function n(t){var o=t.target;t=a[o.id];null!==t.index&&r(t.index);var s=t.attributes,h;for(h in s)r(s[h]);o.removeEventListener("dispose",n);delete a[o.id];h=e.get(o);h.wireframe&&r(h.wireframe);e["delete"](o);o=e.get(t);o.wireframe&&r(o.wireframe);e["delete"](t);i.memory.geometries--}function r(i){var n;n=i.isInterleavedBufferAttribute?e.get(i.data).__webglBuffer:e.get(i).__webglBuffer;void 0!==n&&(t.deleteBuffer(n),i.isInterleavedBufferAttribute?e["delete"](i.data):e["delete"](i))}var a={};return{get:function(t){var e=t.geometry;if(void 0!==a[e.id])return a[e.id];e.addEventListener("dispose",n);var r;e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new wt).setFromObject(t)),r=e._bufferGeometry);a[e.id]=r;i.memory.geometries++;return r}}}function Qt(t,e,i){function n(i,n){var r=i.isInterleavedBufferAttribute?i.data:i,a=e.get(r);if(void 0===a.__webglBuffer){a.__webglBuffer=t.createBuffer();t.bindBuffer(n,a.__webglBuffer);t.bufferData(n,r.array,r.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW);var o=t.FLOAT,s=r.array;s instanceof Float32Array?o=t.FLOAT:s instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):s instanceof Uint16Array?o=t.UNSIGNED_SHORT:s instanceof Int16Array?o=t.SHORT:s instanceof Uint32Array?o=t.UNSIGNED_INT:s instanceof Int32Array?o=t.INT:s instanceof Int8Array?o=t.BYTE:s instanceof Uint8Array&&(o=t.UNSIGNED_BYTE);a.bytesPerElement=s.BYTES_PER_ELEMENT;a.type=o;a.version=r.version;r.onUploadCallback()}else a.version!==r.version&&(t.bindBuffer(n,a.__webglBuffer),!1===r.dynamic?t.bufferData(n,r.array,t.STATIC_DRAW):-1===r.updateRange.count?t.bufferSubData(n,0,r.array):0===r.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count)),r.updateRange.count=0),a.version=r.version)}var r=new Zt(t,e,i);return{getAttributeBuffer:function(t){return t.isInterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer},getAttributeProperties:function(t){return t.isInterleavedBufferAttribute?e.get(t.data):e.get(t)},getWireframeAttribute:function(i){var r=e.get(i);if(void 0!==r.wireframe)return r.wireframe;var a=[],o=i.index;i=i.attributes;if(null!==o){o=o.array;i=0;for(var s=o.length;i<s;i+=3){var h=o[i+0],c=o[i+1],l=o[i+2];a.push(h,c,c,l,l,h)}}else for(o=i.position.array,i=0,s=o.length/3-1;i<s;i+=3)h=i+0,c=i+1,l=i+2,a.push(h,c,c,l,l,h);a=new(65535<Mt(a)?gt:mt)(a,1);n(a,t.ELEMENT_ARRAY_BUFFER);return r.wireframe=a},update:function(e){var i=r.get(e);e.geometry.isGeometry&&i.updateFromObject(e);e=i.index;var a=i.attributes;null!==e&&n(e,t.ELEMENT_ARRAY_BUFFER);for(var o in a)n(a[o],t.ARRAY_BUFFER);e=i.morphAttributes;for(o in e)for(var a=e[o],s=0,h=a.length;s<h;s++)n(a[s],t.ARRAY_BUFFER);return i}}}function Jt(t,e,i,n,r,a,o){function s(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(t.width*i);n.height=Math.floor(t.height*i);n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height);console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t);return n}return t}function h(t){return cr.isPowerOfTwo(t.width)&&cr.isPowerOfTwo(t.height)}function c(e){return 1003===e||1004===e||1005===e?t.NEAREST:t.LINEAR}function l(e){e=e.target;e.removeEventListener("dispose",l);t:{var i=n.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)break t;t.deleteTexture(i.__webglTexture)}n["delete"](e)}v.textures--}function u(e){e=e.target;e.removeEventListener("dispose",u);var i=n.get(e),r=n.get(e.texture);if(e){void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(r=0;6>r;r++)t.deleteFramebuffer(i.__webglFramebuffer[r]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[r]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);n["delete"](e.texture);n["delete"](e)}v.textures--}function p(e,o){var c=n.get(e);if(0<e.version&&c.__version!==e.version){var u=e.image;if(void 0===u)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else if(!1===u.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e);else{void 0===c.__webglInit&&(c.__webglInit=!0,e.addEventListener("dispose",l),c.__webglTexture=t.createTexture(),v.textures++);i.activeTexture(t.TEXTURE0+o);i.bindTexture(t.TEXTURE_2D,c.__webglTexture);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);t.pixelStorei(t.UNPACK_ALIGNMENT,e.unpackAlignment);var p=s(e.image,r.maxTextureSize);if((1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)&&!1===h(p))if(u=p,u instanceof HTMLImageElement||u instanceof HTMLCanvasElement){var f=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");f.width=cr.nearestPowerOfTwo(u.width);f.height=cr.nearestPowerOfTwo(u.height);f.getContext("2d").drawImage(u,0,0,f.width,f.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+u.width+"x"+u.height+"). Resized to "+f.width+"x"+f.height,u);p=f}else p=u;var u=h(p),f=a(e.format),m=a(e.type);d(t.TEXTURE_2D,e,u);var y=e.mipmaps;if(e.isDepthTexture){y=t.DEPTH_COMPONENT;if(1015===e.type){if(!g)throw Error("Float Depth Texture only supported in WebGL2.0");y=t.DEPTH_COMPONENT32F}else g&&(y=t.DEPTH_COMPONENT16);1026===e.format&&y===t.DEPTH_COMPONENT&&1012!==e.type&&1014!==e.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=1012,m=a(e.type));1027===e.format&&(y=t.DEPTH_STENCIL,1020!==e.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=1020,m=a(e.type)));i.texImage2D(t.TEXTURE_2D,0,y,p.width,p.height,0,f,m,null)}else if(e.isDataTexture)if(0<y.length&&u){for(var x=0,b=y.length;x<b;x++)p=y[x],i.texImage2D(t.TEXTURE_2D,x,f,p.width,p.height,0,f,m,p.data);e.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,f,p.width,p.height,0,f,m,p.data);else if(e.isCompressedTexture)for(x=0,b=y.length;x<b;x++)p=y[x],1023!==e.format&&1022!==e.format?-1<i.getCompressedTextureFormats().indexOf(f)?i.compressedTexImage2D(t.TEXTURE_2D,x,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(t.TEXTURE_2D,x,f,p.width,p.height,0,f,m,p.data);else if(0<y.length&&u){x=0;for(b=y.length;x<b;x++)p=y[x],i.texImage2D(t.TEXTURE_2D,x,f,f,m,p);e.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,f,f,m,p);e.generateMipmaps&&u&&t.generateMipmap(t.TEXTURE_2D);c.__version=e.version;if(e.onUpdate)e.onUpdate(e);return}}i.activeTexture(t.TEXTURE0+o);i.bindTexture(t.TEXTURE_2D,c.__webglTexture)}function d(i,o,s){s?(t.texParameteri(i,t.TEXTURE_WRAP_S,a(o.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,a(o.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,a(o.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,a(o.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",o),t.texParameteri(i,t.TEXTURE_MAG_FILTER,c(o.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,c(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",o));!(s=e.get("EXT_texture_filter_anisotropic"))||1015===o.type&&null===e.get("OES_texture_float_linear")||1016===o.type&&null===e.get("OES_texture_half_float_linear")||!(1<o.anisotropy||n.get(o).__currentAnisotropy)||(t.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}function f(e,r,o,s){var h=a(r.texture.format),c=a(r.texture.type);i.texImage2D(s,0,h,r.width,r.height,0,h,c,null);t.bindFramebuffer(t.FRAMEBUFFER,e);t.framebufferTexture2D(t.FRAMEBUFFER,o,s,n.get(r.texture).__webglTexture,0);t.bindFramebuffer(t.FRAMEBUFFER,null)}function m(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e);i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height);t.bindRenderbuffer(t.RENDERBUFFER,null)}var v=o.memory,g="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;this.setTexture2D=p;this.setTextureCube=function(e,o){var c=n.get(e);if(6===e.image.length)if(0<e.version&&c.__version!==e.version){c.__image__webglTextureCube||(e.addEventListener("dispose",l),c.__image__webglTextureCube=t.createTexture(),v.textures++);i.activeTexture(t.TEXTURE0+o);i.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var u=e&&e.isCompressedTexture,p=e.image[0]&&e.image[0].isDataTexture,f=[],m=0;6>m;m++)f[m]=u||p?p?e.image[m].image:e.image[m]:s(e.image[m],r.maxCubemapSize);var g=h(f[0]),y=a(e.format),x=a(e.type);d(t.TEXTURE_CUBE_MAP,e,g);for(m=0;6>m;m++)if(u)for(var b,M=f[m].mipmaps,_=0,w=M.length;_<w;_++)b=M[_],1023!==e.format&&1022!==e.format?-1<i.getCompressedTextureFormats().indexOf(y)?i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,_,y,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,_,y,b.width,b.height,0,y,x,b.data);else p?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,y,f[m].width,f[m].height,0,y,x,f[m].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,y,y,x,f[m]);e.generateMipmaps&&g&&t.generateMipmap(t.TEXTURE_CUBE_MAP);c.__version=e.version;if(e.onUpdate)e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)};this.setTextureCubeDynamic=function(e,r){i.activeTexture(t.TEXTURE0+r);i.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)};this.setupRenderTarget=function(e){var r=n.get(e),a=n.get(e.texture);e.addEventListener("dispose",u);a.__webglTexture=t.createTexture();v.textures++;var o=!0===e.isWebGLRenderTargetCube,s=h(e);if(o){r.__webglFramebuffer=[];for(var c=0;6>c;c++)r.__webglFramebuffer[c]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(o){i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture);d(t.TEXTURE_CUBE_MAP,e.texture,s);for(c=0;6>c;c++)f(r.__webglFramebuffer[c],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+c);e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_CUBE_MAP);i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,a.__webglTexture),d(t.TEXTURE_2D,e.texture,s),f(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);if(e.depthBuffer){r=n.get(e);a=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(a)throw Error("target.depthTexture not supported in Cube render targets");if(e&&e.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer);if(!e.depthTexture||!e.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0);p(e.depthTexture,0);r=n.get(e.depthTexture).__webglTexture;if(1026===e.depthTexture.format)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else if(1027===e.depthTexture.format)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0);else throw Error("Unknown depthTexture format")}else if(a)for(r.__webglDepthbuffer=[],a=0;6>a;a++)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=t.createRenderbuffer(),m(r.__webglDepthbuffer[a],e);else t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),m(r.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(e){var r=e.texture;r.generateMipmaps&&h(e)&&1003!==r.minFilter&&1006!==r.minFilter&&(e=e&&e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,r=n.get(r).__webglTexture,i.bindTexture(e,r),t.generateMipmap(e),i.bindTexture(e,null))}}function Kt(){var t={};return{get:function(e){e=e.uuid;var i=t[e];void 0===i&&(i={},t[e]=i);return i},delete:function(e){delete t[e.uuid]},clear:function(){t={}}}}function $t(t,e,i){function n(e,i,n){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a);t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST);t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(e=0;e<n;e++)t.texImage2D(i+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}function a(e){!0!==x[e]&&(t.enable(e),x[e]=!0)}function o(e){!1!==x[e]&&(t.disable(e),x[e]=!1)}function s(e,n,r,s,h,c,l,u){0!==e?a(t.BLEND):o(t.BLEND);if(e!==M||u!==A)2===e?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):3===e?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):4===e?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),M=e,A=u;if(5===e){h=h||n;c=c||r;l=l||s;if(n!==_||h!==T)t.blendEquationSeparate(i(n),i(h)),_=n,T=h;if(r!==w||s!==E||c!==S||l!==R)t.blendFuncSeparate(i(r),i(s),i(c),i(l)),w=r,E=s,S=c,R=l}else R=S=T=E=w=_=null}function h(t){d.setFunc(t)}function c(e){L!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),L=e)}function l(e){0!==e?(a(t.CULL_FACE),e!==P&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):o(t.CULL_FACE);P=e}function u(e){void 0===e&&(e=t.TEXTURE0+U-1);O!==e&&(t.activeTexture(e),O=e)}var p=new function(){var e=!1,i=new r,n=null,a=new r;return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,o,s){!0===s&&(e*=o,n*=o,r*=o);i.set(e,n,r,o);!1===a.equals(i)&&(t.clearColor(e,n,r,o),a.copy(i))},reset:function(){e=!1;n=null;a.set(0,0,0,1)}}},d=new function(){var e=!1,i=null,n=null,r=null;return{setTest:function(e){e?a(t.DEPTH_TEST):o(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1;r=n=i=null}}},f=new function(){var e=!1,i=null,n=null,r=null,s=null,h=null,c=null,l=null,u=null;return{setTest:function(e){e?a(t.STENCIL_TEST):o(t.STENCIL_TEST)},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){if(n!==e||r!==i||s!==a)t.stencilFunc(e,i,a),n=e,r=i,s=a},setOp:function(e,i,n){if(h!==e||c!==i||l!==n)t.stencilOp(e,i,n),h=e,c=i,l=n},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1;u=l=c=h=s=r=n=i=null}}},m=t.getParameter(t.MAX_VERTEX_ATTRIBS),v=new Uint8Array(m),g=new Uint8Array(m),y=new Uint8Array(m),x={},b=null,M=null,_=null,w=null,E=null,T=null,S=null,R=null,A=!1,L=null,P=null,C=null,I=null,N=null,z=null,U=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),m=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),D=1<=parseFloat(m),O=null,H={},F=new r,B=new r,k={};k[t.TEXTURE_2D]=n(t.TEXTURE_2D,t.TEXTURE_2D,1);k[t.TEXTURE_CUBE_MAP]=n(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:p,depth:d,stencil:f},init:function(){p.setClear(0,0,0,1);d.setClear(1);f.setClear(0);a(t.DEPTH_TEST);h(3);c(!1);l(1);a(t.CULL_FACE);a(t.BLEND);s(1)},initAttributes:function(){for(var t=0,e=v.length;t<e;t++)v[t]=0},enableAttribute:function(i){v[i]=1;0===g[i]&&(t.enableVertexAttribArray(i),g[i]=1);0!==y[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),y[i]=0)},enableAttributeAndDivisor:function(e,i,n){v[e]=1;0===g[e]&&(t.enableVertexAttribArray(e),g[e]=1);y[e]!==i&&(n.vertexAttribDivisorANGLE(e,i),y[e]=i)},disableUnusedAttributes:function(){for(var e=0,i=g.length;e!==i;++e)g[e]!==v[e]&&(t.disableVertexAttribArray(e),g[e]=0)},enable:a,disable:o,getCompressedTextureFormats:function(){if(null===b&&(b=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)b.push(i[n]);return b},setBlending:s,setColorWrite:function(t){p.setMask(t)},setDepthTest:function(t){d.setTest(t)},setDepthWrite:function(t){d.setMask(t)},setDepthFunc:h,setStencilTest:function(t){f.setTest(t)},setStencilWrite:function(t){f.setMask(t)},setStencilFunc:function(t,e,i){f.setFunc(t,e,i)},setStencilOp:function(t,e,i){f.setOp(t,e,i)},setFlipSided:c,setCullFace:l,setLineWidth:function(e){e!==C&&(D&&t.lineWidth(e),C=e)},setPolygonOffset:function(e,i,n){if(e){if(a(t.POLYGON_OFFSET_FILL),I!==i||N!==n)t.polygonOffset(i,n),I=i,N=n}else o(t.POLYGON_OFFSET_FILL)},getScissorTest:function(){return z},setScissorTest:function(e){(z=e)?a(t.SCISSOR_TEST):o(t.SCISSOR_TEST)},activeTexture:u,bindTexture:function(e,i){null===O&&u();var n=H[O];void 0===n&&(n={type:void 0,texture:void 0},H[O]=n);if(n.type!==e||n.texture!==i)t.bindTexture(e,i||k[e]),n.type=e,n.texture=i},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error(t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error(t)}},scissor:function(e){!1===F.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),F.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){for(var e=0;e<g.length;e++)1===g[e]&&(t.disableVertexAttribArray(e),g[e]=0);x={};O=b=null;H={};P=L=M=null;p.reset();d.reset();f.reset()}}}function te(t,e,i){function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp"}var r,a=void 0!==i.precision?i.precision:"highp",o=n(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);i=!0===i.logarithmicDepthBuffer&&!!e.get("EXT_frag_depth");var o=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),c=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),l=t.getParameter(t.MAX_VERTEX_ATTRIBS),u=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),p=t.getParameter(t.MAX_VARYING_VECTORS),d=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),f=0<s,m=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var i=e.get("EXT_texture_filter_anisotropic");return r=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:i,maxTextures:o,maxVertexTextures:s,maxTextureSize:h,maxCubemapSize:c,maxAttributes:l,maxVertexUniforms:u,maxVaryings:p,maxFragmentUniforms:d,vertexTextures:f,floatFragmentTextures:m,floatVertexTextures:f&&m}}function ee(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(i)}null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported.");return e[i]=n}}}function ie(){function t(){c.value!==n&&(c.value=n,c.needsUpdate=0<r);i.numPlanes=r;i.numIntersection=0}function e(t,e,n,r){var a=null!==t?t.length:0,o=null;if(0!==a){o=c.value;if(!0!==r||null===o){r=n+4*a;e=e.matrixWorldInverse;h.getNormalMatrix(e);if(null===o||o.length<r)o=new Float32Array(r);for(r=0;r!==a;++r,n+=4)s.copy(t[r]).applyMatrix4(e,h),s.normal.toArray(o,n),o[n+3]=s.constant}c.value=o;c.needsUpdate=!0}i.numPlanes=a;return o}var i=this,n=null,r=0,a=!1,o=!1,s=new $,h=new K,c={value:null,needsUpdate:!1};this.uniform=c;this.numIntersection=this.numPlanes=0;this.init=function(t,i,o){var s=0!==t.length||i||0!==r||a;a=i;n=e(t,o,0);r=t.length;return s};this.beginShadows=function(){o=!0;e(null)};this.endShadows=function(){o=!1;t()};this.setState=function(i,s,h,l,u,p){if(!a||null===i||0===i.length||o&&!h)o?e(null):t();else{h=o?0:r;var d=4*h,f=u.clippingState||null;c.value=f;f=e(i,l,d,p);for(i=0;i!==d;++i)f[i]=n[i];u.clippingState=f;this.numIntersection=s?this.numPlanes:0;this.numPlanes+=h}}}function ne(t){function e(){Lt.init();Lt.scissor(Z.copy(st).multiplyScalar(ot));Lt.viewport(K.copy(lt).multiplyScalar(ot));Lt.buffers.color.setClear(it.r,it.g,it.b,nt,R)}function i(){X=H=null;j="";V=-1;Lt.reset()}function n(t){t.preventDefault();i();e();Ut.clear()}function a(t){t=t.target;t.removeEventListener("dispose",a);o(t);Ut["delete"](t)}function o(t){var e=Ut.get(t).program;t.program=void 0;void 0!==e&&Ht.releaseProgram(e)}function s(t,e){return Math.abs(e[0])-Math.abs(t[0])}function l(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.program&&e.material.program&&t.material.program!==e.material.program?t.material.program.id-e.material.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function u(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function p(t,e,i,n,r){var a;i.transparent?(n=I,a=++N):(n=P,a=++C);a=n[a];void 0!==a?(a.id=t.id,a.object=t,a.geometry=e,a.material=i,a.z=gt.z,a.group=r):(a={id:t.id,object:t,geometry:e,material:i,z:gt.z,group:r},n.push(a))}function d(t){if(!ut.intersectsSphere(t))return!1;var e=pt.numPlanes;if(0===e)return!0;var i=O.clippingPlanes,n=t.center;t=-t.radius;var r=0;do{if(i[r].distanceToPoint(n)<t)return!1}while(++r!==e);return!0}function f(t,e){if(!1!==t.visible){if(0!==(t.layers.mask&e.layers.mask))if(t.isLight)L.push(t);else if(t.isSprite){var i;(i=!1===t.frustumCulled)||(mt.center.set(0,0,0),mt.radius=.7071067811865476,mt.applyMatrix4(t.matrixWorld),i=!0===d(mt));i&&U.push(t)}else if(t.isLensFlare)D.push(t);else if(t.isImmediateRenderObject)!0===O.sortObjects&&(gt.setFromMatrixPosition(t.matrixWorld),gt.applyMatrix4(vt)),p(t,null,t.material,gt.z,null);else if(t.isMesh||t.isLine||t.isPoints)if(t.isSkinnedMesh&&t.skeleton.update(),(i=!1===t.frustumCulled)||(i=t.geometry,null===i.boundingSphere&&i.computeBoundingSphere(),mt.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),i=!0===d(mt)),i){var n=t.material;if(!0===n.visible)if(!0===O.sortObjects&&(gt.setFromMatrixPosition(t.matrixWorld),gt.applyMatrix4(vt)),i=Ot.update(t),n.isMultiMaterial)for(var r=i.groups,a=n.materials,n=0,o=r.length;n<o;n++){var s=r[n],h=a[s.materialIndex];!0===h.visible&&p(t,i,h,gt.z,s)}else p(t,i,n,gt.z,null)}i=t.children;n=0;for(o=i.length;n<o;n++)f(i[n],e)}}function m(t,e,i,n){for(var r=0,a=t.length;r<a;r++){var o=t[r],s=o.object,h=o.geometry,c=void 0===n?o.material:n,o=o.group;s.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld);s.normalMatrix.getNormalMatrix(s.modelViewMatrix);s.onBeforeRender(O,e,i,h,c,o);if(s.isImmediateRenderObject){v(c);var l=g(i,e.fog,c,s);j="";s.render(function(t){O.renderBufferImmediate(t,l,c)})}else O.renderBufferDirect(i,e.fog,h,c,s,o);s.onAfterRender(O,e,i,h,c,o)}}function v(t){2===t.side?Lt.disable(_t.CULL_FACE):Lt.enable(_t.CULL_FACE);Lt.setFlipSided(1===t.side);!0===t.transparent?Lt.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):Lt.setBlending(0);Lt.setDepthFunc(t.depthFunc);Lt.setDepthTest(t.depthTest);Lt.setDepthWrite(t.depthWrite);Lt.setColorWrite(t.colorWrite);Lt.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function g(t,e,i,n){$=0;var r=Ut.get(i);dt&&(ft||t!==X)&&pt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,t===X&&i.id===V);!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==bt.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===pt.numPlanes&&r.numIntersection===pt.numIntersection||(i.needsUpdate=!0));if(i.needsUpdate){t:{var s=Ut.get(i),h=Ht.getParameters(i,bt,e,pt.numPlanes,pt.numIntersection,n),c=Ht.getProgramCode(i,h),l=s.program,u=!0;if(void 0===l)i.addEventListener("dispose",a);else if(l.code!==c)o(i);else if(void 0!==h.shaderID)break t;else u=!1;u&&(h.shaderID?(l=br[h.shaderID],s.__webglShader={name:i.type,uniforms:vr.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):s.__webglShader={name:i.type,uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader},i.__webglShader=s.__webglShader,l=Ht.acquireProgram(i,h,c),s.program=l,i.program=l);h=l.getAttributes();if(i.morphTargets)for(c=i.numSupportedMorphTargets=0;c<O.maxMorphTargets;c++)0<=h["morphTarget"+c]&&i.numSupportedMorphTargets++;if(i.morphNormals)for(c=i.numSupportedMorphNormals=0;c<O.maxMorphNormals;c++)0<=h["morphNormal"+c]&&i.numSupportedMorphNormals++;h=s.__webglShader.uniforms;if(!i.isShaderMaterial&&!i.isRawShaderMaterial||!0===i.clipping)s.numClippingPlanes=pt.numPlanes,s.numIntersection=pt.numIntersection,h.clippingPlanes=pt.uniform;s.fog=e;s.lightsHash=bt.hash;i.lights&&(h.ambientLightColor.value=bt.ambient,h.directionalLights.value=bt.directional,h.spotLights.value=bt.spot,h.rectAreaLights.value=bt.rectArea,h.pointLights.value=bt.point,h.hemisphereLights.value=bt.hemi,h.directionalShadowMap.value=bt.directionalShadowMap,h.directionalShadowMatrix.value=bt.directionalShadowMatrix,h.spotShadowMap.value=bt.spotShadowMap,h.spotShadowMatrix.value=bt.spotShadowMatrix,h.pointShadowMap.value=bt.pointShadowMap,h.pointShadowMatrix.value=bt.pointShadowMatrix);c=s.program.getUniforms();h=k.seqWithValue(c.seq,h);s.uniformsList=h}i.needsUpdate=!1}var p=!1,u=l=!1,s=r.program,h=s.getUniforms(),c=r.__webglShader.uniforms;s.id!==H&&(_t.useProgram(s.program),H=s.id,u=l=p=!0);i.id!==V&&(V=i.id,l=!0);if(p||t!==X){h.set(_t,t,"projectionMatrix");Rt.logarithmicDepthBuffer&&h.setValue(_t,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2));t!==X&&(X=t,u=l=!0);if(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)p=h.map.cameraPosition,void 0!==p&&p.setValue(_t,gt.setFromMatrixPosition(t.matrixWorld));(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&h.setValue(_t,"viewMatrix",t.matrixWorldInverse);h.set(_t,O,"toneMappingExposure");h.set(_t,O,"toneMappingWhitePoint")}i.skinning&&(h.setOptional(_t,n,"bindMatrix"),h.setOptional(_t,n,"bindMatrixInverse"),t=n.skeleton)&&(Rt.floatVertexTextures&&t.useVertexTexture?(h.set(_t,t,"boneTexture"),h.set(_t,t,"boneTextureWidth"),h.set(_t,t,"boneTextureHeight")):h.setOptional(_t,t,"boneMatrices"));if(l){i.lights&&(t=u,c.ambientLightColor.needsUpdate=t,c.directionalLights.needsUpdate=t,c.pointLights.needsUpdate=t,c.spotLights.needsUpdate=t,c.rectAreaLights.needsUpdate=t,c.hemisphereLights.needsUpdate=t);e&&i.fog&&(c.fogColor.value=e.color,e.isFog?(c.fogNear.value=e.near,c.fogFar.value=e.far):e.isFogExp2&&(c.fogDensity.value=e.density));if(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isMeshNormalMaterial||i.isMeshDepthMaterial){c.opacity.value=i.opacity;c.diffuse.value=i.color;i.emissive&&c.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity);c.map.value=i.map;c.specularMap.value=i.specularMap;c.alphaMap.value=i.alphaMap;i.lightMap&&(c.lightMap.value=i.lightMap,c.lightMapIntensity.value=i.lightMapIntensity);i.aoMap&&(c.aoMap.value=i.aoMap,c.aoMapIntensity.value=i.aoMapIntensity);var d;i.map?d=i.map:i.specularMap?d=i.specularMap:i.displacementMap?d=i.displacementMap:i.normalMap?d=i.normalMap:i.bumpMap?d=i.bumpMap:i.roughnessMap?d=i.roughnessMap:i.metalnessMap?d=i.metalnessMap:i.alphaMap?d=i.alphaMap:i.emissiveMap&&(d=i.emissiveMap);void 0!==d&&(d.isWebGLRenderTarget&&(d=d.texture),e=d.offset,d=d.repeat,c.offsetRepeat.value.set(e.x,e.y,d.x,d.y));c.envMap.value=i.envMap;c.flipEnvMap.value=i.envMap&&i.envMap.isCubeTexture?-1:1;c.reflectivity.value=i.reflectivity;c.refractionRatio.value=i.refractionRatio}i.isLineBasicMaterial?(c.diffuse.value=i.color,c.opacity.value=i.opacity):i.isLineDashedMaterial?(c.diffuse.value=i.color,c.opacity.value=i.opacity,c.dashSize.value=i.dashSize,c.totalSize.value=i.dashSize+i.gapSize,c.scale.value=i.scale):i.isPointsMaterial?(c.diffuse.value=i.color,c.opacity.value=i.opacity,c.size.value=i.size*ot,c.scale.value=.5*at,c.map.value=i.map,null!==i.map&&(d=i.map.offset,i=i.map.repeat,c.offsetRepeat.value.set(d.x,d.y,i.x,i.y))):i.isMeshLambertMaterial?i.emissiveMap&&(c.emissiveMap.value=i.emissiveMap):i.isMeshToonMaterial?(y(c,i),i.gradientMap&&(c.gradientMap.value=i.gradientMap)):i.isMeshPhongMaterial?y(c,i):i.isMeshPhysicalMaterial?(c.clearCoat.value=i.clearCoat,c.clearCoatRoughness.value=i.clearCoatRoughness,x(c,i)):i.isMeshStandardMaterial?x(c,i):i.isMeshDepthMaterial?i.displacementMap&&(c.displacementMap.value=i.displacementMap,c.displacementScale.value=i.displacementScale,c.displacementBias.value=i.displacementBias):i.isMeshNormalMaterial&&(i.bumpMap&&(c.bumpMap.value=i.bumpMap,c.bumpScale.value=i.bumpScale),i.normalMap&&(c.normalMap.value=i.normalMap,c.normalScale.value.copy(i.normalScale)),i.displacementMap&&(c.displacementMap.value=i.displacementMap,c.displacementScale.value=i.displacementScale,c.displacementBias.value=i.displacementBias));void 0!==c.ltcMat&&(c.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE);void 0!==c.ltcMag&&(c.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE);k.upload(_t,r.uniformsList,c,O)}h.set(_t,n,"modelViewMatrix");h.set(_t,n,"normalMatrix");h.setValue(_t,"modelMatrix",n.matrixWorld);return s}function y(t,e){t.specular.value=e.specular;t.shininess.value=Math.max(e.shininess,1e-4);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function x(t,e){t.roughness.value=e.roughness;t.metalness.value=e.metalness;e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap);e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function b(t){var e;if(1e3===t)return _t.REPEAT;if(1001===t)return _t.CLAMP_TO_EDGE;if(1002===t)return _t.MIRRORED_REPEAT;if(1003===t)return _t.NEAREST;if(1004===t)return _t.NEAREST_MIPMAP_NEAREST;if(1005===t)return _t.NEAREST_MIPMAP_LINEAR;if(1006===t)return _t.LINEAR;if(1007===t)return _t.LINEAR_MIPMAP_NEAREST;if(1008===t)return _t.LINEAR_MIPMAP_LINEAR;if(1009===t)return _t.UNSIGNED_BYTE;if(1017===t)return _t.UNSIGNED_SHORT_4_4_4_4;if(1018===t)return _t.UNSIGNED_SHORT_5_5_5_1;if(1019===t)return _t.UNSIGNED_SHORT_5_6_5;if(1010===t)return _t.BYTE;if(1011===t)return _t.SHORT;if(1012===t)return _t.UNSIGNED_SHORT;if(1013===t)return _t.INT;if(1014===t)return _t.UNSIGNED_INT;if(1015===t)return _t.FLOAT;if(1016===t&&(e=Tt.get("OES_texture_half_float"),null!==e))return e.HALF_FLOAT_OES;if(1021===t)return _t.ALPHA;if(1022===t)return _t.RGB;if(1023===t)return _t.RGBA;if(1024===t)return _t.LUMINANCE;if(1025===t)return _t.LUMINANCE_ALPHA;if(1026===t)return _t.DEPTH_COMPONENT;if(1027===t)return _t.DEPTH_STENCIL;if(100===t)return _t.FUNC_ADD;if(101===t)return _t.FUNC_SUBTRACT;if(102===t)return _t.FUNC_REVERSE_SUBTRACT;if(200===t)return _t.ZERO;if(201===t)return _t.ONE;if(202===t)return _t.SRC_COLOR;if(203===t)return _t.ONE_MINUS_SRC_COLOR;if(204===t)return _t.SRC_ALPHA;if(205===t)return _t.ONE_MINUS_SRC_ALPHA;if(206===t)return _t.DST_ALPHA;if(207===t)return _t.ONE_MINUS_DST_ALPHA;if(208===t)return _t.DST_COLOR;if(209===t)return _t.ONE_MINUS_DST_COLOR;if(210===t)return _t.SRC_ALPHA_SATURATE;if(2001===t||2002===t||2003===t||2004===t)if(e=Tt.get("WEBGL_compressed_texture_s3tc"),null!==e){if(2001===t)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===t)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===t)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===t)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(2100===t||2101===t||2102===t||2103===t)if(e=Tt.get("WEBGL_compressed_texture_pvrtc"),null!==e){if(2100===t)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===t)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===t)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===t)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===t&&(e=Tt.get("WEBGL_compressed_texture_etc1"),null!==e))return e.COMPRESSED_RGB_ETC1_WEBGL;if(103===t||104===t)if(e=Tt.get("EXT_blend_minmax"),null!==e){if(103===t)return e.MIN_EXT;if(104===t)return e.MAX_EXT}return 1020===t&&(e=Tt.get("WEBGL_depth_texture"),null!==e)?e.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","84");t=t||{};var M=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_=void 0!==t.context?t.context:null,w=void 0!==t.alpha?t.alpha:!1,E=void 0!==t.depth?t.depth:!0,T=void 0!==t.stencil?t.stencil:!0,S=void 0!==t.antialias?t.antialias:!1,R=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,A=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,L=[],P=[],C=-1,I=[],N=-1,z=new Float32Array(8),U=[],D=[];this.domElement=M;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var O=this,H=null,F=null,B=null,V=-1,j="",X=null,Z=new r,Q=null,K=new r,$=0,it=new G(0),nt=0,rt=M.width,at=M.height,ot=1,st=new r(0,0,rt,at),ht=!1,lt=new r(0,0,rt,at),ut=new tt,pt=new ie,dt=!1,ft=!1,mt=new J,vt=new c,gt=new h,yt=new c,xt=new c,bt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Mt={calls:0,vertices:0,faces:0,points:0};this.info={render:Mt,memory:{geometries:0,textures:0},programs:null};var _t;try{w={alpha:w,depth:E,stencil:T,antialias:S,premultipliedAlpha:R,preserveDrawingBuffer:A};_t=_||M.getContext("webgl",w)||M.getContext("experimental-webgl",w);if(null===_t){if(null!==M.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context."}void 0===_t.getShaderPrecisionFormat&&(_t.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});M.addEventListener("webglcontextlost",n,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}var Tt=new ee(_t);Tt.get("WEBGL_depth_texture");Tt.get("OES_texture_float");Tt.get("OES_texture_float_linear");Tt.get("OES_texture_half_float");Tt.get("OES_texture_half_float_linear");Tt.get("OES_standard_derivatives");Tt.get("ANGLE_instanced_arrays");Tt.get("OES_element_index_uint")&&(wt.MaxIndex=4294967296);var Rt=new te(_t,Tt,t),Lt=new $t(_t,Tt,b),Ut=new Kt,Dt=new Jt(_t,Tt,Lt,Ut,Rt,b,this.info),Ot=new Qt(_t,Ut,this.info),Ht=new Yt(this,Rt),Ft=new zt;this.info.programs=Ht.programs;var Bt=new Nt(_t,Tt,Mt),kt=new It(_t,Tt,Mt),Gt,Vt,jt,Wt;e();this.context=_t;this.capabilities=Rt;this.extensions=Tt;this.properties=Ut;this.state=Lt;var qt=new et(this,bt,Ot,Rt);this.shadowMap=qt;var Xt=new q(this,U),Zt=new W(this,D);this.getContext=function(){return _t};this.getContextAttributes=function(){return _t.getContextAttributes()};this.forceContextLoss=function(){Tt.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return Rt.getMaxAnisotropy()};this.getPrecision=function(){return Rt.precision};this.getPixelRatio=function(){return ot};this.setPixelRatio=function(t){void 0!==t&&(ot=t,this.setSize(lt.z,lt.w,!1))};this.getSize=function(){return{width:rt,height:at}};this.setSize=function(t,e,i){rt=t;at=e;M.width=t*ot;M.height=e*ot;!1!==i&&(M.style.width=t+"px",M.style.height=e+"px");this.setViewport(0,0,t,e)};this.setViewport=function(t,e,i,n){Lt.viewport(lt.set(t,e,i,n))};this.setScissor=function(t,e,i,n){Lt.scissor(st.set(t,e,i,n))};this.setScissorTest=function(t){Lt.setScissorTest(ht=t)};this.getClearColor=function(){return it};this.setClearColor=function(t,e){it.set(t);nt=void 0!==e?e:1;Lt.buffers.color.setClear(it.r,it.g,it.b,nt,R)};this.getClearAlpha=function(){return nt};this.setClearAlpha=function(t){nt=t;Lt.buffers.color.setClear(it.r,it.g,it.b,nt,R)};this.clear=function(t,e,i){var n=0;if(void 0===t||t)n|=_t.COLOR_BUFFER_BIT;if(void 0===e||e)n|=_t.DEPTH_BUFFER_BIT;if(void 0===i||i)n|=_t.STENCIL_BUFFER_BIT;_t.clear(n)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(t,e,i,n){this.setRenderTarget(t);this.clear(e,i,n)};this.resetGLState=i;this.dispose=function(){I=[];N=-1;P=[];C=-1;M.removeEventListener("webglcontextlost",n,!1)};this.renderBufferImmediate=function(t,e,i){Lt.initAttributes();var n=Ut.get(t);t.hasPositions&&!n.position&&(n.position=_t.createBuffer());t.hasNormals&&!n.normal&&(n.normal=_t.createBuffer());t.hasUvs&&!n.uv&&(n.uv=_t.createBuffer());t.hasColors&&!n.color&&(n.color=_t.createBuffer());e=e.getAttributes();t.hasPositions&&(_t.bindBuffer(_t.ARRAY_BUFFER,n.position),_t.bufferData(_t.ARRAY_BUFFER,t.positionArray,_t.DYNAMIC_DRAW),Lt.enableAttribute(e.position),_t.vertexAttribPointer(e.position,3,_t.FLOAT,!1,0,0));if(t.hasNormals){_t.bindBuffer(_t.ARRAY_BUFFER,n.normal);if(!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&1===i.shading)for(var r=0,a=3*t.count;r<a;r+=9){var o=t.normalArray,s=(o[r+0]+o[r+3]+o[r+6])/3,h=(o[r+1]+o[r+4]+o[r+7])/3,c=(o[r+2]+o[r+5]+o[r+8])/3;o[r+0]=s;o[r+1]=h;o[r+2]=c;o[r+3]=s;o[r+4]=h;o[r+5]=c;o[r+6]=s;o[r+7]=h;o[r+8]=c}_t.bufferData(_t.ARRAY_BUFFER,t.normalArray,_t.DYNAMIC_DRAW);Lt.enableAttribute(e.normal);_t.vertexAttribPointer(e.normal,3,_t.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(_t.bindBuffer(_t.ARRAY_BUFFER,n.uv),_t.bufferData(_t.ARRAY_BUFFER,t.uvArray,_t.DYNAMIC_DRAW),Lt.enableAttribute(e.uv),_t.vertexAttribPointer(e.uv,2,_t.FLOAT,!1,0,0));t.hasColors&&0!==i.vertexColors&&(_t.bindBuffer(_t.ARRAY_BUFFER,n.color),_t.bufferData(_t.ARRAY_BUFFER,t.colorArray,_t.DYNAMIC_DRAW),Lt.enableAttribute(e.color),_t.vertexAttribPointer(e.color,3,_t.FLOAT,!1,0,0));Lt.disableUnusedAttributes();_t.drawArrays(_t.TRIANGLES,0,t.count);t.count=0};this.renderBufferDirect=function(t,e,i,n,r,a){v(n);var o=g(t,e,n,r),h=!1;t=i.id+"_"+o.id+"_"+n.wireframe;t!==j&&(j=t,h=!0);e=r.morphTargetInfluences;if(void 0!==e){var c=[];t=0;for(var l=e.length;t<l;t++)h=e[t],c.push([h,t]);c.sort(s);8<c.length&&(c.length=8);var u=i.morphAttributes;t=0;for(l=c.length;t<l;t++)h=c[t],z[t]=h[0],0!==h[0]?(e=h[1],!0===n.morphTargets&&u.position&&i.addAttribute("morphTarget"+t,u.position[e]),!0===n.morphNormals&&u.normal&&i.addAttribute("morphNormal"+t,u.normal[e])):(!0===n.morphTargets&&i.removeAttribute("morphTarget"+t),!0===n.morphNormals&&i.removeAttribute("morphNormal"+t));t=c.length;for(e=z.length;t<e;t++)z[t]=0;o.getUniforms().setValue(_t,"morphTargetInfluences",z);h=!0}e=i.index;l=i.attributes.position;c=1;!0===n.wireframe&&(e=Ot.getWireframeAttribute(i),c=2);null!==e?(t=kt,t.setIndex(e)):t=Bt;if(h){t:{var h=void 0,p;if(i&&i.isInstancedBufferGeometry&&(p=Tt.get("ANGLE_instanced_arrays"),null===p)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");break t}void 0===h&&(h=0);Lt.initAttributes();var u=i.attributes,o=o.getAttributes(),d=n.defaultAttributeValues,f;for(f in o){var m=o[f];if(0<=m){var y=u[f];if(void 0!==y){var x=y.normalized,b=y.itemSize,M=Ot.getAttributeProperties(y),_=M.__webglBuffer,w=M.type,M=M.bytesPerElement;if(y.isInterleavedBufferAttribute){var E=y.data,T=E.stride,y=y.offset;E&&E.isInstancedInterleavedBuffer?(Lt.enableAttributeAndDivisor(m,E.meshPerAttribute,p),void 0===i.maxInstancedCount&&(i.maxInstancedCount=E.meshPerAttribute*E.count)):Lt.enableAttribute(m);_t.bindBuffer(_t.ARRAY_BUFFER,_);_t.vertexAttribPointer(m,b,w,x,T*M,(h*T+y)*M)}else y.isInstancedBufferAttribute?(Lt.enableAttributeAndDivisor(m,y.meshPerAttribute,p),void 0===i.maxInstancedCount&&(i.maxInstancedCount=y.meshPerAttribute*y.count)):Lt.enableAttribute(m),_t.bindBuffer(_t.ARRAY_BUFFER,_),_t.vertexAttribPointer(m,b,w,x,0,h*b*M)}else if(void 0!==d&&(x=d[f],void 0!==x))switch(x.length){case 2:_t.vertexAttrib2fv(m,x);break;case 3:_t.vertexAttrib3fv(m,x);break;case 4:_t.vertexAttrib4fv(m,x);break;default:_t.vertexAttrib1fv(m,x)}}}Lt.disableUnusedAttributes()}null!==e&&_t.bindBuffer(_t.ELEMENT_ARRAY_BUFFER,Ot.getAttributeBuffer(e))}p=0;null!==e?p=e.count:void 0!==l&&(p=l.count);e=i.drawRange.start*c;l=null!==a?a.start*c:0;f=Math.max(e,l);a=Math.max(0,Math.min(p,e+i.drawRange.count*c,l+(null!==a?a.count*c:Infinity))-1-f+1);if(0!==a){if(r.isMesh)if(!0===n.wireframe)Lt.setLineWidth(n.wireframeLinewidth*(null===F?ot:1)),t.setMode(_t.LINES);else switch(r.drawMode){case 0:t.setMode(_t.TRIANGLES);break;case 1:t.setMode(_t.TRIANGLE_STRIP);break;case 2:t.setMode(_t.TRIANGLE_FAN)}else r.isLine?(n=n.linewidth,void 0===n&&(n=1),Lt.setLineWidth(n*(null===F?ot:1)),r.isLineSegments?t.setMode(_t.LINES):t.setMode(_t.LINE_STRIP)):r.isPoints&&t.setMode(_t.POINTS);i&&i.isInstancedBufferGeometry?0<i.maxInstancedCount&&t.renderInstances(i,f,a):t.render(f,a)}};this.render=function(t,e,i,n){if(void 0!==e&&!0!==e.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{j="";V=-1;X=null;!0===t.autoUpdate&&t.updateMatrixWorld();null===e.parent&&e.updateMatrixWorld();e.matrixWorldInverse.getInverse(e.matrixWorld);vt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);ut.setFromMatrix(vt);L.length=0;N=C=-1;U.length=0;D.length=0;ft=this.localClippingEnabled;dt=pt.init(this.clippingPlanes,ft,e);f(t,e);P.length=C+1;I.length=N+1;!0===O.sortObjects&&(P.sort(l),I.sort(u));dt&&pt.beginShadows();for(var r=L,a=0,o=0,s=r.length;o<s;o++){var h=r[o];h.castShadow&&(bt.shadows[a++]=h)}bt.shadows.length=a;qt.render(t,e);for(var r=L,p=h=0,d=0,v,g,y,x,b=e.matrixWorldInverse,M=0,_=0,w=0,E=0,T=0,a=0,o=r.length;a<o;a++)if(s=r[a],v=s.color,g=s.intensity,y=s.distance,x=s.shadow&&s.shadow.map?s.shadow.map.texture:null,s.isAmbientLight)h+=v.r*g,p+=v.g*g,d+=v.b*g;else if(s.isDirectionalLight){var S=Ft.get(s);S.color.copy(s.color).multiplyScalar(s.intensity);S.direction.setFromMatrixPosition(s.matrixWorld);gt.setFromMatrixPosition(s.target.matrixWorld);S.direction.sub(gt);S.direction.transformDirection(b);if(S.shadow=s.castShadow)S.shadowBias=s.shadow.bias,S.shadowRadius=s.shadow.radius,S.shadowMapSize=s.shadow.mapSize;bt.directionalShadowMap[M]=x;bt.directionalShadowMatrix[M]=s.shadow.matrix;bt.directional[M++]=S}else if(s.isSpotLight){S=Ft.get(s);S.position.setFromMatrixPosition(s.matrixWorld);S.position.applyMatrix4(b);S.color.copy(v).multiplyScalar(g);S.distance=y;S.direction.setFromMatrixPosition(s.matrixWorld);gt.setFromMatrixPosition(s.target.matrixWorld);S.direction.sub(gt);S.direction.transformDirection(b);S.coneCos=Math.cos(s.angle);S.penumbraCos=Math.cos(s.angle*(1-s.penumbra));S.decay=0===s.distance?0:s.decay;if(S.shadow=s.castShadow)S.shadowBias=s.shadow.bias,S.shadowRadius=s.shadow.radius,S.shadowMapSize=s.shadow.mapSize;bt.spotShadowMap[w]=x;bt.spotShadowMatrix[w]=s.shadow.matrix;bt.spot[w++]=S}else if(s.isRectAreaLight)S=Ft.get(s),S.color.copy(v).multiplyScalar(g/(s.width*s.height)),S.position.setFromMatrixPosition(s.matrixWorld),S.position.applyMatrix4(b),xt.identity(),yt.copy(s.matrixWorld),yt.premultiply(b),xt.extractRotation(yt),S.halfWidth.set(.5*s.width,0,0),S.halfHeight.set(0,.5*s.height,0),S.halfWidth.applyMatrix4(xt),S.halfHeight.applyMatrix4(xt),bt.rectArea[E++]=S;else if(s.isPointLight){S=Ft.get(s);S.position.setFromMatrixPosition(s.matrixWorld);S.position.applyMatrix4(b);S.color.copy(s.color).multiplyScalar(s.intensity);S.distance=s.distance;S.decay=0===s.distance?0:s.decay;if(S.shadow=s.castShadow)S.shadowBias=s.shadow.bias,S.shadowRadius=s.shadow.radius,S.shadowMapSize=s.shadow.mapSize;bt.pointShadowMap[_]=x;void 0===bt.pointShadowMatrix[_]&&(bt.pointShadowMatrix[_]=new c);gt.setFromMatrixPosition(s.matrixWorld).negate();bt.pointShadowMatrix[_].identity().setPosition(gt);bt.point[_++]=S}else s.isHemisphereLight&&(S=Ft.get(s),S.direction.setFromMatrixPosition(s.matrixWorld),S.direction.transformDirection(b),S.direction.normalize(),S.skyColor.copy(s.color).multiplyScalar(g),S.groundColor.copy(s.groundColor).multiplyScalar(g),bt.hemi[T++]=S);bt.ambient[0]=h;bt.ambient[1]=p;bt.ambient[2]=d;bt.directional.length=M;bt.spot.length=w;bt.rectArea.length=E;bt.point.length=_;bt.hemi.length=T;bt.hash=M+","+_+","+w+","+E+","+T+","+bt.shadows.length;dt&&pt.endShadows();Mt.calls=0;Mt.vertices=0;Mt.faces=0;Mt.points=0;void 0===i&&(i=null);this.setRenderTarget(i);r=t.background;null===r?Lt.buffers.color.setClear(it.r,it.g,it.b,nt,R):r&&r.isColor&&(Lt.buffers.color.setClear(r.r,r.g,r.b,1,R),n=!0);(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);r&&r.isCubeTexture?(void 0===jt&&(jt=new Pt,Wt=new Et(new St(5,5,5),new Y({uniforms:br.cube.uniforms,vertexShader:br.cube.vertexShader,fragmentShader:br.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))),jt.projectionMatrix.copy(e.projectionMatrix),jt.matrixWorld.extractRotation(e.matrixWorld),jt.matrixWorldInverse.getInverse(jt.matrixWorld),Wt.material.uniforms.tCube.value=r,Wt.modelViewMatrix.multiplyMatrices(jt.matrixWorldInverse,Wt.matrixWorld),Ot.update(Wt),O.renderBufferDirect(jt,null,Wt.geometry,Wt.material,Wt,null)):r&&r.isTexture&&(void 0===Gt&&(Gt=new Ct(-1,1,1,-1,0,1),Vt=new Et(new At(2,2),new ct({depthTest:!1,depthWrite:!1,fog:!1}))),Vt.material.map=r,Ot.update(Vt),O.renderBufferDirect(Gt,null,Vt.geometry,Vt.material,Vt,null));t.overrideMaterial?(n=t.overrideMaterial,m(P,t,e,n),m(I,t,e,n)):(Lt.setBlending(0),m(P,t,e),m(I,t,e));Xt.render(t,e);Zt.render(t,e,K);i&&Dt.updateRenderTargetMipmap(i);Lt.setDepthTest(!0);Lt.setDepthWrite(!0);Lt.setColorWrite(!0)}};this.setFaceCulling=function(t,e){Lt.setCullFace(t);Lt.setFlipSided(0===e)};this.allocTextureUnit=function(){var t=$;t>=Rt.maxTextures&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+Rt.maxTextures);$+=1;return t};this.setTexture2D=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture);Dt.setTexture2D(e,i)}}();this.setTexture=function(){var t=!1;return function(e,i){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0);Dt.setTexture2D(e,i)}}();this.setTextureCube=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture);e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?Dt.setTextureCube(e,i):Dt.setTextureCubeDynamic(e,i)}}();this.getCurrentRenderTarget=function(){return F};this.setRenderTarget=function(t){(F=t)&&void 0===Ut.get(t).__webglFramebuffer&&Dt.setupRenderTarget(t);var e=t&&t.isWebGLRenderTargetCube,i;t?(i=Ut.get(t),i=e?i.__webglFramebuffer[t.activeCubeFace]:i.__webglFramebuffer,Z.copy(t.scissor),Q=t.scissorTest,K.copy(t.viewport)):(i=null,Z.copy(st).multiplyScalar(ot),Q=ht,K.copy(lt).multiplyScalar(ot));B!==i&&(_t.bindFramebuffer(_t.FRAMEBUFFER,i),B=i);Lt.scissor(Z);Lt.setScissorTest(Q);Lt.viewport(K);e&&(e=Ut.get(t.texture),_t.framebufferTexture2D(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,e.__webglTexture,t.activeMipMapLevel))};this.readRenderTargetPixels=function(t,e,i,n,r,a){if(!1===(t&&t.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var o=Ut.get(t).__webglFramebuffer;if(o){var s=!1;o!==B&&(_t.bindFramebuffer(_t.FRAMEBUFFER,o),s=!0);try{var h=t.texture,c=h.format,l=h.type;1023!==c&&b(c)!==_t.getParameter(_t.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===l||b(l)===_t.getParameter(_t.IMPLEMENTATION_COLOR_READ_TYPE)||1015===l&&(Tt.get("OES_texture_float")||Tt.get("WEBGL_color_buffer_float"))||1016===l&&Tt.get("EXT_color_buffer_half_float")?_t.checkFramebufferStatus(_t.FRAMEBUFFER)===_t.FRAMEBUFFER_COMPLETE?0<=e&&e<=t.width-n&&0<=i&&i<=t.height-r&&_t.readPixels(e,i,n,r,b(c),b(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&_t.bindFramebuffer(_t.FRAMEBUFFER,B)}}}}}function re(t,e){this.name="";this.color=new G(t);this.density=void 0!==e?e:25e-5}function ae(t,e,i){this.name="";this.color=new G(t);this.near=void 0!==e?e:1;this.far=void 0!==i?i:1e3}function oe(){at.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function se(t,e,i,n,r){at.call(this);this.lensFlares=[];this.positionScreen=new h;this.customUpdateCallback=void 0;void 0!==t&&this.add(t,e,i,n,r)}function he(t){X.call(this);this.type="SpriteMaterial";this.color=new G(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(t)}function ce(t){at.call(this);this.type="Sprite";this.material=void 0!==t?t:new he}function le(){at.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ue(t,e,i){this.useVertexTexture=void 0!==i?i:!0;this.identityMatrix=new c;t=t||[];this.bones=t.slice(0);this.useVertexTexture?(t=Math.sqrt(4*this.bones.length),t=cr.nextPowerOfTwo(Math.ceil(t)),this.boneTextureHeight=this.boneTextureWidth=t=Math.max(t,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new V(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new c)}function pe(){at.call(this);this.type="Bone"}function de(t,e,i){Et.call(this,t,e);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new c;this.bindMatrixInverse=new c;t=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,r=0,a=this.geometry.bones.length;r<a;++r)n=this.geometry.bones[r],e=new pe,t.push(e),e.name=n.name,e.position.fromArray(n.pos),e.quaternion.fromArray(n.rotq),void 0!==n.scl&&e.scale.fromArray(n.scl);r=0;for(a=this.geometry.bones.length;r<a;++r)n=this.geometry.bones[r],-1!==n.parent&&null!==n.parent&&void 0!==t[n.parent]?t[n.parent].add(t[r]):this.add(t[r])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new ue(t,void 0,i),this.matrixWorld)}function fe(t){X.call(this);this.type="LineBasicMaterial";this.color=new G(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(t)}function me(t,e,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new ve(t,e);at.call(this);this.type="Line";this.geometry=void 0!==t?t:new wt;this.material=void 0!==e?e:new fe({color:16777215*Math.random()})}function ve(t,e){me.call(this,t,e);this.type="LineSegments"}function ge(t){X.call(this);this.type="PointsMaterial";this.color=new G(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(t)}function ye(t,e){at.call(this);this.type="Points";this.geometry=void 0!==t?t:new wt;this.material=void 0!==e?e:new ge({color:16777215*Math.random()})}function xe(){at.call(this);this.type="Group"}function be(t,e,i,r,a,o,s,h,c){function l(){requestAnimationFrame(l);t.readyState>=t.HAVE_CURRENT_DATA&&(u.needsUpdate=!0)}n.call(this,t,e,i,r,a,o,s,h,c);this.generateMipmaps=!1;var u=this;l()}function Me(t,e,i,r,a,o,s,h,c,l,u,p){n.call(this,null,o,s,h,c,l,r,a,u,p);this.image={width:e,height:i};this.mipmaps=t;this.generateMipmaps=this.flipY=!1}function _e(t,e,i,r,a,o,s,h,c){n.call(this,t,e,i,r,a,o,s,h,c);this.needsUpdate=!0}function we(t,e,i,r,a,o,s,h,c,l){l=void 0!==l?l:1026;if(1026!==l&&1027!==l)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===l&&(i=1012);void 0===i&&1027===l&&(i=1020);n.call(this,null,r,a,o,s,h,l,i,c);this.image={width:t,height:e};this.magFilter=void 0!==s?s:1003;this.minFilter=void 0!==h?h:1003;this.generateMipmaps=this.flipY=!1}function Ee(t){function e(t,e){return t-e}wt.call(this);this.type="WireframeGeometry";var i=[],n,r,a,o,s=[0,0],c={},l,u=["a","b","c"];if(t&&t.isGeometry){var p=t.faces;n=0;for(a=p.length;n<a;n++){var d=p[n];for(r=0;3>r;r++)s[0]=d[u[r]],s[1]=d[u[(r+1)%3]],s.sort(e),l=s.toString(),void 0===c[l]&&(c[l]={index1:s[0],index2:s[1]})}for(l in c)n=c[l],u=t.vertices[n.index1],i.push(u.x,u.y,u.z),u=t.vertices[n.index2],i.push(u.x,u.y,u.z)}else if(t&&t.isBufferGeometry){var f,u=new h;if(null!==t.index){p=t.attributes.position;d=t.index;f=t.groups;0===f.length&&t.addGroup(0,d.count);t=0;for(o=f.length;t<o;++t)for(n=f[t],r=n.start,a=n.count,n=r,a=r+a;n<a;n+=3)for(r=0;3>r;r++)s[0]=d.getX(n+r),s[1]=d.getX(n+(r+1)%3),s.sort(e),l=s.toString(),void 0===c[l]&&(c[l]={index1:s[0],index2:s[1]});for(l in c)n=c[l],u.fromBufferAttribute(p,n.index1),i.push(u.x,u.y,u.z),u.fromBufferAttribute(p,n.index2),i.push(u.x,u.y,u.z)}else for(p=t.attributes.position,n=0,a=p.count/3;n<a;n++)for(r=0;3>r;r++)c=3*n+r,u.fromBufferAttribute(p,c),i.push(u.x,u.y,u.z),c=3*n+(r+1)%3,u.fromBufferAttribute(p,c),i.push(u.x,u.y,u.z)}this.addAttribute("position",new yt(i,3))}function Te(t,e,i){_t.call(this);this.type="ParametricGeometry";this.parameters={func:t,slices:e,stacks:i};this.fromBufferGeometry(new Se(t,e,i));this.mergeVertices()}function Se(t,e,i){wt.call(this);this.type="ParametricBufferGeometry";this.parameters={func:t,slices:e,stacks:i};var n=[],r=[],a=[],o,s,h=e+1;for(o=0;o<=i;o++){var c=o/i;for(s=0;s<=e;s++){var l=s/e,u=t(l,c);r.push(u.x,u.y,u.z);a.push(l,c)}}for(o=0;o<i;o++)for(s=0;s<e;s++)t=o*h+s+1,c=(o+1)*h+s+1,l=(o+1)*h+s,n.push(o*h+s,t,l),n.push(t,c,l);this.setIndex(n);this.addAttribute("position",new yt(r,3));this.addAttribute("uv",new yt(a,2));this.computeVertexNormals()}function Re(t,e,i,n){_t.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:t,indices:e,radius:i,detail:n};this.fromBufferGeometry(new Ae(t,e,i,n));this.mergeVertices()}function Ae(t,e,n,r){function a(t){c.push(t.x,t.y,t.z)}function o(e,i){var n=3*e;i.x=t[n+0];i.y=t[n+1];i.z=t[n+2]}function s(t,e,i,n){0>n&&1===t.x&&(l[e]=t.x-1);0===i.x&&0===i.z&&(l[e]=n/2/Math.PI+.5)}wt.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:t,indices:e,radius:n,detail:r};n=n||1;var c=[],l=[];(function(t){for(var i=new h,n=new h,r=new h,s=0;s<e.length;s+=3){o(e[s+0],i);o(e[s+1],n);o(e[s+2],r);var c=i,l=n,u=r,p=Math.pow(2,t),d=[],f,m;for(f=0;f<=p;f++){d[f]=[];var v=c.clone().lerp(u,f/p),g=l.clone().lerp(u,f/p),y=p-f;for(m=0;m<=y;m++)d[f][m]=0===m&&f===p?v:v.clone().lerp(g,m/y)}for(f=0;f<p;f++)for(m=0;m<2*(p-f)-1;m++)c=Math.floor(m/2),0===m%2?(a(d[f][c+1]),a(d[f+1][c]),a(d[f][c])):(a(d[f][c+1]),a(d[f+1][c+1]),a(d[f+1][c]))}})(r||0);(function(t){for(var e=new h,i=0;i<c.length;i+=3)e.x=c[i+0],e.y=c[i+1],e.z=c[i+2],e.normalize().multiplyScalar(t),c[i+0]=e.x,c[i+1]=e.y,c[i+2]=e.z})(n);(function(){for(var t=new h,e=0;e<c.length;e+=3)t.x=c[e+0],t.y=c[e+1],t.z=c[e+2],l.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));for(var t=new h,e=new h,n=new h,r=new h,a=new i,o=new i,u=new i,p=0,d=0;p<c.length;p+=9,d+=6){t.set(c[p+0],c[p+1],c[p+2]);e.set(c[p+3],c[p+4],c[p+5]);n.set(c[p+6],c[p+7],c[p+8]);a.set(l[d+0],l[d+1]);o.set(l[d+2],l[d+3]);u.set(l[d+4],l[d+5]);r.copy(t).add(e).add(n).divideScalar(3);var f=Math.atan2(r.z,-r.x);s(a,d+0,t,f);s(o,d+2,e,f);s(u,d+4,n,f)}for(t=0;t<l.length;t+=6)e=l[t+0],n=l[t+2],r=l[t+4],a=Math.min(e,n,r),.9<Math.max(e,n,r)&&.1>a&&(.2>e&&(l[t+0]+=1),.2>n&&(l[t+2]+=1),.2>r&&(l[t+4]+=1))})();this.addAttribute("position",new yt(c,3));this.addAttribute("normal",new yt(c.slice(),3));this.addAttribute("uv",new yt(l,2));this.normalizeNormals()}function Le(t,e){_t.call(this);this.type="TetrahedronGeometry";this.parameters={radius:t,detail:e};this.fromBufferGeometry(new Pe(t,e));this.mergeVertices()}function Pe(t,e){Ae.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e);this.type="TetrahedronBufferGeometry";this.parameters={radius:t,detail:e}}function Ce(t,e){_t.call(this);this.type="OctahedronGeometry";this.parameters={radius:t,detail:e};this.fromBufferGeometry(new Ie(t,e));this.mergeVertices()}function Ie(t,e){Ae.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e);this.type="OctahedronBufferGeometry";this.parameters={radius:t,detail:e}}function Ne(t,e){_t.call(this);this.type="IcosahedronGeometry";this.parameters={radius:t,detail:e};this.fromBufferGeometry(new ze(t,e));this.mergeVertices()}function ze(t,e){var i=(1+Math.sqrt(5))/2;Ae.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e);this.type="IcosahedronBufferGeometry";this.parameters={radius:t,detail:e}}function Ue(t,e){_t.call(this);this.type="DodecahedronGeometry";this.parameters={radius:t,detail:e};this.fromBufferGeometry(new De(t,e));this.mergeVertices()}function De(t,e){var i=(1+Math.sqrt(5))/2,n=1/i;Ae.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e);this.type="DodecahedronBufferGeometry";this.parameters={radius:t,detail:e}}function Oe(t,e,i,n,r,a){_t.call(this);this.type="TubeGeometry";this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");t=new He(t,e,i,n,r);this.tangents=t.tangents;this.normals=t.normals;this.binormals=t.binormals;this.fromBufferGeometry(t);this.mergeVertices()}function He(t,e,n,r,a){function o(i){var a=t.getPointAt(i/e),o=s.normals[i];i=s.binormals[i];for(d=0;d<=r;d++){var h=d/r*Math.PI*2,u=Math.sin(h),h=-Math.cos(h);l.x=h*o.x+u*i.x;l.y=h*o.y+u*i.y;l.z=h*o.z+u*i.z;l.normalize();m.push(l.x,l.y,l.z);c.x=a.x+n*l.x;c.y=a.y+n*l.y;c.z=a.z+n*l.z;f.push(c.x,c.y,c.z)}}wt.call(this);this.type="TubeBufferGeometry";this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:a};e=e||64;n=n||1;r=r||8;a=a||!1;var s=t.computeFrenetFrames(e,a);this.tangents=s.tangents;this.normals=s.normals;this.binormals=s.binormals;var c=new h,l=new h,u=new i,p,d,f=[],m=[],v=[],g=[];for(p=0;p<e;p++)o(p);o(!1===a?e:0);for(p=0;p<=e;p++)for(d=0;d<=r;d++)u.x=p/e,u.y=d/r,v.push(u.x,u.y);(function(){for(d=1;d<=e;d++)for(p=1;p<=r;p++){var t=(r+1)*d+(p-1),i=(r+1)*d+p,n=(r+1)*(d-1)+p;g.push((r+1)*(d-1)+(p-1),t,n);g.push(t,i,n)}})();this.setIndex(g);this.addAttribute("position",new yt(f,3));this.addAttribute("normal",new yt(m,3));this.addAttribute("uv",new yt(v,2))}function Fe(t,e,i,n,r,a,o){_t.call(this);this.type="TorusKnotGeometry";this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a};void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Be(t,e,i,n,r,a));this.mergeVertices()}function Be(t,e,n,r,a,o){function s(t,e,i,n,r){var a=Math.sin(t);e=i/e*t;i=Math.cos(e);r.x=n*(2+i)*.5*Math.cos(t);r.y=n*(2+i)*a*.5;r.z=n*Math.sin(e)*.5}wt.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:a,q:o};t=t||100;e=e||40;n=Math.floor(n)||64;r=Math.floor(r)||8;a=a||2;o=o||3;var c=[],l=[],u=[],p=[],d,f,m=new h,v=new h;new i;var g=new h,y=new h,x=new h,b=new h,M=new h;for(d=0;d<=n;++d)for(f=d/n*a*Math.PI*2,s(f,a,o,t,g),s(f+.01,a,o,t,y),b.subVectors(y,g),M.addVectors(y,g),x.crossVectors(b,M),M.crossVectors(x,b),x.normalize(),M.normalize(),f=0;f<=r;++f){var _=f/r*Math.PI*2,w=-e*Math.cos(_),_=e*Math.sin(_);m.x=g.x+(w*M.x+_*x.x);m.y=g.y+(w*M.y+_*x.y);m.z=g.z+(w*M.z+_*x.z);l.push(m.x,m.y,m.z);v.subVectors(m,g).normalize();u.push(v.x,v.y,v.z);p.push(d/n);p.push(f/r)}for(f=1;f<=n;f++)for(d=1;d<=r;d++)t=(r+1)*f+(d-1),e=(r+1)*f+d,a=(r+1)*(f-1)+d,c.push((r+1)*(f-1)+(d-1),t,a),c.push(t,e,a);this.setIndex(c);this.addAttribute("position",new yt(l,3));this.addAttribute("normal",new yt(u,3));this.addAttribute("uv",new yt(p,2))}function ke(t,e,i,n,r){_t.call(this);this.type="TorusGeometry";this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r};this.fromBufferGeometry(new Ge(t,e,i,n,r))}function Ge(t,e,i,n,r){wt.call(this);this.type="TorusBufferGeometry";this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r};t=t||100;e=e||40;i=Math.floor(i)||8;n=Math.floor(n)||6;r=r||2*Math.PI;var a=[],o=[],s=[],c=[],l=new h,u=new h,p=new h,d,f;for(d=0;d<=i;d++)for(f=0;f<=n;f++){var m=f/n*r,v=d/i*Math.PI*2;u.x=(t+e*Math.cos(v))*Math.cos(m);u.y=(t+e*Math.cos(v))*Math.sin(m);u.z=e*Math.sin(v);o.push(u.x,u.y,u.z);l.x=t*Math.cos(m);l.y=t*Math.sin(m);p.subVectors(u,l).normalize();s.push(p.x,p.y,p.z);c.push(f/n);c.push(d/i)}for(d=1;d<=i;d++)for(f=1;f<=n;f++)t=(n+1)*(d-1)+f-1,e=(n+1)*(d-1)+f,r=(n+1)*d+f,a.push((n+1)*d+f-1,t,r),a.push(t,e,r);this.setIndex(a);this.addAttribute("position",new yt(o,3));this.addAttribute("normal",new yt(s,3));this.addAttribute("uv",new yt(c,2))}function Ve(t,e){"undefined"!==typeof t&&(_t.call(this),this.type="ExtrudeGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeFaceNormals())}function je(t,e){e=e||{};var i=e.font;if(!1===(i&&i.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new _t;i=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50;void 0===e.bevelThickness&&(e.bevelThickness=10);void 0===e.bevelSize&&(e.bevelSize=8);void 0===e.bevelEnabled&&(e.bevelEnabled=!1);Ve.call(this,i,e);this.type="TextGeometry"}function We(t,e,i,n,r,a,o){_t.call(this);this.type="SphereGeometry";this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:o};this.fromBufferGeometry(new qe(t,e,i,n,r,a,o))}function qe(t,e,i,n,r,a,o){wt.call(this);this.type="SphereBufferGeometry";this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:o};t=t||50;e=Math.max(3,Math.floor(e)||8);i=Math.max(2,Math.floor(i)||6);n=void 0!==n?n:0;r=void 0!==r?r:2*Math.PI;a=void 0!==a?a:0;o=void 0!==o?o:Math.PI;var s=a+o,c,l,u=0,p=[],d=new h,f=new h,m=[],v=[],g=[],y=[];for(l=0;l<=i;l++){var x=[],b=l/i;for(c=0;c<=e;c++){var M=c/e;d.x=-t*Math.cos(n+M*r)*Math.sin(a+b*o);d.y=t*Math.cos(a+b*o);d.z=t*Math.sin(n+M*r)*Math.sin(a+b*o);v.push(d.x,d.y,d.z);f.set(d.x,d.y,d.z).normalize();g.push(f.x,f.y,f.z);y.push(M,1-b);x.push(u++)}p.push(x)}for(l=0;l<i;l++)for(c=0;c<e;c++)t=p[l][c+1],n=p[l][c],r=p[l+1][c],o=p[l+1][c+1],(0!==l||0<a)&&m.push(t,n,o),(l!==i-1||s<Math.PI)&&m.push(n,r,o);this.setIndex(m);this.addAttribute("position",new yt(v,3));this.addAttribute("normal",new yt(g,3));this.addAttribute("uv",new yt(y,2))}function Xe(t,e,i,n,r,a){_t.call(this);this.type="RingGeometry";this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a};this.fromBufferGeometry(new Ye(t,e,i,n,r,a))}function Ye(t,e,n,r,a,o){wt.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:a,thetaLength:o};t=t||20;e=e||50;a=void 0!==a?a:0;o=void 0!==o?o:2*Math.PI;n=void 0!==n?Math.max(3,n):8;r=void 0!==r?Math.max(1,r):1;var s=[],c=[],l=[],u=[],p=t,d=(e-t)/r,f=new h,m=new i,v,g;for(v=0;v<=r;v++){for(g=0;g<=n;g++)t=a+g/n*o,f.x=p*Math.cos(t),f.y=p*Math.sin(t),c.push(f.x,f.y,f.z),l.push(0,0,1),m.x=(f.x/e+1)/2,m.y=(f.y/e+1)/2,u.push(m.x,m.y);p+=d}for(v=0;v<r;v++)for(e=v*(n+1),g=0;g<n;g++)t=g+e,a=t+n+1,o=t+n+2,p=t+1,s.push(t,a,p),s.push(a,o,p);this.setIndex(s);this.addAttribute("position",new yt(c,3));this.addAttribute("normal",new yt(l,3));this.addAttribute("uv",new yt(u,2))}function Ze(t,e,i,n){_t.call(this);this.type="LatheGeometry";this.parameters={points:t,segments:e,phiStart:i,phiLength:n};this.fromBufferGeometry(new Qe(t,e,i,n));this.mergeVertices()}function Qe(t,e,n,r){wt.call(this);this.type="LatheBufferGeometry";this.parameters={points:t,segments:e,phiStart:n,phiLength:r};e=Math.floor(e)||12;n=n||0;r=r||2*Math.PI;r=cr.clamp(r,0,2*Math.PI);var a=[],o=[],s=[],c=1/e,l=new h,u=new i,p,d;for(p=0;p<=e;p++){d=n+p*c*r;var f=Math.sin(d),m=Math.cos(d);for(d=0;d<=t.length-1;d++)l.x=t[d].x*f,l.y=t[d].y,l.z=t[d].x*m,o.push(l.x,l.y,l.z),u.x=p/e,u.y=d/(t.length-1),s.push(u.x,u.y)}for(p=0;p<e;p++)for(d=0;d<t.length-1;d++)n=d+p*t.length,c=n+t.length,l=n+t.length+1,u=n+1,a.push(n,c,u),a.push(c,l,u);this.setIndex(a);this.addAttribute("position",new yt(o,3));this.addAttribute("uv",new yt(s,2));this.computeVertexNormals();if(r===2*Math.PI)for(r=this.attributes.normal.array,a=new h,o=new h,s=new h,n=e*t.length*3,d=p=0;p<t.length;p++,d+=3)a.x=r[d+0],a.y=r[d+1],a.z=r[d+2],o.x=r[n+d+0],o.y=r[n+d+1],o.z=r[n+d+2],s.addVectors(a,o).normalize(),r[d+0]=r[n+d+0]=s.x,r[d+1]=r[n+d+1]=s.y,r[d+2]=r[n+d+2]=s.z}function Je(t,e){_t.call(this);this.type="ShapeGeometry";"object"===typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments);this.parameters={shapes:t,curveSegments:e};this.fromBufferGeometry(new Ke(t,e));this.mergeVertices()}function Ke(t,e){function i(t){var i,s,c=r.length/3;t=t.extractPoints(e);var l=t.shape,u=t.holes;if(!1===Tr.isClockWise(l))for(l=l.reverse(),t=0,i=u.length;t<i;t++)s=u[t],!0===Tr.isClockWise(s)&&(u[t]=s.reverse());var p=Tr.triangulateShape(l,u);t=0;for(i=u.length;t<i;t++)s=u[t],l=l.concat(s);t=0;for(i=l.length;t<i;t++)s=l[t],r.push(s.x,s.y,0),a.push(0,0,1),o.push(s.x,s.y);t=0;for(i=p.length;t<i;t++)l=p[t],n.push(l[0]+c,l[1]+c,l[2]+c),h+=3}wt.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:t,curveSegments:e};e=e||12;var n=[],r=[],a=[],o=[],s=0,h=0;if(!1===Array.isArray(t))i(t);else for(var c=0;c<t.length;c++)i(t[c]),this.addGroup(s,h,c),s+=h,h=0;this.setIndex(n);this.addAttribute("position",new yt(r,3));this.addAttribute("normal",new yt(a,3));this.addAttribute("uv",new yt(o,2))}function $e(t,e){function i(t,e){return t-e}wt.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:e};var n=[],r=Math.cos(cr.DEG2RAD*(void 0!==e?e:1)),a=[0,0],o={},s,h=["a","b","c"],c;t.isBufferGeometry?(c=new _t,c.fromBufferGeometry(t)):c=t.clone();c.mergeVertices();c.computeFaceNormals();var l=c.vertices;c=c.faces;for(var u=0,p=c.length;u<p;u++)for(var d=c[u],f=0;3>f;f++)a[0]=d[h[f]],a[1]=d[h[(f+1)%3]],a.sort(i),s=a.toString(),void 0===o[s]?o[s]={index1:a[0],index2:a[1],face1:u,face2:void 0}:o[s].face2=u;for(s in o)if(a=o[s],void 0===a.face2||c[a.face1].normal.dot(c[a.face2].normal)<=r)h=l[a.index1],n.push(h.x,h.y,h.z),h=l[a.index2],n.push(h.x,h.y,h.z);this.addAttribute("position",new yt(n,3))}function ti(t,e,i,n,r,a,o,s){_t.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};this.fromBufferGeometry(new ei(t,e,i,n,r,a,o,s));this.mergeVertices()}function ei(t,e,n,r,a,o,s,c){function l(n){var a,o,l,g=new i,b=new h,M=0,_=!0===n?t:e,w=!0===n?1:-1;o=v;for(a=1;a<=r;a++)d.push(0,y*w,0),f.push(0,w,0),m.push(.5,.5),v++;l=v;for(a=0;a<=r;a++){var E=a/r*c+s,T=Math.cos(E),E=Math.sin(E);b.x=_*E;b.y=y*w;b.z=_*T;d.push(b.x,b.y,b.z);f.push(0,w,0);g.x=.5*T+.5;g.y=.5*E*w+.5;m.push(g.x,g.y);v++}for(a=0;a<r;a++)g=o+a,b=l+a,!0===n?p.push(b,b+1,g):p.push(b+1,b,g),M+=3;u.addGroup(x,M,!0===n?1:2);x+=M}wt.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:c};var u=this;t=void 0!==t?t:20;e=void 0!==e?e:20;n=void 0!==n?n:100;r=Math.floor(r)||8;a=Math.floor(a)||1;o=void 0!==o?o:!1;s=void 0!==s?s:0;c=void 0!==c?c:2*Math.PI;var p=[],d=[],f=[],m=[],v=0,g=[],y=n/2,x=0;(function(){var i,o,l=new h,b=new h,M=0,_=(e-t)/n;for(o=0;o<=a;o++){var w=[],E=o/a,T=E*(e-t)+t;for(i=0;i<=r;i++){var S=i/r,R=S*c+s,A=Math.sin(R),R=Math.cos(R);b.x=T*A;b.y=-E*n+y;b.z=T*R;d.push(b.x,b.y,b.z);l.set(A,_,R).normalize();f.push(l.x,l.y,l.z);m.push(S,1-E);w.push(v++)}g.push(w)}for(i=0;i<r;i++)for(o=0;o<a;o++)l=g[o+1][i],b=g[o+1][i+1],_=g[o][i+1],p.push(g[o][i],l,_),p.push(l,b,_),M+=6;u.addGroup(x,M,0);x+=M})();!1===o&&(0<t&&l(!0),0<e&&l(!1));this.setIndex(p);this.addAttribute("position",new yt(d,3));this.addAttribute("normal",new yt(f,3));this.addAttribute("uv",new yt(m,2))}function ii(t,e,i,n,r,a,o){ti.call(this,0,t,e,i,n,r,a,o);this.type="ConeGeometry";this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:o}}function ni(t,e,i,n,r,a,o){ei.call(this,0,t,e,i,n,r,a,o);this.type="ConeBufferGeometry";this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:o}}function ri(t,e,i,n){_t.call(this);this.type="CircleGeometry";this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n};this.fromBufferGeometry(new ai(t,e,i,n))}function ai(t,e,n,r){wt.call(this);this.type="CircleBufferGeometry";this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r};t=t||50;e=void 0!==e?Math.max(3,e):8;n=void 0!==n?n:0;r=void 0!==r?r:2*Math.PI;var a=[],o=[],s=[],c=[],l,u,p=new h,d=new i;o.push(0,0,0);s.push(0,0,1);c.push(.5,.5);u=0;for(l=3;u<=e;u++,l+=3){var f=n+u/e*r;p.x=t*Math.cos(f);p.y=t*Math.sin(f);o.push(p.x,p.y,p.z);s.push(0,0,1);d.x=(o[l]/t+1)/2;d.y=(o[l+1]/t+1)/2;c.push(d.x,d.y)}for(l=1;l<=e;l++)a.push(l,l+1,0);this.setIndex(a);this.addAttribute("position",new yt(o,3));this.addAttribute("normal",new yt(s,3));this.addAttribute("uv",new yt(c,2))}function oi(){Y.call(this,{uniforms:vr.merge([xr.lights,{opacity:{value:1}}]),vertexShader:gr.shadow_vert,fragmentShader:gr.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}})}function si(t){Y.call(this,t);this.type="RawShaderMaterial"}function hi(t){this.uuid=cr.generateUUID();this.type="MultiMaterial";this.materials=Array.isArray(t)?t:[];this.visible=!0}function ci(t){X.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new G(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new G(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(t)}function li(t){ci.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(t)}function ui(t){X.call(this);this.type="MeshPhongMaterial";this.color=new G(16777215);this.specular=new G(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new G(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(t)}function pi(t){ui.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(t)}function di(t){X.call(this,t);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(t)}function fi(t){X.call(this);this.type="MeshLambertMaterial";this.color=new G(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new G(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(t)}function mi(t){X.call(this);this.type="LineDashedMaterial";this.color=new G(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(t)}function vi(t,e,i){var n=this,r=!1,a=0,o=0;this.onStart=void 0;this.onLoad=t;this.onProgress=e;this.onError=i;this.itemStart=function(t){o++;if(!1===r&&void 0!==n.onStart)n.onStart(t,a,o);r=!0};this.itemEnd=function(t){a++;if(void 0!==n.onProgress)n.onProgress(t,a,o);if(a===o&&(r=!1,void 0!==n.onLoad))n.onLoad()};this.itemError=function(t){if(void 0!==n.onError)n.onError(t)}}function gi(t){this.manager=void 0!==t?t:Lr}function yi(t){this.manager=void 0!==t?t:Lr;this._parser=null}function xi(t){this.manager=void 0!==t?t:Lr;this._parser=null}function bi(t){this.manager=void 0!==t?t:Lr}function Mi(t){this.manager=void 0!==t?t:Lr}function _i(t){this.manager=void 0!==t?t:Lr}function wi(t,e){at.call(this);this.type="Light";this.color=new G(t);this.intensity=void 0!==e?e:1;this.receiveShadow=void 0}function Ei(t,e,i){wi.call(this,t,i);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(at.DefaultUp);this.updateMatrix();this.groundColor=new G(e)}function Ti(t){this.camera=t;this.bias=0;this.radius=1;this.mapSize=new i(512,512);this.map=null;this.matrix=new c}function Si(){Ti.call(this,new Pt(50,1,.5,500))}function Ri(t,e,i,n,r,a){wi.call(this,t,e);this.type="SpotLight";this.position.copy(at.DefaultUp);this.updateMatrix();this.target=new at;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}});this.distance=void 0!==i?i:0;this.angle=void 0!==n?n:Math.PI/3;this.penumbra=void 0!==r?r:0;this.decay=void 0!==a?a:1;this.shadow=new Si}function Ai(t,e,i,n){wi.call(this,t,e);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}});this.distance=void 0!==i?i:0;this.decay=void 0!==n?n:1;this.shadow=new Ti(new Pt(90,1,.5,500))}function Li(){Ti.call(this,new Ct(-5,5,5,-5,.5,500))}function Pi(t,e){wi.call(this,t,e);this.type="DirectionalLight";this.position.copy(at.DefaultUp);this.updateMatrix();this.target=new at;this.shadow=new Li}function Ci(t,e){wi.call(this,t,e);this.type="AmbientLight";this.castShadow=void 0}function Ii(t,e,i,n){this.parameterPositions=t;this._cachedIndex=0;this.resultBuffer=void 0!==n?n:new e.constructor(i);this.sampleValues=e;this.valueSize=i}function Ni(t,e,i,n){Ii.call(this,t,e,i,n);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function zi(t,e,i,n){Ii.call(this,t,e,i,n)}function Ui(t,e,i,n){Ii.call(this,t,e,i,n)}function Di(t,e,i,n){if(void 0===t)throw Error("track name is undefined");if(void 0===e||0===e.length)throw Error("no keyframes in track named "+t);this.name=t;this.times=Pr.convertArray(e,this.TimeBufferType);this.values=Pr.convertArray(i,this.ValueBufferType);this.setInterpolation(n||this.DefaultInterpolation);this.validate();this.optimize()}function Oi(t,e,i,n){Di.call(this,t,e,i,n)}function Hi(t,e,i,n){Ii.call(this,t,e,i,n)}function Fi(t,e,i,n){Di.call(this,t,e,i,n)}function Bi(t,e,i,n){Di.call(this,t,e,i,n)}function ki(t,e,i,n){Di.call(this,t,e,i,n)}function Gi(t,e,i){Di.call(this,t,e,i)}function Vi(t,e,i,n){Di.call(this,t,e,i,n)}function ji(t,e,i,n){Di.apply(this,arguments)}function Wi(t,e,i){this.name=t;this.tracks=i;this.duration=void 0!==e?e:-1;this.uuid=cr.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function qi(t){this.manager=void 0!==t?t:Lr;this.textures={}}function Xi(t){this.manager=void 0!==t?t:Lr}function Yi(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function Zi(t){"boolean"===typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0);this.manager=void 0!==t?t:Lr;this.withCredentials=!1}function Qi(t){this.manager=void 0!==t?t:Lr;this.texturePath=""}function Ji(t,e,i,n,r){e=.5*(n-e);r=.5*(r-i);var a=t*t;return(2*i-2*n+e+r)*t*a+(-3*i+3*n-2*e-r)*a+e*t+i}function Ki(t,e,i,n){var r=1-t;return r*r*e+2*(1-t)*t*i+t*t*n}function $i(t,e,i,n,r){var a=1-t,o=1-t;return a*a*a*e+3*o*o*t*i+3*(1-t)*t*t*n+t*t*t*r}function tn(){}function en(t,e){this.v1=t;this.v2=e}function nn(){this.curves=[];this.autoClose=!1}function rn(t,e,i,n,r,a,o,s){this.aX=t;this.aY=e;this.xRadius=i;this.yRadius=n;this.aStartAngle=r;this.aEndAngle=a;this.aClockwise=o;this.aRotation=s||0}function an(t){this.points=void 0===t?[]:t}function on(t,e,i,n){this.v0=t;this.v1=e;this.v2=i;this.v3=n}function sn(t,e,i){this.v0=t;this.v1=e;this.v2=i}function hn(t){nn.call(this);this.currentPoint=new i;t&&this.fromPoints(t)}function cn(){hn.apply(this,arguments);this.holes=[]}function ln(){this.subPaths=[];this.currentPath=null}function un(t){this.data=t}function pn(t){this.manager=void 0!==t?t:Lr}function dn(t){this.manager=void 0!==t?t:Lr}function fn(t,e,i,n){wi.call(this,t,e);this.type="RectAreaLight";this.position.set(0,1,0);this.updateMatrix();this.width=void 0!==i?i:10;this.height=void 0!==n?n:10}function mn(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Pt;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Pt;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function vn(t,e,i){at.call(this);this.type="CubeCamera";var n=new Pt(90,1,t,e);n.up.set(0,-1,0);n.lookAt(new h(1,0,0));this.add(n);var r=new Pt(90,1,t,e);r.up.set(0,-1,0);r.lookAt(new h(-1,0,0));this.add(r);var a=new Pt(90,1,t,e);a.up.set(0,0,1);a.lookAt(new h(0,1,0));this.add(a);var s=new Pt(90,1,t,e);s.up.set(0,0,-1);s.lookAt(new h(0,-1,0));this.add(s);var c=new Pt(90,1,t,e);c.up.set(0,-1,0);c.lookAt(new h(0,0,1));this.add(c);var l=new Pt(90,1,t,e);l.up.set(0,-1,0);l.lookAt(new h(0,0,-1));this.add(l);this.renderTarget=new o(i,i,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,o=i.texture.generateMipmaps;i.texture.generateMipmaps=!1;i.activeCubeFace=0;t.render(e,n,i);i.activeCubeFace=1;t.render(e,r,i);i.activeCubeFace=2;t.render(e,a,i);i.activeCubeFace=3;t.render(e,s,i);i.activeCubeFace=4;t.render(e,c,i);i.texture.generateMipmaps=o;i.activeCubeFace=5;t.render(e,l,i);t.setRenderTarget(null)}}function gn(){at.call(this);this.type="AudioListener";this.context=zr.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function yn(t){at.call(this);this.type="Audio";this.context=t.context;this.gain=this.context.createGain();this.gain.connect(t.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function xn(t){yn.call(this,t);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function bn(t,e){this.analyser=t.context.createAnalyser();this.analyser.fftSize=void 0!==e?e:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);t.getOutput().connect(this.analyser)}function Mn(t,e,i){this.binding=t;this.valueSize=i;t=Float64Array;switch(e){case"quaternion":e=this._slerp;break;case"string":case"bool":t=Array;e=this._select;break;default:e=this._lerp}this.buffer=new t(4*i);this._mixBufferRegion=e;this.referenceCount=this.useCount=this.cumulativeWeight=0}function _n(t,e,i){this.path=e;this.parsedPath=i||_n.parseTrackName(e);this.node=_n.findNode(t,this.parsedPath.nodeName)||t;this.rootNode=t}function wn(t){this.uuid=cr.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function En(t,e,i){this._mixer=t;this._clip=e;this._localRoot=i||null;t=e.tracks;e=t.length;i=Array(e);for(var n={endingStart:2400,endingEnd:2400},r=0;r!==e;++r){var a=t[r].createInterpolant(null);i[r]=a;a.settings=n}this._interpolantSettings=n;this._interpolants=i;this._propertyBindings=Array(e);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Tn(t){this._root=t;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Sn(t,e){"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=e);this.value=t}function Rn(){wt.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function An(t,e,i,n){this.uuid=cr.generateUUID();this.data=t;this.itemSize=e;this.offset=i;this.normalized=!0===n}function Ln(t,e){this.uuid=cr.generateUUID();this.array=t;this.stride=e;this.count=void 0!==t?t.length/e:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function Pn(t,e,i){Ln.call(this,t,e);this.meshPerAttribute=i||1}function Cn(t,e,i){lt.call(this,t,e);this.meshPerAttribute=i||1}function In(t,e,i,n){this.ray=new it(t,e);this.near=i||0;this.far=n||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function Nn(t,e){return t.distance-e.distance}function zn(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n)){t=t.children;n=0;for(var r=t.length;n<r;n++)zn(t[n],e,i,!0)}}function Un(t){this.autoStart=void 0!==t?t:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function Dn(t,e,i){this.radius=void 0!==t?t:1;this.phi=void 0!==e?e:0;this.theta=void 0!==i?i:0;return this}function On(t,e,i){this.radius=void 0!==t?t:1;this.theta=void 0!==e?e:0;this.y=void 0!==i?i:0;return this}function Hn(t,e){Et.call(this,t,e);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1);this.setAnimationWeight("__default",1)}function Fn(t){at.call(this);this.material=t;this.render=function(t){}}function Bn(t,e,i,n){this.object=t;this.size=void 0!==e?e:1;t=void 0!==i?i:16711680;n=void 0!==n?n:1;e=0;(i=this.object.geometry)&&i.isGeometry?e=3*i.faces.length:i&&i.isBufferGeometry&&(e=i.attributes.normal.count);i=new wt;e=new yt(6*e,3);i.addAttribute("position",e);ve.call(this,i,new fe({color:t,linewidth:n}));this.matrixAutoUpdate=!1;this.update()}function kn(t){at.call(this);this.light=t;this.light.updateMatrixWorld();this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1;t=new wt;for(var e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,n=1;32>i;i++,n++){var r=i/32*Math.PI*2,a=n/32*Math.PI*2;e.push(Math.cos(r),Math.sin(r),1,Math.cos(a),Math.sin(a),1)}t.addAttribute("position",new yt(e,3));e=new fe({fog:!1});this.cone=new ve(t,e);this.add(this.cone);this.update()}function Gn(t){this.bones=this.getBoneList(t);for(var e=new wt,i=[],n=[],r=new G(0,0,1),a=new G(0,1,0),o=0;o<this.bones.length;o++){var s=this.bones[o];s.parent&&s.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(r.r,r.g,r.b),n.push(a.r,a.g,a.b))}e.addAttribute("position",new yt(i,3));e.addAttribute("color",new yt(n,3));i=new fe({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});ve.call(this,e,i);this.root=t;this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function Vn(t,e){this.light=t;this.light.updateMatrixWorld();var i=new qe(e,4,2),n=new ct({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity);Et.call(this,i,n);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function jn(t){at.call(this);this.light=t;this.light.updateMatrixWorld();var e=new ct({color:t.color,fog:!1});t=new ct({color:t.color,fog:!1,wireframe:!0});var i=new wt;i.addAttribute("position",new lt(new Float32Array(18),3));this.add(new Et(i,e));this.add(new Et(i,t));this.update()}function Wn(t,e){at.call(this);this.light=t;this.light.updateMatrixWorld();this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1;var i=new Ie(e);i.rotateY(.5*Math.PI);var n=new ct({vertexColors:2,wireframe:!0}),r=i.getAttribute("position"),r=new Float32Array(3*r.count);i.addAttribute("color",new lt(r,3));this.add(new Et(i,n));this.update()}function qn(t,e,i,n){t=t||10;e=e||10;i=new G(void 0!==i?i:4473924);n=new G(void 0!==n?n:8947848);var r=e/2,a=t/e,o=t/2;t=[];for(var s=[],h=0,c=0,l=-o;h<=e;h++,l+=a){t.push(-o,0,l,o,0,l);t.push(l,0,-o,l,0,o);var u=h===r?i:n;u.toArray(s,c);c+=3;u.toArray(s,c);c+=3;u.toArray(s,c);c+=3;u.toArray(s,c);c+=3}e=new wt;e.addAttribute("position",new yt(t,3));e.addAttribute("color",new yt(s,3));i=new fe({vertexColors:2});ve.call(this,e,i)}function Xn(t,e,i,n,r,a){t=t||10;e=e||16;i=i||8;n=n||64;r=new G(void 0!==r?r:4473924);a=new G(void 0!==a?a:8947848);var o=[],s=[],h,c,l,u,p;for(l=0;l<=e;l++)c=l/e*2*Math.PI,h=Math.sin(c)*t,c=Math.cos(c)*t,o.push(0,0,0),o.push(h,0,c),p=l&1?r:a,s.push(p.r,p.g,p.b),s.push(p.r,p.g,p.b);for(l=0;l<=i;l++)for(p=l&1?r:a,u=t-t/i*l,e=0;e<n;e++)c=e/n*2*Math.PI,h=Math.sin(c)*u,c=Math.cos(c)*u,o.push(h,0,c),s.push(p.r,p.g,p.b),c=(e+1)/n*2*Math.PI,h=Math.sin(c)*u,c=Math.cos(c)*u,o.push(h,0,c),s.push(p.r,p.g,p.b);t=new wt;t.addAttribute("position",new yt(o,3));t.addAttribute("color",new yt(s,3));o=new fe({vertexColors:2});ve.call(this,t,o)}function Yn(t,e,i,n){this.object=t;this.size=void 0!==e?e:1;t=void 0!==i?i:16776960;n=void 0!==n?n:1;e=0;(i=this.object.geometry)&&i.isGeometry?e=i.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");i=new wt;e=new yt(6*e,3);i.addAttribute("position",e);ve.call(this,i,new fe({color:t,linewidth:n}));this.matrixAutoUpdate=!1;this.update()}function Zn(t,e){at.call(this);this.light=t;this.light.updateMatrixWorld();this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1;void 0===e&&(e=1);var i=new wt;i.addAttribute("position",new yt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new fe({fog:!1});this.add(new me(i,n));i=new wt;i.addAttribute("position",new yt([0,0,0,0,0,1],3));this.add(new me(i,n));this.update()}function Qn(t){function e(t,e,n){i(t,n);i(e,n)}function i(t,e){a.push(0,0,0);o.push(e.r,e.g,e.b);void 0===s[t]&&(s[t]=[]);s[t].push(a.length/3-1)}var n=new wt,r=new fe({color:16777215,vertexColors:1}),a=[],o=[],s={},h=new G(16755200),c=new G(16711680),l=new G(43775),u=new G(16777215),p=new G(3355443);e("n1","n2",h);e("n2","n4",h);e("n4","n3",h);e("n3","n1",h);e("f1","f2",h);e("f2","f4",h);e("f4","f3",h);e("f3","f1",h);e("n1","f1",h);e("n2","f2",h);e("n3","f3",h);e("n4","f4",h);e("p","n1",c);e("p","n2",c);e("p","n3",c);e("p","n4",c);e("u1","u2",l);e("u2","u3",l);e("u3","u1",l);e("c","t",u);e("p","c",p);e("cn1","cn2",p);e("cn3","cn4",p);e("cf1","cf2",p);e("cf3","cf4",p);n.addAttribute("position",new yt(a,3));n.addAttribute("color",new yt(o,3));ve.call(this,n,r);this.camera=t;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=t.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=s;this.update()}function Jn(t,e){void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new wt;r.setIndex(new lt(i,1));r.addAttribute("position",new lt(n,3));ve.call(this,r,new fe({color:e}));void 0!==t&&this.update(t)}function Kn(t,e,i,n,r,a){at.call(this);void 0===n&&(n=16776960);void 0===i&&(i=1);void 0===r&&(r=.2*i);void 0===a&&(a=.2*r);void 0===Ur&&(Ur=new wt,Ur.addAttribute("position",new yt([0,0,0,0,1,0],3)),Dr=new ei(0,.5,1,5,1),Dr.translate(0,-.5,0));this.position.copy(e);this.line=new me(Ur,new fe({color:n}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Et(Dr,new ct({color:n}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(t);this.setLength(i,r,a)}function $n(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t];t=new wt;t.addAttribute("position",new yt(e,3));t.addAttribute("color",new yt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));e=new fe({vertexColors:2});ve.call(this,t,e)}function tr(){var t=0,e=0,i=0,n=0;return{initCatmullRom:function(r,a,o,s,h){r=h*(o-r);s=h*(s-a);t=a;e=r;i=-3*a+3*o-2*r-s;n=2*a-2*o+r+s},initNonuniformCatmullRom:function(r,a,o,s,h,c,l){r=((a-r)/h-(o-r)/(h+c)+(o-a)/c)*c;s=((o-a)/c-(s-a)/(c+l)+(s-o)/l)*c;t=a;e=r;i=-3*a+3*o-2*r-s;n=2*a-2*o+r+s},calc:function(r){var a=r*r;return t+e*r+i*a+n*a*r}}}function er(t){this.points=t||[];this.closed=!1}function ir(t,e,i,n){this.v0=t;this.v1=e;this.v2=i;this.v3=n}function nr(t,e,i){this.v0=t;this.v1=e;this.v2=i}function rr(t,e){this.v1=t;this.v2=e}function ar(t,e,i,n,r,a){rn.call(this,t,e,i,i,n,r,a)}function or(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");er.call(this,t);this.type="catmullrom";this.closed=!0}function sr(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");er.call(this,t);this.type="catmullrom"}function hr(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");er.call(this,t);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:0<t?1:+t});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}}();e.prototype={addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]);-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;var i=[],n,r=e.length;for(n=0;n<r;n++)i[n]=e[n];for(n=0;n<r;n++)i[n].call(this,t)}}}};var cr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=Array(36),i=0,n;return function(){for(var r=0;36>r;r++)8===r||13===r||18===r||23===r?e[r]="-":14===r?e[r]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),n=i&15,i>>=4,e[r]=t[19===r?n&3|8:n]);return e.join("")}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){if(t<=e)return 0;if(t>=i)return 1;t=(t-e)/(i-e);return t*t*(3-2*t)},smootherstep:function(t,e,i){if(t<=e)return 0;if(t>=i)return 1;t=(t-e)/(i-e);return t*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*cr.DEG2RAD},radToDeg:function(t){return t*cr.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){t--;t|=t>>1;t|=t>>2;t|=t>>4;t|=t>>8;t|=t>>16;t++;return t}};i.prototype={constructor:i,isVector2:!0,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,e){this.x=t;this.y=e;return this},setScalar:function(t){this.y=this.x=t;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){this.x=t.x;this.y=t.y;return this},add:function(t,e){if(void 0!==e)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e);this.x+=t.x;this.y+=t.y;return this},addScalar:function(t){this.x+=t;this.y+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;return this},addScaledVector:function(t,e){this.x+=t.x*e;this.y+=t.y*e;return this},sub:function(t,e){if(void 0!==e)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e);this.x-=t.x;this.y-=t.y;return this},subScalar:function(t){this.x-=t;this.y-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;return this},multiply:function(t){this.x*=t.x;this.y*=t.y;return this},multiplyScalar:function(t){isFinite(t)?(this.x*=t,this.y*=t):this.y=this.x=0;return this},divide:function(t){this.x/=t.x;this.y/=t.y;return this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);return this},max:function(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);return this},clamp:function(t,e){this.x=Math.max(t.x,Math.min(e.x,this.x));this.y=Math.max(t.y,Math.min(e.y,this.y));return this},clampScalar:function(){var t,e;return function(n,r){void 0===t&&(t=new i,e=new i);t.set(n,n);e.set(r,r);return this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);0>t&&(t+=2*Math.PI);return t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;t=this.y-t.y;return e*e+t*t},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;return this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;return t},fromBufferAttribute:function(t,e,i){void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");this.x=t.getX(e);this.y=t.getY(e);return this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;this.x=r*i-a*n+t.x;this.y=r*n+a*i+t.y;return this}};var lr=0;n.DEFAULT_IMAGE=void 0;n.DEFAULT_MAPPING=300;n.prototype={constructor:n,isTexture:!0,set needsUpdate(t){!0===t&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.image=t.image;this.mipmaps=t.mipmaps.slice(0);this.mapping=t.mapping;this.wrapS=t.wrapS;this.wrapT=t.wrapT;this.magFilter=t.magFilter;this.minFilter=t.minFilter;this.anisotropy=t.anisotropy;this.format=t.format;this.type=t.type;this.offset.copy(t.offset);this.repeat.copy(t.repeat);this.generateMipmaps=t.generateMipmaps;this.premultiplyAlpha=t.premultiplyAlpha;this.flipY=t.flipY;this.unpackAlignment=t.unpackAlignment;this.encoding=t.encoding;return this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=cr.generateUUID());if(void 0===t.images[i.uuid]){var n=t.images,r=i.uuid,a=i.uuid,o;void 0!==i.toDataURL?o=i:(o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),o.width=i.width,o.height=i.height,o.getContext("2d").drawImage(i,0,0,i.width,i.height));o=2048<o.width||2048<o.height?o.toDataURL("image/jpeg",.6):o.toDataURL("image/png");n[r]={uuid:a,url:o}}e.image=i.uuid}return t.textures[this.uuid]=e},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){t.multiply(this.repeat);t.add(this.offset);if(0>t.x||1<t.x)switch(this.wrapS){case 1e3:t.x-=Math.floor(t.x);break;case 1001:t.x=0>t.x?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(0>t.y||1<t.y)switch(this.wrapT){case 1e3:t.y-=Math.floor(t.y);break;case 1001:t.y=0>t.y?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}};Object.assign(n.prototype,e.prototype);r.prototype={constructor:r,isVector4:!0,set:function(t,e,i,n){this.x=t;this.y=e;this.z=i;this.w=n;return this},setScalar:function(t){this.w=this.z=this.y=this.x=t;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},setW:function(t){this.w=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=void 0!==t.w?t.w:1;return this},add:function(t,e){if(void 0!==e)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e);this.x+=t.x;this.y+=t.y;this.z+=t.z;this.w+=t.w;return this},addScalar:function(t){this.x+=t;this.y+=t;this.z+=t;this.w+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;this.w=t.w+e.w;return this},addScaledVector:function(t,e){this.x+=t.x*e;this.y+=t.y*e;this.z+=t.z*e;this.w+=t.w*e;return this},sub:function(t,e){if(void 0!==e)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e);this.x-=t.x;this.y-=t.y;this.z-=t.z;this.w-=t.w;return this},subScalar:function(t){this.x-=t;this.y-=t;this.z-=t;this.w-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;this.w=t.w-e.w;return this},multiplyScalar:function(t){isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w;t=t.elements;this.x=t[0]*e+t[4]*i+t[8]*n+t[12]*r;this.y=t[1]*e+t[5]*i+t[9]*n+t[13]*r;this.z=t[2]*e+t[6]*i+t[10]*n+t[14]*r;this.w=t[3]*e+t[7]*i+t[11]*n+t[15]*r;return this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e);return this},setAxisAngleFromRotationMatrix:function(t){var e,i,n;t=t.elements;var r=t[0];n=t[4];var a=t[8],o=t[1],s=t[5],h=t[9];i=t[2];e=t[6];var c=t[10];if(.01>Math.abs(n-o)&&.01>Math.abs(a-i)&&.01>Math.abs(h-e)){if(.1>Math.abs(n+o)&&.1>Math.abs(a+i)&&.1>Math.abs(h+e)&&.1>Math.abs(r+s+c-3))return this.set(1,0,0,0),this;t=Math.PI;r=(r+1)/2;s=(s+1)/2;c=(c+1)/2;n=(n+o)/4;a=(a+i)/4;h=(h+e)/4;r>s&&r>c?.01>r?(e=0,n=i=.707106781):(e=Math.sqrt(r),i=n/e,n=a/e):s>c?.01>s?(e=.707106781,i=0,n=.707106781):(i=Math.sqrt(s),e=n/i,n=h/i):.01>c?(i=e=.707106781,n=0):(n=Math.sqrt(c),e=a/n,i=h/n);this.set(e,i,n,t);return this}t=Math.sqrt((e-h)*(e-h)+(a-i)*(a-i)+(o-n)*(o-n));.001>Math.abs(t)&&(t=1);this.x=(e-h)/t;this.y=(a-i)/t;this.z=(o-n)/t;this.w=Math.acos((r+s+c-1)/2);return this},min:function(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);this.w=Math.min(this.w,t.w);return this},max:function(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);this.w=Math.max(this.w,t.w);return this},clamp:function(t,e){this.x=Math.max(t.x,Math.min(e.x,this.x));this.y=Math.max(t.y,Math.min(e.y,this.y));this.z=Math.max(t.z,Math.min(e.z,this.z));this.w=Math.max(t.w,Math.min(e.w,this.w));return this},clampScalar:function(){var t,e;return function(i,n){void 0===t&&(t=new r,e=new r);t.set(i,i,i,i);e.set(n,n,n,n);return this.clamp(t,e)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;this.z+=(t.z-this.z)*e;this.w+=(t.w-this.w)*e;return this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];this.z=t[e+2];this.w=t[e+3];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;t[e+2]=this.z;t[e+3]=this.w;return t},fromBufferAttribute:function(t,e,i){void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=t.getX(e);this.y=t.getY(e);this.z=t.getZ(e);this.w=t.getW(e);return this}};a.prototype={constructor:a,isWebGLRenderTarget:!0,setSize:function(t,e){if(this.width!==t||this.height!==e)this.width=t,this.height=e,this.dispose();this.viewport.set(0,0,t,e);this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.width=t.width;this.height=t.height;this.viewport.copy(t.viewport);this.texture=t.texture.clone();this.depthBuffer=t.depthBuffer;this.stencilBuffer=t.stencilBuffer;this.depthTexture=t.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(a.prototype,e.prototype);o.prototype=Object.create(a.prototype);o.prototype.constructor=o;o.prototype.isWebGLRenderTargetCube=!0;s.prototype={constructor:s,get x(){return this._x},set x(t){this._x=t;this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t;this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t;this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t;this.onChangeCallback()},set:function(t,e,i,n){this._x=t;this._y=e;this._z=i;this._w=n;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){this._x=t.x;this._y=t.y;this._z=t.z;this._w=t.w;this.onChangeCallback();return this},setFromEuler:function(t,e){if(!1===(t&&t.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),a=Math.sin(t._x/2),o=Math.sin(t._y/2),s=Math.sin(t._z/2),h=t.order;"XYZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"YXZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"ZXY"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"ZYX"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"YZX"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r-a*o*s):"XZY"===h&&(this._x=a*n*r-i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r+a*o*s);if(!1!==e)this.onChangeCallback();return this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);this._x=t.x*n;this._y=t.y*n;this._z=t.z*n;this._w=Math.cos(i);this.onChangeCallback();return this},setFromRotationMatrix:function(t){var e=t.elements,i=e[0];t=e[4];var n=e[8],r=e[1],a=e[5],o=e[9],s=e[2],h=e[6],e=e[10],c=i+a+e;0<c?(i=.5/Math.sqrt(c+1),this._w=.25/i,this._x=(h-o)*i,this._y=(n-s)*i,this._z=(r-t)*i):i>a&&i>e?(i=2*Math.sqrt(1+i-a-e),this._w=(h-o)/i,this._x=.25*i,this._y=(t+r)/i,this._z=(n+s)/i):a>e?(i=2*Math.sqrt(1+a-i-e),this._w=(n-s)/i,this._x=(t+r)/i,this._y=.25*i,this._z=(o+h)/i):(i=2*Math.sqrt(1+e-i-a),this._w=(r-t)/i,this._x=(n+s)/i,this._y=(o+h)/i,this._z=.25*i);this.onChangeCallback();return this},setFromUnitVectors:function(){var t,e;return function(i,n){void 0===t&&(t=new h);e=i.dot(n)+1;1e-6>e?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,n);this._x=t.x;this._y=t.y;this._z=t.z;this._w=e;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t);this.onChangeCallback();return this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,a=t._w,o=e._x,s=e._y,h=e._z,c=e._w;this._x=i*c+a*o+n*h-r*s;this._y=n*c+a*s+r*o-i*h;this._z=r*c+a*h+i*s-n*o;this._w=a*c-i*o-n*s-r*h;this.onChangeCallback();return this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,a=this._w,o=a*t._w+i*t._x+n*t._y+r*t._z;0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t);if(1<=o)return this._w=a,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-o*o);if(.001>Math.abs(s))return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var h=Math.atan2(s,o),o=Math.sin((1-e)*h)/s,s=Math.sin(e*h)/s;this._w=a*o+this._w*s;this._x=i*o+this._x*s;this._y=n*o+this._y*s;this._z=r*o+this._z*s;this.onChangeCallback();return this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){void 0===e&&(e=0);this._x=t[e];this._y=t[e+1];this._z=t[e+2];this._w=t[e+3];this.onChangeCallback();return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this._x;t[e+1]=this._y;t[e+2]=this._z;t[e+3]=this._w;return t},onChange:function(t){this.onChangeCallback=t;return this},onChangeCallback:function(){}};Object.assign(s,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,a,o){var s=i[n+0],h=i[n+1],c=i[n+2];i=i[n+3];n=r[a+0];var l=r[a+1],u=r[a+2];r=r[a+3];if(i!==r||s!==n||h!==l||c!==u){a=1-o;var p=s*n+h*l+c*u+i*r,d=0<=p?1:-1,f=1-p*p;f>Number.EPSILON&&(f=Math.sqrt(f),p=Math.atan2(f,p*d),a=Math.sin(a*p)/f,o=Math.sin(o*p)/f);d*=o;s=s*a+n*d;h=h*a+l*d;c=c*a+u*d;i=i*a+r*d;a===1-o&&(o=1/Math.sqrt(s*s+h*h+c*c+i*i),s*=o,h*=o,c*=o,i*=o)}t[e]=s;t[e+1]=h;t[e+2]=c;t[e+3]=i}});h.prototype={constructor:h,isVector3:!0,set:function(t,e,i){this.x=t;this.y=e;this.z=i;return this},setScalar:function(t){this.z=this.y=this.x=t;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},add:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e);this.x+=t.x;this.y+=t.y;this.z+=t.z;return this},addScalar:function(t){this.x+=t;this.y+=t;this.z+=t;return this},addVectors:function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;return this},addScaledVector:function(t,e){this.x+=t.x*e;this.y+=t.y*e;this.z+=t.z*e;return this},sub:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e);this.x-=t.x;this.y-=t.y;this.z-=t.z;return this},subScalar:function(t){this.x-=t;this.y-=t;this.z-=t;return this},subVectors:function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;return this},multiply:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e);this.x*=t.x;this.y*=t.y;this.z*=t.z;return this},multiplyScalar:function(t){isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):this.z=this.y=this.x=0;return this},multiplyVectors:function(t,e){this.x=t.x*e.x;this.y=t.y*e.y;this.z=t.z*e.z;return this},applyEuler:function(){var t;return function(e){!1===(e&&e.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===t&&(t=new s);return this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t;return function(e,i){void 0===t&&(t=new s);return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z;t=t.elements;this.x=t[0]*e+t[3]*i+t[6]*n;this.y=t[1]*e+t[4]*i+t[7]*n;this.z=t[2]*e+t[5]*i+t[8]*n;return this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z;t=t.elements;this.x=t[0]*e+t[4]*i+t[8]*n+t[12];this.y=t[1]*e+t[5]*i+t[9]*n+t[13];this.z=t[2]*e+t[6]*i+t[10]*n+t[14];return this.divideScalar(t[3]*e+t[7]*i+t[11]*n+t[15])},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,o=t.z;t=t.w;var s=t*e+a*n-o*i,h=t*i+o*e-r*n,c=t*n+r*i-a*e,e=-r*e-a*i-o*n;this.x=s*t+e*-r+h*-o-c*-a;this.y=h*t+e*-a+c*-r-s*-o;this.z=c*t+e*-o+s*-a-h*-r;return this},project:function(){var t;return function(e){void 0===t&&(t=new c);t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld));return this.applyMatrix4(t)}}(),unproject:function(){var t;return function(e){void 0===t&&(t=new c);t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix));return this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,n=this.z;t=t.elements;this.x=t[0]*e+t[4]*i+t[8]*n;this.y=t[1]*e+t[5]*i+t[9]*n;this.z=t[2]*e+t[6]*i+t[10]*n;return this.normalize()},divide:function(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);return this},max:function(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);return this},clamp:function(t,e){this.x=Math.max(t.x,Math.min(e.x,this.x));this.y=Math.max(t.y,Math.min(e.y,this.y));this.z=Math.max(t.z,Math.min(e.z,this.z));return this},clampScalar:function(){var t,e;return function(i,n){void 0===t&&(t=new h,e=new h);t.set(i,i,i);e.set(n,n,n);return this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;this.z+=(t.z-this.z)*e;return this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;this.x=n*t.z-r*t.y;this.y=r*t.x-i*t.z;this.z=i*t.y-n*t.x;return this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,o=e.y,s=e.z;this.x=n*s-r*o;this.y=r*a-i*s;this.z=i*o-n*a;return this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t;return function(e){void 0===t&&(t=new h);t.copy(this).projectOnVector(e);return this.sub(t)}}(),reflect:function(){var t;return function(e){void 0===t&&(t=new h);return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){t=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(cr.clamp(t,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;t=this.z-t.z;return e*e+i*i+t*t},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;this.x=e*Math.sin(t.theta);this.y=Math.cos(t.phi)*t.radius;this.z=e*Math.cos(t.theta);return this},setFromCylindrical:function(t){this.x=t.radius*Math.sin(t.theta);this.y=t.y;this.z=t.radius*Math.cos(t.theta);return this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length();t=this.setFromMatrixColumn(t,2).length();this.x=e;this.y=i;this.z=t;return this},setFromMatrixColumn:function(t,e){if("number"===typeof t){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var i=t;t=e;e=i}return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){void 0===e&&(e=0);this.x=t[e];this.y=t[e+1];this.z=t[e+2];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.x;t[e+1]=this.y;t[e+2]=this.z;return t},fromBufferAttribute:function(t,e,i){void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");this.x=t.getX(e);this.y=t.getY(e);this.z=t.getZ(e);return this}};c.prototype={constructor:c,isMatrix4:!0,set:function(t,e,i,n,r,a,o,s,h,c,l,u,p,d,f,m){var v=this.elements;v[0]=t;v[4]=e;v[8]=i;v[12]=n;v[1]=r;v[5]=a;v[9]=o;v[13]=s;v[2]=h;v[6]=c;v[10]=l;v[14]=u;v[3]=p;v[7]=d;v[11]=f;v[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new c).fromArray(this.elements)},copy:function(t){this.elements.set(t.elements);return this},copyPosition:function(t){var e=this.elements;t=t.elements;e[12]=t[12];e[13]=t[13];e[14]=t[14];return this},extractBasis:function(t,e,i){t.setFromMatrixColumn(this,0);e.setFromMatrixColumn(this,1);i.setFromMatrixColumn(this,2);return this},makeBasis:function(t,e,i){this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1);return this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new h);var i=this.elements,n=e.elements,r=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length();e=1/t.setFromMatrixColumn(e,2).length();i[0]=n[0]*r;i[1]=n[1]*r;i[2]=n[2]*r;i[4]=n[4]*a;i[5]=n[5]*a;i[6]=n[6]*a;i[8]=n[8]*e;i[9]=n[9]*e;i[10]=n[10]*e;return this}}(),makeRotationFromEuler:function(t){!1===(t&&t.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,a=Math.cos(i),i=Math.sin(i),o=Math.cos(n),n=Math.sin(n),s=Math.cos(r),r=Math.sin(r);if("XYZ"===t.order){t=a*s;var h=a*r,c=i*s,l=i*r;e[0]=o*s;e[4]=-o*r;e[8]=n;e[1]=h+c*n;e[5]=t-l*n;e[9]=-i*o;e[2]=l-t*n;e[6]=c+h*n;e[10]=a*o}else"YXZ"===t.order?(t=o*s,h=o*r,c=n*s,l=n*r,e[0]=t+l*i,e[4]=c*i-h,e[8]=a*n,e[1]=a*r,e[5]=a*s,e[9]=-i,e[2]=h*i-c,e[6]=l+t*i,e[10]=a*o):"ZXY"===t.order?(t=o*s,h=o*r,c=n*s,l=n*r,e[0]=t-l*i,e[4]=-a*r,e[8]=c+h*i,e[1]=h+c*i,e[5]=a*s,e[9]=l-t*i,e[2]=-a*n,e[6]=i,e[10]=a*o):"ZYX"===t.order?(t=a*s,h=a*r,c=i*s,l=i*r,e[0]=o*s,e[4]=c*n-h,e[8]=t*n+l,e[1]=o*r,e[5]=l*n+t,e[9]=h*n-c,e[2]=-n,e[6]=i*o,e[10]=a*o):"YZX"===t.order?(t=a*o,h=a*n,c=i*o,l=i*n,e[0]=o*s,e[4]=l-t*r,e[8]=c*r+h,e[1]=r,e[5]=a*s,e[9]=-i*s,e[2]=-n*s,e[6]=h*r+c,e[10]=t-l*r):"XZY"===t.order&&(t=a*o,h=a*n,c=i*o,l=i*n,e[0]=o*s,e[4]=-r,e[8]=n*s,e[1]=t*r+l,e[5]=a*s,e[9]=h*r-c,e[2]=c*r-h,e[6]=i*s,e[10]=l*r+t);e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,a=t.w,o=i+i,s=n+n,h=r+r;t=i*o;var c=i*s,i=i*h,l=n*s,n=n*h,r=r*h,o=a*o,s=a*s,a=a*h;e[0]=1-(l+r);e[4]=c-a;e[8]=i+s;e[1]=c+a;e[5]=1-(t+r);e[9]=n-o;e[2]=i-s;e[6]=n+o;e[10]=1-(t+l);e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this},lookAt:function(){var t,e,i;return function(n,r,a){void 0===t&&(t=new h,e=new h,i=new h);var o=this.elements;i.subVectors(n,r).normalize();0===i.lengthSq()&&(i.z=1);t.crossVectors(a,i).normalize();0===t.lengthSq()&&(i.z+=1e-4,t.crossVectors(a,i).normalize());e.crossVectors(i,t);o[0]=t.x;o[4]=e.x;o[8]=i.x;o[1]=t.y;o[5]=e.y;o[9]=i.y;o[2]=t.z;o[6]=e.z;o[10]=i.z;return this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],c=i[1],l=i[5],u=i[9],p=i[13],d=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],x=i[11],i=i[15],b=n[0],M=n[4],_=n[8],w=n[12],E=n[1],T=n[5],S=n[9],R=n[13],A=n[2],L=n[6],P=n[10],C=n[14],I=n[3],N=n[7],z=n[11],n=n[15];r[0]=a*b+o*E+s*A+h*I;r[4]=a*M+o*T+s*L+h*N;r[8]=a*_+o*S+s*P+h*z;r[12]=a*w+o*R+s*C+h*n;r[1]=c*b+l*E+u*A+p*I;r[5]=c*M+l*T+u*L+p*N;r[9]=c*_+l*S+u*P+p*z;r[13]=c*w+l*R+u*C+p*n;r[2]=d*b+f*E+m*A+v*I;r[6]=d*M+f*T+m*L+v*N;r[10]=d*_+f*S+m*P+v*z;r[14]=d*w+f*R+m*C+v*n;r[3]=g*b+y*E+x*A+i*I;r[7]=g*M+y*T+x*L+i*N;r[11]=g*_+y*S+x*P+i*z;r[15]=g*w+y*R+x*C+i*n;return this},multiplyToArray:function(t,e,i){var n=this.elements;this.multiplyMatrices(t,e);i[0]=n[0];i[1]=n[1];i[2]=n[2];i[3]=n[3];i[4]=n[4];i[5]=n[5];i[6]=n[6];i[7]=n[7];i[8]=n[8];i[9]=n[9];i[10]=n[10];i[11]=n[11];i[12]=n[12];i[13]=n[13];i[14]=n[14];i[15]=n[15];return this},multiplyScalar:function(t){var e=this.elements;e[0]*=t;e[4]*=t;e[8]*=t;e[12]*=t;e[1]*=t;e[5]*=t;e[9]*=t;e[13]*=t;e[2]*=t;e[6]*=t;e[10]*=t;e[14]*=t;e[3]*=t;e[7]*=t;e[11]*=t;e[15]*=t;return this},applyToBufferAttribute:function(){var t;return function(e){void 0===t&&(t=new h);for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],o=t[5],s=t[9],h=t[13],c=t[2],l=t[6],u=t[10],p=t[14];return t[3]*(+r*s*l-n*h*l-r*o*u+i*h*u+n*o*p-i*s*p)+t[7]*(+e*s*p-e*h*u+r*a*u-n*a*p+n*h*c-r*s*c)+t[11]*(+e*h*l-e*o*p-r*a*l+i*a*p+r*o*c-i*h*c)+t[15]*(-n*o*c-e*s*l+e*o*u+n*a*l-i*a*u+i*s*c)},transpose:function(){var t=this.elements,e;e=t[1];t[1]=t[4];t[4]=e;e=t[2];t[2]=t[8];t[8]=e;e=t[6];t[6]=t[9];t[9]=e;e=t[3];t[3]=t[12];t[12]=e;e=t[7];t[7]=t[13];t[13]=e;e=t[11];t[11]=t[14];t[14]=e;return this},setPosition:function(t){var e=this.elements;e[12]=t.x;e[13]=t.y;e[14]=t.z;return this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],a=n[1],o=n[2],s=n[3],h=n[4],c=n[5],l=n[6],u=n[7],p=n[8],d=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],n=n[15],x=d*y*u-g*f*u+g*l*m-c*y*m-d*l*n+c*f*n,b=v*f*u-p*y*u-v*l*m+h*y*m+p*l*n-h*f*n,M=p*g*u-v*d*u+v*c*m-h*g*m-p*c*n+h*d*n,_=v*d*l-p*g*l-v*c*f+h*g*f+p*c*y-h*d*y,w=r*x+a*b+o*M+s*_;if(0===w){if(!0===e)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}w=1/w;i[0]=x*w;i[1]=(g*f*s-d*y*s-g*o*m+a*y*m+d*o*n-a*f*n)*w;i[2]=(c*y*s-g*l*s+g*o*u-a*y*u-c*o*n+a*l*n)*w;i[3]=(d*l*s-c*f*s-d*o*u+a*f*u+c*o*m-a*l*m)*w;i[4]=b*w;i[5]=(p*y*s-v*f*s+v*o*m-r*y*m-p*o*n+r*f*n)*w;i[6]=(v*l*s-h*y*s-v*o*u+r*y*u+h*o*n-r*l*n)*w;i[7]=(h*f*s-p*l*s+p*o*u-r*f*u-h*o*m+r*l*m)*w;i[8]=M*w;i[9]=(v*d*s-p*g*s-v*a*m+r*g*m+p*a*n-r*d*n)*w;i[10]=(h*g*s-v*c*s+v*a*u-r*g*u-h*a*n+r*c*n)*w;i[11]=(p*c*s-h*d*s-p*a*u+r*d*u+h*a*m-r*c*m)*w;i[12]=_*w;i[13]=(p*g*o-v*d*o+v*a*f-r*g*f-p*a*y+r*d*y)*w;i[14]=(v*c*o-h*g*o-v*a*l+r*g*l+h*a*y-r*c*y)*w;i[15]=(h*d*o-p*c*o+p*a*l-r*d*l-h*a*f+r*c*f)*w;return this},scale:function(t){var e=this.elements,i=t.x,n=t.y;t=t.z;e[0]*=i;e[4]*=n;e[8]*=t;e[1]*=i;e[5]*=n;e[9]*=t;e[2]*=i;e[6]*=n;e[10]*=t;e[3]*=i;e[7]*=n;e[11]*=t;return this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,i){this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1);return this},makeRotationX:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1);return this},makeRotationY:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1);return this},makeRotationZ:function(t){var e=Math.cos(t);t=Math.sin(t);this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,o=t.y,s=t.z,h=r*a,c=r*o;this.set(h*a+i,h*o-n*s,h*s+n*o,0,h*o+n*s,c*o+i,c*s-n*a,0,h*s-n*o,c*s+n*a,r*s*s+i,0,0,0,0,1);return this},makeScale:function(t,e,i){this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1);return this},makeShear:function(t,e,i){this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1);return this},compose:function(t,e,i){this.makeRotationFromQuaternion(e);this.scale(i);this.setPosition(t);return this},decompose:function(){var t,e;return function(i,n,r){void 0===t&&(t=new h,e=new c);var a=this.elements,o=t.set(a[0],a[1],a[2]).length(),s=t.set(a[4],a[5],a[6]).length(),l=t.set(a[8],a[9],a[10]).length();0>this.determinant()&&(o=-o);i.x=a[12];i.y=a[13];i.z=a[14];e.elements.set(this.elements);i=1/o;var a=1/s,u=1/l;e.elements[0]*=i;e.elements[1]*=i;e.elements[2]*=i;e.elements[4]*=a;e.elements[5]*=a;e.elements[6]*=a;e.elements[8]*=u;e.elements[9]*=u;e.elements[10]*=u;n.setFromRotationMatrix(e);r.x=o;r.y=s;r.z=l;return this}}(),makePerspective:function(t,e,i,n,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements;o[0]=2*r/(e-t);o[4]=0;o[8]=(e+t)/(e-t);o[12]=0;o[1]=0;o[5]=2*r/(i-n);o[9]=(i+n)/(i-n);o[13]=0;o[2]=0;o[6]=0;o[10]=-(a+r)/(a-r);o[14]=-2*a*r/(a-r);o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makeOrthographic:function(t,e,i,n,r,a){var o=this.elements,s=1/(e-t),h=1/(i-n),c=1/(a-r);o[0]=2*s;o[4]=0;o[8]=0;o[12]=-((e+t)*s);o[1]=0;o[5]=2*h;o[9]=0;o[13]=-((i+n)*h);o[2]=0;o[6]=0;o[10]=-2*c;o[14]=-((a+r)*c);o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},equals:function(t){var e=this.elements;t=t.elements;for(var i=0;16>i;i++)if(e[i]!==t[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;16>i;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);var i=this.elements;t[e]=i[0];t[e+1]=i[1];t[e+2]=i[2];t[e+3]=i[3];t[e+4]=i[4];t[e+5]=i[5];t[e+6]=i[6];t[e+7]=i[7];t[e+8]=i[8];t[e+9]=i[9];t[e+10]=i[10];t[e+11]=i[11];t[e+12]=i[12];t[e+13]=i[13];t[e+14]=i[14];t[e+15]=i[15];return t}};l.prototype=Object.create(n.prototype);l.prototype.constructor=l;l.prototype.isCubeTexture=!0;Object.defineProperty(l.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ur=new n,pr=new l,dr=[],fr=[];B.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var a=i[n];a.setValue(t,e[a.id])}};var mr=/([\w\d_]+)(\])?(\[|\.)?/g;k.prototype.setValue=function(t,e,i){e=this.map[e];void 0!==e&&e.setValue(t,i,this.renderer)};k.prototype.set=function(t,e,i){var n=this.map[i];void 0!==n&&n.setValue(t,e[i],this.renderer)};k.prototype.setOptional=function(t,e,i){e=e[i];void 0!==e&&this.setValue(t,i,e)};k.upload=function(t,e,i,n){for(var r=0,a=e.length;r!==a;++r){var o=e[r],s=i[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,n)}};k.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var a=t[n];a.id in e&&i.push(a)}return i};var vr={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]),r;for(r in n)e[r]=n[r]}return e},clone:function(t){var e={},i;for(i in t){e[i]={};for(var n in t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}},gr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};G.prototype={constructor:G,isColor:!0,r:1,g:1,b:1,set:function(t){t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t);return this},setScalar:function(t){this.b=this.g=this.r=t;return this},setHex:function(t){t=Math.floor(t);this.r=(t>>16&255)/255;this.g=(t>>8&255)/255;this.b=(t&255)/255;return this},setRGB:function(t,e,i){this.r=t;this.g=e;this.b=i;return this},setHSL:function(){function t(t,e,i){0>i&&(i+=1);1<i&&--i;return i<1/6?t+6*(e-t)*i:.5>i?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){e=cr.euclideanModulo(e,1);i=cr.clamp(i,0,1);n=cr.clamp(n,0,1);0===i?this.r=this.g=this.b=n:(i=.5>=n?n*(1+i):n+i-n*i,n=2*n-i,this.r=t(n,i,e+1/3),this.g=t(n,i,e),this.b=t(n,i,e-1/3));return this}}(),setStyle:function(t){function e(e){void 0!==e&&1>parseFloat(e)&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n=i[2];switch(i[1]){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var n=parseFloat(i[1])/360,r=parseInt(i[2],10)/100,a=parseInt(i[3],10)/100;e(i[5]);return this.setHSL(n,r,a)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){i=i[1];n=i.length;if(3===n)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}t&&0<t.length&&(i=yr[t],void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){this.r=t.r;this.g=t.g;this.b=t.b;return this},copyGammaToLinear:function(t,e){void 0===e&&(e=2);this.r=Math.pow(t.r,e);this.g=Math.pow(t.g,e);this.b=Math.pow(t.b,e);return this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=0<e?1/e:1;this.r=Math.pow(t.r,i);this.g=Math.pow(t.g,i);this.b=Math.pow(t.b,i);return this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;this.r=t*t;this.g=e*e;this.b=i*i;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t=t||{h:0,s:0,l:0};var e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),a=Math.min(e,i,n),o,s=(a+r)/2;if(a===r)a=o=0;else{var h=r-a,a=.5>=s?h/(r+a):h/(2-r-a);switch(r){case e:o=(i-n)/h+(i<n?6:0);break;case i:o=(n-e)/h+2;break;case n:o=(e-i)/h+4}o/=6}t.h=o;t.s=a;t.l=s;return t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();n.h+=t;n.s+=e;n.l+=i;this.setHSL(n.h,n.s,n.l);return this},add:function(t){this.r+=t.r;this.g+=t.g;this.b+=t.b;return this},addColors:function(t,e){this.r=t.r+e.r;this.g=t.g+e.g;this.b=t.b+e.b;return this},addScalar:function(t){this.r+=t;this.g+=t;this.b+=t;return this},sub:function(t){this.r=Math.max(0,this.r-t.r);this.g=Math.max(0,this.g-t.g);this.b=Math.max(0,this.b-t.b);return this},multiply:function(t){this.r*=t.r;this.g*=t.g;this.b*=t.b;return this},multiplyScalar:function(t){this.r*=t;this.g*=t;this.b*=t;return this},lerp:function(t,e){this.r+=(t.r-this.r)*e;this.g+=(t.g-this.g)*e;this.b+=(t.b-this.b)*e;return this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){void 0===e&&(e=0);this.r=t[e];this.g=t[e+1];this.b=t[e+2];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this.r;t[e+1]=this.g;t[e+2]=this.b;return t},toJSON:function(){return this.getHex()}};var yr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};V.prototype=Object.create(n.prototype);V.prototype.constructor=V;V.prototype.isDataTexture=!0;var xr={common:{diffuse:{value:new G(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new r(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new G(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new G(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new r(0,0,1,1)}}},br={basic:{uniforms:vr.merge([xr.common,xr.aomap,xr.lightmap,xr.fog]),vertexShader:gr.meshbasic_vert,fragmentShader:gr.meshbasic_frag},lambert:{uniforms:vr.merge([xr.common,xr.aomap,xr.lightmap,xr.emissivemap,xr.fog,xr.lights,{emissive:{value:new G(0)}}]),vertexShader:gr.meshlambert_vert,fragmentShader:gr.meshlambert_frag},phong:{uniforms:vr.merge([xr.common,xr.aomap,xr.lightmap,xr.emissivemap,xr.bumpmap,xr.normalmap,xr.displacementmap,xr.gradientmap,xr.fog,xr.lights,{emissive:{value:new G(0)},specular:{value:new G(1118481)},shininess:{value:30}}]),vertexShader:gr.meshphong_vert,fragmentShader:gr.meshphong_frag},standard:{uniforms:vr.merge([xr.common,xr.aomap,xr.lightmap,xr.emissivemap,xr.bumpmap,xr.normalmap,xr.displacementmap,xr.roughnessmap,xr.metalnessmap,xr.fog,xr.lights,{emissive:{value:new G(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gr.meshphysical_vert,fragmentShader:gr.meshphysical_frag},points:{uniforms:vr.merge([xr.points,xr.fog]),vertexShader:gr.points_vert,fragmentShader:gr.points_frag},dashed:{uniforms:vr.merge([xr.common,xr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gr.linedashed_vert,fragmentShader:gr.linedashed_frag},depth:{uniforms:vr.merge([xr.common,xr.displacementmap]),vertexShader:gr.depth_vert,fragmentShader:gr.depth_frag},normal:{uniforms:vr.merge([xr.common,xr.bumpmap,xr.normalmap,xr.displacementmap,{opacity:{value:1}}]),vertexShader:gr.normal_vert,fragmentShader:gr.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:gr.cube_vert,fragmentShader:gr.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:gr.equirect_vert,fragmentShader:gr.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new h}},vertexShader:gr.distanceRGBA_vert,fragmentShader:gr.distanceRGBA_frag}};br.physical={uniforms:vr.merge([br.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:gr.meshphysical_vert,fragmentShader:gr.meshphysical_frag};j.prototype={constructor:j,set:function(t,e){this.min.copy(t);this.max.copy(e);return this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new i;return function(e,i){var n=t.copy(i).multiplyScalar(.5);this.min.copy(e).sub(n);this.max.copy(e).add(n);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){t=t||new i;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){t=t||new i;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){this.min.min(t);this.max.max(t);return this},expandByVector:function(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function(t){this.min.addScalar(-t);this.max.addScalar(t);return this},containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new i).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y?!1:!0},clampPoint:function(t,e){return(e||new i).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new i;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){this.min.max(t.min);this.max.min(t.max);return this},union:function(t){this.min.min(t.min);this.max.max(t.max);return this},translate:function(t){this.min.add(t);this.max.add(t);return this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};var Mr=0;X.prototype={constructor:X,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update();this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0===i)console.warn("THREE.Material: '"+e+"' parameter is undefined.");else{var n=this[e];void 0===n?console.warn("THREE."+this.type+": '"+e+"' is not a property of this material."):n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i}}},toJSON:function(t){function e(t){var e=[],i;for(i in t){var n=t[i];delete n.metadata;e.push(n)}return e}var i=void 0===t;i&&(t={textures:{},images:{}});var n={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid;n.type=this.type;""!==this.name&&(n.name=this.name);this.color&&this.color.isColor&&(n.color=this.color.getHex());void 0!==this.roughness&&(n.roughness=this.roughness);void 0!==this.metalness&&(n.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex());this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex());void 0!==this.shininess&&(n.shininess=this.shininess);void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid);this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid);this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid);this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid);this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid);this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity);this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid);void 0!==this.size&&(n.size=this.size);void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(n.blending=this.blending);2!==this.shading&&(n.shading=this.shading);0!==this.side&&(n.side=this.side);0!==this.vertexColors&&(n.vertexColors=this.vertexColors);1>this.opacity&&(n.opacity=this.opacity);!0===this.transparent&&(n.transparent=this.transparent);n.depthFunc=this.depthFunc;n.depthTest=this.depthTest;n.depthWrite=this.depthWrite;0<this.alphaTest&&(n.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(n.wireframe=this.wireframe);1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin);n.skinning=this.skinning;n.morphTargets=this.morphTargets;i&&(i=e(t.textures),t=e(t.images),0<i.length&&(n.textures=i),0<t.length&&(n.images=t));return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name;this.fog=t.fog;this.lights=t.lights;this.blending=t.blending;this.side=t.side;this.shading=t.shading;this.vertexColors=t.vertexColors;this.opacity=t.opacity;this.transparent=t.transparent;this.blendSrc=t.blendSrc;this.blendDst=t.blendDst;this.blendEquation=t.blendEquation;this.blendSrcAlpha=t.blendSrcAlpha;this.blendDstAlpha=t.blendDstAlpha;this.blendEquationAlpha=t.blendEquationAlpha;this.depthFunc=t.depthFunc;this.depthTest=t.depthTest;this.depthWrite=t.depthWrite;this.colorWrite=t.colorWrite;this.precision=t.precision;this.polygonOffset=t.polygonOffset;this.polygonOffsetFactor=t.polygonOffsetFactor;this.polygonOffsetUnits=t.polygonOffsetUnits;this.alphaTest=t.alphaTest;this.premultipliedAlpha=t.premultipliedAlpha;this.overdraw=t.overdraw;this.visible=t.visible;this.clipShadows=t.clipShadows;this.clipIntersection=t.clipIntersection;t=t.clippingPlanes;var e=null;if(null!==t)for(var i=t.length,e=Array(i),n=0;n!==i;++n)e[n]=t[n].clone();this.clippingPlanes=e;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(X.prototype,e.prototype);Y.prototype=Object.create(X.prototype);Y.prototype.constructor=Y;Y.prototype.isShaderMaterial=!0;Y.prototype.copy=function(t){X.prototype.copy.call(this,t);this.fragmentShader=t.fragmentShader;this.vertexShader=t.vertexShader;this.uniforms=vr.clone(t.uniforms);this.defines=t.defines;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.lights=t.lights;this.clipping=t.clipping;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.morphNormals=t.morphNormals;this.extensions=t.extensions;return this};Y.prototype.toJSON=function(t){t=X.prototype.toJSON.call(this,t);t.uniforms=this.uniforms;t.vertexShader=this.vertexShader;t.fragmentShader=this.fragmentShader;return t};Z.prototype=Object.create(X.prototype);Z.prototype.constructor=Z;Z.prototype.isMeshDepthMaterial=!0;Z.prototype.copy=function(t){X.prototype.copy.call(this,t);this.depthPacking=t.depthPacking;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.map=t.map;this.alphaMap=t.alphaMap;this.displacementMap=t.displacementMap;this.displacementScale=t.displacementScale;this.displacementBias=t.displacementBias;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;return this};Q.prototype={constructor:Q,isBox3:!0,set:function(t,e){this.min.copy(t);this.max.copy(e);return this},setFromArray:function(t){for(var e=Infinity,i=Infinity,n=Infinity,r=-Infinity,a=-Infinity,o=-Infinity,s=0,h=t.length;s<h;s+=3){var c=t[s],l=t[s+1],u=t[s+2];c<e&&(e=c);l<i&&(i=l);u<n&&(n=u);c>r&&(r=c);l>a&&(a=l);u>o&&(o=u)}this.min.set(e,i,n);this.max.set(r,a,o);return this},setFromBufferAttribute:function(t){for(var e=Infinity,i=Infinity,n=Infinity,r=-Infinity,a=-Infinity,o=-Infinity,s=0,h=t.count;s<h;s++){var c=t.getX(s),l=t.getY(s),u=t.getZ(s);c<e&&(e=c);l<i&&(i=l);u<n&&(n=u);c>r&&(r=c);l>a&&(a=l);u>o&&(o=u)}this.min.set(e,i,n);this.max.set(r,a,o);return this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new h;return function(e,i){var n=t.copy(i).multiplyScalar(.5);this.min.copy(e).sub(n);this.max.copy(e).add(n);return this}}(),setFromObject:function(t){this.makeEmpty();return this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.min.copy(t.min);this.max.copy(t.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){t=t||new h;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){t=t||new h;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){this.min.min(t);this.max.max(t);return this},expandByVector:function(t){this.min.sub(t);this.max.add(t);return this},expandByScalar:function(t){this.min.addScalar(-t);this.max.addScalar(t);return this},expandByObject:function(){var t=new h;return function(e){var i=this;e.updateMatrixWorld(!0);e.traverse(function(e){var n,r;n=e.geometry;if(void 0!==n)if(n.isGeometry){var a=n.vertices;n=0;for(r=a.length;n<r;n++)t.copy(a[n]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(n.isBufferGeometry&&(a=n.attributes.position,void 0!==a))for(n=0,r=a.count;n<r;n++)t.fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),i.expandByPoint(t)});return this}}(),containsPoint:function(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?!1:!0},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new h).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?!1:!0},intersectsSphere:function(){var t;return function(e){void 0===t&&(t=new h);this.clampPoint(e.center,t);return t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,i;0<t.normal.x?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x);0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y);0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z);return e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new h).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new h;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new h;return function(e){e=e||new J;this.getCenter(e.center);e.radius=.5*this.getSize(t).length();return e}}(),intersect:function(t){this.min.max(t.min);this.max.min(t.max);this.isEmpty()&&this.makeEmpty();return this},union:function(t){this.min.min(t.min);this.max.max(t.max);return this},applyMatrix4:function(){var t=[new h,new h,new h,new h,new h,new h,new h,new h];return function(e){if(this.isEmpty())return this;t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.setFromPoints(t);return this}}(),translate:function(t){this.min.add(t);this.max.add(t);return this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};J.prototype={constructor:J,set:function(t,e){this.center.copy(t);this.radius=e;return this},setFromPoints:function(){var t;return function(e,i){void 0===t&&(t=new Q);var n=this.center;void 0!==i?n.copy(i):t.setFromPoints(e).getCenter(n);for(var r=0,a=0,o=e.length;a<o;a++)r=Math.max(r,n.distanceToSquared(e[a]));this.radius=Math.sqrt(r);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.center.copy(t.center);this.radius=t.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new h;n.copy(t);i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center));return n},getBoundingBox:function(t){t=t||new Q;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(t){this.center.applyMatrix4(t);this.radius*=t.getMaxScaleOnAxis();return this},translate:function(t){this.center.add(t);return this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}};K.prototype={constructor:K,isMatrix3:!0,set:function(t,e,i,n,r,a,o,s,h){var c=this.elements;c[0]=t;c[1]=n;c[2]=o;c[3]=e;c[4]=r;c[5]=s;c[6]=i;c[7]=a;c[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){t=t.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},setFromMatrix4:function(t){t=t.elements;this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]);return this},applyToBufferAttribute:function(){var t;return function(e){void 0===t&&(t=new h);for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiplyScalar:function(t){var e=this.elements;e[0]*=t;e[3]*=t;e[6]*=t;e[1]*=t;e[4]*=t;e[7]*=t;e[2]*=t;e[5]*=t;e[8]*=t;return this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],o=t[5],s=t[6],h=t[7],t=t[8];return e*a*t-e*o*h-i*r*t+i*o*s+n*r*h-n*a*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],a=i[1],o=i[2],s=i[3],h=i[4],c=i[5],l=i[6],u=i[7],i=i[8],p=i*h-c*u,d=c*l-i*s,f=u*s-h*l,m=r*p+a*d+o*f;if(0===m){if(!0===e)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}m=1/m;n[0]=p*m;n[1]=(o*u-i*a)*m;n[2]=(c*a-o*h)*m;n[3]=d*m;n[4]=(i*r-o*l)*m;n[5]=(o*s-c*r)*m;n[6]=f*m;n[7]=(a*l-u*r)*m;n[8]=(h*r-a*s)*m;return this},transpose:function(){var t,e=this.elements;t=e[1];e[1]=e[3];e[3]=t;t=e[2];e[2]=e[6];e[6]=t;t=e[5];e[5]=e[7];e[7]=t;return this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;t[0]=e[0];t[1]=e[3];t[2]=e[6];t[3]=e[1];t[4]=e[4];t[5]=e[7];t[6]=e[2];t[7]=e[5];t[8]=e[8];return this},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;9>i;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);var i=this.elements;t[e]=i[0];t[e+1]=i[1];t[e+2]=i[2];t[e+3]=i[3];t[e+4]=i[4];t[e+5]=i[5];t[e+6]=i[6];t[e+7]=i[7];t[e+8]=i[8];return t}};$.prototype={constructor:$,set:function(t,e){this.normal.copy(t);this.constant=e;return this},setComponents:function(t,e,i,n){this.normal.set(t,e,i);this.constant=n;return this},setFromNormalAndCoplanarPoint:function(t,e){this.normal.copy(t);this.constant=-e.dot(this.normal);return this},setFromCoplanarPoints:function(){var t=new h,e=new h;return function(i,n,r){n=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize();this.setFromNormalAndCoplanarPoint(n,i);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.normal.copy(t.normal);this.constant=t.constant;return this},normalize:function(){var t=1/this.normal.length();this.normal.multiplyScalar(t);this.constant*=t;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t);return(e||new h).copy(this.normal).multiplyScalar(i)},intersectLine:function(){var t=new h;return function(e,i){var n=i||new h,r=e.delta(t),a=this.normal.dot(r);if(0===a){if(0===this.distanceToPoint(e.start))return n.copy(e.start)}else return a=-(e.start.dot(this.normal)+this.constant)/a,0>a||1<a?void 0:n.copy(r).multiplyScalar(a).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start);t=this.distanceToPoint(t.end);return 0>e&&0<t||0>t&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new h).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new h,e=new K;return function(i,n){var r=this.coplanarPoint(t).applyMatrix4(i),a=n||e.getNormalMatrix(i),a=this.normal.applyMatrix3(a).normalize();this.constant=-r.dot(a);return this}}(),translate:function(t){this.constant-=t.dot(this.normal);return this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}};tt.prototype={constructor:tt,set:function(t,e,i,n,r,a){var o=this.planes;o[0].copy(t);o[1].copy(e);o[2].copy(i);o[3].copy(n);o[4].copy(r);o[5].copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;6>i;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements;t=i[0];var n=i[1],r=i[2],a=i[3],o=i[4],s=i[5],h=i[6],c=i[7],l=i[8],u=i[9],p=i[10],d=i[11],f=i[12],m=i[13],v=i[14],i=i[15];e[0].setComponents(a-t,c-o,d-l,i-f).normalize();e[1].setComponents(a+t,c+o,d+l,i+f).normalize();e[2].setComponents(a+n,c+s,d+u,i+m).normalize();e[3].setComponents(a-n,c-s,d-u,i-m).normalize();e[4].setComponents(a-r,c-h,d-p,i-v).normalize();e[5].setComponents(a+r,c+h,d+p,i+v).normalize();return this},intersectsObject:function(){var t=new J;return function(e){var i=e.geometry;null===i.boundingSphere&&i.computeBoundingSphere();t.copy(i.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new J;return function(e){t.center.set(0,0,0);t.radius=.7071067811865476;t.applyMatrix4(e.matrixWorld);return this.intersectsSphere(t)}}(),intersectsSphere:function(t){var e=this.planes,i=t.center;t=-t.radius;for(var n=0;6>n;n++)if(e[n].distanceToPoint(i)<t)return!1;return!0},intersectsBox:function(){var t=new h,e=new h;return function(i){for(var n=this.planes,r=0;6>r;r++){var a=n[r];t.x=0<a.normal.x?i.min.x:i.max.x;e.x=0<a.normal.x?i.max.x:i.min.x;t.y=0<a.normal.y?i.min.y:i.max.y;e.y=0<a.normal.y?i.max.y:i.min.y;t.z=0<a.normal.z?i.min.z:i.max.z;e.z=0<a.normal.z?i.max.z:i.min.z;var o=a.distanceToPoint(t),a=a.distanceToPoint(e);if(0>o&&0>a)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;6>i;i++)if(0>e[i].distanceToPoint(t))return!1;return!0}};it.prototype={constructor:it,set:function(t,e){this.origin.copy(t);this.direction.copy(e);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.origin.copy(t.origin);this.direction.copy(t.direction);return this},at:function(t,e){return(e||new h).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){this.direction.copy(t).sub(this.origin).normalize();return this},recast:function(){var t=new h;return function(e){this.origin.copy(this.at(e,t));return this}}(),closestPointToPoint:function(t,e){var i=e||new h;i.subVectors(t,this.origin);var n=i.dot(this.direction);return 0>n?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new h;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);if(0>i)return this.origin.distanceToSquared(e);t.copy(this.direction).multiplyScalar(i).add(this.origin);return t.distanceToSquared(e)}}(),distanceSqToSegment:function(){var t=new h,e=new h,i=new h;return function(n,r,a,o){t.copy(n).add(r).multiplyScalar(.5);e.copy(r).sub(n).normalize();i.copy(this.origin).sub(t);var s=.5*n.distanceTo(r),h=-this.direction.dot(e),c=i.dot(this.direction),l=-i.dot(e),u=i.lengthSq(),p=Math.abs(1-h*h),d;0<p?(n=h*l-c,r=h*c-l,d=s*p,0<=n?r>=-d?r<=d?(s=1/p,n*=s,r*=s,h=n*(n+h*r+2*c)+r*(h*n+r+2*l)+u):(r=s,n=Math.max(0,-(h*r+c)),h=-n*n+r*(r+2*l)+u):(r=-s,n=Math.max(0,-(h*r+c)),h=-n*n+r*(r+2*l)+u):r<=-d?(n=Math.max(0,-(-h*s+c)),r=0<n?-s:Math.min(Math.max(-s,-l),s),h=-n*n+r*(r+2*l)+u):r<=d?(n=0,r=Math.min(Math.max(-s,-l),s),h=r*(r+2*l)+u):(n=Math.max(0,-(h*s+c)),r=0<n?s:Math.min(Math.max(-s,-l),s),h=-n*n+r*(r+2*l)+u)):(r=0<h?-s:s,n=Math.max(0,-(h*r+c)),h=-n*n+r*(r+2*l)+u);a&&a.copy(this.direction).multiplyScalar(n).add(this.origin);o&&o.copy(e).multiplyScalar(r).add(t);return h}}(),intersectSphere:function(){var t=new h;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,a=e.radius*e.radius;if(r>a)return null;a=Math.sqrt(a-r);r=n-a;n+=a;return 0>r&&0>n?null:0>r?this.at(n,i):this.at(r,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=t?t:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e?!0:!1},intersectBox:function(t,e){var i,n,r,a,o;n=1/this.direction.x;a=1/this.direction.y;o=1/this.direction.z;var s=this.origin;0<=n?(i=(t.min.x-s.x)*n,n*=t.max.x-s.x):(i=(t.max.x-s.x)*n,n*=t.min.x-s.x);0<=a?(r=(t.min.y-s.y)*a,a*=t.max.y-s.y):(r=(t.max.y-s.y)*a,a*=t.min.y-s.y);if(i>a||r>n)return null;if(r>i||i!==i)i=r;if(a<n||n!==n)n=a;0<=o?(r=(t.min.z-s.z)*o,o*=t.max.z-s.z):(r=(t.max.z-s.z)*o,o*=t.min.z-s.z);if(i>o||r>n)return null;if(r>i||i!==i)i=r;if(o<n||n!==n)n=o;return 0>n?null:this.at(0<=i?i:n,e)},intersectsBox:function(){var t=new h;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new h,e=new h,i=new h,n=new h;return function(r,a,o,s,h){e.subVectors(a,r);i.subVectors(o,r);n.crossVectors(e,i);a=this.direction.dot(n);if(0<a){if(s)return null;s=1}else if(0>a)s=-1,a=-a;else return null;t.subVectors(this.origin,r);r=s*this.direction.dot(i.crossVectors(t,i));if(0>r)return null;o=s*this.direction.dot(e.cross(t));if(0>o||r+o>a)return null;r=-s*t.dot(n);return 0>r?null:this.at(r/a,h)}}(),applyMatrix4:function(t){this.direction.add(this.origin).applyMatrix4(t);this.origin.applyMatrix4(t);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}};nt.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");nt.DefaultOrder="XYZ";nt.prototype={constructor:nt,isEuler:!0,get x(){return this._x},set x(t){this._x=t;this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t;this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t;this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t;this.onChangeCallback()},set:function(t,e,i,n){this._x=t;this._y=e;this._z=i;this._order=n||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){this._x=t._x;this._y=t._y;this._z=t._z;this._order=t._order;this.onChangeCallback();return this},setFromRotationMatrix:function(t,e,i){var n=cr.clamp,r=t.elements;t=r[0];var a=r[4],o=r[8],s=r[1],h=r[5],c=r[9],l=r[2],u=r[6],r=r[10];e=e||this._order;"XYZ"===e?(this._y=Math.asin(n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(-c,r),this._z=Math.atan2(-a,t)):(this._x=Math.atan2(u,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),.99999>Math.abs(c)?(this._y=Math.atan2(o,r),this._z=Math.atan2(s,h)):(this._y=Math.atan2(-l,t),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(-l,r),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(s,t))):"ZYX"===e?(this._y=Math.asin(-n(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(u,r),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-a,h))):"YZX"===e?(this._z=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,t)):(this._x=0,this._y=Math.atan2(o,r))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,t)):(this._x=Math.atan2(-c,r),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e);this._order=e;if(!1!==i)this.onChangeCallback();return this},setFromQuaternion:function(){var t;return function(e,i,n){void 0===t&&(t=new c);t.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(t,i,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new s;return function(e){t.setFromEuler(this);return this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){this._x=t[0];this._y=t[1];this._z=t[2];void 0!==t[3]&&(this._order=t[3]);this.onChangeCallback();return this},toArray:function(t,e){void 0===t&&(t=[]);void 0===e&&(e=0);t[e]=this._x;t[e+1]=this._y;t[e+2]=this._z;t[e+3]=this._order;return t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new h(this._x,this._y,this._z)},onChange:function(t){this.onChangeCallback=t;return this},onChangeCallback:function(){}};rt.prototype={constructor:rt,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!==(this.mask&t.mask)}};var _r=0;at.DefaultUp=new h(0,1,0);at.DefaultMatrixAutoUpdate=!0;at.prototype={constructor:at,isObject3D:!0,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new s;return function(e,i){t.setFromAxisAngle(e,i);this.quaternion.multiply(t);return this}}(),rotateX:function(){var t=new h(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new h(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new h(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new h;return function(e,i){t.copy(e).applyQuaternion(this.quaternion);this.position.add(t.multiplyScalar(i));return this}}(),translateX:function(){var t=new h(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new h(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new h(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new c;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new c;return function(e){t.lookAt(e,this.position,this.up);this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this;t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);e=this.children.indexOf(t);-1!==e&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(e,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){t=t||new h;this.updateMatrixWorld(!0);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new h,e=new h;return function(i){i=i||new s;this.updateMatrixWorld(!0);this.matrixWorld.decompose(t,i,e);return i}}(),getWorldRotation:function(){var t=new s;return function(e){e=e||new nt;this.getWorldQuaternion(t);return e.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new h,e=new s;return function(i){i=i||new h;this.updateMatrixWorld(!0);this.matrixWorld.decompose(t,e,i);return i}}(),getWorldDirection:function(){var t=new s;return function(e){e=e||new h;this.getWorldQuaternion(t);return e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===t)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){function e(t){var e=[],i;for(i in t){var n=t[i];delete n.metadata;e.push(n)}return e}var i=void 0===t||""===t,n={};i&&(t={geometries:{},materials:{},textures:{},images:{}},n.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var r={};r.uuid=this.uuid;r.type=this.type;""!==this.name&&(r.name=this.name);"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData);!0===this.castShadow&&(r.castShadow=!0);!0===this.receiveShadow&&(r.receiveShadow=!0);!1===this.visible&&(r.visible=!1);r.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),r.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),r.material=this.material.uuid);if(0<this.children.length){r.children=[];for(var a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(i){var i=e(t.geometries),a=e(t.materials),o=e(t.textures);t=e(t.images);0<i.length&&(n.geometries=i);0<a.length&&(n.materials=a);0<o.length&&(n.textures=o);0<t.length&&(n.images=t)}n.object=r;return n},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){void 0===e&&(e=!0);this.name=t.name;this.up.copy(t.up);this.position.copy(t.position);this.quaternion.copy(t.quaternion);this.scale.copy(t.scale);this.matrix.copy(t.matrix);this.matrixWorld.copy(t.matrixWorld);this.matrixAutoUpdate=t.matrixAutoUpdate;this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate;this.layers.mask=t.layers.mask;this.visible=t.visible;this.castShadow=t.castShadow;this.receiveShadow=t.receiveShadow;this.frustumCulled=t.frustumCulled;this.renderOrder=t.renderOrder;this.userData=JSON.parse(JSON.stringify(t.userData));if(!0===e)for(var i=0;i<t.children.length;i++)this.add(t.children[i].clone());return this}};Object.assign(at.prototype,e.prototype);ot.prototype={constructor:ot,set:function(t,e){this.start.copy(t);this.end.copy(e);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.start.copy(t.start);this.end.copy(t.end);return this},getCenter:function(t){return(t||new h).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new h).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new h;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new h,e=new h;return function(i,n){t.subVectors(i,this.start);e.subVectors(this.end,this.start);var r=e.dot(e),r=e.dot(t)/r;n&&(r=cr.clamp(r,0,1));return r}}(),closestPointToPoint:function(t,e,i){t=this.closestPointToPointParameter(t,e);i=i||new h;return this.delta(i).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){this.start.applyMatrix4(t);this.end.applyMatrix4(t);return this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}};st.normal=function(){var t=new h;return function(e,i,n,r){r=r||new h;r.subVectors(n,i);t.subVectors(e,i);r.cross(t);e=r.lengthSq();return 0<e?r.multiplyScalar(1/Math.sqrt(e)):r.set(0,0,0)}}();st.barycoordFromPoint=function(){var t=new h,e=new h,i=new h;return function(n,r,a,o,s){t.subVectors(o,r);e.subVectors(a,r);i.subVectors(n,r);n=t.dot(t);r=t.dot(e);a=t.dot(i);var c=e.dot(e);o=e.dot(i);var l=n*c-r*r;s=s||new h;if(0===l)return s.set(-2,-1,-1);l=1/l;c=(c*a-r*o)*l;n=(n*o-r*a)*l;return s.set(1-c-n,n,c)}}();st.containsPoint=function(){var t=new h;return function(e,i,n,r){e=st.barycoordFromPoint(e,i,n,r,t);return 0<=e.x&&0<=e.y&&1>=e.x+e.y}}();st.prototype={constructor:st,set:function(t,e,i){this.a.copy(t);this.b.copy(e);this.c.copy(i);return this},setFromPointsAndIndices:function(t,e,i,n){this.a.copy(t[e]);this.b.copy(t[i]);this.c.copy(t[n]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a.copy(t.a);this.b.copy(t.b);this.c.copy(t.c);return this},area:function(){var t=new h,e=new h;return function(){t.subVectors(this.c,this.b);e.subVectors(this.a,this.b);return.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new h).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return st.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new $).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return st.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return st.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var t,e,i,n;return function(r,a){void 0===t&&(t=new $,e=[new ot,new ot,new ot],i=new h,n=new h);var o=a||new h,s=Infinity;t.setFromCoplanarPoints(this.a,this.b,this.c);t.projectPoint(r,i);if(!0===this.containsPoint(i))o.copy(i);else{e[0].set(this.a,this.b);e[1].set(this.b,this.c);e[2].set(this.c,this.a);for(var c=0;c<e.length;c++){e[c].closestPointToPoint(i,!0,n);var l=i.distanceToSquared(n);l<s&&(s=l,o.copy(n))}}return o}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};ht.prototype={constructor:ht,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.normal.copy(t.normal);this.color.copy(t.color);this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();e=0;for(i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};ct.prototype=Object.create(X.prototype);ct.prototype.constructor=ct;ct.prototype.isMeshBasicMaterial=!0;ct.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.map=t.map;this.lightMap=t.lightMap;this.lightMapIntensity=t.lightMapIntensity;this.aoMap=t.aoMap;this.aoMapIntensity=t.aoMapIntensity;this.specularMap=t.specularMap;this.alphaMap=t.alphaMap;this.envMap=t.envMap;this.combine=t.combine;this.reflectivity=t.reflectivity;this.refractionRatio=t.refractionRatio;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.wireframeLinecap=t.wireframeLinecap;this.wireframeLinejoin=t.wireframeLinejoin;this.skinning=t.skinning;this.morphTargets=t.morphTargets;return this};lt.prototype={constructor:lt,isBufferAttribute:!0,set needsUpdate(t){!0===t&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0;this.array=t},setDynamic:function(t){this.dynamic=t;return this},copy:function(t){this.array=new t.array.constructor(t.array);this.itemSize=t.itemSize;this.count=t.count;this.normalized=t.normalized;this.dynamic=t.dynamic;return this},copyAt:function(t,e,i){t*=this.itemSize;i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){this.array.set(t);return this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new G);e[i++]=a.r;e[i++]=a.g;e[i++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];e[i++]=a.a;e[i++]=a.b;e[i++]=a.c}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,a=t.length;r<a;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new i);e[n++]=o.x;e[n++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new h);e[i++]=a.x;e[i++]=a.y;e[i++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,a=t.length;n<a;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new r);e[i++]=o.x;e[i++]=o.y;e[i++]=o.z;e[i++]=o.w}return this},set:function(t,e){void 0===e&&(e=0);this.array.set(t,e);return this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){this.array[t*this.itemSize]=e;return this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){this.array[t*this.itemSize+1]=e;return this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){this.array[t*this.itemSize+2]=e;return this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){this.array[t*this.itemSize+3]=e;return this},setXY:function(t,e,i){t*=this.itemSize;this.array[t+0]=e;this.array[t+1]=i;return this},setXYZ:function(t,e,i,n){t*=this.itemSize;this.array[t+0]=e;this.array[t+1]=i;this.array[t+2]=n;return this},setXYZW:function(t,e,i,n,r){t*=this.itemSize;this.array[t+0]=e;this.array[t+1]=i;this.array[t+2]=n;this.array[t+3]=r;return this},onUpload:function(t){this.onUploadCallback=t;return this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}};ut.prototype=Object.create(lt.prototype);ut.prototype.constructor=ut;pt.prototype=Object.create(lt.prototype);pt.prototype.constructor=pt;dt.prototype=Object.create(lt.prototype);dt.prototype.constructor=dt;ft.prototype=Object.create(lt.prototype);ft.prototype.constructor=ft;mt.prototype=Object.create(lt.prototype);mt.prototype.constructor=mt;vt.prototype=Object.create(lt.prototype);vt.prototype.constructor=vt;gt.prototype=Object.create(lt.prototype);gt.prototype.constructor=gt;yt.prototype=Object.create(lt.prototype);yt.prototype.constructor=yt;xt.prototype=Object.create(lt.prototype);xt.prototype.constructor=xt;Object.assign(bt.prototype,{computeGroups:function(t){var e,i=[],n=void 0;t=t.faces;for(var r=0;r<t.length;r++){var a=t[r];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*r-e.start,i.push(e)),e={start:3*r,materialIndex:n})}void 0!==e&&(e.count=3*r-e.start,i.push(e));this.groups=i},fromGeometry:function(t){var e=t.faces,n=t.vertices,r=t.faceVertexUvs,a=r[0]&&0<r[0].length,o=r[1]&&0<r[1].length,s=t.morphTargets,h=s.length,c;if(0<h){c=[];for(var l=0;l<h;l++)c[l]=[];this.morphTargets.position=c}var u=t.morphNormals,p=u.length,d;if(0<p){d=[];for(l=0;l<p;l++)d[l]=[];this.morphTargets.normal=d}for(var f=t.skinIndices,m=t.skinWeights,v=f.length===n.length,g=m.length===n.length,l=0;l<e.length;l++){var y=e[l];this.vertices.push(n[y.a],n[y.b],n[y.c]);var x=y.vertexNormals;3===x.length?this.normals.push(x[0],x[1],x[2]):(x=y.normal,this.normals.push(x,x,x));x=y.vertexColors;3===x.length?this.colors.push(x[0],x[1],x[2]):(x=y.color,this.colors.push(x,x,x));!0===a&&(x=r[0][l],void 0!==x?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new i,new i,new i)));!0===o&&(x=r[1][l],void 0!==x?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new i,new i,new i)));for(x=0;x<h;x++){var b=s[x].vertices;c[x].push(b[y.a],b[y.b],b[y.c])}for(x=0;x<p;x++)b=u[x].vertexNormals[l],d[x].push(b.a,b.b,b.c);v&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]);g&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}this.computeGroups(t);this.verticesNeedUpdate=t.verticesNeedUpdate;this.normalsNeedUpdate=t.normalsNeedUpdate;this.colorsNeedUpdate=t.colorsNeedUpdate;this.uvsNeedUpdate=t.uvsNeedUpdate;this.groupsNeedUpdate=t.groupsNeedUpdate;return this}});var wr=0;_t.prototype={constructor:_t,isGeometry:!0,applyMatrix:function(t){for(var e=(new K).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(t);i=0;for(n=this.faces.length;i<n;i++){t=this.faces[i];t.normal.applyMatrix3(e).normalize();for(var r=0,a=t.vertexNormals.length;r<a;r++)t.vertexNormals[r].applyMatrix3(e).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationX(e);this.applyMatrix(t);return this}}(),rotateY:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationY(e);this.applyMatrix(t);return this}}(),rotateZ:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationZ(e);this.applyMatrix(t);return this}}(),translate:function(){var t;return function(e,i,n){void 0===t&&(t=new c);t.makeTranslation(e,i,n);this.applyMatrix(t);return this}}(),scale:function(){var t;return function(e,i,n){void 0===t&&(t=new c);t.makeScale(e,i,n);this.applyMatrix(t);return this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new at);t.lookAt(e);t.updateMatrix();this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,i,r){var a=void 0!==s?[p[t].clone(),p[e].clone(),p[i].clone()]:[],o=void 0!==c?[n.colors[t].clone(),n.colors[e].clone(),n.colors[i].clone()]:[];r=new ht(t,e,i,a,o,r);n.faces.push(r);void 0!==l&&n.faceVertexUvs[0].push([d[t].clone(),d[e].clone(),d[i].clone()]);void 0!==u&&n.faceVertexUvs[1].push([f[t].clone(),f[e].clone(),f[i].clone()])}var n=this,r=null!==t.index?t.index.array:void 0,a=t.attributes,o=a.position.array,s=void 0!==a.normal?a.normal.array:void 0,c=void 0!==a.color?a.color.array:void 0,l=void 0!==a.uv?a.uv.array:void 0,u=void 0!==a.uv2?a.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var p=[],d=[],f=[],m=a=0;a<o.length;a+=3,m+=2)n.vertices.push(new h(o[a],o[a+1],o[a+2])),void 0!==s&&p.push(new h(s[a],s[a+1],s[a+2])),void 0!==c&&n.colors.push(new G(c[a],c[a+1],c[a+2])),void 0!==l&&d.push(new i(l[m],l[m+1])),void 0!==u&&f.push(new i(u[m],u[m+1]));if(void 0!==r)if(o=t.groups,0<o.length)for(a=0;a<o.length;a++)for(var v=o[a],g=v.start,y=v.count,m=g,g=g+y;m<g;m+=3)e(r[m],r[m+1],r[m+2],v.materialIndex);else for(a=0;a<r.length;a+=3)e(r[a],r[a+1],r[a+2]);else for(a=0;a<o.length/3;a+=3)e(a,a+1,a+2);this.computeFaceNormals();null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone());null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();this.translate(t.x,t.y,t.z);return t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,e=0===e?1:1/e,i=new c;i.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1);this.applyMatrix(i);return this},computeFaceNormals:function(){for(var t=new h,e=new h,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],a=this.vertices[r.a],o=this.vertices[r.b];t.subVectors(this.vertices[r.c],o);e.subVectors(a,o);t.cross(e);t.normalize();r.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,i,n;n=Array(this.vertices.length);e=0;for(i=this.vertices.length;e<i;e++)n[e]=new h;if(t){var r,a,o,s=new h,c=new h;t=0;for(e=this.faces.length;t<e;t++)i=this.faces[t],r=this.vertices[i.a],a=this.vertices[i.b],o=this.vertices[i.c],s.subVectors(o,a),c.subVectors(r,a),s.cross(c),n[i.a].add(s),n[i.b].add(s),n[i.c].add(s)}else for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++)i=this.faces[t],n[i.a].add(i.normal),n[i.b].add(i.normal),n[i.c].add(i.normal);e=0;for(i=this.vertices.length;e<i;e++)n[e].normalize();t=0;for(e=this.faces.length;t<e;t++)i=this.faces[t],r=i.vertexNormals,3===r.length?(r[0].copy(n[i.a]),r[1].copy(n[i.b]),r[2].copy(n[i.c])):(r[0]=n[i.a].clone(),r[1]=n[i.b].clone(),r[2]=n[i.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;this.computeFaceNormals();t=0;for(e=this.faces.length;t<e;t++){i=this.faces[t];var n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;i=0;for(n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var a=new _t;a.faces=this.faces;t=0;for(e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={};this.morphNormals[t].faceNormals=[];this.morphNormals[t].vertexNormals=[];r=this.morphNormals[t].faceNormals;var o=this.morphNormals[t].vertexNormals,s,c;i=0;for(n=this.faces.length;i<n;i++)s=new h,c={a:new h,b:new h,c:new h},r.push(s),o.push(c)}o=this.morphNormals[t];a.vertices=this.morphTargets[t].vertices;a.computeFaceNormals();a.computeVertexNormals();i=0;for(n=this.faces.length;i<n;i++)r=this.faces[i],s=o.faceNormals[i],c=o.vertexNormals[i],s.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}i=0;for(n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)0<i&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Q);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new J);this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(!1===(t&&t.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);else{var n,r=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,h=t.faces,c=this.faceVertexUvs[0],l=t.faceVertexUvs[0],u=this.colors,p=t.colors;void 0===i&&(i=0);void 0!==e&&(n=(new K).getNormalMatrix(e));t=0;for(var d=o.length;t<d;t++){var f=o[t].clone();void 0!==e&&f.applyMatrix4(e);a.push(f)}t=0;for(d=p.length;t<d;t++)u.push(p[t].clone());t=0;for(d=h.length;t<d;t++){var o=h[t],m=o.vertexNormals,p=o.vertexColors,u=new ht(o.a+r,o.b+r,o.c+r);u.normal.copy(o.normal);void 0!==n&&u.normal.applyMatrix3(n).normalize();e=0;for(a=m.length;e<a;e++)f=m[e].clone(),void 0!==n&&f.applyMatrix3(n).normalize(),u.vertexNormals.push(f);u.color.copy(o.color);e=0;for(a=p.length;e<a;e++)f=p[e],u.vertexColors.push(f.clone());u.materialIndex=o.materialIndex+i;s.push(u)}t=0;for(d=l.length;t<d;t++)if(i=l[t],n=[],void 0!==i){e=0;for(a=i.length;e<a;e++)n.push(i[e].clone());c.push(n)}}},mergeMesh:function(t){!1===(t&&t.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t):(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t={},e=[],i=[],n,r=Math.pow(10,4),a,o;a=0;for(o=this.vertices.length;a<o;a++)n=this.vertices[a],n=Math.round(n.x*r)+"_"+Math.round(n.y*r)+"_"+Math.round(n.z*r),void 0===t[n]?(t[n]=a,e.push(this.vertices[a]),i[a]=e.length-1):i[a]=i[t[n]];t=[];a=0;for(o=this.faces.length;a<o;a++)for(r=this.faces[a],r.a=i[r.a],r.b=i[r.b],r.c=i[r.c],r=[r.a,r.b,r.c],n=0;3>n;n++)if(r[n]===r[(n+1)%3]){t.push(a);break}for(a=t.length-1;0<=a;a--)for(r=t[a],this.faces.splice(r,1),i=0,o=this.faceVertexUvs.length;i<o;i++)this.faceVertexUvs[i].splice(r,1);a=this.vertices.length-e.length;this.vertices=e;return a},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n=this.faceVertexUvs[0],r=this.faceVertexUvs[1],a,o;n&&n.length===e&&(a=[]);r&&r.length===e&&(o=[]);for(i=0;i<e;i++){var s=t[i]._id;a&&a.push(n[s]);o&&o.push(r[s])}a&&(this.faceVertexUvs[0]=a);o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function t(t,e,i){return i?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();if(void 0!==c[e])return c[e];c[e]=h.length/3;h.push(t.x,t.y,t.z);return c[e]}function i(t){var e=t.r.toString()+t.g.toString()+t.b.toString();if(void 0!==u[e])return u[e];u[e]=l.length;l.push(t.getHex());return u[e]}function n(t){var e=t.x.toString()+t.y.toString();if(void 0!==d[e])return d[e];d[e]=p.length/2;p.push(t.x,t.y);return d[e]}var r={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};r.uuid=this.uuid;r.type=this.type;""!==this.name&&(r.name=this.name);if(void 0!==this.parameters){var a=this.parameters,o;for(o in a)void 0!==a[o]&&(r[o]=a[o]);return r}a=[];for(o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}var s=[],h=[],c={},l=[],u={},p=[],d={};for(o=0;o<this.faces.length;o++){var f=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],v=0<f.normal.length(),g=0<f.vertexNormals.length,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,x=0<f.vertexColors.length,b=0,b=t(b,0,0),b=t(b,1,!0),b=t(b,2,!1),b=t(b,3,m),b=t(b,4,v),b=t(b,5,g),b=t(b,6,y),b=t(b,7,x);s.push(b);s.push(f.a,f.b,f.c);s.push(f.materialIndex);m&&(m=this.faceVertexUvs[0][o],s.push(n(m[0]),n(m[1]),n(m[2])));v&&s.push(e(f.normal));g&&(v=f.vertexNormals,s.push(e(v[0]),e(v[1]),e(v[2])));y&&s.push(i(f.color));x&&(f=f.vertexColors,s.push(i(f[0]),i(f[1]),i(f[2])))}r.data={};r.data.vertices=a;r.data.normals=h;0<l.length&&(r.data.colors=l);0<p.length&&(r.data.uvs=[p]);r.data.faces=s;return r},clone:function(){return(new _t).copy(this)},copy:function(t){var e,i,n,r,a,o;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=t.name;n=t.vertices;e=0;for(i=n.length;e<i;e++)this.vertices.push(n[e].clone());n=t.colors;e=0;for(i=n.length;e<i;e++)this.colors.push(n[e].clone());n=t.faces;e=0;for(i=n.length;e<i;e++)this.faces.push(n[e].clone());e=0;for(i=t.faceVertexUvs.length;e<i;e++){var s=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);n=0;for(r=s.length;n<r;n++){var h=s[n],c=[];a=0;for(o=h.length;a<o;a++)c.push(h[a].clone());this.faceVertexUvs[e].push(c)}}a=t.morphTargets;e=0;for(i=a.length;e<i;e++){o={};o.name=a[e].name;if(void 0!==a[e].vertices)for(o.vertices=[],n=0,r=a[e].vertices.length;n<r;n++)o.vertices.push(a[e].vertices[n].clone());if(void 0!==a[e].normals)for(o.normals=[],n=0,r=a[e].normals.length;n<r;n++)o.normals.push(a[e].normals[n].clone());this.morphTargets.push(o)}a=t.morphNormals;e=0;for(i=a.length;e<i;e++){o={};if(void 0!==a[e].vertexNormals)for(o.vertexNormals=[],n=0,r=a[e].vertexNormals.length;n<r;n++)s=a[e].vertexNormals[n],h={},h.a=s.a.clone(),h.b=s.b.clone(),h.c=s.c.clone(),o.vertexNormals.push(h);if(void 0!==a[e].faceNormals)for(o.faceNormals=[],n=0,r=a[e].faceNormals.length;n<r;n++)o.faceNormals.push(a[e].faceNormals[n].clone());this.morphNormals.push(o)}n=t.skinWeights;e=0;for(i=n.length;e<i;e++)this.skinWeights.push(n[e].clone());n=t.skinIndices;e=0;for(i=n.length;e<i;e++)this.skinIndices.push(n[e].clone());n=t.lineDistances;e=0;for(i=n.length;e<i;e++)this.lineDistances.push(n[e]);e=t.boundingBox;null!==e&&(this.boundingBox=e.clone());e=t.boundingSphere;null!==e&&(this.boundingSphere=e.clone());this.elementsNeedUpdate=t.elementsNeedUpdate;this.verticesNeedUpdate=t.verticesNeedUpdate;this.uvsNeedUpdate=t.uvsNeedUpdate;this.normalsNeedUpdate=t.normalsNeedUpdate;this.colorsNeedUpdate=t.colorsNeedUpdate;this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate;this.groupsNeedUpdate=t.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(_t.prototype,e.prototype);wt.prototype={constructor:wt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<Mt(t)?gt:mt)(t,1):this.index=t},addAttribute:function(t,e,i){if(!1===(e&&e.isBufferAttribute)&&!1===(e&&e.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new lt(e,i));else if("index"===t)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e);else return this.attributes[t]=e,this},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){delete this.attributes[t];return this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t;this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);e=this.attributes.normal;void 0!==e&&((new K).getNormalMatrix(t).applyToBufferAttribute(e),e.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationX(e);this.applyMatrix(t);return this}}(),rotateY:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationY(e);this.applyMatrix(t);return this}}(),rotateZ:function(){var t;return function(e){void 0===t&&(t=new c);t.makeRotationZ(e);this.applyMatrix(t);return this}}(),translate:function(){var t;return function(e,i,n){void 0===t&&(t=new c);t.makeTranslation(e,i,n);this.applyMatrix(t);return this}}(),scale:function(){var t;return function(e,i,n){void 0===t&&(t=new c);t.makeScale(e,i,n);this.applyMatrix(t);return this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new at);t.lookAt(e);t.updateMatrix();this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();this.translate(t.x,t.y,t.z);return t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){t=new yt(3*e.vertices.length,3);var i=new yt(3*e.colors.length,3);this.addAttribute("position",t.copyVector3sArray(e.vertices));this.addAttribute("color",i.copyColorsArray(e.colors));e.lineDistances&&e.lineDistances.length===e.vertices.length&&(t=new yt(e.lineDistances.length,1),this.addAttribute("lineDistance",t.copyArray(e.lineDistances)));null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone());null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;!0===e.elementsNeedUpdate&&(i=void 0,e.elementsNeedUpdate=!1);if(void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate;i.normalsNeedUpdate=e.normalsNeedUpdate;i.colorsNeedUpdate=e.colorsNeedUpdate;i.uvsNeedUpdate=e.uvsNeedUpdate;i.groupsNeedUpdate=e.groupsNeedUpdate;e.verticesNeedUpdate=!1;e.normalsNeedUpdate=!1;e.colorsNeedUpdate=!1;e.uvsNeedUpdate=!1;e.groupsNeedUpdate=!1;e=i}!0===e.verticesNeedUpdate&&(i=this.attributes.position,void 0!==i&&(i.copyVector3sArray(e.vertices),i.needsUpdate=!0),e.verticesNeedUpdate=!1);!0===e.normalsNeedUpdate&&(i=this.attributes.normal,void 0!==i&&(i.copyVector3sArray(e.normals),i.needsUpdate=!0),e.normalsNeedUpdate=!1);!0===e.colorsNeedUpdate&&(i=this.attributes.color,void 0!==i&&(i.copyColorsArray(e.colors),i.needsUpdate=!0),e.colorsNeedUpdate=!1);e.uvsNeedUpdate&&(i=this.attributes.uv,void 0!==i&&(i.copyVector2sArray(e.uvs),i.needsUpdate=!0),e.uvsNeedUpdate=!1);e.lineDistancesNeedUpdate&&(i=this.attributes.lineDistance,void 0!==i&&(i.copyArray(e.lineDistances),i.needsUpdate=!0),e.lineDistancesNeedUpdate=!1);e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1);return this},fromGeometry:function(t){t.__directGeometry=(new bt).fromGeometry(t);return this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);this.addAttribute("position",new lt(e,3).copyVector3sArray(t.vertices));0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.addAttribute("normal",new lt(e,3).copyVector3sArray(t.normals)));0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.addAttribute("color",new lt(e,3).copyColorsArray(t.colors)));0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.addAttribute("uv",new lt(e,2).copyVector2sArray(t.uvs)));0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.addAttribute("uv2",new lt(e,2).copyVector2sArray(t.uvs2)));0<t.indices.length&&(e=new(65535<Mt(t.indices)?Uint32Array:Uint16Array)(3*t.indices.length),this.setIndex(new lt(e,1).copyIndicesArray(t.indices)));this.groups=t.groups;for(var i in t.morphTargets){for(var e=[],n=t.morphTargets[i],r=0,a=n.length;r<a;r++){var o=n[r],s=new yt(3*o.length,3);e.push(s.copyVector3sArray(o))}this.morphAttributes[i]=e}0<t.skinIndices.length&&(i=new yt(4*t.skinIndices.length,4),this.addAttribute("skinIndex",i.copyVector4sArray(t.skinIndices)));0<t.skinWeights.length&&(i=new yt(4*t.skinWeights.length,4),this.addAttribute("skinWeight",i.copyVector4sArray(t.skinWeights)));null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone());null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Q);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new Q,e=new h;return function(){null===this.boundingSphere&&(this.boundingSphere=new J);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;t.setFromBufferAttribute(i);t.getCenter(n);for(var r=0,a=0,o=i.count;a<o;a++)e.x=i.getX(a),e.y=i.getY(a),e.z=i.getZ(a),r=Math.max(r,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(r);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new lt(new Float32Array(n.length),3));else for(var r=e.normal.array,a=0,o=r.length;a<o;a++)r[a]=0;var r=e.normal.array,s,c,l,u=new h,p=new h,d=new h,f=new h,m=new h;if(t){t=t.array;0===i.length&&this.addGroup(0,t.length);for(var v=0,g=i.length;v<g;++v)for(a=i[v],o=a.start,s=a.count,a=o,o+=s;a<o;a+=3)s=3*t[a+0],c=3*t[a+1],l=3*t[a+2],u.fromArray(n,s),p.fromArray(n,c),d.fromArray(n,l),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),r[s]+=f.x,r[s+1]+=f.y,r[s+2]+=f.z,r[c]+=f.x,r[c+1]+=f.y,r[c+2]+=f.z,r[l]+=f.x,r[l+1]+=f.y,r[l+2]+=f.z}else for(a=0,o=n.length;a<o;a+=9)u.fromArray(n,a),p.fromArray(n,a+3),d.fromArray(n,a+6),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),r[a]=f.x,r[a+1]=f.y,r[a+2]=f.z,r[a+3]=f.x,r[a+4]=f.y,r[a+5]=f.z,r[a+6]=f.x,r[a+7]=f.y,r[a+8]=f.z;this.normalizeNormals();e.normal.needsUpdate=!0}},merge:function(t,e){if(!1===(t&&t.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);else{void 0===e&&(e=0);var i=this.attributes,n;for(n in i)if(void 0!==t.attributes[n])for(var r=i[n].array,a=t.attributes[n],o=a.array,s=0,a=a.itemSize*e;s<o.length;s++,a++)r[a]=o[s];return this}},normalizeNormals:function(){for(var t=this.attributes.normal.array,e,i,n,r=0,a=t.length;r<a;r+=3)e=t[r],i=t[r+1],n=t[r+2],e=1/Math.sqrt(e*e+i*i+n*n),t[r]*=e,t[r+1]*=e,t[r+2]*=e},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new wt,e=this.index.array,i=this.attributes,n;for(n in i){for(var r=i[n],a=r.array,r=r.itemSize,o=new a.constructor(e.length*r),s,h=0,c=0,l=e.length;c<l;c++){s=e[c]*r;for(var u=0;u<r;u++)o[h++]=a[s++]}t.addAttribute(n,new lt(o,r))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};t.uuid=this.uuid;t.type=this.type;""!==this.name&&(t.name=this.name);if(void 0!==this.parameters){var e=this.parameters,i;for(i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;null!==n&&(e=Array.prototype.slice.call(n.array),t.data.index={type:n.array.constructor.name,array:e});n=this.attributes;for(i in n){var r=n[i],e=Array.prototype.slice.call(r.array);t.data.attributes[i]={itemSize:r.itemSize,type:r.array.constructor.name,array:e,normalized:r.normalized}}i=this.groups;0<i.length&&(t.data.groups=JSON.parse(JSON.stringify(i)));i=this.boundingSphere;null!==i&&(t.data.boundingSphere={center:i.center.toArray(),radius:i.radius});return t},clone:function(){return(new wt).copy(this)},copy:function(t){var e,i,n;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.name=t.name;i=t.index;null!==i&&this.setIndex(i.clone());i=t.attributes;for(e in i)this.addAttribute(e,i[e].clone());var r=t.morphAttributes;for(e in r){var a=[],o=r[e];i=0;for(n=o.length;i<n;i++)a.push(o[i].clone());this.morphAttributes[e]=a}e=t.groups;i=0;for(n=e.length;i<n;i++)r=e[i],this.addGroup(r.start,r.count,r.materialIndex);e=t.boundingBox;null!==e&&(this.boundingBox=e.clone());e=t.boundingSphere;null!==e&&(this.boundingSphere=e.clone());this.drawRange.start=t.drawRange.start;this.drawRange.count=t.drawRange.count;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};wt.MaxIndex=65535;Object.assign(wt.prototype,e.prototype);Et.prototype=Object.assign(Object.create(at.prototype),{constructor:Et,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){at.prototype.copy.call(this,t);this.drawMode=t.drawMode;return this},updateMorphTargets:function(){var t=this.geometry.morphTargets;if(void 0!==t&&0<t.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,i=t.length;e<i;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[t[e].name]=e}},raycast:function(){function t(t,e,i,n,r,a,o){st.barycoordFromPoint(t,e,i,n,y);r.multiplyScalar(y.x);a.multiplyScalar(y.y);o.multiplyScalar(y.z);r.add(a).add(o);return r.clone()}function e(t,e,i,n,r,a,o){var s=t.material;if(null===(1===s.side?i.intersectTriangle(a,r,n,!0,o):i.intersectTriangle(n,r,a,2!==s.side,o)))return null;b.copy(o);b.applyMatrix4(t.matrixWorld);i=e.ray.origin.distanceTo(b);return i<e.near||i>e.far?null:{distance:i,point:b.clone(),object:t}}function n(i,n,r,a,o,h,c,p){s.fromBufferAttribute(a,h);l.fromBufferAttribute(a,c);u.fromBufferAttribute(a,p);if(i=e(i,n,r,s,l,u,x))o&&(m.fromBufferAttribute(o,h),v.fromBufferAttribute(o,c),g.fromBufferAttribute(o,p),i.uv=t(x,s,l,u,m,v,g)),i.face=new ht(h,c,p,st.normal(s,l,u)),i.faceIndex=h;return i}var r=new c,a=new it,o=new J,s=new h,l=new h,u=new h,p=new h,d=new h,f=new h,m=new i,v=new i,g=new i,y=new h,x=new h,b=new h;return function(i,h){var c=this.geometry,y=this.material,b=this.matrixWorld;if(void 0!==y&&(null===c.boundingSphere&&c.computeBoundingSphere(),o.copy(c.boundingSphere),o.applyMatrix4(b),!1!==i.ray.intersectsSphere(o)&&(r.getInverse(b),a.copy(i.ray).applyMatrix4(r),null===c.boundingBox||!1!==a.intersectsBox(c.boundingBox)))){var M;if(c.isBufferGeometry){var _,w,y=c.index,E=c.attributes.position,b=c.attributes.uv,T,S;if(null!==y)for(T=0,S=y.count;T<S;T+=3){if(c=y.getX(T),_=y.getX(T+1),w=y.getX(T+2),M=n(this,i,a,E,b,c,_,w))M.faceIndex=Math.floor(T/3),h.push(M)}else for(T=0,S=E.count;T<S;T+=3)if(c=T,_=T+1,w=T+2,M=n(this,i,a,E,b,c,_,w))M.index=c,h.push(M)}else if(c.isGeometry){var R,A,b=y&&y.isMultiMaterial;T=!0===b?y.materials:null;S=c.vertices;_=c.faces;w=c.faceVertexUvs[0];0<w.length&&(E=w);for(var L=0,P=_.length;L<P;L++){var C=_[L];M=!0===b?T[C.materialIndex]:y;if(void 0!==M){w=S[C.a];R=S[C.b];A=S[C.c];if(!0===M.morphTargets){M=c.morphTargets;var I=this.morphTargetInfluences;s.set(0,0,0);l.set(0,0,0);u.set(0,0,0);for(var N=0,z=M.length;N<z;N++){var U=I[N];if(0!==U){var D=M[N].vertices;s.addScaledVector(p.subVectors(D[C.a],w),U);l.addScaledVector(d.subVectors(D[C.b],R),U);u.addScaledVector(f.subVectors(D[C.c],A),U)}}s.add(w);l.add(R);u.add(A);w=s;R=l;A=u}if(M=e(this,i,a,w,R,A,x))E&&(I=E[L],m.copy(I[0]),v.copy(I[1]),g.copy(I[2]),M.uv=t(x,w,R,A,m,v,g)),M.face=C,M.faceIndex=L,h.push(M)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});Tt.prototype=Object.create(_t.prototype);Tt.prototype.constructor=Tt;St.prototype=Object.create(wt.prototype);St.prototype.constructor=St;Rt.prototype=Object.create(_t.prototype);Rt.prototype.constructor=Rt;At.prototype=Object.create(wt.prototype);At.prototype.constructor=At;Lt.prototype=Object.create(at.prototype);Lt.prototype.constructor=Lt;Lt.prototype.isCamera=!0;Lt.prototype.getWorldDirection=function(){var t=new s;return function(e){e=e||new h;this.getWorldQuaternion(t);return e.set(0,0,-1).applyQuaternion(t)}}();Lt.prototype.lookAt=function(){var t=new c;return function(e){t.lookAt(this.position,e,this.up);this.quaternion.setFromRotationMatrix(t)}}();Lt.prototype.clone=function(){return(new this.constructor).copy(this)};Lt.prototype.copy=function(t){at.prototype.copy.call(this,t);this.matrixWorldInverse.copy(t.matrixWorldInverse);this.projectionMatrix.copy(t.projectionMatrix);return this};Pt.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Pt,isPerspectiveCamera:!0,copy:function(t){Lt.prototype.copy.call(this,t);this.fov=t.fov;this.zoom=t.zoom;this.near=t.near;this.far=t.far;this.focus=t.focus;this.aspect=t.aspect;this.view=null===t.view?null:Object.assign({},t.view);this.filmGauge=t.filmGauge;this.filmOffset=t.filmOffset;return this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t;this.fov=2*cr.RAD2DEG*Math.atan(t);this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*cr.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*cr.RAD2DEG*Math.atan(Math.tan(.5*cr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,a){this.aspect=t/e;this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:a};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*cr.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==a)var o=a.fullWidth,s=a.fullHeight,r=r+a.offsetX*n/o,e=e-a.offsetY*i/s,n=a.width/o*n,i=a.height/s*i;a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth());this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){t=at.prototype.toJSON.call(this,t);t.object.fov=this.fov;t.object.zoom=this.zoom;t.object.near=this.near;t.object.far=this.far;t.object.focus=this.focus;t.object.aspect=this.aspect;null!==this.view&&(t.object.view=Object.assign({},this.view));t.object.filmGauge=this.filmGauge;t.object.filmOffset=this.filmOffset;return t}});Ct.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Ct,isOrthographicCamera:!0,copy:function(t){Lt.prototype.copy.call(this,t);this.left=t.left;this.right=t.right;this.top=t.top;this.bottom=t.bottom;this.near=t.near;this.far=t.far;this.zoom=t.zoom;this.view=null===t.view?null:Object.assign({},t.view);return this},setViewOffset:function(t,e,i,n,r,a){this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:a};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,i=i+t,t=n+e,e=n-e;if(null!==this.view)var i=this.zoom/(this.view.width/this.view.fullWidth),e=this.zoom/(this.view.height/this.view.fullHeight),a=(this.right-this.left)/this.view.width,n=(this.top-this.bottom)/this.view.height,r=r+this.view.offsetX/i*a,i=r+this.view.width/i*a,t=t-this.view.offsetY/e*n,e=t-this.view.height/e*n;this.projectionMatrix.makeOrthographic(r,i,t,e,this.near,this.far)},toJSON:function(t){t=at.prototype.toJSON.call(this,t);t.object.zoom=this.zoom;t.object.left=this.left;t.object.right=this.right;t.object.top=this.top;t.object.bottom=this.bottom;t.object.near=this.near;t.object.far=this.far;null!==this.view&&(t.object.view=Object.assign({},this.view));return t}});var Er=0;re.prototype.isFogExp2=!0;re.prototype.clone=function(){return new re(this.color.getHex(),this.density)};re.prototype.toJSON=function(t){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};ae.prototype.isFog=!0;ae.prototype.clone=function(){return new ae(this.color.getHex(),this.near,this.far)};ae.prototype.toJSON=function(t){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};oe.prototype=Object.create(at.prototype);oe.prototype.constructor=oe;oe.prototype.copy=function(t,e){at.prototype.copy.call(this,t,e);null!==t.background&&(this.background=t.background.clone());null!==t.fog&&(this.fog=t.fog.clone());null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone());this.autoUpdate=t.autoUpdate;this.matrixAutoUpdate=t.matrixAutoUpdate;return this};oe.prototype.toJSON=function(t){var e=at.prototype.toJSON.call(this,t);null!==this.background&&(e.object.background=this.background.toJSON(t));null!==this.fog&&(e.object.fog=this.fog.toJSON());return e};se.prototype=Object.assign(Object.create(at.prototype),{constructor:se,isLensFlare:!0,copy:function(t){at.prototype.copy.call(this,t);this.positionScreen.copy(t.positionScreen);this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,a){void 0===e&&(e=-1);void 0===i&&(i=0);void 0===a&&(a=1);void 0===r&&(r=new G(16777215));void 0===n&&(n=1);i=Math.min(i,Math.max(0,i));this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:r,blending:n})},updateLensFlares:function(){var t,e=this.lensFlares.length,i,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<e;t++)i=this.lensFlares[t],i.x=this.positionScreen.x+n*i.distance,i.y=this.positionScreen.y+r*i.distance,i.wantedRotation=i.x*Math.PI*.25,i.rotation+=.25*(i.wantedRotation-i.rotation)}});he.prototype=Object.create(X.prototype);he.prototype.constructor=he;he.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.map=t.map;this.rotation=t.rotation;return this};ce.prototype=Object.assign(Object.create(at.prototype),{constructor:ce,isSprite:!0,raycast:function(){var t=new h;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.distanceSqToPoint(t);n>this.scale.x*this.scale.y/4||i.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}});le.prototype=Object.assign(Object.create(at.prototype),{constructor:le,copy:function(t){at.prototype.copy.call(this,t,!1);t=t.levels;for(var e=0,i=t.length;e<i;e++){var n=t[e];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0);e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t});this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:function(){var t=new h;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,i)}}(),update:function(){var t=new h,e=new h;return function(i){var n=this.levels;if(1<n.length){t.setFromMatrixPosition(i.matrixWorld);e.setFromMatrixPosition(this.matrixWorld);i=t.distanceTo(e);n[0].object.visible=!0;for(var r=1,a=n.length;r<a;r++)if(i>=n[r].distance)n[r-1].object.visible=!1,n[r].object.visible=!0;else break;for(;r<a;r++)n[r].object.visible=!1}}}(),toJSON:function(t){t=at.prototype.toJSON.call(this,t);t.object.levels=[];for(var e=this.levels,i=0,n=e.length;i<n;i++){var r=e[i];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}});Object.assign(ue.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new c;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld);this.boneInverses.push(i)}},pose:function(){for(var t,e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);e=0;for(i=this.bones.length;e<i;e++)if(t=this.bones[e])t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale)},update:function(){var t=new c;return function(){for(var e=0,i=this.bones.length;e<i;e++)t.multiplyMatrices(this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix,this.boneInverses[e]),t.toArray(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new ue(this.bones,this.boneInverses,this.useVertexTexture)}});pe.prototype=Object.assign(Object.create(at.prototype),{constructor:pe,isBone:!0});de.prototype=Object.assign(Object.create(Et.prototype),{constructor:de,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t;void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld);this.bindMatrix.copy(e);this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t],i=1/e.lengthManhattan();Infinity!==i?e.multiplyScalar(i):e.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var e=new r,n=this.geometry.attributes.skinWeight,t=0;t<n.count;t++)e.x=n.getX(t),e.y=n.getY(t),e.z=n.getZ(t),e.w=n.getW(t),i=1/e.lengthManhattan(),Infinity!==i?e.multiplyScalar(i):e.set(1,0,0,0),n.setXYZW(t,e.x,e.y,e.z,e.w)},updateMatrixWorld:function(t){Et.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}});fe.prototype=Object.create(X.prototype);fe.prototype.constructor=fe;fe.prototype.isLineBasicMaterial=!0;fe.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.linewidth=t.linewidth;this.linecap=t.linecap;this.linejoin=t.linejoin;return this};me.prototype=Object.assign(Object.create(at.prototype),{constructor:me,isLine:!0,raycast:function(){var t=new c,e=new it,i=new J;return function(n,r){var a=n.linePrecision,a=a*a,o=this.geometry,s=this.matrixWorld;null===o.boundingSphere&&o.computeBoundingSphere();i.copy(o.boundingSphere);i.applyMatrix4(s);if(!1!==n.ray.intersectsSphere(i)){t.getInverse(s);e.copy(n.ray).applyMatrix4(t);var c=new h,l=new h,s=new h,u=new h,p=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var d=o.index,f=o.attributes.position.array;if(null!==d)for(var d=d.array,o=0,m=d.length-1;o<m;o+=p){var v=d[o+1];c.fromArray(f,3*d[o]);l.fromArray(f,3*v);v=e.distanceSqToSegment(c,l,u,s);v>a||(u.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(u),v<n.near||v>n.far||r.push({distance:v,point:s.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this}))}else for(o=0,m=f.length/3-1;o<m;o+=p)c.fromArray(f,3*o),l.fromArray(f,3*o+3),v=e.distanceSqToSegment(c,l,u,s),v>a||(u.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(u),v<n.near||v>n.far||r.push({distance:v,point:s.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this}))}else if(o.isGeometry)for(c=o.vertices,l=c.length,o=0;o<l-1;o+=p)v=e.distanceSqToSegment(c[o],c[o+1],u,s),v>a||(u.applyMatrix4(this.matrixWorld),v=n.ray.origin.distanceTo(u),v<n.near||v>n.far||r.push({distance:v,point:s.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});ve.prototype=Object.assign(Object.create(me.prototype),{constructor:ve,isLineSegments:!0});ge.prototype=Object.create(X.prototype);ge.prototype.constructor=ge;ge.prototype.isPointsMaterial=!0;ge.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.map=t.map;this.size=t.size;this.sizeAttenuation=t.sizeAttenuation;return this};ye.prototype=Object.assign(Object.create(at.prototype),{constructor:ye,isPoints:!0,raycast:function(){var t=new c,e=new it,i=new J;return function(n,r){function a(t,i){var a=e.distanceSqToPoint(t);if(a<u){var s=e.closestPointToPoint(t);s.applyMatrix4(c);var h=n.ray.origin.distanceTo(s);h<n.near||h>n.far||r.push({distance:h,distanceToRay:Math.sqrt(a),point:s.clone(),index:i,face:null,object:o})}}var o=this,s=this.geometry,c=this.matrixWorld,l=n.params.Points.threshold;null===s.boundingSphere&&s.computeBoundingSphere();i.copy(s.boundingSphere);i.applyMatrix4(c);if(!1!==n.ray.intersectsSphere(i)){t.getInverse(c);e.copy(n.ray).applyMatrix4(t);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,l=new h;if(s.isBufferGeometry){var p=s.index,s=s.attributes.position.array;if(null!==p)for(var d=p.array,p=0,f=d.length;p<f;p++){var m=d[p];l.fromArray(s,3*m);a(l,m)}else for(p=0,d=s.length/3;p<d;p++)l.fromArray(s,3*p),a(l,p)}else for(l=s.vertices,p=0,d=l.length;p<d;p++)a(l[p],p)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});xe.prototype=Object.assign(Object.create(at.prototype),{constructor:xe});be.prototype=Object.create(n.prototype);be.prototype.constructor=be;Me.prototype=Object.create(n.prototype);Me.prototype.constructor=Me;Me.prototype.isCompressedTexture=!0;_e.prototype=Object.create(n.prototype);_e.prototype.constructor=_e;we.prototype=Object.create(n.prototype);we.prototype.constructor=we;we.prototype.isDepthTexture=!0;Ee.prototype=Object.create(wt.prototype);Ee.prototype.constructor=Ee;Te.prototype=Object.create(_t.prototype);Te.prototype.constructor=Te;Se.prototype=Object.create(wt.prototype);Se.prototype.constructor=Se;Re.prototype=Object.create(_t.prototype);Re.prototype.constructor=Re;Ae.prototype=Object.create(wt.prototype);Ae.prototype.constructor=Ae;Le.prototype=Object.create(_t.prototype);Le.prototype.constructor=Le;Pe.prototype=Object.create(Ae.prototype);Pe.prototype.constructor=Pe;Ce.prototype=Object.create(_t.prototype);Ce.prototype.constructor=Ce;Ie.prototype=Object.create(Ae.prototype);Ie.prototype.constructor=Ie;Ne.prototype=Object.create(_t.prototype);Ne.prototype.constructor=Ne;ze.prototype=Object.create(Ae.prototype);ze.prototype.constructor=ze;Ue.prototype=Object.create(_t.prototype);Ue.prototype.constructor=Ue;De.prototype=Object.create(Ae.prototype);De.prototype.constructor=De;Oe.prototype=Object.create(_t.prototype);Oe.prototype.constructor=Oe;He.prototype=Object.create(wt.prototype);He.prototype.constructor=He;Fe.prototype=Object.create(_t.prototype);Fe.prototype.constructor=Fe;Be.prototype=Object.create(wt.prototype);Be.prototype.constructor=Be;ke.prototype=Object.create(_t.prototype);ke.prototype.constructor=ke;Ge.prototype=Object.create(wt.prototype);Ge.prototype.constructor=Ge;var Tr={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},triangulate:function(){return function(t,e){var i=t.length;if(3>i)return null;var n=[],r=[],a=[],o,s,h;if(0<Tr.area(t))for(s=0;s<i;s++)r[s]=s;else for(s=0;s<i;s++)r[s]=i-1-s;var c=2*i;for(s=i-1;2<i;){if(0>=c--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}o=s;i<=o&&(o=0);s=o+1;i<=s&&(s=0);h=s+1;i<=h&&(h=0);var l;t:{var u,p,d,f,m,v,g,y;u=t[r[o]].x;p=t[r[o]].y;d=t[r[s]].x;f=t[r[s]].y;m=t[r[h]].x;v=t[r[h]].y;if(0>=(d-u)*(v-p)-(f-p)*(m-u))l=!1;else{var x,b,M,_,w,E,T,S,R,A;x=m-d;b=v-f;M=u-m;_=p-v;w=d-u;E=f-p;for(l=0;l<i;l++)if(g=t[r[l]].x,y=t[r[l]].y,!(g===u&&y===p||g===d&&y===f||g===m&&y===v)&&(T=g-u,S=y-p,R=g-d,A=y-f,g-=m,y-=v,R=x*A-b*R,T=w*S-E*T,S=M*y-_*g,R>=-Number.EPSILON&&S>=-Number.EPSILON&&T>=-Number.EPSILON)){l=!1;break t}l=!0}}if(l){n.push([t[r[o]],t[r[s]],t[r[h]]]);a.push([r[o],r[s],r[h]]);o=s;for(h=s+1;h<i;o++,h++)r[o]=r[h];i--;c=2*i}}return e?a:n}}(),triangulateShape:function(t,e){function i(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function n(t,e,i){return t.x!==e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function r(t,e,i,r,a){var o=e.x-t.x,s=e.y-t.y,h=r.x-i.x,c=r.y-i.y,l=t.x-i.x,u=t.y-i.y,p=s*h-o*c,d=s*l-o*u;if(Math.abs(p)>Number.EPSILON){if(0<p){if(0>d||d>p)return[];h=c*l-h*u;if(0>h||h>p)return[]}else{if(0<d||d<p)return[];h=c*l-h*u;if(0<h||h<p)return[]}if(0===h)return!a||0!==d&&d!==p?[t]:[];if(h===p)return!a||0!==d&&d!==p?[e]:[];if(0===d)return[i];if(d===p)return[r];a=h/p;return[{x:t.x+a*o,y:t.y+a*s}]}if(0!==d||c*l!==h*u)return[];s=0===o&&0===s;h=0===h&&0===c;if(s&&h)return t.x!==i.x||t.y!==i.y?[]:[t];if(s)return n(i,r,t)?[t]:[];if(h)return n(t,e,i)?[i]:[];0!==o?(t.x<e.x?(o=t,h=t.x,s=e,t=e.x):(o=e,h=e.x,s=t,t=t.x),i.x<r.x?(e=i,p=i.x,c=r,i=r.x):(e=r,p=r.x,c=i,i=i.x)):(t.y<e.y?(o=t,h=t.y,s=e,t=e.y):(o=e,h=e.y,s=t,t=t.y),i.y<r.y?(e=i,p=i.y,c=r,i=r.y):(e=r,p=r.y,c=i,i=i.y));return h<=p?t<p?[]:t===p?a?[]:[e]:t<=i?[e,s]:[e,c]:h>i?[]:h===i?a?[]:[o]:t<=i?[o,s]:[o,c]}function a(t,e,i,n){var r=e.x-t.x,a=e.y-t.y;e=i.x-t.x;i=i.y-t.y;var o=n.x-t.x;n=n.y-t.y;t=r*i-a*e;r=r*n-a*o;return Math.abs(t)>Number.EPSILON?(e=o*i-n*e,0<t?0<=r&&0<=e:0<=r||0<=e):0<r}i(t);e.forEach(i);var o,s,h,c,l,u={};h=t.concat();o=0;for(s=e.length;o<s;o++)Array.prototype.push.apply(h,e[o]);o=0;for(s=h.length;o<s;o++)l=h[o].x+":"+h[o].y,void 0!==u[l]&&console.warn("THREE.ShapeUtils: Duplicate point",l,o),u[l]=o;o=function(t,e){function i(t,e){var i=s.length-1,n=t-1;0>n&&(n=i);var r=t+1;r>i&&(r=0);i=a(s[t],s[n],s[r],h[e]);if(!i)return!1;i=h.length-1;n=e-1;0>n&&(n=i);r=e+1;r>i&&(r=0);return(i=a(h[e],h[n],h[r],s[t]))?!0:!1}function n(t,e){var i,n;for(i=0;i<s.length;i++)if(n=i+1,n%=s.length,n=r(t,e,s[i],s[n],!0),0<n.length)return!0;return!1}function o(t,i){var n,a,o,s;for(n=0;n<c.length;n++)for(a=e[c[n]],o=0;o<a.length;o++)if(s=o+1,s%=a.length,s=r(t,i,a[o],a[s],!0),0<s.length)return!0;return!1}var s=t.concat(),h,c=[],l,u,p,d,f,m=[],v,g,y,x=0;for(l=e.length;x<l;x++)c.push(x);v=0;for(var b=2*c.length;0<c.length;){b--;if(0>b){console.log("Infinite Loop! Holes left:"+c.length+", Probably Hole outside Shape!");break}for(u=v;u<s.length;u++){p=s[u];l=-1;for(x=0;x<c.length;x++)if(d=c[x],f=p.x+":"+p.y+":"+d,void 0===m[f]){h=e[d];for(g=0;g<h.length;g++)if(d=h[g],i(u,g)&&!n(p,d)&&!o(p,d)){l=g;c.splice(x,1);v=s.slice(0,u+1);d=s.slice(u);g=h.slice(l);y=h.slice(0,l+1);s=v.concat(g).concat(y).concat(d);v=u;break}if(0<=l)break;m[f]=!0}if(0<=l)break}}return s}(t,e);var p=Tr.triangulate(o,!1);o=0;for(s=p.length;o<s;o++)for(c=p[o],h=0;3>h;h++)l=c[h].x+":"+c[h].y,l=u[l],void 0!==l&&(c[h]=l);return p.concat()},isClockWise:function(t){return 0>Tr.area(t)}};Ve.prototype=Object.create(_t.prototype);Ve.prototype.constructor=Ve;Ve.prototype.addShapeList=function(t,e){for(var i=t.length,n=0;n<i;n++)this.addShape(t[n],e)};Ve.prototype.addShape=function(t,e){function n(t,e,i){e||console.error("THREE.ExtrudeGeometry: vec does not exist");return e.clone().multiplyScalar(i).add(t)}function r(t,e,n){var r,a,o;a=t.x-e.x;o=t.y-e.y;r=n.x-t.x;var s=n.y-t.y,h=a*a+o*o;if(Math.abs(a*s-o*r)>Number.EPSILON){var c=Math.sqrt(h),l=Math.sqrt(r*r+s*s),h=e.x-o/c;e=e.y+a/c;s=((n.x-s/l-h)*s-(n.y+r/l-e)*r)/(a*s-o*r);r=h+a*s-t.x;a=e+o*s-t.y;o=r*r+a*a;if(2>=o)return new i(r,a);o=Math.sqrt(o/2)}else t=!1,a>Number.EPSILON?r>Number.EPSILON&&(t=!0):a<-Number.EPSILON?r<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(s)&&(t=!0),t?(r=-o,o=Math.sqrt(h)):(r=a,a=o,o=Math.sqrt(h/2));return new i(r/o,a/o)}function a(t,e){var i,n;for(B=t.length;0<=--B;){i=B;n=B-1;0>n&&(n=t.length-1);var r,a=m+2*p;for(r=0;r<a;r++){var o=O*r,s=O*(r+1),h=e+i+o,o=e+n+o,c=e+n+s,s=e+i+s,h=h+A,o=o+A,c=c+A,s=s+A;R.faces.push(new ht(h,o,s,null,null,1));R.faces.push(new ht(o,c,s,null,null,1));h=x.generateSideWallUV(R,h,o,c,s);R.faceVertexUvs[0].push([h[0],h[1],h[3]]);R.faceVertexUvs[0].push([h[1],h[2],h[3]])}}}function o(t,e,i){R.vertices.push(new h(t,e,i))}function s(t,e,i){t+=A;e+=A;i+=A;R.faces.push(new ht(t,e,i,null,null,0));t=x.generateTopUV(R,t,e,i);R.faceVertexUvs[0].push(t)}var c=void 0!==e.amount?e.amount:100,l=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:l-2,p=void 0!==e.bevelSegments?e.bevelSegments:3,d=void 0!==e.bevelEnabled?e.bevelEnabled:!0,f=void 0!==e.curveSegments?e.curveSegments:12,m=void 0!==e.steps?e.steps:1,v=e.extrudePath,g,y=!1,x=void 0!==e.UVGenerator?e.UVGenerator:Ve.WorldUVGenerator,b,M,_,w;v&&(g=v.getSpacedPoints(m),y=!0,d=!1,b=void 0!==e.frames?e.frames:v.computeFrenetFrames(m,!1),M=new h,_=new h,w=new h);d||(u=l=p=0);var E,T,S,R=this,A=this.vertices.length,v=t.extractPoints(f),f=v.shape,L=v.holes;if(v=!Tr.isClockWise(f)){f=f.reverse();T=0;for(S=L.length;T<S;T++)E=L[T],Tr.isClockWise(E)&&(L[T]=E.reverse());v=!1}var P=Tr.triangulateShape(f,L),C=f;T=0;for(S=L.length;T<S;T++)E=L[T],f=f.concat(E);var I,N,z,U,D,O=f.length,H,F=P.length,v=[],B=0;z=C.length;I=z-1;for(N=B+1;B<z;B++,I++,N++)I===z&&(I=0),N===z&&(N=0),v[B]=r(C[B],C[I],C[N]);var k=[],G,V=v.concat();T=0;for(S=L.length;T<S;T++){E=L[T];G=[];B=0;z=E.length;I=z-1;for(N=B+1;B<z;B++,I++,N++)I===z&&(I=0),N===z&&(N=0),G[B]=r(E[B],E[I],E[N]);k.push(G);V=V.concat(G)}for(I=0;I<p;I++){z=I/p;U=l*Math.cos(z*Math.PI/2);N=u*Math.sin(z*Math.PI/2);B=0;for(z=C.length;B<z;B++)D=n(C[B],v[B],N),o(D.x,D.y,-U);T=0;for(S=L.length;T<S;T++)for(E=L[T],G=k[T],B=0,z=E.length;B<z;B++)D=n(E[B],G[B],N),o(D.x,D.y,-U)}N=u;for(B=0;B<O;B++)D=d?n(f[B],V[B],N):f[B],y?(_.copy(b.normals[0]).multiplyScalar(D.x),M.copy(b.binormals[0]).multiplyScalar(D.y),w.copy(g[0]).add(_).add(M),o(w.x,w.y,w.z)):o(D.x,D.y,0);for(z=1;z<=m;z++)for(B=0;B<O;B++)D=d?n(f[B],V[B],N):f[B],y?(_.copy(b.normals[z]).multiplyScalar(D.x),M.copy(b.binormals[z]).multiplyScalar(D.y),w.copy(g[z]).add(_).add(M),o(w.x,w.y,w.z)):o(D.x,D.y,c/m*z);for(I=p-1;0<=I;I--){z=I/p;U=l*Math.cos(z*Math.PI/2);N=u*Math.sin(z*Math.PI/2);B=0;for(z=C.length;B<z;B++)D=n(C[B],v[B],N),o(D.x,D.y,c+U);T=0;for(S=L.length;T<S;T++)for(E=L[T],G=k[T],B=0,z=E.length;B<z;B++)D=n(E[B],G[B],N),y?o(D.x,D.y+g[m-1].y,g[m-1].x+U):o(D.x,D.y,c+U)}(function(){if(d){var t=0*O;for(B=0;B<F;B++)H=P[B],s(H[2]+t,H[1]+t,H[0]+t);t=O*(m+2*p);for(B=0;B<F;B++)H=P[B],s(H[0]+t,H[1]+t,H[2]+t)}else{for(B=0;B<F;B++)H=P[B],s(H[2],H[1],H[0]);for(B=0;B<F;B++)H=P[B],s(H[0]+O*m,H[1]+O*m,H[2]+O*m)}})();(function(){var t=0;a(C,t);t+=C.length;T=0;for(S=L.length;T<S;T++)E=L[T],a(E,t),t+=E.length})()};Ve.WorldUVGenerator={generateTopUV:function(t,e,n,r){t=t.vertices;e=t[e];n=t[n];r=t[r];return[new i(e.x,e.y),new i(n.x,n.y),new i(r.x,r.y)]},generateSideWallUV:function(t,e,n,r,a){t=t.vertices;e=t[e];n=t[n];r=t[r];a=t[a];return.01>Math.abs(e.y-n.y)?[new i(e.x,1-e.z),new i(n.x,1-n.z),new i(r.x,1-r.z),new i(a.x,1-a.z)]:[new i(e.y,1-e.z),new i(n.y,1-n.z),new i(r.y,1-r.z),new i(a.y,1-a.z)]}};je.prototype=Object.create(Ve.prototype);je.prototype.constructor=je;We.prototype=Object.create(_t.prototype);We.prototype.constructor=We;qe.prototype=Object.create(wt.prototype);qe.prototype.constructor=qe;Xe.prototype=Object.create(_t.prototype);Xe.prototype.constructor=Xe;Ye.prototype=Object.create(wt.prototype);Ye.prototype.constructor=Ye;Ze.prototype=Object.create(_t.prototype);Ze.prototype.constructor=Ze;Qe.prototype=Object.create(wt.prototype);Qe.prototype.constructor=Qe;Je.prototype=Object.create(_t.prototype);Je.prototype.constructor=Je;Ke.prototype=Object.create(wt.prototype);Ke.prototype.constructor=Ke;$e.prototype=Object.create(wt.prototype);$e.prototype.constructor=$e;ti.prototype=Object.create(_t.prototype);ti.prototype.constructor=ti;ei.prototype=Object.create(wt.prototype);ei.prototype.constructor=ei;ii.prototype=Object.create(ti.prototype);ii.prototype.constructor=ii;ni.prototype=Object.create(ei.prototype);ni.prototype.constructor=ni;ri.prototype=Object.create(_t.prototype);ri.prototype.constructor=ri;ai.prototype=Object.create(wt.prototype);ai.prototype.constructor=ai;var Sr=Object.freeze({WireframeGeometry:Ee,ParametricGeometry:Te,ParametricBufferGeometry:Se,TetrahedronGeometry:Le,TetrahedronBufferGeometry:Pe,OctahedronGeometry:Ce,OctahedronBufferGeometry:Ie,IcosahedronGeometry:Ne,IcosahedronBufferGeometry:ze,DodecahedronGeometry:Ue,DodecahedronBufferGeometry:De,PolyhedronGeometry:Re,PolyhedronBufferGeometry:Ae,TubeGeometry:Oe,TubeBufferGeometry:He,TorusKnotGeometry:Fe,TorusKnotBufferGeometry:Be,TorusGeometry:ke,TorusBufferGeometry:Ge,TextGeometry:je,SphereGeometry:We,SphereBufferGeometry:qe,RingGeometry:Xe,RingBufferGeometry:Ye,PlaneGeometry:Rt,PlaneBufferGeometry:At,LatheGeometry:Ze,LatheBufferGeometry:Qe,ShapeGeometry:Je,ShapeBufferGeometry:Ke,ExtrudeGeometry:Ve,EdgesGeometry:$e,ConeGeometry:ii,ConeBufferGeometry:ni,CylinderGeometry:ti,CylinderBufferGeometry:ei,CircleGeometry:ri,CircleBufferGeometry:ai,BoxGeometry:Tt,BoxBufferGeometry:St});oi.prototype=Object.create(Y.prototype);oi.prototype.constructor=oi;oi.prototype.isShadowMaterial=!0;si.prototype=Object.create(Y.prototype);si.prototype.constructor=si;si.prototype.isRawShaderMaterial=!0;hi.prototype={constructor:hi,isMultiMaterial:!0,toJSON:function(t){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,n=0,r=i.length;n<r;n++){var a=i[n].toJSON(t);delete a.metadata;e.materials.push(a)}e.visible=this.visible;return e},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());t.visible=this.visible;return t}};ci.prototype=Object.create(X.prototype);ci.prototype.constructor=ci;ci.prototype.isMeshStandardMaterial=!0;ci.prototype.copy=function(t){X.prototype.copy.call(this,t);this.defines={STANDARD:""};this.color.copy(t.color);this.roughness=t.roughness;this.metalness=t.metalness;this.map=t.map;this.lightMap=t.lightMap;this.lightMapIntensity=t.lightMapIntensity;this.aoMap=t.aoMap;this.aoMapIntensity=t.aoMapIntensity;this.emissive.copy(t.emissive);this.emissiveMap=t.emissiveMap;this.emissiveIntensity=t.emissiveIntensity;this.bumpMap=t.bumpMap;this.bumpScale=t.bumpScale;this.normalMap=t.normalMap;this.normalScale.copy(t.normalScale);this.displacementMap=t.displacementMap;this.displacementScale=t.displacementScale;this.displacementBias=t.displacementBias;this.roughnessMap=t.roughnessMap;this.metalnessMap=t.metalnessMap;this.alphaMap=t.alphaMap;this.envMap=t.envMap;this.envMapIntensity=t.envMapIntensity;this.refractionRatio=t.refractionRatio;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.wireframeLinecap=t.wireframeLinecap;this.wireframeLinejoin=t.wireframeLinejoin;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.morphNormals=t.morphNormals;return this};li.prototype=Object.create(ci.prototype);li.prototype.constructor=li;li.prototype.isMeshPhysicalMaterial=!0;li.prototype.copy=function(t){ci.prototype.copy.call(this,t);this.defines={PHYSICAL:""};this.reflectivity=t.reflectivity;this.clearCoat=t.clearCoat;this.clearCoatRoughness=t.clearCoatRoughness;return this};ui.prototype=Object.create(X.prototype);ui.prototype.constructor=ui;ui.prototype.isMeshPhongMaterial=!0;ui.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.specular.copy(t.specular);this.shininess=t.shininess;this.map=t.map;this.lightMap=t.lightMap;this.lightMapIntensity=t.lightMapIntensity;this.aoMap=t.aoMap;this.aoMapIntensity=t.aoMapIntensity;this.emissive.copy(t.emissive);this.emissiveMap=t.emissiveMap;this.emissiveIntensity=t.emissiveIntensity;this.bumpMap=t.bumpMap;this.bumpScale=t.bumpScale;this.normalMap=t.normalMap;this.normalScale.copy(t.normalScale);this.displacementMap=t.displacementMap;this.displacementScale=t.displacementScale;this.displacementBias=t.displacementBias;this.specularMap=t.specularMap;this.alphaMap=t.alphaMap;this.envMap=t.envMap;this.combine=t.combine;this.reflectivity=t.reflectivity;this.refractionRatio=t.refractionRatio;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.wireframeLinecap=t.wireframeLinecap;this.wireframeLinejoin=t.wireframeLinejoin;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.morphNormals=t.morphNormals;return this};pi.prototype=Object.create(ui.prototype);pi.prototype.constructor=pi;pi.prototype.isMeshToonMaterial=!0;pi.prototype.copy=function(t){ui.prototype.copy.call(this,t);this.gradientMap=t.gradientMap;return this};di.prototype=Object.create(X.prototype);di.prototype.constructor=di;di.prototype.isMeshNormalMaterial=!0;di.prototype.copy=function(t){X.prototype.copy.call(this,t);this.bumpMap=t.bumpMap;this.bumpScale=t.bumpScale;this.normalMap=t.normalMap;this.normalScale.copy(t.normalScale);this.displacementMap=t.displacementMap;this.displacementScale=t.displacementScale;this.displacementBias=t.displacementBias;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.morphNormals=t.morphNormals;return this};fi.prototype=Object.create(X.prototype);fi.prototype.constructor=fi;fi.prototype.isMeshLambertMaterial=!0;fi.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.map=t.map;this.lightMap=t.lightMap;this.lightMapIntensity=t.lightMapIntensity;this.aoMap=t.aoMap;this.aoMapIntensity=t.aoMapIntensity;this.emissive.copy(t.emissive);this.emissiveMap=t.emissiveMap;this.emissiveIntensity=t.emissiveIntensity;this.specularMap=t.specularMap;this.alphaMap=t.alphaMap;this.envMap=t.envMap;this.combine=t.combine;this.reflectivity=t.reflectivity;this.refractionRatio=t.refractionRatio;this.wireframe=t.wireframe;this.wireframeLinewidth=t.wireframeLinewidth;this.wireframeLinecap=t.wireframeLinecap;this.wireframeLinejoin=t.wireframeLinejoin;this.skinning=t.skinning;this.morphTargets=t.morphTargets;this.morphNormals=t.morphNormals;return this};mi.prototype=Object.create(X.prototype);mi.prototype.constructor=mi;mi.prototype.isLineDashedMaterial=!0;mi.prototype.copy=function(t){X.prototype.copy.call(this,t);this.color.copy(t.color);this.linewidth=t.linewidth;this.scale=t.scale;this.dashSize=t.dashSize;this.gapSize=t.gapSize;return this};var Rr=Object.freeze({ShadowMaterial:oi,SpriteMaterial:he,RawShaderMaterial:si,ShaderMaterial:Y,PointsMaterial:ge,MultiMaterial:hi,MeshPhysicalMaterial:li,MeshStandardMaterial:ci,MeshPhongMaterial:ui,MeshToonMaterial:pi,MeshNormalMaterial:di,MeshLambertMaterial:fi,MeshDepthMaterial:Z,MeshBasicMaterial:ct,LineDashedMaterial:mi,LineBasicMaterial:fe,Material:X}),Ar={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Lr=new vi;Object.assign(gi.prototype,{load:function(t,e,i,n){void 0===t&&(t="");void 0!==this.path&&(t=this.path+t);var r=this,a=Ar.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a);r.manager.itemEnd(t)},0),a;var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],h=!!o[2],o=o[3],o=window.decodeURIComponent(o);h&&(o=window.atob(o));try{var c,l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":c=new ArrayBuffer(o.length);for(var u=new Uint8Array(c),h=0;h<o.length;h++)u[h]=o.charCodeAt(h);"blob"===l&&(c=new Blob([c],{type:s}));break;case"document":c=(new DOMParser).parseFromString(o,s);break;case"json":c=JSON.parse(o);break;default:c=o}window.setTimeout(function(){e&&e(c);r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e);r.manager.itemError(t)},0)}}else{var p=new XMLHttpRequest;p.open("GET",t,!0);p.addEventListener("load",function(i){var a=i.target.response;Ar.add(t,a);200===this.status?(e&&e(a),r.manager.itemEnd(t)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(a),r.manager.itemEnd(t)):(n&&n(i),r.manager.itemError(t))},!1);void 0!==i&&p.addEventListener("progress",function(t){i(t)},!1);p.addEventListener("error",function(e){n&&n(e);r.manager.itemError(t)},!1);void 0!==this.responseType&&(p.responseType=this.responseType);void 0!==this.withCredentials&&(p.withCredentials=this.withCredentials);p.overrideMimeType&&p.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");p.send(null)}r.manager.itemStart(t);return p},setPath:function(t){this.path=t;return this},setResponseType:function(t){this.responseType=t;return this},setWithCredentials:function(t){this.withCredentials=t;return this},setMimeType:function(t){this.mimeType=t;return this}});Object.assign(yi.prototype,{load:function(t,e,i,n){function r(r){h.load(t[r],function(t){t=a._parser(t,!0);o[r]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps};c+=1;6===c&&(1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s))},i,n)}var a=this,o=[],s=new Me;s.image=o;var h=new gi(this.manager);h.setPath(this.path);h.setResponseType("arraybuffer");if(Array.isArray(t))for(var c=0,l=0,u=t.length;l<u;++l)r(l);else h.load(t,function(t){t=a._parser(t,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,n=0;n<i;n++){o[n]={mipmaps:[]};for(var r=0;r<t.mipmapCount;r++)o[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+r]),o[n].format=t.format,o[n].width=t.width,o[n].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;1===t.mipmapCount&&(s.minFilter=1006);s.format=t.format;s.needsUpdate=!0;e&&e(s)},i,n);return s},setPath:function(t){this.path=t;return this}});Object.assign(xi.prototype,{load:function(t,e,i,n){var r=this,a=new V,o=new gi(this.manager);o.setResponseType("arraybuffer");o.load(t,function(t){if(t=r._parser(t))void 0!==t.image?a.image=t.image:void 0!==t.data&&(a.image.width=t.width,a.image.height=t.height,a.image.data=t.data),a.wrapS=void 0!==t.wrapS?t.wrapS:1001,a.wrapT=void 0!==t.wrapT?t.wrapT:1001,a.magFilter=void 0!==t.magFilter?t.magFilter:1006,a.minFilter=void 0!==t.minFilter?t.minFilter:1008,a.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(a.format=t.format),void 0!==t.type&&(a.type=t.type),void 0!==t.mipmaps&&(a.mipmaps=t.mipmaps),1===t.mipmapCount&&(a.minFilter=1006),a.needsUpdate=!0,e&&e(a,t)},i,n);return a}});Object.assign(bi.prototype,{load:function(t,e,i,n){void 0===t&&(t="");void 0!==this.path&&(t=this.path+t);var r=this,a=Ar.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a);r.manager.itemEnd(t)},0),a;i=document.createElementNS("http://www.w3.org/1999/xhtml","img");i.addEventListener("load",function(){Ar.add(t,this);e&&e(this);r.manager.itemEnd(t)},!1);i.addEventListener("error",function(e){n&&n(e);r.manager.itemError(t)},!1);void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin);r.manager.itemStart(t);i.src=t;return i},setCrossOrigin:function(t){this.crossOrigin=t;return this},setPath:function(t){this.path=t;return this}});Object.assign(Mi.prototype,{load:function(t,e,i,n){function r(i){o.load(t[i],function(t){a.images[i]=t;s++;6===s&&(a.needsUpdate=!0,e&&e(a))},void 0,n)}var a=new l,o=new bi(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);var s=0;for(i=0;i<t.length;++i)r(i);return a},setCrossOrigin:function(t){this.crossOrigin=t;return this},setPath:function(t){this.path=t;return this}});Object.assign(_i.prototype,{load:function(t,e,i,r){var a=new n,o=new bi(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);o.load(t,function(i){var n=0<t.search(/\.(jpg|jpeg)$/)||0===t.search(/^data\:image\/jpeg/);a.format=n?1022:1023;a.image=i;a.needsUpdate=!0;void 0!==e&&e(a)},i,r);return a},setCrossOrigin:function(t){this.crossOrigin=t;return this},setPath:function(t){this.path=t;return this}});wi.prototype=Object.assign(Object.create(at.prototype),{constructor:wi,isLight:!0,copy:function(t){at.prototype.copy.call(this,t);this.color.copy(t.color);this.intensity=t.intensity;return this},toJSON:function(t){t=at.prototype.toJSON.call(this,t);t.object.color=this.color.getHex();t.object.intensity=this.intensity;void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(t.object.distance=this.distance);void 0!==this.angle&&(t.object.angle=this.angle);void 0!==this.decay&&(t.object.decay=this.decay);void 0!==this.penumbra&&(t.object.penumbra=this.penumbra);void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON());return t}});Ei.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ei,isHemisphereLight:!0,copy:function(t){wi.prototype.copy.call(this,t);this.groundColor.copy(t.groundColor);return this}});Object.assign(Ti.prototype,{copy:function(t){this.camera=t.camera.clone();this.bias=t.bias;this.radius=t.radius;this.mapSize.copy(t.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};0!==this.bias&&(t.bias=this.bias);1!==this.radius&&(t.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)t.mapSize=this.mapSize.toArray();t.camera=this.camera.toJSON(!1).object;delete t.camera.matrix;return t}});Si.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Si,isSpotLightShadow:!0,update:function(t){var e=2*cr.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height;t=t.distance||500;var n=this.camera;if(e!==n.fov||i!==n.aspect||t!==n.far)n.fov=e,n.aspect=i,n.far=t,n.updateProjectionMatrix()}});Ri.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ri,isSpotLight:!0,copy:function(t){wi.prototype.copy.call(this,t);this.distance=t.distance;this.angle=t.angle;this.penumbra=t.penumbra;this.decay=t.decay;this.target=t.target.clone();this.shadow=t.shadow.clone();return this}});Ai.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ai,isPointLight:!0,copy:function(t){wi.prototype.copy.call(this,t);this.distance=t.distance;this.decay=t.decay;this.shadow=t.shadow.clone();return this}});Li.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Li});Pi.prototype=Object.assign(Object.create(wi.prototype),{constructor:Pi,isDirectionalLight:!0,copy:function(t){wi.prototype.copy.call(this,t);this.target=t.target.clone();this.shadow=t.shadow.clone();return this}});Ci.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ci,isAmbientLight:!0});var Pr={arraySlice:function(t,e,i){return Pr.isTypedArray(t)?new t.constructor(t.subarray(e,i)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,i=Array(e),n=0;n!==e;++n)i[n]=n;i.sort(function(e,i){return t[e]-t[i]});return i},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),a=0,o=0;o!==n;++a)for(var s=i[a]*e,h=0;h!==e;++h)r[o++]=t[s+h];return r},flattenJSON:function(t,e,i,n){for(var r=1,a=t[0];void 0!==a&&void 0===a[n];)a=t[r++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o)){do{o=a[n],void 0!==o&&(e.push(a.time),i.push.apply(i,o)),a=t[r++]}while(void 0!==a)}else if(void 0!==o.toArray){do{o=a[n],void 0!==o&&(e.push(a.time),o.toArray(i,i.length)),a=t[r++]}while(void 0!==a)}else{do{o=a[n],void 0!==o&&(e.push(a.time),i.push(o)),a=t[r++]}while(void 0!==a)}}}};Ii.prototype={constructor:Ii,evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{i:{n:if(!(t<n)){for(var a=i+2;;){if(void 0===n){if(t<r)break n;this._cachedIndex=i=e.length;return this.afterEnd_(i-1,t,r)}if(i===a)break;r=n;n=e[++i];if(t<n)break e}n=e.length;break i}if(t>=r)break t;else{a=e[1];t<a&&(i=2,r=a);for(a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;n=r;r=e[--i-1];if(t>=r)break e}n=i;i=0}}for(;i<n;)r=i+n>>>1,t<e[r]?n=r:i=r+1;n=e[i];r=e[i-1];if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=i=e.length,this.afterEnd_(i-1,r,t)}this._cachedIndex=i;this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize;t*=n;for(var r=0;r!==n;++r)e[r]=i[t+r];return e},interpolate_:function(t,e,i,n){throw Error("call to abstract method")},intervalChanged_:function(t,e,i){}};Object.assign(Ii.prototype,{beforeStart_:Ii.prototype.copySampleValue_,afterEnd_:Ii.prototype.copySampleValue_});Ni.prototype=Object.assign(Object.create(Ii.prototype),{constructor:Ni,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,a=t+1,o=n[r],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t;o=2*e-i;break;case 2402:r=n.length-2;o=e+n[r]-n[r+1];break;default:r=t,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=t;s=2*i-e;break;case 2402:a=1;s=i+n[1]-n[0];break;default:a=t-1,s=e}t=.5*(i-e);n=this.valueSize;this._weightPrev=t/(e-o);this._weightNext=t/(s-i);this._offsetPrev=r*n;this._offsetNext=a*n},interpolate_:function(t,e,i,n){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize;t*=o;var s=t-o,h=this._offsetPrev,c=this._offsetNext,l=this._weightPrev,u=this._weightNext,p=(i-e)/(n-e);i=p*p;n=i*p;e=-l*n+2*l*i-l*p;l=(1+l)*n+(-1.5-2*l)*i+(-.5+l)*p+1;p=(-1-u)*n+(1.5+u)*i+.5*p;u=u*n-u*i;for(i=0;i!==o;++i)r[i]=e*a[h+i]+l*a[s+i]+p*a[t+i]+u*a[c+i];return r}});zi.prototype=Object.assign(Object.create(Ii.prototype),{constructor:zi,interpolate_:function(t,e,i,n){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize;t*=o;var s=t-o;e=(i-e)/(n-e);i=1-e;for(n=0;n!==o;++n)r[n]=a[s+n]*i+a[t+n]*e;return r}});Ui.prototype=Object.assign(Object.create(Ii.prototype),{constructor:Ui,interpolate_:function(t,e,i,n){return this.copySampleValue_(t-1)}});var Cr;Cr={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Ui(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new zi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Ni(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(e);console.warn(e)}else this.createInterpolant=e},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,a=n-1;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;++a;if(0!==r||a!==n)r>=a&&(a=Math.max(a,1),r=a-1),n=this.getValueSize(),this.times=Pr.arraySlice(i,r,a),this.values=Pr.arraySlice(this.values,r*n,a*n);return this},validate:function(){var t=!0,e=this.getValueSize();0!==e-Math.floor(e)&&(console.error("invalid value size in track",this),t=!1);var i=this.times,e=this.values,n=i.length;0===n&&(console.error("track is empty",this),t=!1);for(var r=null,a=0;a!==n;a++){var o=i[a];if("number"===typeof o&&isNaN(o)){console.error("time is not a valid number",this,a,o);t=!1;break}if(null!==r&&r>o){console.error("out of order keys",this,a,o,r);t=!1;break}r=o}if(void 0!==e&&Pr.isTypedArray(e))for(a=0,i=e.length;a!==i;++a)if(n=e[a],isNaN(n)){console.error("value is not a valid number",this,a,n);t=!1;break}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,a=t.length-1,o=1;o<a;++o){var s=!1,h=t[o];if(h!==t[o+1]&&(1!==o||h!==h[0]))if(n)s=!0;else for(var c=o*i,l=c-i,u=c+i,h=0;h!==i;++h){var p=e[c+h];if(p!==e[l+h]||p!==e[u+h]){s=!0;break}}if(s){if(o!==r)for(t[r]=t[o],s=o*i,c=r*i,h=0;h!==i;++h)e[c+h]=e[s+h];++r}}if(0<a){t[r]=t[a];s=a*i;c=r*i;for(h=0;h!==i;++h)e[c+h]=e[s+h];++r}r!==t.length&&(this.times=Pr.arraySlice(t,0,r),this.values=Pr.arraySlice(e,0,r*i));return this}};Oi.prototype=Object.assign(Object.create(Cr),{constructor:Oi,ValueTypeName:"vector"});Hi.prototype=Object.assign(Object.create(Ii.prototype),{constructor:Hi,interpolate_:function(t,e,i,n){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize;t*=o;e=(i-e)/(n-e);for(i=t+o;t!==i;t+=4)s.slerpFlat(r,0,a,t-o,a,t,e);return r}});Fi.prototype=Object.assign(Object.create(Cr),{constructor:Fi,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new Hi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0});Bi.prototype=Object.assign(Object.create(Cr),{constructor:Bi,ValueTypeName:"number"});ki.prototype=Object.assign(Object.create(Cr),{constructor:ki,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Gi.prototype=Object.assign(Object.create(Cr),{constructor:Gi,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Vi.prototype=Object.assign(Object.create(Cr),{constructor:Vi,ValueTypeName:"color"});ji.prototype=Cr;Cr.constructor=ji;Object.assign(ji,{parse:function(t){if(void 0===t.type)throw Error("track type undefined, can not parse");var e=ji._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];Pr.flattenJSON(t.keys,i,n,"value");t.times=i;t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e=t.constructor;if(void 0!==e.toJSON)e=e.toJSON(t);else{var e={name:t.name,times:Pr.convertArray(t.times,Array),values:Pr.convertArray(t.values,Array)},i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}e.type=t.ValueTypeName;return e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Bi;case"vector":case"vector2":case"vector3":case"vector4":return Oi;case"color":return Vi;case"quaternion":return Fi;case"bool":case"boolean":return Gi;case"string":return ki}throw Error("Unsupported typeName: "+t)}});Wi.prototype={constructor:Wi,resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e)var n=this.tracks[e],t=Math.max(t,n.times[n.times.length-1]);this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}};Object.assign(Wi,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,a=i.length;r!==a;++r)e.push(ji.parse(i[r]).scale(n));return new Wi(t.name,t.duration,e)},toJSON:function(t){var e=[],i=t.tracks;t={name:t.name,duration:t.duration,tracks:e};for(var n=0,r=i.length;n!==r;++n)e.push(ji.toJSON(i[n]));return t},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,a=[],o=0;o<r;o++){var s=[],h=[];s.push((o+r-1)%r,o,(o+1)%r);h.push(0,1,0);var c=Pr.getKeyframeOrder(s),s=Pr.sortedArray(s,1,c),h=Pr.sortedArray(h,1,c);n||0!==s[0]||(s.push(r),h.push(h[0]));a.push(new Bi(".morphTargetInfluences["+e[o].name+"]",s,h).scale(1/i))}return new Wi(t,-1,a)},findByName:function(t,e){var i=t;Array.isArray(t)||(i=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],h=s.name.match(r);if(h&&1<h.length){var c=h[1];(h=n[c])||(n[c]=h=[]);h.push(s)}}t=[];for(c in n)t.push(Wi.CreateFromMorphTargetSequence(c,n[c],e,i));return t},parseAnimation:function(t,e){if(!t)return console.error("  no animation in JSONLoader data"),null;for(var i=function(t,e,i,n,r){if(0!==i.length){var a=[],o=[];Pr.flattenJSON(i,a,o,n);0!==a.length&&r.push(new t(e,a,o))}},n=[],r=t.name||"default",a=t.length||-1,o=t.fps||30,s=t.hierarchy||[],h=0;h<s.length;h++){var c=s[h].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var a={},l=0;l<c.length;l++)if(c[l].morphTargets)for(var u=0;u<c[l].morphTargets.length;u++)a[c[l].morphTargets[u]]=-1;for(var p in a){for(var d=[],f=[],u=0;u!==c[l].morphTargets.length;++u){var m=c[l];d.push(m.time);f.push(m.morphTarget===p?1:0)}n.push(new Bi(".morphTargetInfluence["+p+"]",d,f))}a=a.length*(o||1)}else l=".bones["+e[h].name+"]",i(Oi,l+".position",c,"pos",n),i(Fi,l+".quaternion",c,"rot",n),i(Oi,l+".scale",c,"scl",n)}return 0===n.length?null:new Wi(r,a,n)}});Object.assign(qi.prototype,{load:function(t,e,i,n){var r=this;new gi(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){function e(t){void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t);return n[t]}var n=this.textures,r=new Rr[t.type];void 0!==t.uuid&&(r.uuid=t.uuid);void 0!==t.name&&(r.name=t.name);void 0!==t.color&&r.color.setHex(t.color);void 0!==t.roughness&&(r.roughness=t.roughness);void 0!==t.metalness&&(r.metalness=t.metalness);void 0!==t.emissive&&r.emissive.setHex(t.emissive);void 0!==t.specular&&r.specular.setHex(t.specular);void 0!==t.shininess&&(r.shininess=t.shininess);void 0!==t.clearCoat&&(r.clearCoat=t.clearCoat);void 0!==t.clearCoatRoughness&&(r.clearCoatRoughness=t.clearCoatRoughness);void 0!==t.uniforms&&(r.uniforms=t.uniforms);void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader);void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader);void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors);void 0!==t.fog&&(r.fog=t.fog);void 0!==t.shading&&(r.shading=t.shading);void 0!==t.blending&&(r.blending=t.blending);void 0!==t.side&&(r.side=t.side);void 0!==t.opacity&&(r.opacity=t.opacity);void 0!==t.transparent&&(r.transparent=t.transparent);void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest);void 0!==t.depthTest&&(r.depthTest=t.depthTest);void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite);void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite);void 0!==t.wireframe&&(r.wireframe=t.wireframe);void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth);void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap);void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin);void 0!==t.skinning&&(r.skinning=t.skinning);void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets);void 0!==t.size&&(r.size=t.size);void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation);void 0!==t.map&&(r.map=e(t.map));void 0!==t.alphaMap&&(r.alphaMap=e(t.alphaMap),r.transparent=!0);void 0!==t.bumpMap&&(r.bumpMap=e(t.bumpMap));void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale);void 0!==t.normalMap&&(r.normalMap=e(t.normalMap));if(void 0!==t.normalScale){var a=t.normalScale;!1===Array.isArray(a)&&(a=[a,a]);r.normalScale=(new i).fromArray(a)}void 0!==t.displacementMap&&(r.displacementMap=e(t.displacementMap));void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale);void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias);void 0!==t.roughnessMap&&(r.roughnessMap=e(t.roughnessMap));void 0!==t.metalnessMap&&(r.metalnessMap=e(t.metalnessMap));void 0!==t.emissiveMap&&(r.emissiveMap=e(t.emissiveMap));void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity);void 0!==t.specularMap&&(r.specularMap=e(t.specularMap));void 0!==t.envMap&&(r.envMap=e(t.envMap));void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity);void 0!==t.lightMap&&(r.lightMap=e(t.lightMap));void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity);void 0!==t.aoMap&&(r.aoMap=e(t.aoMap));void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity);void 0!==t.gradientMap&&(r.gradientMap=e(t.gradientMap));if(void 0!==t.materials)for(var a=0,o=t.materials.length;a<o;a++)r.materials.push(this.parse(t.materials[a]));return r}});Object.assign(Xi.prototype,{load:function(t,e,i,n){var r=this;new gi(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new wt,i=t.data.index,n={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==i&&(i=new n[i.type](i.array),e.setIndex(new lt(i,1)));var r=t.data.attributes,a;for(a in r){var o=r[a],i=new n[o.type](o.array);e.addAttribute(a,new lt(i,o.itemSize,o.normalized))}n=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==n)for(a=0,i=n.length;a!==i;++a)r=n[a],e.addGroup(r.start,r.count,r.materialIndex);t=t.data.boundingSphere;void 0!==t&&(n=new h,void 0!==t.center&&n.fromArray(t.center),e.boundingSphere=new J(n,t.radius));return e}});Yi.prototype={constructor:Yi,crossOrigin:void 0,extractUrlBase:function(t){t=t.split("/");if(1===t.length)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:function(){var t={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},e,i,n;return function(r,a,o){function s(t,e,n,r,s){t=a+t;var c=Yi.Handlers.get(t);null!==c?t=c.load(t):(i.setCrossOrigin(o),t=i.load(t));void 0!==e&&(t.repeat.fromArray(e),1!==e[0]&&(t.wrapS=1e3),1!==e[1]&&(t.wrapT=1e3));void 0!==n&&t.offset.fromArray(n);void 0!==r&&("repeat"===r[0]&&(t.wrapS=1e3),"mirror"===r[0]&&(t.wrapS=1002),"repeat"===r[1]&&(t.wrapT=1e3),"mirror"===r[1]&&(t.wrapT=1002));void 0!==s&&(t.anisotropy=s);e=cr.generateUUID();h[e]=t;return e}void 0===e&&(e=new G);void 0===i&&(i=new _i);void 0===n&&(n=new qi);var h={},c={uuid:cr.generateUUID(),type:"MeshLambertMaterial"},l;for(l in r){var u=r[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=u;break;case"blending":c.blending=t[u];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(u).getHex();break;case"colorSpecular":c.specular=e.fromArray(u).getHex();break;case"colorEmissive":c.emissive=e.fromArray(u).getHex();break;case"specularCoef":c.shininess=u;break;case"shading":"basic"===u.toLowerCase()&&(c.type="MeshBasicMaterial");"phong"===u.toLowerCase()&&(c.type="MeshPhongMaterial");"standard"===u.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=s(u,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=s(u,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=s(u,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=s(u,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=s(u,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=u;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=s(u,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=[u,u];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=s(u,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=s(u,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=s(u,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=s(u,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=1;break;case"doubleSided":c.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");c.opacity=u;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[l]=u;break;case"vertexColors":!0===u&&(c.vertexColors=2);"face"===u&&(c.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,u)}}"MeshBasicMaterial"===c.type&&delete c.emissive;"MeshPhongMaterial"!==c.type&&delete c.specular;1>c.opacity&&(c.transparent=!0);n.setTextures(h);return n.parse(c)}}()};Yi.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i+1];if(e[i].test(t))return r}return null}};Object.assign(Zi.prototype,{load:function(t,e,i,n){var r=this,a=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Yi.prototype.extractUrlBase(t),o=new gi(this.manager);o.setWithCredentials(this.withCredentials);o.load(t,function(i){i=JSON.parse(i);var n=i.metadata;if(void 0!==n&&(n=n.type,void 0!==n)){if("object"===n.toLowerCase()){console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===n.toLowerCase()){console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.");return}}i=r.parse(i,a);e(i.geometry,i.materials)},i,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){var n=new _t,a=void 0!==t.scale?1/t.scale:1;(function(e){var r,a,o,s,c,l,u,p,d,f,m,v,g,y=t.faces;l=t.vertices;var x=t.normals,b=t.colors,M=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&M++;for(r=0;r<M;r++)n.faceVertexUvs[r]=[]}s=0;for(c=l.length;s<c;)r=new h,r.x=l[s++]*e,r.y=l[s++]*e,r.z=l[s++]*e,n.vertices.push(r);s=0;for(c=y.length;s<c;)if(e=y[s++],d=e&1,o=e&2,r=e&8,u=e&16,f=e&32,l=e&64,e&=128,d){d=new ht;d.a=y[s];d.b=y[s+1];d.c=y[s+3];m=new ht;m.a=y[s+1];m.b=y[s+2];m.c=y[s+3];s+=4;o&&(o=y[s++],d.materialIndex=o,m.materialIndex=o);o=n.faces.length;if(r)for(r=0;r<M;r++)for(v=t.uvs[r],n.faceVertexUvs[r][o]=[],n.faceVertexUvs[r][o+1]=[],a=0;4>a;a++)p=y[s++],g=v[2*p],p=v[2*p+1],g=new i(g,p),2!==a&&n.faceVertexUvs[r][o].push(g),0!==a&&n.faceVertexUvs[r][o+1].push(g);u&&(u=3*y[s++],d.normal.set(x[u++],x[u++],x[u]),m.normal.copy(d.normal));if(f)for(r=0;4>r;r++)u=3*y[s++],f=new h(x[u++],x[u++],x[u]),2!==r&&d.vertexNormals.push(f),0!==r&&m.vertexNormals.push(f);l&&(l=y[s++],l=b[l],d.color.setHex(l),m.color.setHex(l));if(e)for(r=0;4>r;r++)l=y[s++],l=b[l],2!==r&&d.vertexColors.push(new G(l)),0!==r&&m.vertexColors.push(new G(l));n.faces.push(d);n.faces.push(m)}else{d=new ht;d.a=y[s++];d.b=y[s++];d.c=y[s++];o&&(o=y[s++],d.materialIndex=o);o=n.faces.length;if(r)for(r=0;r<M;r++)for(v=t.uvs[r],n.faceVertexUvs[r][o]=[],a=0;3>a;a++)p=y[s++],g=v[2*p],p=v[2*p+1],g=new i(g,p),n.faceVertexUvs[r][o].push(g);u&&(u=3*y[s++],d.normal.set(x[u++],x[u++],x[u]));if(f)for(r=0;3>r;r++)u=3*y[s++],f=new h(x[u++],x[u++],x[u]),d.vertexNormals.push(f);l&&(l=y[s++],d.color.setHex(b[l]));if(e)for(r=0;3>r;r++)l=y[s++],d.vertexColors.push(new G(b[l]));n.faces.push(d)}})(a);(function(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,a=t.skinWeights.length;i<a;i+=e)n.skinWeights.push(new r(t.skinWeights[i],1<e?t.skinWeights[i+1]:0,2<e?t.skinWeights[i+2]:0,3<e?t.skinWeights[i+3]:0));if(t.skinIndices)for(i=0,a=t.skinIndices.length;i<a;i+=e)n.skinIndices.push(new r(t.skinIndices[i],1<e?t.skinIndices[i+1]:0,2<e?t.skinIndices[i+2]:0,3<e?t.skinIndices[i+3]:0));n.bones=t.bones;n.bones&&0<n.bones.length&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.")})();(function(e){if(void 0!==t.morphTargets)for(var i=0,r=t.morphTargets.length;i<r;i++){n.morphTargets[i]={};n.morphTargets[i].name=t.morphTargets[i].name;n.morphTargets[i].vertices=[];for(var a=n.morphTargets[i].vertices,o=t.morphTargets[i].vertices,s=0,c=o.length;s<c;s+=3){var l=new h;l.x=o[s]*e;l.y=o[s+1]*e;l.z=o[s+2]*e;a.push(l)}}if(void 0!==t.morphColors&&0<t.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),e=n.faces,a=t.morphColors[0].colors,i=0,r=e.length;i<r;i++)e[i].color.fromArray(a,3*i)})(a);(function(){var e=[],i=[];void 0!==t.animation&&i.push(t.animation);void 0!==t.animations&&(t.animations.length?i=i.concat(t.animations):i.push(t.animations));for(var r=0;r<i.length;r++){var a=Wi.parseAnimation(i[r],n.bones);a&&e.push(a)}n.morphTargets&&(i=Wi.CreateClipsFromMorphTargetSequences(n.morphTargets,10),e=e.concat(i));0<e.length&&(n.animations=e)})();n.computeFaceNormals();n.computeBoundingSphere();if(void 0===t.materials||0===t.materials.length)return{geometry:n};a=Yi.prototype.initMaterials(t.materials,e,this.crossOrigin);return{geometry:n,materials:a}}});Object.assign(Qi.prototype,{load:function(t,e,i,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var r=this;new gi(r.manager).load(t,function(i){var a=null;try{a=JSON.parse(i)}catch(e){void 0!==n&&n(e);console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message);return}i=a.metadata;void 0===i||void 0===i.type||"geometry"===i.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead."):r.parse(a,e)},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(r)}),n=this.parseTextures(t.textures,n),n=this.parseMaterials(t.materials,n),r=this.parseObject(t.object,i,n);t.animations&&(r.animations=this.parseAnimations(t.animations));void 0!==t.images&&0!==t.images.length||void 0===e||e(r);return r},parseGeometries:function(t){var e={};if(void 0!==t)for(var i=new Zi,n=new Xi,r=0,a=t.length;r<a;r++){var o,s=t[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Sr[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Sr[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Sr[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Sr[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Sr[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Sr[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":o=new Sr[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Sr[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Sr[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Sr[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Sr[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":o=n.parse(s);break;case"Geometry":o=i.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid;void 0!==s.name&&(o.name=s.name);e[s.uuid]=o}return e},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new qi;n.setTextures(e);for(var r=0,a=t.length;r<a;r++){var o=n.parse(t[r]);i[o.uuid]=o}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=Wi.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){function i(t){n.manager.itemStart(t);return o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t)})}var n=this,r={};if(void 0!==t&&0<t.length){var a=new vi(e),o=new bi(a);o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var h=t[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:n.texturePath+h.url;r[h.uuid]=i(c)}}return r},parseTextures:function(t,e){function i(t,e){if("number"===typeof t)return t;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t);return e[t]}var r={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},a={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},o={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008},s={};if(void 0!==t)for(var h=0,c=t.length;h<c;h++){var l=t[h];void 0===l.image&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid);void 0===e[l.image]&&console.warn("THREE.ObjectLoader: Undefined image",l.image);var u=new n(e[l.image]);u.needsUpdate=!0;u.uuid=l.uuid;void 0!==l.name&&(u.name=l.name);void 0!==l.mapping&&(u.mapping=i(l.mapping,r));void 0!==l.offset&&u.offset.fromArray(l.offset);void 0!==l.repeat&&u.repeat.fromArray(l.repeat);void 0!==l.wrap&&(u.wrapS=i(l.wrap[0],a),u.wrapT=i(l.wrap[1],a));void 0!==l.minFilter&&(u.minFilter=i(l.minFilter,o));void 0!==l.magFilter&&(u.magFilter=i(l.magFilter,o));void 0!==l.anisotropy&&(u.anisotropy=l.anisotropy);void 0!==l.flipY&&(u.flipY=l.flipY);s[l.uuid]=u}return s},parseObject:function(){var t=new c;return function(e,i,n){function r(t){void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t);return i[t]}function a(t){if(void 0!==t)return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}var o;switch(e.type){case"Scene":o=new oe;void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new G(e.background));void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new ae(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new re(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new Pt(e.fov,e.aspect,e.near,e.far);void 0!==e.focus&&(o.focus=e.focus);void 0!==e.zoom&&(o.zoom=e.zoom);void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge);void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset);void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Ct(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":o=new Ci(e.color,e.intensity);break;case"DirectionalLight":o=new Pi(e.color,e.intensity);break;case"PointLight":o=new Ai(e.color,e.intensity,e.distance,e.decay);break;case"SpotLight":o=new Ri(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Ei(e.color,e.groundColor,e.intensity);break;case"Mesh":o=r(e.geometry);var s=a(e.material);o=o.bones&&0<o.bones.length?new de(o,s):new Et(o,s);break;case"LOD":o=new le;break;case"Line":o=new me(r(e.geometry),a(e.material),e.mode);break;case"LineSegments":o=new ve(r(e.geometry),a(e.material));break;case"PointCloud":case"Points":o=new ye(r(e.geometry),a(e.material));break;case"Sprite":o=new ce(a(e.material));break;case"Group":o=new xe;break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:o=new at}o.uuid=e.uuid;void 0!==e.name&&(o.name=e.name);void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale));void 0!==e.castShadow&&(o.castShadow=e.castShadow);void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow);e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera)));void 0!==e.visible&&(o.visible=e.visible);void 0!==e.userData&&(o.userData=e.userData);if(void 0!==e.children)for(var h in e.children)o.add(this.parseObject(e.children[h],i,n));if("LOD"===e.type)for(e=e.levels,s=0;s<e.length;s++){var c=e[s];h=o.getObjectByProperty("uuid",c.object);void 0!==h&&o.addLevel(h,c.distance)}return o}}()});tn.prototype={constructor:tn,getPoint:function(t){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(t){t=this.getUtoTmapping(t);return this.getPoint(t)},getPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){isNaN(t)&&(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],i,n=this.getPoint(0),r,a=0;e.push(0);for(r=1;r<=t;r++)i=this.getPoint(r/t),a+=i.distanceTo(n),e.push(a),n=i;return this.cacheArcLengths=e},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(t,e){var i=this.getLengths(),n,r=i.length,a;a=e?e:t*i[r-1];for(var o=0,s=r-1,h;o<=s;)if(n=Math.floor(o+(s-o)/2),h=i[n]-a,0>h)o=n+1;else if(0<h)s=n-1;else{s=n;break}n=s;if(i[n]===a)return n/(r-1);o=i[n];return(n+(a-o)/(i[n+1]-o))/(r-1)},getTangent:function(t){var e=t-1e-4;t+=1e-4;0>e&&(e=0);1<t&&(t=1);e=this.getPoint(e);return this.getPoint(t).clone().sub(e).normalize()},getTangentAt:function(t){t=this.getUtoTmapping(t);return this.getTangent(t)},computeFrenetFrames:function(t,e){var i=new h,n=[],r=[],a=[],o=new h,s=new c,l,u;for(l=0;l<=t;l++)u=l/t,n[l]=this.getTangentAt(u),n[l].normalize();r[0]=new h;a[0]=new h;l=Number.MAX_VALUE;u=Math.abs(n[0].x);var p=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=l&&(l=u,i.set(1,0,0));p<=l&&(l=p,i.set(0,1,0));d<=l&&i.set(0,0,1);o.crossVectors(n[0],i).normalize();r[0].crossVectors(n[0],o);a[0].crossVectors(n[0],r[0]);for(l=1;l<=t;l++)r[l]=r[l-1].clone(),a[l]=a[l-1].clone(),o.crossVectors(n[l-1],n[l]),o.length()>Number.EPSILON&&(o.normalize(),i=Math.acos(cr.clamp(n[l-1].dot(n[l]),-1,1)),r[l].applyMatrix4(s.makeRotationAxis(o,i))),a[l].crossVectors(n[l],r[l]);if(!0===e)for(i=Math.acos(cr.clamp(r[0].dot(r[t]),-1,1)),i/=t,0<n[0].dot(o.crossVectors(r[0],r[t]))&&(i=-i),l=1;l<=t;l++)r[l].applyMatrix4(s.makeRotationAxis(n[l],i*l)),a[l].crossVectors(n[l],r[l]);return{tangents:n,normals:r,binormals:a}}};en.prototype=Object.create(tn.prototype);en.prototype.constructor=en;en.prototype.isLineCurve=!0;en.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);e.multiplyScalar(t).add(this.v1);return e};en.prototype.getPointAt=function(t){return this.getPoint(t)};en.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()};nn.prototype=Object.assign(Object.create(tn.prototype),{constructor:nn,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new en(e,t))},getPoint:function(t){var e=t*this.getLength(),i=this.getCurveLengths();for(t=0;t<i.length;){if(i[t]>=e)return e=i[t]-e,t=this.curves[t],i=t.getLength(),t.getPointAt(0===i?0:1-e/i);t++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){isNaN(t)&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));this.autoClose&&e.push(e[0]);return e},getPoints:function(t){t=t||12;for(var e=[],i,n=0,r=this.curves;n<r.length;n++)for(var a=r[n],a=a.getPoints(a&&a.isEllipseCurve?2*t:a&&a.isLineCurve?1:a&&a.isSplineCurve?t*a.points.length:t),o=0;o<a.length;o++){var s=a[o];i&&i.equals(s)||(e.push(s),i=s)}this.autoClose&&1<e.length&&!e[e.length-1].equals(e[0])&&e.push(e[0]);return e},createPointsGeometry:function(t){t=this.getPoints(t);return this.createGeometry(t)},createSpacedPointsGeometry:function(t){t=this.getSpacedPoints(t);return this.createGeometry(t)},createGeometry:function(t){for(var e=new _t,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new h(r.x,r.y,r.z||0))}return e}});rn.prototype=Object.create(tn.prototype);rn.prototype.constructor=rn;rn.prototype.isEllipseCurve=!0;rn.prototype.getPoint=function(t){for(var e=2*Math.PI,n=this.aEndAngle-this.aStartAngle,r=Math.abs(n)<Number.EPSILON;0>n;)n+=e;for(;n>e;)n-=e;n<Number.EPSILON&&(n=r?0:e);!0!==this.aClockwise||r||(n=n===e?-e:n-e);e=this.aStartAngle+t*n;t=this.aX+this.xRadius*Math.cos(e);var a=this.aY+this.yRadius*Math.sin(e);0!==this.aRotation&&(e=Math.cos(this.aRotation),n=Math.sin(this.aRotation),r=t-this.aX,a-=this.aY,t=r*e-a*n+this.aX,a=r*n+a*e+this.aY);return new i(t,a)};an.prototype=Object.create(tn.prototype);an.prototype.constructor=an;an.prototype.isSplineCurve=!0;an.prototype.getPoint=function(t){var e=this.points,n=(e.length-1)*t;t=Math.floor(n);var n=n-t,r=e[0===t?t:t-1],a=e[t],o=e[t>e.length-2?e.length-1:t+1],e=e[t>e.length-3?e.length-1:t+2];return new i(Ji(n,r.x,a.x,o.x,e.x),Ji(n,r.y,a.y,o.y,e.y))};on.prototype=Object.create(tn.prototype);on.prototype.constructor=on;on.prototype.getPoint=function(t){var e=this.v0,n=this.v1,r=this.v2,a=this.v3;return new i($i(t,e.x,n.x,r.x,a.x),$i(t,e.y,n.y,r.y,a.y))};sn.prototype=Object.create(tn.prototype);sn.prototype.constructor=sn;sn.prototype.getPoint=function(t){var e=this.v0,n=this.v1,r=this.v2;return new i(Ki(t,e.x,n.x,r.x),Ki(t,e.y,n.y,r.y))};var Ir=Object.assign(Object.create(nn.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var n=new en(this.currentPoint.clone(),new i(t,e));this.curves.push(n);this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,n,r){t=new sn(this.currentPoint.clone(),new i(t,e),new i(n,r));this.curves.push(t);this.currentPoint.set(n,r)},bezierCurveTo:function(t,e,n,r,a,o){t=new on(this.currentPoint.clone(),new i(t,e),new i(n,r),new i(a,o));this.curves.push(t);this.currentPoint.set(a,o)},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),e=new an(e);this.curves.push(e);this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,a){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,i,n,r,a)},absarc:function(t,e,i,n,r,a){this.absellipse(t,e,i,i,n,r,a)},ellipse:function(t,e,i,n,r,a,o,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,i,n,r,a,o,s)},absellipse:function(t,e,i,n,r,a,o,s){t=new rn(t,e,i,n,r,a,o,s);0<this.curves.length&&(e=t.getPoint(0),e.equals(this.currentPoint)||this.lineTo(e.x,e.y));this.curves.push(t);t=t.getPoint(1);this.currentPoint.copy(t)}});hn.prototype=Ir;Ir.constructor=hn;cn.prototype=Object.assign(Object.create(Ir),{constructor:cn,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}});ln.prototype={moveTo:function(t,e){this.currentPath=new hn;this.subPaths.push(this.currentPath);this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,a){this.currentPath.bezierCurveTo(t,e,i,n,r,a)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],a=new cn;a.curves=r.curves;e.push(a)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,a=0;a<i;r=a++){var o=e[r],s=e[a],h=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(o=e[a],h=-h,s=e[r],c=-c),!(t.y<o.y||t.y>s.y))if(t.y===o.y){if(t.x===o.x)return!0}else{r=c*(t.x-o.x)-h*(t.y-o.y);if(0===r)return!0;0>r||(n=!n)}}else if(t.y===o.y&&(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x))return!0}return n}var r=Tr.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return i(a);var o,s,h,c=[];if(1===a.length)return s=a[0],h=new cn,h.curves=s.curves,c.push(h),c;var l=!r(a[0].getPoints()),l=t?!l:l;h=[];var u=[],p=[],d=0,f;u[d]=void 0;p[d]=[];for(var m=0,v=a.length;m<v;m++)s=a[m],f=s.getPoints(),o=r(f),(o=t?!o:o)?(!l&&u[d]&&d++,u[d]={s:new cn,p:f},u[d].s.curves=s.curves,l&&d++,p[d]=[]):p[d].push({h:s,p:f[0]});if(!u[0])return i(a);if(1<u.length){m=!1;s=[];r=0;for(a=u.length;r<a;r++)h[r]=[];r=0;for(a=u.length;r<a;r++)for(o=p[r],l=0;l<o.length;l++){d=o[l];f=!0;for(v=0;v<u.length;v++)n(d.p,u[v].p)&&(r!==v&&s.push({froms:r,tos:v,hole:l}),f?(f=!1,h[v].push(d)):m=!0);f&&h[r].push(d)}0<s.length&&(m||(p=h))}m=0;for(r=u.length;m<r;m++)for(h=u[m].s,c.push(h),s=p[m],a=0,o=s.length;a<o;a++)h.holes.push(s[a].h);return c}};Object.assign(un.prototype,{isFont:!0,generateShapes:function(t,e,i){void 0===e&&(e=100);void 0===i&&(i=4);var n=this.data;t=String(t).split("");var r=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=0,s=0;e=[];for(var h=0;h<t.length;h++){var c=t[h];if("\n"===c)o=0,s-=a;else{var l;l=r;var u=o,p=s;if(c=n.glyphs[c]||n.glyphs["?"]){var d=new ln,f=[],m,v,g,y,x,b,M,_;if(c.o)for(var w=c._cachedOutline||(c._cachedOutline=c.o.split(" ")),E=0,T=w.length;E<T;)switch(w[E++]){case"m":m=w[E++]*l+u;v=w[E++]*l+p;d.moveTo(m,v);break;case"l":m=w[E++]*l+u;v=w[E++]*l+p;d.lineTo(m,v);break;case"q":m=w[E++]*l+u;v=w[E++]*l+p;x=w[E++]*l+u;b=w[E++]*l+p;d.quadraticCurveTo(x,b,m,v);if(y=f[f.length-1]){g=y.x;y=y.y;for(var S=1;S<=i;S++){var R=S/i;Ki(R,g,x,m);Ki(R,y,b,v)}}break;case"b":if(m=w[E++]*l+u,v=w[E++]*l+p,x=w[E++]*l+u,b=w[E++]*l+p,M=w[E++]*l+u,_=w[E++]*l+p,d.bezierCurveTo(x,b,M,_,m,v),y=f[f.length-1])for(g=y.x,y=y.y,S=1;S<=i;S++)R=S/i,$i(R,g,x,M,m),$i(R,y,b,_,v)}l={offsetX:c.ha*l,path:d}}else l=void 0;o+=l.offsetX;e.push(l.path)}}i=[];n=0;for(t=e.length;n<t;n++)Array.prototype.push.apply(i,e[n].toShapes());return i}});Object.assign(pn.prototype,{load:function(t,e,i,n){var r=this;new gi(this.manager).load(t,function(t){var i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}t=r.parse(i);e&&e(t)},i,n)},parse:function(t){return new un(t)}});var Nr,zr={getContext:function(){void 0===Nr&&(Nr=new(window.AudioContext||window.webkitAudioContext));return Nr},setContext:function(t){Nr=t}};Object.assign(dn.prototype,{load:function(t,e,i,n){var r=new gi(this.manager);r.setResponseType("arraybuffer");r.load(t,function(t){zr.getContext().decodeAudioData(t,function(t){e(t)})},i,n)}});fn.prototype=Object.assign(Object.create(wi.prototype),{constructor:fn,isRectAreaLight:!0,copy:function(t){wi.prototype.copy.call(this,t);this.width=t.width;this.height=t.height;return this}});Object.assign(mn.prototype,{update:function(){var t,e,i,n,r,a,o,s=new c,h=new c;return function(c){if(t!==this||e!==c.focus||i!==c.fov||n!==c.aspect*this.aspect||r!==c.near||a!==c.far||o!==c.zoom){t=this;e=c.focus;i=c.fov;n=c.aspect*this.aspect;r=c.near;a=c.far;o=c.zoom;var l=c.projectionMatrix.clone(),u=this.eyeSep/2,p=u*r/e,d=r*Math.tan(cr.DEG2RAD*i*.5)/o,f;h.elements[12]=-u;s.elements[12]=u;u=-d*n+p;f=d*n+p;l.elements[0]=2*r/(f-u);l.elements[8]=(f+u)/(f-u);this.cameraL.projectionMatrix.copy(l);u=-d*n-p;f=d*n-p;l.elements[0]=2*r/(f-u);l.elements[8]=(f+u)/(f-u);this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(h);this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(s)}}()});vn.prototype=Object.create(at.prototype);vn.prototype.constructor=vn;gn.prototype=Object.assign(Object.create(at.prototype),{constructor:gn,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=t;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new h,e=new s,i=new h,n=new h;return function(r){at.prototype.updateMatrixWorld.call(this,r);r=this.context.listener;var a=this.up;this.matrixWorld.decompose(t,e,i);n.set(0,0,-1).applyQuaternion(e);r.positionX?(r.positionX.setValueAtTime(t.x,this.context.currentTime),r.positionY.setValueAtTime(t.y,this.context.currentTime),r.positionZ.setValueAtTime(t.z,this.context.currentTime),r.forwardX.setValueAtTime(n.x,this.context.currentTime),r.forwardY.setValueAtTime(n.y,this.context.currentTime),r.forwardZ.setValueAtTime(n.z,this.context.currentTime),r.upX.setValueAtTime(a.x,this.context.currentTime),r.upY.setValueAtTime(a.y,this.context.currentTime),r.upZ.setValueAtTime(a.z,this.context.currentTime)):(r.setPosition(t.x,t.y,t.z),r.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()});yn.prototype=Object.assign(Object.create(at.prototype),{constructor:yn,getOutput:function(){return this.gain},setNodeSource:function(t){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=t;this.connect();return this},setBuffer:function(t){this.buffer=t;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var t=this.context.createBufferSource();t.buffer=this.buffer;t.loop=this.loop;t.onended=this.onEnded.bind(this);t.playbackRate.setValueAtTime(this.playbackRate,this.startTime);t.start(0,this.startTime);this.isPlaying=!0;this.source=t;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){t||(t=[]);!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){this.gain.gain.value=t;return this}});xn.prototype=Object.assign(Object.create(yn.prototype),{constructor:xn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new h;return function(e){at.prototype.updateMatrixWorld.call(this,e);t.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(t.x,t.y,t.z)}}()});Object.assign(bn.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}});Mn.prototype={constructor:Mn,accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,a=this.cumulativeWeight;if(0===a){for(a=0;a!==n;++a)i[r+a]=i[a];a=e}else a+=e,this._mixBufferRegion(i,r,0,e/a,n);this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,i=this.buffer;t=t*e+e;var n=this.cumulativeWeight,r=this.binding;this.cumulativeWeight=0;1>n&&this._mixBufferRegion(i,t,3*e,1-n,e);for(var n=e,a=e+e;n!==a;++n)if(i[n]!==i[n+e]){r.setValue(i,t);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,i=3*e;this.binding.getValue(t,i);for(var n=e;n!==i;++n)t[n]=t[i+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,i,n,r){if(.5<=n)for(n=0;n!==r;++n)t[e+n]=t[i+n]},_slerp:function(t,e,i,n,r){s.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var a=1-n,o=0;o!==r;++o){var s=e+o;t[s]=t[s]*a+t[i+o]*n}}};_n.prototype={constructor:_n,getValue:function(t,e){this.bind();this.getValue(t,e)},setValue:function(t,e){this.bind();this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;t||(this.node=t=_n.findNode(this.rootNode,e.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(t){if(i){var a=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("  can not bind to material as node does not have a material",this);return}if(!t.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}t=t.skeleton.bones;for(i=0;i<t.length;i++)if(t[i].name===a){a=i;break}break;default:if(void 0===t[i]){console.error("  can not bind to objectName of node, undefined",this);return}t=t[i]}if(void 0!==a){if(void 0===t[a]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,t);return}t=t[a]}}a=t[n];if(void 0===a)console.error("  trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t);else{e=this.Versioning.None;void 0!==t.needsUpdate?(e=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);i=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!t.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(i=0;i<this.node.geometry.morphTargets.length;i++)if(t.geometry.morphTargets[i].name===r){r=i;break}}i=this.BindingType.ArrayElement;this.resolvedProperty=a;this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=a):void 0!==a.length?(i=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[i];this.setValue=this.SetterByBindingTypeAndVersioning[i][e]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(_n.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:_n.prototype.getValue,_setValue_unbound:_n.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.node[this.propertyName]=t[e]},function(t,e){this.node[this.propertyName]=t[e];this.targetObject.needsUpdate=!0},function(t,e){this.node[this.propertyName]=t[e];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e];this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e);this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e);this.targetObject.matrixWorldNeedsUpdate=!0}]]});_n.Composite=function(t,e,i){i=i||_n.parseTrackName(e);this._targetGroup=t;this._bindings=t.subscribe_(e,i)};_n.Composite.prototype={constructor:_n.Composite,getValue:function(t,e){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}};_n.create=function(t,e,i){return t&&t.isAnimationObjectGroup?new _n.Composite(t,e,i):new _n(t,e,i)};_n.parseTrackName=function(t){var e=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(t);if(!e)throw Error("cannot parse trackName at all: "+t);e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};if(null===e.propertyName||0===e.propertyName.length)throw Error("can not parse propertyName from trackName: "+t);return e};_n.findNode=function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=function(t){for(var i=0;i<t.bones.length;i++){var n=t.bones[i];if(n.name===e)return n}return null}(t.skeleton);if(i)return i}if(t.children){var n=function(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.name===e||r.uuid===e||(r=n(r.children)))return r}return null};if(i=n(t.children))return i}return null};wn.prototype={constructor:wn,isAnimationObjectGroup:!0,add:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,h=s.length,c=0,l=arguments.length;c!==l;++c){var u=arguments[c],p=u.uuid,d=r[p];if(void 0===d){d=i++;r[p]=d;e.push(u);for(var p=0,f=h;p!==f;++p)s[p].push(new _n(u,a[p],o[p]))}else if(d<n){var m=--n,f=e[m];r[f.uuid]=d;e[d]=f;r[p]=m;e[m]=u;p=0;for(f=h;p!==f;++p){var v=s[p],g=v[d];v[d]=v[m];void 0===g&&(g=new _n(u,a[p],o[p]));v[m]=g}}else void 0!==e[d]&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=n},remove:function(t){for(var e=this._objects,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,a=r.length,o=0,s=arguments.length;o!==s;++o){var h=arguments[o],c=h.uuid,l=n[c];if(void 0!==l&&l>=i){var u=i++,p=e[u];n[p.uuid]=l;e[l]=p;n[c]=u;e[u]=h;h=0;for(c=a;h!==c;++h){var p=r[h],d=p[l];p[l]=p[u];p[u]=d}}}this.nCachedObjects_=i},uncache:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,a=this._bindings,o=a.length,s=0,h=arguments.length;s!==h;++s){var c=arguments[s].uuid,l=r[c];if(void 0!==l)if(delete r[c],l<n){var c=--n,u=e[c],p=--i,d=e[p];r[u.uuid]=l;e[l]=u;r[d.uuid]=c;e[c]=d;e.pop();u=0;for(d=o;u!==d;++u){var f=a[u],m=f[p];f[l]=f[c];f[c]=m;f.pop()}}else for(p=--i,d=e[p],r[d.uuid]=l,e[l]=d,e.pop(),u=0,d=o;u!==d;++u)f=a[u],f[l]=f[p],f.pop()}this.nCachedObjects_=n},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var a=this._paths,o=this._parsedPaths,s=this._objects,h=this.nCachedObjects_,c=Array(s.length),n=r.length;i[t]=n;a.push(t);o.push(e);r.push(c);i=h;for(n=s.length;i!==n;++i)c[i]=new _n(s[i],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=i;a[i]=s;a.pop();r[i]=r[o];r.pop();n[i]=n[o];n.pop()}}};En.prototype={constructor:En,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){this._startTime=t;return this},setLoop:function(t,e){this.loop=t;this.repetitions=e;return this},setEffectiveWeight:function(t){this.weight=t;this._effectiveWeight=this.enabled?t:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){t.fadeOut(e);this.fadeIn(e);if(i){i=this._clip.duration;var n=t._clip.duration,r=i/n;t.warp(1,n/i,e);this.warp(r,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t));return this},setEffectiveTimeScale:function(t){this.timeScale=t;this._effectiveTimeScale=this.paused?0:t;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){this.timeScale=this._clip.duration/t;return this.stopWarping()},syncWith:function(t){this.time=t.time;this.timeScale=t.timeScale;return this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(this._timeScaleInterpolant=a=n._lendControlInterpolant());n=a.parameterPositions;a=a.sampleValues;n[0]=r;n[1]=r+i;a[0]=t/o;a[1]=e/o;return this},stopWarping:function(){var t=this._timeScaleInterpolant;null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){var r=this._startTime;if(null!==r){e=(t-r)*i;if(0>e||0===i)return;this._startTime=null;e*=i}e*=this._updateTimeScale(t);i=this._updateTime(e);t=this._updateWeight(t);if(0<t){e=this._interpolants;for(var r=this._propertyBindings,a=0,o=e.length;a!==o;++a)e[a].evaluate(i),r[a].accumulate(n,t)}},_updateWeight:function(t){var e=0;if(this.enabled){var e=this.weight,i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0],e=e*n;t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){var e=this.timeScale,i=this._timeScaleInterpolant;if(null!==i){var n=i.evaluate(t)[0],e=e*n;t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(2200===n)t:{if(-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1)),e>=i)e=i;else if(0>e)e=0;else break t;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{n=2202===n;-1===r&&(0<=t?(r=0,this._setEndings(!0,0===this.repetitions,n)):this._setEndings(0===this.repetitions,!0,n));if(e>=i||0>e){var a=Math.floor(e/i),e=e-i*a,r=r+Math.abs(a),o=this.repetitions-r;0>o?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=0<t?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(0===o?(t=0>t,this._setEndings(t,!t,n)):this._setEndings(!1,!1,n),this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a}))}if(n&&1===(r&1))return this.time=e,i-e}return this.time=e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,a=this._weightInterpolant;null===a&&(this._weightInterpolant=a=n._lendControlInterpolant());n=a.parameterPositions;a=a.sampleValues;n[0]=r;a[0]=e;n[1]=r+t;a[1]=i;return this}};Tn.prototype={constructor:Tn,clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"===typeof t?Wi.findByName(i,t):t,i=null!==r?r.uuid:t,a=this._actionsByClip[i],o=null;if(void 0!==a){o=a.actionByRoot[n];if(void 0!==o)return o;o=a.knownActions[0];null===r&&(r=o._clip)}if(null===r)return null;r=new En(this,r,e);this._bindAction(r,o);this._addInactiveAction(r,i,n);return r},existingAction:function(t,e){var i=e||this._root,n=i.uuid,i="string"===typeof t?Wi.findByName(i,t):t,i=this._actionsByClip[i?i.uuid:t];return void 0!==i?i.actionByRoot[n]||null:null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings,r=this._nActiveBindings=this._nActiveActions=0;r!==e;++r)t[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1,o=0;o!==i;++o){var s=e[o];s.enabled&&s._update(n,t,r,a)}t=this._bindings;e=this._nActiveBindings;for(o=0;o!==e;++o)t[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions;t=t.uuid;var i=this._actionsByClip,n=i[t];if(void 0!==n){for(var n=n.knownActions,r=0,a=n.length;r!==a;++r){var o=n[r];this._deactivateAction(o);var s=o._cacheIndex,h=e[e.length-1];o._cacheIndex=null;o._byClipCacheIndex=null;h._cacheIndex=s;e[s]=h;e.pop();this._removeInactiveBindingsForAction(o)}delete i[t]}},uncacheRoot:function(t){t=t.uuid;var e=this._actionsByClip,i;for(i in e){var n=e[i].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}i=this._bindingsByRootAndName[t];if(void 0!==i)for(var r in i)t=i[r],t.restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}};Object.assign(Tn.prototype,{_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,a=t._propertyBindings,o=t._interpolants,s=i.uuid,h=this._bindingsByRootAndName,c=h[s];void 0===c&&(c={},h[s]=c);for(h=0;h!==r;++h){var l=n[h],u=l.name,p=c[u];if(void 0===p){p=a[h];if(void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,u));continue}p=new Mn(_n.create(i,u,e&&e._propertyBindings[h].binding.parsedPath),l.ValueTypeName,l.getValueSize());++p.referenceCount;this._addInactiveBinding(p,s,u)}a[h]=p;o[h].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]);this._addInactiveAction(t,i,e)}e=t._propertyBindings;i=0;for(n=e.length;i!==n;++i){var r=e[i];0===r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){t=t._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,a=r[e];void 0===a?(a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a):(e=a.knownActions,t._byClipCacheIndex=e.length,e.push(t));t._cacheIndex=n.length;n.push(t);a.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n;e[n]=i;e.pop();t._cacheIndex=null;var i=t._clip.uuid,n=this._actionsByClip,r=n[i],a=r.knownActions,o=a[a.length-1],s=t._byClipCacheIndex;o._byClipCacheIndex=s;a[s]=o;a.pop();t._byClipCacheIndex=null;delete r.actionByRoot[(e._localRoot||this._root).uuid];0===a.length&&delete n[i];this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){t=t._propertyBindings;for(var e=0,i=t.length;e!==i;++e){var n=t[e];0===--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n;e[n]=t;r._cacheIndex=i;e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n;e[n]=t;r._cacheIndex=i;e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],a=this._bindings;void 0===r&&(r={},n[e]=r);r[i]=t;t._cacheIndex=a.length;a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,i=i.path,r=this._bindingsByRootAndName,a=r[n],o=e[e.length-1];t=t._cacheIndex;o._cacheIndex=t;e[t]=o;e.pop();delete a[i];t:{for(var s in a)break t;delete r[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n;e[n]=t;r._cacheIndex=i;e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n;e[n]=t;r._cacheIndex=i;e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];void 0===i&&(i=new zi(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i);return i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n;e[n]=t;r.__cacheIndex=i;e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1)});Object.assign(Tn.prototype,e.prototype);Sn.prototype.clone=function(){return new Sn(void 0===this.value.clone?this.value:this.value.clone())};Rn.prototype=Object.create(wt.prototype);Rn.prototype.constructor=Rn;Rn.prototype.isInstancedBufferGeometry=!0;Rn.prototype.addGroup=function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i})};Rn.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var e=t.attributes,i;for(i in e)this.addAttribute(i,e[i].clone());t=t.groups;i=0;for(e=t.length;i<e;i++){var n=t[i];this.addGroup(n.start,n.count,n.materialIndex)}return this};An.prototype={constructor:An,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(t,e){this.data.array[t*this.data.stride+this.offset]=e;return this},setY:function(t,e){this.data.array[t*this.data.stride+this.offset+1]=e;return this},setZ:function(t,e){this.data.array[t*this.data.stride+this.offset+2]=e;return this},setW:function(t,e){this.data.array[t*this.data.stride+this.offset+3]=e;return this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){t=t*this.data.stride+this.offset;this.data.array[t+0]=e;this.data.array[t+1]=i;return this},setXYZ:function(t,e,i,n){t=t*this.data.stride+this.offset;this.data.array[t+0]=e;this.data.array[t+1]=i;this.data.array[t+2]=n;return this},setXYZW:function(t,e,i,n,r){t=t*this.data.stride+this.offset;this.data.array[t+0]=e;this.data.array[t+1]=i;this.data.array[t+2]=n;this.data.array[t+3]=r;return this}};Ln.prototype={constructor:Ln,isInterleavedBuffer:!0,set needsUpdate(t){!0===t&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0;this.array=t},setDynamic:function(t){this.dynamic=t;return this},copy:function(t){this.array=new t.array.constructor(t.array);this.count=t.count;this.stride=t.stride;this.dynamic=t.dynamic;return this},copyAt:function(t,e,i){t*=this.stride;i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){void 0===e&&(e=0);this.array.set(t,e);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){this.onUploadCallback=t;return this}};Pn.prototype=Object.create(Ln.prototype);Pn.prototype.constructor=Pn;Pn.prototype.isInstancedInterleavedBuffer=!0;Pn.prototype.copy=function(t){Ln.prototype.copy.call(this,t);this.meshPerAttribute=t.meshPerAttribute;return this};Cn.prototype=Object.create(lt.prototype);Cn.prototype.constructor=Cn;Cn.prototype.isInstancedBufferAttribute=!0;Cn.prototype.copy=function(t){lt.prototype.copy.call(this,t);this.meshPerAttribute=t.meshPerAttribute;return this};In.prototype={constructor:In,linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var i=[];zn(t,this,i,e);i.sort(Nn);return i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)zn(t[n],this,i,e);i.sort(Nn);return i}};Un.prototype={constructor:Un,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var t=0;this.autoStart&&!this.running&&this.start();if(this.running){var e=(performance||Date).now(),t=(e-this.oldTime)/1e3;this.oldTime=e;this.elapsedTime+=t}return t}};Dn.prototype={constructor:Dn,set:function(t,e,i){this.radius=t;this.phi=e;this.theta=i;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.radius=t.radius;this.phi=t.phi;this.theta=t.theta;return this},makeSafe:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi));return this},setFromVector3:function(t){this.radius=t.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(cr.clamp(t.y/this.radius,-1,1)));return this}};On.prototype={constructor:On,set:function(t,e,i){this.radius=t;this.theta=e;this.y=i;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.radius=t.radius;this.theta=t.theta;this.y=t.y;return this},setFromVector3:function(t){this.radius=Math.sqrt(t.x*t.x+t.z*t.z);this.theta=Math.atan2(t.x,t.z);this.y=t.y;return this}};Hn.prototype=Object.create(Et.prototype);Hn.prototype.constructor=Hn;Hn.prototype.createAnimation=function(t,e,i,n){e={start:e,end:i,length:i-e+1,fps:n,duration:(i-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=e;this.animationsList.push(e)};Hn.prototype.autoCreateAnimations=function(t){for(var e=/([a-z]+)_?(\d+)/i,i,n={},r=this.geometry,a=0,o=r.morphTargets.length;a<o;a++){var s=r.morphTargets[a].name.match(e);if(s&&1<s.length){var h=s[1];n[h]||(n[h]={start:Infinity,end:-Infinity});s=n[h];a<s.start&&(s.start=a);a>s.end&&(s.end=a);i||(i=h)}}for(h in n)s=n[h],this.createAnimation(h,s.start,s.end,t);this.firstAnimation=i};Hn.prototype.setAnimationDirectionForward=function(t){if(t=this.animationsMap[t])t.direction=1,t.directionBackwards=!1};Hn.prototype.setAnimationDirectionBackward=function(t){if(t=this.animationsMap[t])t.direction=-1,t.directionBackwards=!0};Hn.prototype.setAnimationFPS=function(t,e){var i=this.animationsMap[t];i&&(i.fps=e,i.duration=(i.end-i.start)/i.fps)};Hn.prototype.setAnimationDuration=function(t,e){var i=this.animationsMap[t];i&&(i.duration=e,i.fps=(i.end-i.start)/i.duration)};Hn.prototype.setAnimationWeight=function(t,e){var i=this.animationsMap[t];i&&(i.weight=e)};Hn.prototype.setAnimationTime=function(t,e){var i=this.animationsMap[t];i&&(i.time=e)};Hn.prototype.getAnimationTime=function(t){var e=0;if(t=this.animationsMap[t])e=t.time;return e};Hn.prototype.getAnimationDuration=function(t){var e=-1;if(t=this.animationsMap[t])e=t.duration;return e};Hn.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("THREE.MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")};Hn.prototype.stopAnimation=function(t){if(t=this.animationsMap[t])t.active=!1};Hn.prototype.update=function(t){for(var e=0,i=this.animationsList.length;e<i;e++){var n=this.animationsList[e];if(n.active){var r=n.duration/n.length;n.time+=n.direction*t;if(n.mirroredLoop){if(n.time>n.duration||0>n.time)n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),0>n.time&&(n.time=0,n.directionBackwards=!1)}else n.time%=n.duration,0>n.time&&(n.time+=n.duration);var a=n.start+cr.clamp(Math.floor(n.time/r),0,n.length-1),o=n.weight;a!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*o,this.morphTargetInfluences[a]=0,n.lastFrame=n.currentFrame,n.currentFrame=a);r=n.time%r/r;n.directionBackwards&&(r=1-r);n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=r*o,this.morphTargetInfluences[n.lastFrame]=(1-r)*o):this.morphTargetInfluences[n.currentFrame]=o}}};Fn.prototype=Object.create(at.prototype);Fn.prototype.constructor=Fn;Fn.prototype.isImmediateRenderObject=!0;Bn.prototype=Object.create(ve.prototype);Bn.prototype.constructor=Bn;Bn.prototype.update=function(){var t=new h,e=new h,i=new K;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0);i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,h=o.faces,c=o=0,l=h.length;c<l;c++)for(var u=h[c],p=0,d=u.vertexNormals.length;p<d;p++){var f=u.vertexNormals[p];t.copy(s[u[n[p]]]).applyMatrix4(r);e.copy(f).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t);a.setXYZ(o,t.x,t.y,t.z);o+=1;a.setXYZ(o,e.x,e.y,e.z);o+=1}else if(o&&o.isBufferGeometry)for(n=o.attributes.position,s=o.attributes.normal,p=o=0,d=n.count;p<d;p++)t.set(n.getX(p),n.getY(p),n.getZ(p)).applyMatrix4(r),e.set(s.getX(p),s.getY(p),s.getZ(p)),e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),a.setXYZ(o,t.x,t.y,t.z),o+=1,a.setXYZ(o,e.x,e.y,e.z),o+=1;a.needsUpdate=!0;return this}}();kn.prototype=Object.create(at.prototype);kn.prototype.constructor=kn;kn.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};kn.prototype.update=function(){var t=new h,e=new h;return function(){var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i);t.setFromMatrixPosition(this.light.matrixWorld);e.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(e.sub(t));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();Gn.prototype=Object.create(ve.prototype);Gn.prototype.constructor=Gn;Gn.prototype.getBoneList=function(t){var e=[];t&&t.isBone&&e.push(t);for(var i=0;i<t.children.length;i++)e.push.apply(e,this.getBoneList(t.children[i]));return e};Gn.prototype.update=function(){var t=new h,e=new c,i=new c;return function(){var n=this.geometry,r=n.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var a=0,o=0;a<this.bones.length;a++){var s=this.bones[a];s.parent&&s.parent.isBone&&(e.multiplyMatrices(i,s.matrixWorld),t.setFromMatrixPosition(e),r.setXYZ(o,t.x,t.y,t.z),e.multiplyMatrices(i,s.parent.matrixWorld),t.setFromMatrixPosition(e),r.setXYZ(o+1,t.x,t.y,t.z),o+=2)}n.getAttribute("position").needsUpdate=!0}}();Vn.prototype=Object.create(Et.prototype);Vn.prototype.constructor=Vn;Vn.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};Vn.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};jn.prototype=Object.create(at.prototype);jn.prototype.constructor=jn;jn.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();this.children[1].geometry.dispose();this.children[1].material.dispose()};jn.prototype.update=function(){var t=new h,e=new h;return function(){var i=this.children[0],n=this.children[1];if(this.light.target){t.setFromMatrixPosition(this.light.matrixWorld);e.setFromMatrixPosition(this.light.target.matrixWorld);var r=e.clone().sub(t);i.lookAt(r);n.lookAt(r)}i.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);n.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var n=.5*this.light.width,r=.5*this.light.height,i=i.geometry.getAttribute("position"),a=i.array;a[0]=n;a[1]=-r;a[2]=0;a[3]=n;a[4]=r;a[5]=0;a[6]=-n;a[7]=r;a[8]=0;a[9]=-n;a[10]=r;a[11]=0;a[12]=-n;a[13]=-r;a[14]=0;a[15]=n;a[16]=-r;a[17]=0;i.needsUpdate=!0}}();Wn.prototype=Object.create(at.prototype);Wn.prototype.constructor=Wn;Wn.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};Wn.prototype.update=function(){var t=new h,e=new G,i=new G;return function(){var n=this.children[0],r=n.geometry.getAttribute("color");e.copy(this.light.color).multiplyScalar(this.light.intensity);i.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var a=0,o=r.count;a<o;a++){var s=a<o/2?e:i;r.setXYZ(a,s.r,s.g,s.b)}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate());r.needsUpdate=!0}}();qn.prototype=Object.create(ve.prototype);qn.prototype.constructor=qn;Xn.prototype=Object.create(ve.prototype);Xn.prototype.constructor=Xn;Yn.prototype=Object.create(ve.prototype);Yn.prototype.constructor=Yn;Yn.prototype.update=function(){var t=new h,e=new h,i=new K;return function(){this.object.updateMatrixWorld(!0);i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,a=a.faces,s=0,h=0,c=a.length;h<c;h++){var l=a[h],u=l.normal;t.copy(o[l.a]).add(o[l.b]).add(o[l.c]).divideScalar(3).applyMatrix4(n);e.copy(u).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t);r.setXYZ(s,t.x,t.y,t.z);s+=1;r.setXYZ(s,e.x,e.y,e.z);s+=1}r.needsUpdate=!0;return this}}();Zn.prototype=Object.create(at.prototype);Zn.prototype.constructor=Zn;Zn.prototype.dispose=function(){var t=this.children[0],e=this.children[1];t.geometry.dispose();t.material.dispose();e.geometry.dispose();e.material.dispose()};Zn.prototype.update=function(){var t=new h,e=new h,i=new h;return function(){t.setFromMatrixPosition(this.light.matrixWorld);e.setFromMatrixPosition(this.light.target.matrixWorld);i.subVectors(e,t);var n=this.children[0],r=this.children[1];n.lookAt(i);n.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);r.lookAt(i);r.scale.z=i.length()}}();Qn.prototype=Object.create(ve.prototype);Qn.prototype.constructor=Qn;Qn.prototype.update=function(){function t(t,a,o,s){n.set(a,o,s).unproject(r);t=i[t];if(void 0!==t)for(a=e.getAttribute("position"),o=0,s=t.length;o<s;o++)a.setXYZ(t[o],n.x,n.y,n.z)}var e,i,n=new h,r=new Lt;return function(){e=this.geometry;i=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix);t("c",0,0,-1);t("t",0,0,1);t("n1",-1,-1,-1);t("n2",1,-1,-1);t("n3",-1,1,-1);t("n4",1,1,-1);t("f1",-1,-1,1);t("f2",1,-1,1);t("f3",-1,1,1);t("f4",1,1,1);t("u1",.7,1.1,-1);t("u2",-.7,1.1,-1);t("u3",0,2,-1);t("cf1",-1,0,1);t("cf2",1,0,1);t("cf3",0,-1,1);t("cf4",0,1,1);t("cn1",-1,0,-1);t("cn2",1,0,-1);t("cn3",0,-1,-1);t("cn4",0,1,-1);e.getAttribute("position").needsUpdate=!0}}();Jn.prototype=Object.create(ve.prototype);Jn.prototype.constructor=Jn;Jn.prototype.update=function(){var t=new Q;return function(e){e&&e.isBox3?t.copy(e):t.setFromObject(e);if(!t.isEmpty()){e=t.min;var i=t.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x;r[1]=i.y;r[2]=i.z;r[3]=e.x;r[4]=i.y;r[5]=i.z;r[6]=e.x;r[7]=e.y;r[8]=i.z;r[9]=i.x;r[10]=e.y;r[11]=i.z;r[12]=i.x;r[13]=i.y;r[14]=e.z;r[15]=e.x;r[16]=i.y;r[17]=e.z;r[18]=e.x;r[19]=e.y;r[20]=e.z;r[21]=i.x;r[22]=e.y;r[23]=e.z;n.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var Ur,Dr;Kn.prototype=Object.create(at.prototype);Kn.prototype.constructor=Kn;Kn.prototype.setDirection=function(){var t=new h,e;return function(i){.99999<i.y?this.quaternion.set(0,0,0,1):-.99999>i.y?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}();Kn.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t);void 0===i&&(i=.2*e);this.line.scale.set(1,Math.max(0,t-e),1);this.line.updateMatrix();this.cone.scale.set(i,e,i);this.cone.position.y=t;this.cone.updateMatrix()};Kn.prototype.setColor=function(t){this.line.material.color.copy(t);this.cone.material.color.copy(t)};$n.prototype=Object.create(ve.prototype);$n.prototype.constructor=$n;var Or=new h,Hr=new tr,Fr=new tr,Br=new tr;er.prototype=Object.create(tn.prototype);er.prototype.constructor=er;er.prototype.getPoint=function(t){var e=this.points,i=e.length;2>i&&console.log("duh, you need at least 2 points");t*=i-(this.closed?0:1);var n=Math.floor(t);t-=n;this.closed?n+=0<n?0:(Math.floor(Math.abs(n)/e.length)+1)*e.length:0===t&&n===i-1&&(n=i-2,t=1);var r,a,o;this.closed||0<n?r=e[(n-1)%i]:(Or.subVectors(e[0],e[1]).add(e[0]),r=Or);a=e[n%i];o=e[(n+1)%i];this.closed||n+2<i?e=e[(n+2)%i]:(Or.subVectors(e[i-1],e[i-2]).add(e[i-1]),e=Or);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var s="chordal"===this.type?.5:.25,i=Math.pow(r.distanceToSquared(a),s),n=Math.pow(a.distanceToSquared(o),s),s=Math.pow(o.distanceToSquared(e),s);1e-4>n&&(n=1);1e-4>i&&(i=n);1e-4>s&&(s=n);Hr.initNonuniformCatmullRom(r.x,a.x,o.x,e.x,i,n,s);Fr.initNonuniformCatmullRom(r.y,a.y,o.y,e.y,i,n,s);Br.initNonuniformCatmullRom(r.z,a.z,o.z,e.z,i,n,s)}else"catmullrom"===this.type&&(i=void 0!==this.tension?this.tension:.5,Hr.initCatmullRom(r.x,a.x,o.x,e.x,i),Fr.initCatmullRom(r.y,a.y,o.y,e.y,i),Br.initCatmullRom(r.z,a.z,o.z,e.z,i));return new h(Hr.calc(t),Fr.calc(t),Br.calc(t))};ir.prototype=Object.create(tn.prototype);ir.prototype.constructor=ir;ir.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new h($i(t,e.x,i.x,n.x,r.x),$i(t,e.y,i.y,n.y,r.y),$i(t,e.z,i.z,n.z,r.z))};nr.prototype=Object.create(tn.prototype);nr.prototype.constructor=nr;nr.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new h(Ki(t,e.x,i.x,n.x),Ki(t,e.y,i.y,n.y),Ki(t,e.z,i.z,n.z))};rr.prototype=Object.create(tn.prototype);rr.prototype.constructor=rr;rr.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new h;e.subVectors(this.v2,this.v1);e.multiplyScalar(t);e.add(this.v1);return e};ar.prototype=Object.create(rn.prototype);ar.prototype.constructor=ar;tn.create=function(t,e){console.log("THREE.Curve.create() has been deprecated");t.prototype=Object.create(tn.prototype);t.prototype.constructor=t;t.prototype.getPoint=e;return t};or.prototype=Object.create(er.prototype);sr.prototype=Object.create(er.prototype);hr.prototype=Object.create(er.prototype);Object.assign(hr.prototype,{initFromArray:function(t){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(t){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(t){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});qn.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Object.assign(j.prototype,{center:function(t){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(t)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(t){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},size:function(t){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(t)}});Object.assign(Q.prototype,{center:function(t){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(t)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(t){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},isIntersectionSphere:function(t){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(t)},size:function(t){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(t)}});ot.prototype.center=function(t){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(t)};cr.random16=function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()};Object.assign(K.prototype,{flattenToArrayOffset:function(t,e){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(t,e)},multiplyVector3:function(t){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return t.applyMatrix3(this)},multiplyVector3Array:function(t){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(t)},applyToBuffer:function(t,e,i){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(c.prototype,{extractPosition:function(t){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(t)},flattenToArrayOffset:function(t,e){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(t,e)},getPosition:function(){var t;return function(){void 0===t&&(t=new h);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(t)},multiplyVector3:function(t){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},multiplyVector4:function(t){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},multiplyVector3Array:function(t){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(t)},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");t.transformDirection(this)},crossVector:function(t){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t,e,i){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,a){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(t,e,n,i,r,a)}});$.prototype.isIntersectionLine=function(t){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(t)};s.prototype.multiplyVector3=function(t){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return t.applyQuaternion(this)};Object.assign(it.prototype,{isIntersectionBox:function(t){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(t)},isIntersectionPlane:function(t){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(t)},isIntersectionSphere:function(t){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(t)}});Object.assign(cn.prototype,{extrude:function(t){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Ve(this,t)},makeGeometry:function(t){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Je(this,t)}});Object.assign(i.prototype,{fromAttribute:function(t,e,i){console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,e,i)}});Object.assign(h.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},applyProjection:function(t){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(t)},fromAttribute:function(t,e,i){console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,e,i)}});Object.assign(r.prototype,{fromAttribute:function(t,e,i){console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(t,e,i)}});_t.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")};Object.assign(at.prototype,{getChildByName:function(t){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(e,t)}});Object.defineProperties(at.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(le.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Pt.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==e&&(this.filmGauge=e);this.setFocalLength(t)};Object.defineProperties(wi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=t}}});Object.defineProperties(lt.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(wt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(t)},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(wt.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(Sn.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(X.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new G}}});Object.defineProperties(ui.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Y.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=t}}});Object.assign(ne.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(ne.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=t}}});Object.defineProperties(et.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(t){t=1!==t;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+".");this.renderReverseSided=t}}});Object.defineProperties(a.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=t}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=t}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=t}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=t}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=t}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=t}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=t}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=t}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=t}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=t}}});yn.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;(new dn).load(t,function(t){e.setBuffer(t)});return this};bn.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};t.WebGLRenderTargetCube=o;t.WebGLRenderTarget=a;t.WebGLRenderer=ne;t.ShaderLib=br;t.UniformsLib=xr;t.UniformsUtils=vr;t.ShaderChunk=gr;t.FogExp2=re;t.Fog=ae;t.Scene=oe;t.LensFlare=se;t.Sprite=ce;t.LOD=le;t.SkinnedMesh=de;t.Skeleton=ue;t.Bone=pe;t.Mesh=Et;t.LineSegments=ve;t.Line=me;t.Points=ye;t.Group=xe;t.VideoTexture=be;t.DataTexture=V;t.CompressedTexture=Me;t.CubeTexture=l;t.CanvasTexture=_e;t.DepthTexture=we;t.Texture=n;t.CompressedTextureLoader=yi;t.DataTextureLoader=xi;t.CubeTextureLoader=Mi;t.TextureLoader=_i;t.ObjectLoader=Qi;t.MaterialLoader=qi;t.BufferGeometryLoader=Xi;t.DefaultLoadingManager=Lr;t.LoadingManager=vi;t.JSONLoader=Zi;t.ImageLoader=bi;t.FontLoader=pn;t.FileLoader=gi;t.Loader=Yi;t.Cache=Ar;t.AudioLoader=dn;t.SpotLightShadow=Si;t.SpotLight=Ri;t.PointLight=Ai;t.RectAreaLight=fn;t.HemisphereLight=Ei;t.DirectionalLightShadow=Li;t.DirectionalLight=Pi;t.AmbientLight=Ci;t.LightShadow=Ti;t.Light=wi;t.StereoCamera=mn;t.PerspectiveCamera=Pt;t.OrthographicCamera=Ct;t.CubeCamera=vn;t.Camera=Lt;t.AudioListener=gn;t.PositionalAudio=xn;t.AudioContext=zr;t.AudioAnalyser=bn;t.Audio=yn;t.VectorKeyframeTrack=Oi;t.StringKeyframeTrack=ki;t.QuaternionKeyframeTrack=Fi;t.NumberKeyframeTrack=Bi;t.ColorKeyframeTrack=Vi;t.BooleanKeyframeTrack=Gi;t.PropertyMixer=Mn;t.PropertyBinding=_n;t.KeyframeTrack=ji;t.AnimationUtils=Pr;t.AnimationObjectGroup=wn;t.AnimationMixer=Tn;t.AnimationClip=Wi;t.Uniform=Sn;t.InstancedBufferGeometry=Rn;t.BufferGeometry=wt;t.GeometryIdCount=function(){return wr++};t.Geometry=_t;t.InterleavedBufferAttribute=An;t.InstancedInterleavedBuffer=Pn;t.InterleavedBuffer=Ln;t.InstancedBufferAttribute=Cn;t.Face3=ht;t.Object3D=at;t.Raycaster=In;t.Layers=rt;t.EventDispatcher=e;t.Clock=Un;t.QuaternionLinearInterpolant=Hi;t.LinearInterpolant=zi;t.DiscreteInterpolant=Ui;t.CubicInterpolant=Ni;t.Interpolant=Ii;t.Triangle=st;t.Math=cr;t.Spherical=Dn;t.Cylindrical=On;t.Plane=$;t.Frustum=tt;t.Sphere=J;t.Ray=it;t.Matrix4=c;t.Matrix3=K;t.Box3=Q;t.Box2=j;t.Line3=ot;t.Euler=nt;t.Vector4=r;t.Vector3=h;t.Vector2=i;t.Quaternion=s;t.Color=G;t.MorphBlendMesh=Hn;t.ImmediateRenderObject=Fn;t.VertexNormalsHelper=Bn;t.SpotLightHelper=kn;t.SkeletonHelper=Gn;t.PointLightHelper=Vn;t.RectAreaLightHelper=jn;t.HemisphereLightHelper=Wn;t.GridHelper=qn;t.PolarGridHelper=Xn;t.FaceNormalsHelper=Yn;t.DirectionalLightHelper=Zn;t.CameraHelper=Qn;t.BoxHelper=Jn;t.ArrowHelper=Kn;t.AxisHelper=$n;t.CatmullRomCurve3=er;t.CubicBezierCurve3=ir;t.QuadraticBezierCurve3=nr;t.LineCurve3=rr;t.ArcCurve=ar;t.EllipseCurve=rn;t.SplineCurve=an;t.CubicBezierCurve=on;t.QuadraticBezierCurve=sn;t.LineCurve=en;t.Shape=cn;t.Path=hn;t.ShapePath=ln;t.Font=un;t.CurvePath=nn;t.Curve=tn;t.ShapeUtils=Tr;t.SceneUtils={createMultiMaterialObject:function(t,e){for(var i=new xe,n=0,r=e.length;n<r;n++)i.add(new Et(t,e[n]));return i},detach:function(t,e,i){t.applyMatrix(e.matrixWorld);e.remove(t);i.add(t)},attach:function(t,e,i){var n=new c;n.getInverse(i.matrixWorld);t.applyMatrix(n);e.remove(t);i.add(t)}};t.WireframeGeometry=Ee;t.ParametricGeometry=Te;t.ParametricBufferGeometry=Se;t.TetrahedronGeometry=Le;t.TetrahedronBufferGeometry=Pe;t.OctahedronGeometry=Ce;t.OctahedronBufferGeometry=Ie;t.IcosahedronGeometry=Ne;t.IcosahedronBufferGeometry=ze;t.DodecahedronGeometry=Ue;t.DodecahedronBufferGeometry=De;t.PolyhedronGeometry=Re;t.PolyhedronBufferGeometry=Ae;t.TubeGeometry=Oe;t.TubeBufferGeometry=He;t.TorusKnotGeometry=Fe;t.TorusKnotBufferGeometry=Be;t.TorusGeometry=ke;t.TorusBufferGeometry=Ge;t.TextGeometry=je;t.SphereGeometry=We;t.SphereBufferGeometry=qe;t.RingGeometry=Xe;t.RingBufferGeometry=Ye;t.PlaneGeometry=Rt;t.PlaneBufferGeometry=At;t.LatheGeometry=Ze;t.LatheBufferGeometry=Qe;t.ShapeGeometry=Je;t.ShapeBufferGeometry=Ke;t.ExtrudeGeometry=Ve;t.EdgesGeometry=$e;t.ConeGeometry=ii;t.ConeBufferGeometry=ni;t.CylinderGeometry=ti;t.CylinderBufferGeometry=ei;t.CircleGeometry=ri;t.CircleBufferGeometry=ai;t.BoxGeometry=Tt;t.BoxBufferGeometry=St;t.ShadowMaterial=oi;t.SpriteMaterial=he;t.RawShaderMaterial=si;t.ShaderMaterial=Y;t.PointsMaterial=ge;t.MultiMaterial=hi;t.MeshPhysicalMaterial=li;t.MeshStandardMaterial=ci;t.MeshPhongMaterial=ui;t.MeshToonMaterial=pi;t.MeshNormalMaterial=di;t.MeshLambertMaterial=fi;t.MeshDepthMaterial=Z;t.MeshBasicMaterial=ct;t.LineDashedMaterial=mi;t.LineBasicMaterial=fe;t.Material=X;t.Float64BufferAttribute=xt;t.Float32BufferAttribute=yt;t.Uint32BufferAttribute=gt;t.Int32BufferAttribute=vt;t.Uint16BufferAttribute=mt;t.Int16BufferAttribute=ft;t.Uint8ClampedBufferAttribute=dt;t.Uint8BufferAttribute=pt;t.Int8BufferAttribute=ut;t.BufferAttribute=lt;t.REVISION="84";t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};t.CullFaceNone=0;t.CullFaceBack=1;t.CullFaceFront=2;t.CullFaceFrontBack=3;t.FrontFaceDirectionCW=0;t.FrontFaceDirectionCCW=1;t.BasicShadowMap=0;t.PCFShadowMap=1;t.PCFSoftShadowMap=2;t.FrontSide=0;t.BackSide=1;t.DoubleSide=2;t.FlatShading=1;t.SmoothShading=2;t.NoColors=0;t.FaceColors=1;t.VertexColors=2;t.NoBlending=0;t.NormalBlending=1;t.AdditiveBlending=2;t.SubtractiveBlending=3;t.MultiplyBlending=4;t.CustomBlending=5;t.AddEquation=100;t.SubtractEquation=101;t.ReverseSubtractEquation=102;t.MinEquation=103;t.MaxEquation=104;t.ZeroFactor=200;t.OneFactor=201;t.SrcColorFactor=202;t.OneMinusSrcColorFactor=203;t.SrcAlphaFactor=204;t.OneMinusSrcAlphaFactor=205;t.DstAlphaFactor=206;t.OneMinusDstAlphaFactor=207;t.DstColorFactor=208;t.OneMinusDstColorFactor=209;t.SrcAlphaSaturateFactor=210;t.NeverDepth=0;t.AlwaysDepth=1;t.LessDepth=2;t.LessEqualDepth=3;t.EqualDepth=4;t.GreaterEqualDepth=5;t.GreaterDepth=6;t.NotEqualDepth=7;t.MultiplyOperation=0;t.MixOperation=1;t.AddOperation=2;t.NoToneMapping=0;t.LinearToneMapping=1;t.ReinhardToneMapping=2;t.Uncharted2ToneMapping=3;t.CineonToneMapping=4;t.UVMapping=300;t.CubeReflectionMapping=301;t.CubeRefractionMapping=302;t.EquirectangularReflectionMapping=303;t.EquirectangularRefractionMapping=304;t.SphericalReflectionMapping=305;t.CubeUVReflectionMapping=306;t.CubeUVRefractionMapping=307;t.RepeatWrapping=1e3;t.ClampToEdgeWrapping=1001;t.MirroredRepeatWrapping=1002;t.NearestFilter=1003;t.NearestMipMapNearestFilter=1004;t.NearestMipMapLinearFilter=1005;t.LinearFilter=1006;t.LinearMipMapNearestFilter=1007;t.LinearMipMapLinearFilter=1008;t.UnsignedByteType=1009;t.ByteType=1010;t.ShortType=1011;t.UnsignedShortType=1012;t.IntType=1013;t.UnsignedIntType=1014;t.FloatType=1015;t.HalfFloatType=1016;t.UnsignedShort4444Type=1017;t.UnsignedShort5551Type=1018;t.UnsignedShort565Type=1019;t.UnsignedInt248Type=1020;t.AlphaFormat=1021;t.RGBFormat=1022;t.RGBAFormat=1023;t.LuminanceFormat=1024;t.LuminanceAlphaFormat=1025;t.RGBEFormat=1023;t.DepthFormat=1026;t.DepthStencilFormat=1027;t.RGB_S3TC_DXT1_Format=2001;t.RGBA_S3TC_DXT1_Format=2002;t.RGBA_S3TC_DXT3_Format=2003;t.RGBA_S3TC_DXT5_Format=2004;t.RGB_PVRTC_4BPPV1_Format=2100;t.RGB_PVRTC_2BPPV1_Format=2101;t.RGBA_PVRTC_4BPPV1_Format=2102;t.RGBA_PVRTC_2BPPV1_Format=2103;t.RGB_ETC1_Format=2151;t.LoopOnce=2200;t.LoopRepeat=2201;t.LoopPingPong=2202;t.InterpolateDiscrete=2300;t.InterpolateLinear=2301;t.InterpolateSmooth=2302;t.ZeroCurvatureEnding=2400;t.ZeroSlopeEnding=2401;t.WrapAroundEnding=2402;t.TrianglesDrawMode=0;t.TriangleStripDrawMode=1;t.TriangleFanDrawMode=2;t.LinearEncoding=3e3;t.sRGBEncoding=3001;t.GammaEncoding=3007;t.RGBEEncoding=3002;t.LogLuvEncoding=3003;t.RGBM7Encoding=3004;t.RGBM16Encoding=3005;t.RGBDEncoding=3006;t.BasicDepthPacking=3200;t.RGBADepthPacking=3201;t.CubeGeometry=Tt;t.Face4=function(t,e,i,n,r,a,o){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new ht(t,e,i,r,a,o)};t.LineStrip=0;t.LinePieces=1;t.MeshFaceMaterial=function(t){console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial.");return new hi(t)};t.PointCloud=function(t,e){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new ye(t,e)};t.Particle=function(t){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new ce(t)};t.ParticleSystem=function(t,e){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new ye(t,e)};t.PointCloudMaterial=function(t){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new ge(t)};t.ParticleBasicMaterial=function(t){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new ge(t)};t.ParticleSystemMaterial=function(t){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new ge(t)};t.Vertex=function(t,e,i){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new h(t,e,i)};t.DynamicBufferAttribute=function(t,e){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new lt(t,e).setDynamic(!0)};t.Int8Attribute=function(t,e){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new ut(t,e)};t.Uint8Attribute=function(t,e){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new pt(t,e)};t.Uint8ClampedAttribute=function(t,e){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new dt(t,e)};t.Int16Attribute=function(t,e){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new ft(t,e)};t.Uint16Attribute=function(t,e){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new mt(t,e)};t.Int32Attribute=function(t,e){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new vt(t,e)};t.Uint32Attribute=function(t,e){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new gt(t,e)};t.Float32Attribute=function(t,e){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new yt(t,e)};t.Float64Attribute=function(t,e){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new xt(t,e)};t.ClosedSplineCurve3=or;t.SplineCurve3=sr;t.Spline=hr;t.BoundingBoxHelper=function(t,e){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new Jn(t,e)};t.EdgesHelper=function(t,e){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new ve(new $e(t.geometry),new fe({color:void 0!==e?e:16777215}))};t.WireframeHelper=function(t,e){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new ve(new Ee(t.geometry),new fe({color:void 0!==e?e:16777215}))};t.XHRLoader=function(t){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new gi(t)};t.BinaryTextureLoader=function(t){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new xi(t)};t.GeometryUtils={merge:function(t,e,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry);t.merge(e,n,i)},center:function(t){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return t.center()}};t.ImageUtils={crossOrigin:void 0,loadTexture:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new _i;r.setCrossOrigin(this.crossOrigin);t=r.load(t,i,void 0,n);e&&(t.mapping=e);return t},loadTextureCube:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Mi;r.setCrossOrigin(this.crossOrigin);t=r.load(t,i,void 0,n);e&&(t.mapping=e);return t},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};t.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project().");t.project(e)};this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");t.unproject(e)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(t,"__esModule",{value:!0})});!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var o=e||window.event,s=h.call(arguments,1),c=0,u=0,p=0,d=0,f=0,m=0;if(e=t.event.fix(o),e.type="mousewheel","detail"in o&&(p=-1*o.detail),"wheelDelta"in o&&(p=o.wheelDelta),"wheelDeltaY"in o&&(p=o.wheelDeltaY),"wheelDeltaX"in o&&(u=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(u=-1*p,p=0),c=0===p?u:p,"deltaY"in o&&(p=-1*o.deltaY,c=p),"deltaX"in o&&(u=o.deltaX,0===p&&(c=-1*u)),0!==p||0!==u){if(1===o.deltaMode){var v=t.data(this,"mousewheel-line-height");c*=v,p*=v,u*=v}else if(2===o.deltaMode){var g=t.data(this,"mousewheel-page-height");c*=g,p*=g,u*=g}if(d=Math.max(Math.abs(p),Math.abs(u)),(!a||a>d)&&(a=d,n(o,d)&&(a/=40)),n(o,d)&&(c/=40,u/=40,p/=40),c=Math[c>=1?"floor":"ceil"](c/a),u=Math[u>=1?"floor":"ceil"](u/a),p=Math[p>=1?"floor":"ceil"](p/a),l.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();f=e.clientX-y.left,m=e.clientY-y.top}return e.deltaX=u,e.deltaY=p,e.deltaFactor=a,e.offsetX=f,e.offsetY=m,e.deltaMode=0,s.unshift(e,c,u,p),r&&clearTimeout(r),r=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,s)}}function i(){a=null}function n(t,e){return l.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var r,a,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(t.event.fixHooks)for(var c=o.length;c;)t.event.fixHooks[o[--c]]=t.event.mouseHooks;var l=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=s.length;i;)this.addEventListener(s[--i],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",l.getLineHeight(this)),t.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=s.length;i;)this.removeEventListener(s[--i],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e),n=i["offsetParent"in t.fn?"offsetParent":"parent"]();return n.length||(n=t("body")),parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})});(function(t,e,i){var n=t([]),r=t.resize=t.extend(t.resize,{}),a,o="setTimeout",s="resize",h=s+"-special-event",c="delay",l="throttleWindow";r[c]=250;r[l]=true;t.event.special[s]={setup:function(){if(!r[l]&&this[o]){return false}var e=t(this);n=n.add(e);t.data(this,h,{w:e.width(),h:e.height()});if(n.length===1){u()}},teardown:function(){if(!r[l]&&this[o]){return false}var e=t(this);n=n.not(e);e.removeData(h);if(!n.length){clearTimeout(a)}},add:function(e){if(!r[l]&&this[o]){return false}var n;function a(e,r,a){var o=t(this),s=t.data(this,h);s.w=r!==i?r:o.width();s.h=a!==i?a:o.height();n.apply(this,arguments)}if(t.isFunction(e)){n=e;return a}else{n=e.handler;e.handler=a}}};function u(){a=e[o](function(){n.each(function(){var e=t(this),i=e.width(),n=e.height(),r=t.data(this,h);if(i!==r.w||n!==r.h){e.trigger(s,[r.w=i,r.h=n])}});u()},r[c])}})(jQuery,this);$.postJSON=function(t,e,i,n){$.ajax({type:"POST",contentType:"application/json;charset=utf-8",url:t,data:JSON.stringify(e),dataType:"json",error:n,success:i})};var Align={center:0,left:1,right:2};var Style={stroke:0,rect:1};TextSprite=function(t){THREE.Object3D.call(this);var e=new THREE.Texture;e.minFilter=THREE.LinearFilter;e.magFilter=THREE.LinearFilter;var i=new THREE.SpriteMaterial({map:e,depthTest:false});this.sprite=new THREE.Sprite(i);this.add(this.sprite);this.text="";this.offset=[0,0];this.style={fontface:"",fontsize:15,textColor:"#000000",borderThickness:1,borderFillet:6,borderColor:"rgba(0,0,0,0.8)",backgroundColor:"rgba(255,255,255,0.8)"};if(t!=null){if(t.text!=null){this.text=t.text}if(t.offset!=null){this.offset[0]=t.offset[0];this.offset[1]=t.offset[1]}if(t.style!=null){if(t.style.fontface!=null)this.style.fontface=t.style.fontface;if(t.style.fontsize!=null)this.style.fontsize=t.style.fontsize;if(t.style.textColor!=null)this.style.textColor=t.style.textColor;if(t.style.borderThickness!=null)this.style.borderThickness=t.style.borderThickness;if(t.style.borderFillet!=null)this.style.borderFillet=t.style.borderFillet;if(t.style.borderColor!=null)this.style.borderColor=t.style.borderColor;if(t.style.backgroundColor!=null)this.style.backgroundColor=t.style.backgroundColor}}this.update()};TextSprite.prototype=new THREE.Object3D;TextSprite.prototype.setStyle=function(t){if(t.fontface!=null)this.style.fontface=t.fontface;if(t.fontsize!=null)this.style.fontsize=t.fontsize;if(t.textColor!=null)this.style.textColor=t.textColor;if(t.borderThickness!=null)this.style.borderThickness=t.borderThickness;if(t.borderFillet!=null)this.style.borderFillet=t.borderFillet;if(t.borderColor!=null)this.style.borderColor=t.borderColor;if(t.backgroundColor!=null)this.style.backgroundColor=t.backgroundColor;this.update()};TextSprite.prototype.setOffset=function(t,e){this.offset[0]=t;this.offset[1]=e;this.update()};TextSprite.prototype.setText=function(t){this.text=t;this.update()};TextSprite.prototype.update=function(){var t=this.style.fontsize+"px "+this.style.fontface;var e=document.createElement("canvas");var i=e.getContext("2d");i.font=t;var n=i.measureText(this.text);var r=n.width;var a=Math.round(this.style.fontsize*.2)+this.style.borderThickness;var o=r+2*a;var s=this.style.fontsize+2*a;var e=document.createElement("canvas");var i=e.getContext("2d");i.canvas.width=o;i.canvas.height=s;i.font=t;if(this.style.borderThickness>0){i.fillStyle=this.style.backgroundColor;i.strokeStyle=this.style.borderColor;i.lineWidth=this.style.borderThickness;this.roundRect(i,this.style.borderThickness/2,this.style.borderThickness/2,o-this.style.borderThickness,s-this.style.borderThickness,this.style.borderFillet);i.fillStyle=this.style.textColor;i.fillText(this.text,a,this.style.fontsize+a/2)}else{i.strokeStyle=this.style.backgroundColor;i.strokeText(this.text,a,this.style.fontsize+a/2);i.fillStyle=this.style.textColor;i.fillText(this.text,a,this.style.fontsize+a/2)}var h=new THREE.Texture(e);h.minFilter=THREE.LinearFilter;h.magFilter=THREE.LinearFilter;h.needsUpdate=true;this.sprite.material.map=h;var c=s/this.style.fontsize;var l=o/s*c;var u=1*c;var p=this.offset[0]/this.style.fontsize;var d=this.offset[1]/this.style.fontsize;this.sprite.scale.set(l,u,1);this.sprite.position.set(p,0,d)};TextSprite.prototype.roundRect=function(t,e,i,n,r,a){n--;t.beginPath();t.moveTo(e+a,i);t.lineTo(e+n-a,i);t.quadraticCurveTo(e+n,i,e+n,i+a);t.lineTo(e+n,i+r-a);t.quadraticCurveTo(e+n,i+r,e+n-a,i+r);t.lineTo(e+a,i+r);t.quadraticCurveTo(e,i+r,e,i+r-a);t.lineTo(e,i+a);t.quadraticCurveTo(e,i,e+a,i);t.closePath();t.fill();t.stroke()};RotControl=function(t,e){var i=this;var n=$(e);t.target=new THREE.Vector3(0,0,0);this.onRot=function(t){};var r=Math.PI*3/4;var a=false;var o=0;var s=0;var h=function(t){a=true};var c=function(t){a=false};var l=function(n){var r=n.offsetX-o;var h=n.offsetY-s;o=n.offsetX;s=n.offsetY;if(i.enabled==false)return;if(n.buttons==0)return;if(!a)return;var c=.02*t.fov*r/e.clientHeight;var l=.02*t.fov*h/e.clientHeight;var u=t.getWorldDirection();var p=new THREE.Vector3(0,0,1);var d=new THREE.Vector3;d.crossVectors(u,p);d.normalize();var f=new THREE.Quaternion;f.setFromAxisAngle(d,l);var m=new THREE.Quaternion;m.setFromAxisAngle(p,c);var v=new THREE.Vector3;v.copy(u);v.applyQuaternion(f);if(Math.abs(v.z)<.9)u.applyQuaternion(f);u.applyQuaternion(m);var g=t.position;var y=new THREE.Vector3;y.addVectors(g,u);t.up.set(0,0,1);t.lookAt(y);var u=t.getWorldDirection();var x=Math.atan2(u.x,u.y)*180/Math.PI;var b=t.fov;var M=Math.atan(Math.tan(b/2)*t.aspect)*2*180/Math.PI;var _={heading:x,fovx:M};i.onRot(_)};this.dispose=function(){n.unbind("mousemove",l);n.unbind("mousedown",h);n.unbind("mouseup",c)};n.bind("mousemove",l);n.bind("mousedown",h);n.bind("mouseup",c);this.enabled=false};var Tool={none:0,measurePoint:1,measureLength:2,measureArea:3,measureZ:4,measureFacade:5,measureAngle:6,measureSlope:7,createPoint:11,createPolyline:12,createPolygon:13,caliplane:14,pick:21,remove:22,fullscreen:23,lrs:24,play:31,stop:32,next:33,prev:34,branch:35,back:36,history:37};var FullMode={fill:1,trans:2,clip:3,stretch:4};var SampleMode={none:0,cloud:1,photo:2,ground:3,plane:4,object:5,depth:6};var LocateState={success:0,typeError:1,dataError:2,imageError:3,busy:4};var ControlType={arrow:0,history:1};function PPV(t){var e=this;this.getVersion=function(){return"20170707"};console.log("ppv:"+e.getVersion());var i=$("#"+t);var n=document.getElementById(t);var r;var a="";var o=3;var s=1;var h=Tool.none;var c=SampleMode.photo;var l=false;var u=false;var p=0;var d;var f;var m=-1.45;var v=50;var g=100;var y=8.4456;var x=7.0656;var b=5;var M=1.1953125;function _(){var t=document.scripts;var e="";for(var i=t.length-1;i>=0;i--){var n=t[i].src;var r=n.toLowerCase().indexOf("ppv/js/ppv.");if(r>=0){e=n.substring(0,r);break}}return e}var w=_();var E=new THREE.TextureLoader;var T;var S;var R;var A;var L=new THREE.Group;var P=new THREE.Group;var C=new THREE.Group;var I=new THREE.Group;var N=new THREE.Group;var z=new THREE.Group;var U=new THREE.Group;var D=new THREE.Group;var O=new THREE.Group;var H=new THREE.Group;var F=new THREE.Group;var B=new THREE.Group;var k="+proj=merc +lat_0=0 +lon_0=0 +k=1.000000 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs ";var G=proj4(k);var V=new THREE.Vector3;var j=new THREE.Vector3;var W=new THREE.Group;var q;var X;var Y=new THREE.PlaneBufferGeometry(1,1);var Z=new THREE.SphereBufferGeometry(1,32,32);var Q=new THREE.MeshLambertMaterial({color:16711935,side:THREE.FrontSide,shading:THREE.SmoothShading});var J=new THREE.SphereBufferGeometry(1,100,50);var K=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,shading:THREE.SmoothShading});var tt=new THREE.RingGeometry(1,1.2,64);var et=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,transparent:true,opacity:.6});var it=new THREE.Mesh(tt,et);var nt=new TextSprite({style:{textColor:"#ffff88",borderThickness:0,backgroundColor:"#000000"}});F.add(it);F.add(nt);function rt(t){t.minFilter=THREE.LinearFilter;t.magFilter=THREE.LinearFilter;t.generateMipmaps=false;t.mapping=THREE.UVMapping}var at=E.load(w+"ppv/icon/arrow-e.png");rt(at);var ot=E.load(w+"ppv/icon/arrow-w.png");rt(ot);var st=E.load(w+"ppv/icon/arrow-s.png");rt(st);var ht=E.load(w+"ppv/icon/arrow-n.png");rt(ht);var ct=E.load(w+"ppv/icon/arrow-ne.png");rt(ct);var lt=E.load(w+"ppv/icon/arrow-nw.png");rt(lt);var ut=E.load(w+"ppv/icon/arrow-se.png");rt(ut);var pt=E.load(w+"ppv/icon/arrow-sw.png");rt(pt);var dt=E.load(w+"ppv/icon/history.png");rt(pt);function ft(t){if(t>=-22.5&&t<22.5)return ht;else if(t>=22.5&&t<67.5)return ct;else if(t>=67.5&&t<112.5)return at;else if(t>=112.5&&t<157.5)return ut;else if(t>=157.5||t<-157.5)return st;else if(t>=-157.5&&t<-112.5)return pt;else if(t>=-112.5&&t<-67.5)return ot;else if(t>=-67.5&&t<-22.5)return lt}var mt=w+"ppv/icon/error-imaj.jpg";var vt=E.load(mt);rt(vt);error_360_url=w+"ppv/icon/error-360.jpg";var gt=E.load(error_360_url);rt(gt);var yt=new THREE.Raycaster;var xt=new THREE.Vector2;var bt=new THREE.Vector2(-1,-1);var Mt=new THREE.Vector2(-1,-1);var _t=new THREE.Vector2(0,0);var wt;var Et;var Tt={bgcolor:0,fullView:FullMode.fill,enableArrow:true,enableHistory:true,scope:100,thumb:"Middle",magnifier:{size:256,zoom:5,fix:false},arrows:{forward:5,below:1.8,lean:15},key:{del:46,play:32,fforward:33,fbackward:34,forward:38,backward:40,fullscreen:120},label:{fontface:"",fontsize:15,textColor:"#000000",borderThickness:1,borderFillet:6,borderColor:"rgba(0,0,0,0.8)",backgroundColor:"rgba(255,255,255,0.8)"}};this.setPref=function(t){if(t.bgcolor!=null){Tt.bgcolor=t.bgcolor;A.setClearColor(Tt.bgcolor)}if(t.fullView!=null){Tt.fullView=t.fullView}if(t.enableArrow!=null){Tt.enableArrow=t.enableArrow;I.visible=Tt.enableArrow}if(t.enableHistory!=null){Tt.enableHistory=t.enableHistory;N.visible=Tt.enableArrow}if(t.scope!=null){Tt.scope=t.scope;g=Tt.scope/b;var e=new THREE.Vector3(0,b*g,0);var i=new THREE.Euler(Math.PI/2,0,0);var n=new THREE.Vector3(y*g,x*g,1);var n=new THREE.Vector3(y*g,x*g,1);q.rotation.copy(i);q.scale.copy(n);q.position.copy(e)}if(t.arrows){if(t.arrows.forward!=null){Tt.arrows.forward=t.arrows.forward}if(t.arrows.below!=null){Tt.arrows.below=t.arrows.below}if(t.arrows.lean!=null){Tt.arrows.lean=t.arrows.lean}}if(t.magnifier){if(t.magnifier.size!=null){Tt.magnifier.size=t.magnifier.size}if(t.magnifier.zoom!=null){Tt.magnifier.zoom=t.magnifier.zoom}if(t.magnifier.fix!=null){Tt.magnifier.fix=t.magnifier.fix}}if(t.key){if(t.key.del!=null){Tt.key.del=t.key.del}if(t.key.play!=null){Tt.key.play=t.key.play}if(t.key.fforward!=null){Tt.key.fforward=t.key.fforward}if(t.key.fbackward!=null){Tt.key.fbackward=t.key.fbackward}if(t.key.forward!=null){Tt.key.forward=t.key.forward}if(t.key.backward!=null){Tt.key.backward=t.key.backward}if(t.key.fullscreen!=null){Tt.key.fullscreen=t.key.fullscreen}}if(t.label){if(t.label.fontface!=null)Tt.label.fontface=t.label.fontface;if(t.label.fontsize!=null)Tt.label.fontsize=t.label.fontsize;if(t.label.textColor!=null)Tt.label.textColor=t.label.textColor;if(t.label.borderThickness!=null)Tt.label.borderThickness=t.label.borderThickness;if(t.label.borderFillet!=null)Tt.label.borderFillet=t.label.borderFillet;if(t.label.borderColor!=null)Tt.label.borderColor=t.label.borderColor;if(t.label.backgroundColor!=null)Tt.label.backgroundColor=t.label.backgroundColor}};this.getPref=function(){return Tt};this.isPlaying=function(){return l};this.setServer=function(t){a=t};this.locate=function(t,e,i,n){r=n;if(u){var s={state:LocateState.busy};this.onLocate(s);return}u=true;Be();o=t;switch(o){case-1:{var h=50;var c=15;$.get("php/locate.php",{lon:e,lat:i,tol:h,angle:c},function(t){var e=t.substr(0,6);if(e=="error:"){console.error(t);u=false;return}qe(t,true)})}break;case 0:{$.postJSON(a+"/GetBranchByCoord",{type:o,x:e,y:i,key:r},function(t){Ve(t.d,true)},function t(e,i){u=false})}break;case 3:{$.postJSON(a+"/GetBranchByCoord",{type:o,x:e,y:i,key:r},function(t){Xe(t.d,true)},function t(e,i){u=false})}break;case 4:{$.postJSON(a+"/GetBranchByCoord",{type:o,x:e,y:i,key:r},function(t){Ye(t.d,true)},function t(e,i){u=false})}break}};this.locateByID=function(t,e,i){r=i;if(u){var n={state:LocateState.busy};this.onLocate(n);return}u=true;Be();o=t;switch(o){case-1:{var s=50;var h=15;$.get(a+"/locate_by_id.php",{id:e,tol:s,angle:h},function(t){var e=t.substr(0,6);if(e=="error:"){console.error(t);u=false;return}qe(t,true)})}break;case 0:{$.postJSON(a+"/GetBranchByID",{type:o,id:e,step:1,key:r},function(t){Ve(t.d,true)},function t(e,i){u=false})}break;case 3:{$.postJSON(a+"/GetBranchByID",{type:o,id:e,step:1,key:r},function(t){Xe(t.d,true)},function t(e,i){u=false})}break;case 4:{$.postJSON(a+"/GetBranchByID",{type:o,id:e,step:1,key:r},function(t){Ye(t.d,true)},function t(e,i){u=false})}break}};function St(t,e){if(u){return}u=true;Be();setTimeout(function(){switch(o){case-1:{var e=50;var i=15;$.get(a+"/locate_by_id.php",{id:t,tol:e,angle:i},function(t){var e=t.substr(0,6);if(e=="error:"){console.error(t);u=false;return}qe(t)})}break;case 0:{$.postJSON(a+"/GetBranchByID",{type:o,id:t,step:1,key:r},function(t){Ve(t.d)},function t(e,i){u=false})}break;case 3:{$.postJSON(a+"/GetBranchByID",{type:o,id:t,step:1,key:r},function(t){Xe(t.d)},function t(e,i){u=false})}break;case 4:{$.postJSON(a+"/GetBranchByID",{type:o,id:t,step:1,key:r},function(t){Ye(t.d)},function t(e,i){u=false})}break}},100)}function Rt(t){if(d!=null){if(t==1){switch(o){case-1:if(d.next)return d.next.id;break;case 0:if(d.Nextframe)return d.Nextframe.ImgId;break;case 3:if(d.Nextframe)return d.Nextframe.PmId;break;case 4:if(d.Nextframe)return d.Nextframe.Id;break}}else if(t==-1){switch(o){case-1:if(d.prev)return d.prev.id;break;case 0:if(d.Prevframe)return d.Prevframe.ImgId;break;case 3:if(d.Prevframe)return d.Prevframe.PmId;break;case 4:if(d.Prevframe)return d.Prevframe.Id;break}}else{}}return p+t}this.step=function(t){if(l)return;St(Rt(t))};this.play=function(){if(l)return;var t={tool:Tool.play};this.onTool(t);l=true;St(Rt(1))};this.stop=function(){l=false;var t={tool:Tool.stop};this.onTool(t)};this.setTool=function(t){ae(t)};this.getTool=function(){return h};this.setSampleMode=function(t){c=t};this.getSampleMode=function(){return c};this.getFrame=function(){return p};this.lookAt=function(t,e,i){if(!we())return;var n=[t,e];var r=G.forward(n);var a=new THREE.Vector3(r[0]-V.x,r[1]-V.y,i-V.z);var o=T.getWorldDirection();var s=new THREE.Vector3;s.subVectors(a,T.position);s.normalize();var h=o.distanceTo(s);if(h<.1){var c=0;var l=30;var u=new THREE.Vector3;var p=setInterval(function(){if(++c==l){clearInterval(p)}var t=1*c/l;u.x=o.x+(s.x-o.x)*t;u.y=o.y+(s.y-o.y)*t;u.z=o.z+(s.z-o.z)*t;u.normalize();var e=new THREE.Vector3(0,0,1);T.position.set(0,0,0);T.up.copy(e);T.lookAt(u);T.position.copy(j);ke()},20)}else{var c=0;var l=30;var u=new THREE.Vector3;var d=new THREE.Quaternion;var f=new THREE.Quaternion;f.setFromUnitVectors(o,s);var p=setInterval(function(){if(++c==l){clearInterval(p)}var t=1*c/l;d.slerp(f,t);u.copy(o);u.applyQuaternion(d);u.normalize();var e=new THREE.Vector3(0,0,1);T.position.set(0,0,0);T.up.copy(e);T.lookAt(u);T.position.copy(j);ke()},20)}};this.undo=function(){var t={button:1};switch(h){case Tool.measurePoint:Xt(xt,t);break;case Tool.measureLength:Yt(xt,t);break;case Tool.measureArea:Qt(xt,t);break;case Tool.measureZ:Jt(xt,t);break;case Tool.measureFacade:Kt(xt,t);break;case Tool.measureAngle:$t(xt,t);break;case Tool.measureSlope:te(xt,t);break;case Tool.createPoint:jt(xt,t);break;case Tool.createPolyline:Wt(xt,t);break;case Tool.createPolygon:qt(xt,t);break;case Tool.pick:Gt(xt,t);break;case Tool.remove:Vt(xt,t);break}};this.finish=function(){var t={button:2};switch(h){case Tool.measurePoint:Xt(xt,t);break;case Tool.measureLength:Yt(xt,t);break;case Tool.measureArea:Qt(xt,t);break;case Tool.measureZ:Jt(xt,t);break;case Tool.measureFacade:Kt(xt,t);break;case Tool.measureAngle:$t(xt,t);break;case Tool.measureSlope:te(xt,t);break;case Tool.createPoint:jt(xt,t);break;case Tool.createPolyline:Wt(xt,t);break;case Tool.createPolygon:qt(xt,t);break;case Tool.pick:Gt(xt,t);break;case Tool.remove:Vt(xt,t);break}};this.addLayer=function(t){var e=B.getObjectByName(name);if(e=null)return;e=new THREE.Group;e.name=t.name;e.userData=t;if(t.type=="Point"){var i=t.icon;if(i==null){i=w+"ppv/icon/disc.png"}e.texture=E.load(i)}B.add(e);return e};this.findLayer=function(t){var e=B.getObjectByName(t);if(e==null)return;return e};this.getLayer=function(t){var e=t;return e.userData};this.setLayer=function(t,e){var i=t;i.name=e.name;i.userData=e;if(e.type=="Point"){var n=e.icon;if(n==null){n=w+"ppv/icon/disc.png"}i.texture=E.load(n)}for(var r=0;r<i.children.length;r++){var a=i.children[r];this.setFeature(a,a.userData)}};this.removeLayer=function(t){var e=t;B.remove(e)};this.removeAllLayers=function(){B.children=[]};this.needsUpdate=false;function At(t,e,i){var n=t.userData;var r=e.geometry.coordinates;var a=G.forward(r);var o=new THREE.Vector3(0,0,0);if(e.toGround!=null){o.set(a[0]-V.x,a[1]-V.y,T.position.z+e.toGround+m)}else{o.set(a[0]-V.x,a[1]-V.y,r[2]-V.z)}var s=new THREE.SpriteMaterial({map:t.texture,color:n.color,opacity:n.opacity});t.material=s;var h=new THREE.Sprite(t.material);h.position.copy(o);h.updateMatrixWorld(true);i.add(h);if(e.name!=null&&e.name.length>0){var c=new TextSprite({text:e.name,offset:[0,-(n.fontSize*1.2+n.size)/2],style:Tt.label});c.setStyle({fontsize:n.fontSize});c.position.copy(o);c.updateMatrixWorld(true);i.add(c)}return i}function Lt(t,e,i){var n=e.geometry.coordinates;var r=new THREE.Vector3(0,0,0);var a=0;for(var o=0;o<n.length;o++){var s=n[o];var h=G.forward(s);var c=new THREE.Vector3(0,0,0);if(e.toGround!=null){c.set(h[0]-V.x,h[1]-V.y,T.position.z+e.toGround+m)}else{c.set(h[0]-V.x,h[1]-V.y,s[2]-V.z)}r.add(c);a++;var l=new THREE.Vector3(0,0,0);if(t.offset!=null)l.set(t.offset[0]/t.size,0,t.offset[1]/t.size);if(t.icon!=null){var u=E.load(t.icon);var p=new THREE.SpriteMaterial({map:u,color:t.color,opacity:t.opacity});var d=new THREE.Sprite(p);d.position.copy(l);var f=new THREE.Group;f.add(d);f.position.copy(c);i.add(f)}else{var v=new THREE.MeshStandardMaterial({color:t.color,opacity:t.opacity,side:THREE.FrontSide,shading:THREE.SmoothShading});var g=new THREE.Mesh(Z,v);g.position.copy(c);i.add(g)}}if(e.name!=null&&e.name.length>0){var y=new TextSprite({text:e.name,offset:[0,-(t.fontSize*1.2+t.size)/2],style:Tt.label});y.setStyle({fontsize:t.fontSize});r.x/=a;r.y/=a;r.z/=a;y.position.copy(r);i.add(y)}return i}function Pt(t,e,i){var n=e.geometry.coordinates;var r=new THREE.Geometry;for(var a=0;a<n.length;a++){var o=n[a];var s=G.forward(o);if(e.toGround!=null){var h=new THREE.Vector3(s[0]-V.x,s[1]-V.y,T.position.z+e.toGround+m);r.vertices.push(h)}else{var h=new THREE.Vector3(s[0]-V.x,s[1]-V.y,o[2]-V.z);r.vertices.push(h)}}var c=new THREE.LineBasicMaterial({color:t.color,opacity:t.opacity,linewidth:t.lineWidth});var l=new THREE.Line(r,c);i.add(l);if(e.name!=null&&e.name.length>0){var u=new TextSprite({text:e.name,style:Tt.label});u.setStyle({fontsize:t.fontSize});r.computeBoundingBox();var p=r.boundingBox.getCenter();u.position.copy(p);i.add(u)}return i}function Ct(t,e,i){var n=e.geometry.coordinates;var r=new THREE.Vector3(0,0,0);var a=0;for(var o=0;o<n.length;o++){var s=n[o];var h=new THREE.Geometry;for(var c=0;c<s.length;c++){var l=s[c];var u=G.forward(l);var p=new THREE.Vector3(0,0,0);if(e.toGround!=null){p.set(u[0]-V.x,u[1]-V.y,T.position.z+e.toGround+m)}else{p.set(u[0]-V.x,u[1]-V.y,l[2]-V.z)}r.add(p);a++;h.vertices.push(p)}var d=new THREE.LineBasicMaterial({color:t.color,opacity:t.opacity,linewidth:t.lineWidth});var f=new THREE.Line(h,d);i.add(f)}if(e.name!=null&&e.name.length>0){var v=new TextSprite({text:e.name,style:Tt.label});v.setStyle({fontsize:t.fontSize});r.x/=a;r.y/=a;r.z/=a;v.position.copy(r);i.add(v)}return i}function It(t,e,i){var n=e.geometry.coordinates;var r=new THREE.LineBasicMaterial({color:t.color,opacity:t.opacity,linewidth:t.lineWidth});var a;for(var o=0;o<n.length;o++){var s=n[o];var h=new THREE.Geometry;for(var c=0;c<s.length;c++){var l=s[c];var u=G.forward(l);if(e.toGround!=null){var p=new THREE.Vector3(u[0]-V.x,u[1]-V.y,T.position.z+e.toGround+m);h.vertices.push(p)}else{var p=new THREE.Vector3(u[0]-V.x,u[1]-V.y,l[2]-V.z);h.vertices.push(p)}}var d=new THREE.Line(h,r);i.add(d);if(e.toGround!=null){var f=h.vertices[0];var v=[];for(var c=0;c<h.vertices.length;c++){var g=new THREE.Vector3;g.copy(h.vertices[c]);g.sub(f);v.push(g)}if(!a){a=new THREE.Shape(v)}else{var y=new THREE.Path(v);a.holes.push(y)}}}if(a){var x=new THREE.ShapeBufferGeometry(a);var r=new THREE.MeshBasicMaterial({color:65535,transparent:true,opacity:.5,side:THREE.DoubleSide});var b=new THREE.Mesh(x,r);b.position.copy(f);i.add(b)}if(e.name!=null&&e.name.length>0){var M=new TextSprite({text:e.name,style:Tt.label});M.setStyle({fontsize:t.fontSize});var h=i.children[0].geometry;h.computeBoundingBox();var _=h.boundingBox.getCenter();M.position.copy(_);i.add(M)}return i}function Ct(t,e,i){console.warn("N/A: MultiLineString")}function Nt(t,e,i){console.warn("N/A: GeometryCollection")}this.addFeature=function(t,e){var i=t;var n=i.userData;var r=new THREE.Group;r.userData=e;var a=e.type;if(a=="Feature"){var o=e.geometry.type;if(o=="Point"){At(i,e,r)}else if(o=="LineString"){Pt(n,e,r)}else if(o=="Polygon"){It(n,e,r)}else if(o=="MultiPoint"){Lt(n,e,r)}else if(o=="MultiLineString"){Ct(n,e,r)}else if(o=="MultiPolygon"){parseMultiPolygon(n,e,r)}else if(o=="GeometryCollection"){Nt(n,e,r)}}else if(a=="FeatureCollection"){}i.add(r);return r};this.findFeature=function(t){for(var e=0;e<B.children.length;e++){var i=B.children[e];for(var n=0;n<i.children.length;n++){var r=i.children[n];if(r.userData.fid==t)return r}}};this.getFeature=function(t){var e=t;return e.userData};this.setFeature=function(t,e){var i=t;i.children=[];var n=i.parent;var r=n.userData;i.userData=e;var a=e.type;if(a=="Feature"){var o=e.geometry.type;if(o=="Point"){At(n,e,i)}else if(o=="LineString"){Pt(r,e,i)}else if(o=="Polygon"){It(r,e,i)}else if(o=="MultiPoint"){Lt(r,e,i)}else if(o=="MultiLineString"){Ct(r,e,i)}else if(o=="MultiPolygon"){parseMultiPolygon(r,e,i)}else if(o=="GeometryCollection"){Nt(r,e,i)}}else if(a=="FeatureCollection"){}if(Et==i){Bt(Et)}return i};this.removeFeature=function(t){var e=t;e.parent.remove(e)};this.removeAllFeatures=function(t){var e=t;e.children=[]};this.selectFeature=function(t){var e=t;if(Et!=e){if(Et)Et.children[0].material.color.setHex(Et.children[0].currentHex);Et=e;Et.children[0].currentHex=Et.children[0].material.color.getHex();Et.children[0].material.color.setHex(16711680)}};this.visible=function(t,e){t.visible=e};this.onLocate=function(t){};this.onPosition=function(t){};this.onEye=function(t){};this.onFeatureCreate=function(t){};this.onFeatureSelect=function(t){};this.onFeatureRemove=function(t){};this.onMeasure=function(t){};this.onTool=function(t){};this.onRender=function(t){};function zt(t){if(Tt.magnifier.fix){var e={x:Mt.x-Tt.magnifier.size*.5,y:Mt.y-Tt.magnifier.size*.5,w:Tt.magnifier.size,h:Tt.magnifier.size};var i=new THREE.Vector2;i.x=(t.x-e.x)/e.w*2-1;i.y=(t.y-e.y)/e.h*2-1;return i}else{var r=new THREE.Vector2(Mt.x+(t.x-Mt.x)/Tt.magnifier.zoom,Mt.y+(t.y-Mt.y)/Tt.magnifier.zoom);var a=new THREE.Vector2;r.x=r.x/n.clientWidth*2-1;r.y=r.y/n.clientHeight*2-1;return r}}function Ut(t){xt.x=t.offsetX/n.clientWidth*2-1;xt.y=-(t.offsetY/n.clientHeight)*2+1}function Dt(t,e,i,n){var r=1/Math.tan(e/2)/i;r=r*n/2;return t*r}function Ot(t){switch(c){case SampleMode.photo:return Ht(t);case SampleMode.ground:return Ft(t)}}function Ht(t){if(S.visible){yt.setFromCamera(_t,S)}else{yt.setFromCamera(t,T)}var e=yt.ray;if(U.children.length==0){var i=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0)];var n=new THREE.Vector3;n.copy(e.direction);n.setLength(100);i[0].copy(T.position);i[1].copy(T.position).add(n);var r=new THREE.LineBasicMaterial({color:16777215,opacity:1,linewidth:3,vertexColors:THREE.VertexColors});var a=new THREE.Geometry;a.vertices=i;a.colors.push(new THREE.Color(65280),new THREE.Color(16711680));var o=new THREE.Line(a,r);U.add(o);var s=Rt(-1);St(s);return null}else{var h=U.children[0].geometry;var c=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0)];var l=e.distanceSqToSegment(h.vertices[0],h.vertices[1],c[0],c[1]);var u=c[0].lerp(c[1],.5);U.children=[];var s=Rt(1);St(s);return u}}function Ft(t){if(S.visible){yt.setFromCamera(_t,S)}else{yt.setFromCamera(t,T)}var e=yt.ray;var i=new THREE.Plane(new THREE.Vector3(0,0,-1),T.position.z+m);var n=e.intersectPlane(i);return n}function Bt(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.material){i.currentHex=i.material.color.getHex();i.material.color.setHex(16711680)}Bt(i)}}function kt(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];if(i.material){i.material.color.setHex(i.currentHex)}kt(i)}}function Gt(t,i){if(S.visible){yt.setFromCamera(_t,S)}else{yt.setFromCamera(t,T)}var n=yt.intersectObject(B,true);if(n.length>0){var r=n[0].object;while(!r.userData.geometry){r=r.parent}if(Et!=r){if(Et){kt(Et)}Et=r;Bt(Et);var i={layer:r.parent,feature:r,layername:r.parent.name,fid:r.userData.fid};e.onFeatureSelect(i)}}else{if(Et){kt(Et)}Et=null}}function Vt(t,i){switch(i.button){case 0:{Gt(t,i)}break;case 1:{}break;case 2:{if(Et){var n=Et;var i={layer:n.parent,feature:n,layername:n.parent.name,fid:n.userData.fid};e.onFeatureRemove(i);if(i.cancel)return;e.removeFeature(n);Et=null}}break}}function jt(t,i){var n=Ot(t);if(n==null)return;var r=[n.x+V.x,n.y+V.y];var a=G.inverse(r);a[2]=n.z+V.z;var o={type:"Feature",geometry:{type:"Point",coordinates:a}};ie();e.onFeatureCreate(o)}function Wt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.push(n);var o=new THREE.Line(a,r);z.children=[];z.add(o)}var s=new THREE.Mesh(Z,Q);s.position.copy(n);D.add(s)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.pop();var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop()}}break;case 2:{if(z.children.length==0)return;var a=z.children[0].geometry;if(a.vertices.length<2)return;var h=[];for(var c=0;c<a.vertices.length;c++){var l=a.vertices[c];var u=[l.x+V.x,l.y+V.y];var p=G.inverse(u);p[2]=l.z+V.z;h[c]=p}var d={type:"Feature",geometry:{type:"LineString",coordinates:h}};ie();e.onFeatureCreate(d)}break}}function qt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);a.vertices.push(a.vertices[0]);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.pop();a.vertices.push(n);a.vertices.push(a.vertices[0]);var o=new THREE.Line(a,r);z.children=[];z.add(o)}var s=new THREE.Mesh(Z,Q);s.position.copy(n);D.add(s)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.pop();a.vertices.pop();a.vertices.push(a.vertices[0]);var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop()}}break;case 2:{if(z.children.length==0)return;var a=z.children[0].geometry;if(a.vertices.length<2)return;var h=[];for(var c=0;c<a.vertices.length;c++){var l=a.vertices[c];var u=[l.x+V.x,l.y+V.y];var p=G.inverse(u);p[2]=l.z+V.z;h[c]=p}var d={type:"Feature",geometry:{type:"Polygon",coordinates:[h]}};ie();e.onFeatureCreate(d)}break}}function Xt(t,i){var n=Ot(t,i);if(n==null)return;var r=[n.x+V.x,n.y+V.y,n.z+V.z];var a=G.inverse(r);var o="lon "+a[0].toFixed(8)+" lat "+a[1].toFixed(8)+" alt "+r[2].toFixed(2)+" m";var s=new TextSprite({text:o,offset:[0,Tt.label.fontsize*1.2],style:Tt.label});s.position.copy(n);ee();H.add(s);var h=new THREE.Mesh(Z,Q);h.position.copy(n);D.children=[];D.add(h);var i={lonlat:[a[0],a[1],n.z+V.z]};e.onMeasure(i)}function Yt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.push(n);var o=new THREE.Line(a,r);z.children=[];z.add(o);if(a.vertices.length>1){var s=0;for(var h=1;h<a.vertices.length;h++){var c=a.vertices[h-1];var l=a.vertices[h];s+=c.distanceTo(l)}var u=s.toFixed(2)+" m";var p=new TextSprite({text:u,style:Tt.label});a.computeBoundingBox();var d=a.boundingBox.getCenter();p.position.copy(d);ee();H.add(p);var i={length:s};e.onMeasure(i)}else{ee()}}var f=new THREE.Mesh(Z,Q);f.position.copy(n);D.add(f)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.pop();var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop();if(a.vertices.length>1){var s=0;for(var h=1;h<a.vertices.length;h++){var c=a.vertices[h-1];var l=a.vertices[h];s+=c.distanceTo(l)}var u=s.toFixed(2)+" m";var p=new TextSprite({text:u,style:Tt.label});a.computeBoundingBox();var d=a.boundingBox.getCenter();p.position.copy(d);ee();H.add(p);var i={length:s};e.onMeasure(i)}else{ee()}}}break;case 2:{}break}}function Zt(t,e,i,n){var r=new THREE.Vector3(0,0,0);var a=new THREE.Vector3(0,0,0);if(i){r.z=1}else{var o=[Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)];if(o[0]<o[1]){if(o[0]<o[2])r.x=1;else r.z=1}else{if(o[1]<o[2])r.y=1;else r.z=1}}a.crossVectors(t,r).normalize();r.crossVectors(a,t).normalize();var s=new THREE.Matrix4;if(n!=null){if(n=="z"||n=="xy")s.makeBasis(r,a,t);else if(n=="y"||n=="xz")s.makeBasis(a,t,r);else if(n=="x"||n=="yz")s.makeBasis(t,r,a)}else{s.makeBasis(a,t,r)}var h=new THREE.Quaternion;h.setFromRotationMatrix(s);if(e!=null){var c=new THREE.Matrix4;c.getInverse(s);e.setFromRotationMatrix(c)}return h}function Qt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);if(a.vertices.length<2){a.vertices.push(n)}else if(a.vertices.length==2){a.vertices.push(n);a.vertices.push(a.vertices[0])}else{a.vertices.pop();a.vertices.push(n);a.vertices.push(a.vertices[0])}var o=new THREE.Line(a,r);z.children=[];z.add(o);var s=a.vertices.length;if(s>3){var h=a.vertices[0];var c=a.vertices[1];var l=a.vertices[2];var u=new THREE.Vector3;var p=new THREE.Vector3;var d=new THREE.Vector3;u.subVectors(c,h).normalize();p.subVectors(l,h).normalize();d.crossVectors(u,p).normalize();var f=new THREE.Plane;f.setFromNormalAndCoplanarPoint(d,h);var m=new THREE.Quaternion;var v=Zt(d,m,null,"z");var g=[];for(var y=0;y<a.vertices.length;y++){var x=new THREE.Vector3;x.copy(a.vertices[y]);x.sub(h);x.applyQuaternion(m);g.push(new THREE.Vector2(x.x,x.y))}var b=Math.abs(THREE.ShapeUtils.area(g));var M=b.toFixed(2)+" m";a.computeBoundingBox();var _=a.boundingBox.getCenter();var w=new TextSprite({text:M,style:Tt.label});w.position.copy(_);ee();H.add(w);var i={area:b};e.onMeasure(i)}}var E=new THREE.Mesh(Z,Q);E.position.copy(n);D.add(E)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);if(a.vertices.length>4){a.vertices.pop();a.vertices.pop();a.vertices.push(a.vertices[0])}else if(a.vertices.length>3){a.vertices.pop();a.vertices.pop()}else{a.vertices.pop()}var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop();if(a.vertices.length>3){var h=a.vertices[0];var c=a.vertices[1];var l=a.vertices[2];var u=new THREE.Vector3;var p=new THREE.Vector3;var d=new THREE.Vector3;u.subVectors(c,h);u.normalize();p.subVectors(l,h);p.normalize();d.crossVectors(u,p);d.normalize();var f=new THREE.Plane;f.setFromNormalAndCoplanarPoint(d,h);var m=new THREE.Quaternion;var v=Zt(d,m,null,"z");var g=[];for(var y=0;y<a.vertices.length;y++){var x=new THREE.Vector3;x.copy(a.vertices[y]);x.sub(h);x.applyQuaternion(m);g.push(new THREE.Vector2(x.x,x.y))}var T=new THREE.Shape(g);var S=new THREE.ShapeBufferGeometry(T);var r=new THREE.MeshBasicMaterial({color:65535,transparent:true,opacity:.5,side:THREE.DoubleSide});var R=new THREE.Mesh(S,r);R.position.copy(h);R.quaternion.copy(v);o.add(R);var b=Math.abs(THREE.ShapeUtils.area(g));var M=b.toFixed(2)+" m";a.computeBoundingBox();var _=a.boundingBox.getCenter();var w=new TextSprite({text:M,style:Tt.label});w.position.copy(_);ee();H.add(w);var i={area:b};e.onMeasure(i)}else{ee()}}}break;case 2:{}break}}function Jt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o);var s=new THREE.Mesh(Z,Q);s.position.copy(n);D.add(s)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;var h=z.children[0].geometry.vertices[0];var c;var l;if(h.z>n.z){c=h;l=n}else{c=n;l=h}var u=new THREE.Vector3(c.x,c.y,l.z);a.vertices.push(c);a.vertices.push(l);a.vertices.push(u);a.vertices.push(c);var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children=[];{var s=new THREE.Mesh(Z,Q);s.position.copy(c);D.add(s)}{var s=new THREE.Mesh(Z,Q);s.position.copy(l);D.add(s)}ee();var i={};{var p=c.distanceTo(l);var d=p.toFixed(2)+" m";i.length=p;var f=new TextSprite({text:d,style:Tt.label});f.position.copy(c);H.add(f)}{var p=l.distanceTo(u);var d=p.toFixed(2)+" m";i.lengthXY=p;var f=new TextSprite({text:d,style:Tt.label});var m=new THREE.Vector3;m.lerpVectors(l,u,.5);f.position.copy(m);H.add(f)}{var p=c.distanceTo(u);var d=p.toFixed(2)+" m";i.lengthZ=p;var f=new TextSprite({text:d,style:Tt.label});var m=new THREE.Vector3;m.lerpVectors(c,u,.5);f.position.copy(m);H.add(f)}e.onMeasure(i)}}break;case 1:{if(z.children.length>0){z.children=[];D.children=[];ee()}}break;case 2:{}break}}function Kt(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o);var s=new THREE.Mesh(Z,Q);s.position.copy(n);D.add(s)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;var h=z.children[0].geometry.vertices[0];var c=n;var l=new THREE.Vector3(h.x,h.y,c.z);var u=new THREE.Vector3(c.x,c.y,h.z);a.vertices.push(h);a.vertices.push(l);a.vertices.push(c);a.vertices.push(u);a.vertices.push(h);var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children=[];{var s=new THREE.Mesh(Z,Q);s.position.copy(h);D.add(s)}{var s=new THREE.Mesh(Z,Q);s.position.copy(c);D.add(s)}ee();var i={};{var p=h.distanceTo(l);var d=p.toFixed(2)+" m";i.height=p;var f=new TextSprite({text:d,style:Tt.label});var m=new THREE.Vector3;m.lerpVectors(h,l,.5);f.position.copy(m);H.add(f)}{var p=h.distanceTo(u);var d=p.toFixed(2)+" m";i.width=p;var f=new TextSprite({text:d,style:Tt.label});var m=new THREE.Vector3;m.lerpVectors(h,u,.5);f.position.copy(m);H.add(f)}{var v=h;var g=new THREE.Vector3;var y=new THREE.Vector3;var x=new THREE.Vector3;g.subVectors(u,h);g.normalize();y.subVectors(l,h);y.normalize();x.crossVectors(g,y);x.normalize();var b=new THREE.Plane;b.setFromNormalAndCoplanarPoint(x,h);var M=new THREE.Quaternion;var _=Zt(x,M,null,"z");var w=[];for(var E=0;E<a.vertices.length;E++){var T=new THREE.Vector3;T.copy(a.vertices[E]);T.sub(v);T.applyQuaternion(M);w.push(new THREE.Vector2(T.x,T.y))}var S=new THREE.Shape(w);var R=new THREE.ShapeBufferGeometry(S);var r=new THREE.MeshBasicMaterial({color:65535,transparent:true,opacity:.5,side:THREE.DoubleSide});var A=new THREE.Mesh(R,r);A.position.copy(v);A.quaternion.copy(_);o.add(A);var L=Math.abs(THREE.ShapeUtils.area(w));var P=L.toFixed(2)+" m";i.area=L;var f=new TextSprite({text:P,style:Tt.label});var m=new THREE.Vector3;m.lerpVectors(h,c,.5);f.position.copy(m);H.add(f)}e.onMeasure(i)}}break;case 1:{if(z.children.length>0){z.children=[];D.children=[];ee()}}break;case 2:{}break}}function $t(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;if(z.children[0].geometry.vertices.length==3)D.children=[];else a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.push(n);var o=new THREE.Line(a,r);z.children=[];z.add(o);if(a.vertices.length==3){var s=a.vertices[0];var h=a.vertices[1];var c=a.vertices[2];var l=new THREE.Vector3;var u=new THREE.Vector3;l.subVectors(s,h);u.subVectors(c,h);var p=l.angleTo(u)*180/Math.PI;var d=p.toFixed(2)+"";var f=new TextSprite({text:d,style:Tt.label});a.computeBoundingBox();var m=a.boundingBox.getCenter();f.position.copy(m);ee();H.add(f);var i={angle:p};e.onMeasure(i)}else{ee()}}var v=new THREE.Mesh(Z,Q);v.position.copy(n);D.add(v)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);a.vertices.pop();var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop();ee()}}break;case 2:{}break}}function te(t,i){switch(i.button){case 0:{var n=Ot(t);if(n==null)return;if(z.children.length==0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices.push(n);var o=new THREE.Line(a,r);z.add(o)}else{var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;if(z.children[0].geometry.vertices.length==4)D.children=[];else a.vertices=z.children[0].geometry.vertices.slice(0);if(a.vertices.length<2){a.vertices.push(n)}else if(a.vertices.length==2){a.vertices.push(n);a.vertices.push(a.vertices[0])}else{a.vertices.pop();a.vertices.push(n);a.vertices.push(a.vertices[0])}var o=new THREE.Line(a,r);z.children=[];z.add(o);if(a.vertices.length==4){var s=a.vertices[0];var h=a.vertices[1];var c=a.vertices[2];var l=new THREE.Vector3;var u=new THREE.Vector3;var p=new THREE.Vector3;l.subVectors(h,s);l.normalize();u.subVectors(c,s);u.normalize();p.crossVectors(l,u);p.normalize();var d=new THREE.Plane;d.setFromNormalAndCoplanarPoint(p,s);var f=new THREE.Quaternion;var m=Zt(p,f,null,"z");var v=[];for(var g=0;g<a.vertices.length;g++){var y=new THREE.Vector3;y.copy(a.vertices[g]);y.sub(s);y.applyQuaternion(f);v.push(new THREE.Vector2(y.x,y.y))}var x=new THREE.Shape(v);var b=new THREE.ShapeBufferGeometry(x);var r=new THREE.MeshBasicMaterial({color:65535,transparent:true,opacity:.5,side:THREE.DoubleSide});var M=new THREE.Mesh(b,r);M.position.copy(s);M.quaternion.copy(m);o.add(M);var _=new THREE.Vector3(0,0,1);var w=p.angleTo(_)*180/Math.PI;var E=w.toFixed(2)+"";var T=new TextSprite({text:E,style:Tt.label});a.computeBoundingBox();var S=a.boundingBox.getCenter();T.position.copy(S);ee();H.add(T);var i={slope:w};e.onMeasure(i)}else{ee()}}var R=new THREE.Mesh(Z,Q);R.position.copy(n);D.add(R)}break;case 1:{if(z.children.length>0){var r=new THREE.LineBasicMaterial({color:16711935,opacity:1,linewidth:3});var a=new THREE.Geometry;a.vertices=z.children[0].geometry.vertices.slice(0);if(a.vertices.length>4){a.vertices.pop();a.vertices.pop();a.vertices.push(a.vertices[0])}else if(a.vertices.length>3){a.vertices.pop();a.vertices.pop()}else{a.vertices.pop()}var o=new THREE.Line(a,r);z.children=[];z.add(o);D.children.pop();ee()}}break;case 2:{}break}}function ee(){H.children=[]}function ie(){z.children=[];U.children=[];D.children=[];O.children=[];ee();if(Et){kt(Et)}Et=null;Be()}function ne(t,e,i,n,r,a,o,s){var h=new THREE.MeshBasicMaterial({color:16777215,transparent:true,alphaTest:.1,side:THREE.DoubleSide,shading:THREE.SmoothShading});if(r==null){h.map=new THREE.Texture}else if(r instanceof String){h.map=E.load(r)}else if(r instanceof THREE.Texture){h.map=r}rt(h.map);if(n!=null){h.color.setHex(n)}var c=new THREE.Mesh(e,h);c.currentHex=h.color.getHex();if(i!=null)c.name=i;if(o!=null)c.rotation.copy(o);if(s!=null)c.scale.copy(s);if(a!=null)c.position.copy(a);t.add(c);return c}function re(t,e,i){var n=E.load(i);n.minFilter=THREE.LinearFilter;n.magFilter=THREE.LinearFilter;n.generateMipmaps=false;n.mapping=THREE.UVMapping;var r=new THREE.MeshBasicMaterial({color:16777215,map:n});r.transparent=true;var a=new THREE.Mesh(e,r);t.add(a);return a}function ae(t){ie();h=t;console.debug("cur_tool: %d",h);var i={tool:t};e.onTool(i)}function oe(t){t.stopPropagation();ae(Tool.measurePoint)}function se(t){t.stopPropagation();ae(Tool.measureLength)}function he(t){t.stopPropagation();ae(Tool.measureArea)}function ce(t){t.stopPropagation();ae(Tool.measureZ)}function le(t){t.stopPropagation();ae(Tool.measureFacade)}function ue(t){t.stopPropagation();ae(Tool.measureAngle)}function pe(t){t.stopPropagation();ae(Tool.measureSlope)}function de(t){t.stopPropagation();ae(Tool.createPoint)}function fe(t){t.stopPropagation();ae(Tool.createPolyline)}function me(t){t.stopPropagation();ae(Tool.createPolygon)}function ve(t){t.stopPropagation();ae(Tool.pick)}function ge(t){t.stopPropagation();ae(Tool.remove)}function ye(t){t.stopPropagation()}function xe(){var t=document.createElement("div");t.setAttribute("class","ppv_toolbar");n.appendChild(t);var e=document.createElement("img");e.setAttribute("src","icon/.png");e.setAttribute("title","");e.setAttribute("class","ppv_button");e.addEventListener("mousedown",oe,false);t.appendChild(e);var i=document.createElement("img");i.setAttribute("src","icon/.png");i.setAttribute("title","");i.setAttribute("class","ppv_button");i.addEventListener("mousedown",se,false);t.appendChild(i);var r=document.createElement("img");r.setAttribute("src","icon/.png");r.setAttribute("title","");r.setAttribute("class","ppv_button");r.addEventListener("mousedown",he,false);t.appendChild(r);var a=document.createElement("img");a.setAttribute("src","icon/.png");a.setAttribute("title","");a.setAttribute("class","ppv_button");a.addEventListener("mousedown",ce,false);t.appendChild(a);var o=document.createElement("img");o.setAttribute("src","icon/.png");o.setAttribute("title","");o.setAttribute("class","ppv_button");o.addEventListener("mousedown",le,false);t.appendChild(o);var s=document.createElement("img");s.setAttribute("src","icon/.png");s.setAttribute("title","");s.setAttribute("class","ppv_button");s.addEventListener("mousedown",he,false);t.appendChild(s);var h=document.createElement("img");h.setAttribute("src","icon/.png");h.setAttribute("title","");h.setAttribute("class","ppv_button");h.addEventListener("mousedown",pe,false);t.appendChild(h);var c=document.createElement("img");c.setAttribute("src","icon/.png");c.setAttribute("title","");c.setAttribute("class","ppv_button");c.addEventListener("mousedown",de,false);t.appendChild(c);var l=document.createElement("img");l.setAttribute("src","icon/.png");l.setAttribute("title","");l.setAttribute("class","ppv_button");l.addEventListener("mousedown",fe,false);t.appendChild(l);var u=document.createElement("img");u.setAttribute("src","icon/.png");u.setAttribute("title","");u.setAttribute("class","ppv_button");u.addEventListener("mousedown",me,false);t.appendChild(u);var p=document.createElement("img");p.setAttribute("src","icon/.png");p.setAttribute("title","");p.setAttribute("class","ppv_button");p.addEventListener("mousedown",ve,false);t.appendChild(p);var d=document.createElement("img");d.setAttribute("src","icon/.png");d.setAttribute("title","");d.setAttribute("class","ppv_button");d.addEventListener("mousedown",ge,false);t.appendChild(d);var f=document.createElement("img");f.setAttribute("src","icon/LRS.png");f.setAttribute("title","");f.setAttribute("class","ppv_button");f.addEventListener("mousedown",ye,false);t.appendChild(f)}function be(){E.crossOrigin="anonymous";R=new THREE.Scene;T=new THREE.PerspectiveCamera(45,1,.1,1e4);S=new THREE.PerspectiveCamera(45,1,.1,1e4);S.visible=false;T.position.set(0,0,0);var t=T.position;T.up.set(0,1,0);T.lookAt(new THREE.Vector3(t.x+0,t.y+1,t.z+0));R.add(T);control=new RotControl(T,n);control.onRot=function(t){ke();e.onEye(t);if(d!=null){var i=T.getWorldDirection();var n=Math.atan2(i.x,i.y);var r=0;switch(o){case-1:r=-d.cur.heading;break;case 0:r=-d.Currentframe.Heading;break;case 3:r=d.Currentframe.Yaw*Math.PI/180;break;case 4:r=d.Currentframe.Heading*Math.PI/180;break}f=r-n}};var r=[];r[0]=new THREE.DirectionalLight(16777215,.8);r[1]=new THREE.DirectionalLight(16777215,.8);r[2]=new THREE.DirectionalLight(16777215,.8);r[3]=new THREE.AmbientLight(16777215,.8);r[4]=new THREE.PointLight(16777215,.8);r[0].position.set(-1,1,1);r[1].position.set(0,1,1);r[2].position.set(0,-1,1);T.add(r[0]);T.add(r[1]);R.add(r[3]);R.add(C);R.add(L);L.add(B);R.add(P);P.add(I);P.add(N);P.add(z);P.add(U);P.add(D);P.add(O);P.add(H);P.add(F);g=Tt.scope/b;var t=new THREE.Vector3(0,b*g,0);var a=new THREE.Euler(Math.PI/2,0,0);var s=new THREE.Vector3(y*g,x*g,1);q=ne(W,Y,"camgroup",16777215,null,t,a,s);C.add(W);X=new THREE.Mesh(J,K);K.map=new THREE.Texture;X.scale.set(-Tt.scope,Tt.scope,Tt.scope);var h=new THREE.Vector3(0,-1,0);X.up.set(0,0,1);X.lookAt(h);A=new THREE.WebGLRenderer({alpha:true,antialias:true});A.setClearColor(Tt.bgcolor,0);A.setPixelRatio(window.devicePixelRatio);n.appendChild(A.domElement);i.bind("contextmenu",Le);i.bind("touchstart",Pe);i.bind("mousedown",ze);i.bind("mouseup",Ue);i.bind("mousemove",De);i.bind("mousewheel",Oe);$(window).bind("keydown",Ae);Me()}function Me(){requestAnimationFrame(Me);_e()}function _e(){Ee();{var t=T.position.distanceTo(nt.getWorldPosition());var i=Dt(1,T.fov*Math.PI/180,t,A.domElement.clientHeight);var n=nt.style.fontsize/i;nt.scale.set(n,n,n)}for(var r=0;r<H.children.length;r++){var a=H.children[r];{var t=T.position.distanceTo(a.getWorldPosition());var i=Dt(1,T.fov*Math.PI/180,t,A.domElement.clientHeight);var n=a.style.fontsize/i;a.scale.set(n,n,n)}}for(var r=0;r<D.children.length;r++){var a=D.children[r];var t=T.position.distanceTo(a.getWorldPosition());var i=Dt(1,T.fov*Math.PI/180,t,A.domElement.clientHeight);var n=5/i;a.scale.set(n,n,n)}for(var r=0;r<B.children.length;r++){var o=B.children[r];var s=o.userData;if(s.fixSize)continue;for(var h=0;h<o.children.length;h++){var c=o.children[h];c.visible=true;for(var l=0;l<c.children.length;l++){var a=c.children[l];if(a instanceof TextSprite){var t=T.position.distanceTo(a.getWorldPosition());var i=Dt(1,T.fov*Math.PI/180,t,A.domElement.clientHeight);var n=s.fontSize/i;a.scale.set(n,n,n)}else if(a instanceof THREE.Sprite){var t=T.position.distanceTo(a.getWorldPosition());if(t>Tt.scope){c.visible=false;break}var i=Dt(1,T.fov*Math.PI/180,t,A.domElement.clientHeight);var n=s.size/i;a.scale.set(n,n,n)}}}}if(u){I.visible=false;N.visible=false}else{I.visible=Tt.enableArrow;N.visible=Tt.enableHistory}var p=A.getSize();var d=A.userData;A.setViewport(0,0,p.width,p.height);A.setScissor(d.left,d.top,d.width,d.height);A.setScissorTest(true);A.render(R,T);var f={canvas:A.domElement};e.onRender(f);if(S.visible){D.visibleTemp=D.visible;z.visibleTemp=z.visible;I.visibleTemp=I.visible;N.visibleTemp=N.visible;F.visibleTemp=F.visible;D.visible=false;z.visible=false;I.visible=false;N.visible=false;F.visible=false;var m=Tt.magnifier.size/2;if(Tt.magnifier.fix){A.setViewport(Mt.x-m,Mt.y-m,Tt.magnifier.size,Tt.magnifier.size);A.setScissor(Mt.x-m,Mt.y-m,Tt.magnifier.size,Tt.magnifier.size)}else{A.setViewport(bt.x-m,bt.y-m,Tt.magnifier.size,Tt.magnifier.size);A.setScissor(bt.x-m,bt.y-m,Tt.magnifier.size,Tt.magnifier.size)}A.setScissorTest(true);A.render(R,S);D.visible=D.visibleTemp;z.visible=z.visibleTemp;I.visible=I.visibleTemp;N.visible=N.visibleTemp;F.visible=F.visibleTemp}}function we(){if(W.children.length>0&&W.children[0]==X)return true;else return false}function Ee(){var t=Re();var e=n.clientWidth;var i=n.clientHeight;var r=e/i;var a={top:0,left:0,width:e,height:i};A.userData=a;T.aspect=r;if(we()){}else{var o=x;switch(Tt.fullView){case FullMode.fill:{if(r>M){}else{o=y/r}T.aspect=r}break;case FullMode.trans:{if(r>M){a.left=(e-i*M)/2;a.width=i*M}else{a.top=(i-e/M)/2;a.height=e/M;o=y/r}}break;case FullMode.clip:{if(r>M){o=y/r}}break;case FullMode.stretch:{T.aspect=M}break}var s=2*Math.atan(o/2/b)*180/Math.PI;T.fov=s}T.updateProjectionMatrix();if(S.visible){S.fov=T.fov*Tt.magnifier.size/i/Tt.magnifier.zoom;S.updateProjectionMatrix()}A.setSize(e,i)}function Te(t){if(t.requestFullscreen){t.requestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullscreen){t.webkitRequestFullscreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}}function Se(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}function Re(){var t=document.mozFullScreen;var e=document.webkitIsFullScreen;var i=document.fullscreen;var n=document.msFullscreen;return t||e||i||n}function Ae(t){switch(t.keyCode){case 27:{ae(Tool.none)}break;case Tt.key.del:if(Et){var i=Et;var t={layer:i.parent,feature:i,layername:i.parent.name,fid:i.userData.fid};e.onFeatureRemove(t);if(t.cancel)return;e.removeFeature(i);Et=null}break;case Tt.key.play:{if(l)e.stop();else e.play()}break;case Tt.key.fforward:{e.step(10)}break;case Tt.key.fbackward:{e.step(-10)}break;case Tt.key.forward:{e.step(1)}break;case Tt.key.backward:{e.step(-1)}break;case Tt.key.fullscreen:{if(Re())Se();else Te(n)}break}}function Le(t){t.preventDefault()}function Pe(t){t.preventDefault();if(t.touches.length==1)Ue(t.touches[0])}var Ce=false;var Ie=false;var Ne={x:0,y:0};function ze(t){t.preventDefault();Ut(t);control.enabled=we();Ce=true;Ie=false;Ne.x=t.offsetX;Ne.y=t.offsetY}function Ue(t){t.preventDefault();Ut(t);Ie=false;if(!Ce)return;yt.setFromCamera(xt,T);var e=yt.intersectObject(I,true);if(e.length>0){if(e[0].object.name=="history"){Fe(e[0].object.userData)}else{var i=e[0].object.name;St(i)}}else{console.debug("onPPVisionMouseUp cur_tool: %d",h);switch(h){case Tool.none:He(xt,t);break;case Tool.measurePoint:Xt(xt,t);break;case Tool.measureLength:Yt(xt,t);break;case Tool.measureArea:Qt(xt,t);break;case Tool.measureZ:Jt(xt,t);break;case Tool.measureFacade:Kt(xt,t);break;case Tool.measureAngle:$t(xt,t);break;case Tool.measureSlope:te(xt,t);break;case Tool.createPoint:jt(xt,t);break;case Tool.createPolyline:Wt(xt,t);break;case Tool.createPolygon:qt(xt,t);break;case Tool.pick:Gt(xt,t);break;case Tool.remove:Vt(xt,t);break}}}function De(t){t.preventDefault();Ut(t);if(t.buttons>0){if(!Ie){var e=t.offsetX-Ne.x;var i=t.offsetY-Ne.y;if(Math.abs(e)>3||Math.abs(i)>3){Ie=true;Ce=false}}}F.visible=false;bt.x=t.offsetX;bt.y=n.clientHeight-t.offsetY;if(t.ctrlKey){if(!S.visible){S.visible=true;Mt.copy(bt);if(Tt.magnifier.fix){yt.setFromCamera(xt,T);var r=yt.ray;S.position.set(0,0,0);S.up.copy(T.up);S.lookAt(r.direction);S.position.copy(T.position)}}if(Tt.magnifier.fix){_t=zt(bt)}else{_t.set(0,0);var a=zt(bt);yt.setFromCamera(a,T);var r=yt.ray;S.position.set(0,0,0);S.up.copy(T.up);S.lookAt(r.direction);S.position.copy(T.position)}return}else{S.visible=false}yt.setFromCamera(xt,T);var o=yt.intersectObject(I,true);if(o.length>0){if(wt!=o[0].object){if(wt)wt.material.color.setHex(wt.currentHex);wt=o[0].object;wt.currentHex=wt.material.color.getHex();wt.material.color.setHex(16711680)}return}else{if(wt)wt.material.color.setHex(wt.currentHex);wt=null}if(h==Tool.none){var s=Ft(xt);if(s==null){F.visible=false}else{var c=s.distanceTo(T.position);var l=c;if(l>5&&l<100){F.visible=true;F.position.copy(s);if(c>0)nt.setText(" "+l.toFixed(0)+"m");else nt.setText(" "+l.toFixed(0)+"m")}else{F.visible=false}}}}function Oe(t){t.preventDefault();if(we()){if(t.deltaY>0&&T.fov>5){T.fov*=.8;T.updateProjectionMatrix()}else if(t.deltaY<0&&T.fov<90){T.fov*=1.2;T.updateProjectionMatrix()}}else{if(t.deltaY>0){e.step(1)}else{e.step(-1)}}}function He(t,i){if(!F.visible)return;var n=[F.position.x+V.x,F.position.y+V.y,F.position.z+V.z];var a=G.inverse(n);e.locate(o,a[0],a[1],r)}function Fe(t){var e=Be();if(e==null)return;var i=document.createElement("div");e.appendChild(i);i.id="history";i.className="history";for(var n=0;n<t.length;n++){var r=t[n];var a=document.createElement("img");a.id="history_item_"+n;a.className="history_item";a.setAttribute("src",r.thumb);a.setAttribute("title",r.date);a.userData=r;a.thumbError=false;a.addEventListener("error",function(){if(!this.thumbError){this.thumbError=true;this.src=this.userData.img}else{this.src=mt}},false);a.addEventListener("click",function(){St(this.userData.id)},false);i.appendChild(a)}}function Be(){var t=document.getElementById("history_container");if(t!=null){var e=document.getElementById("history");if(e!=null){t.removeChild(e)}}return t}function ke(){var t=T.position;var e=T.getWorldDirection();var i=new THREE.Vector3(0,0,1);var n=new THREE.Vector3;n.crossVectors(e,i);n.normalize();e.setLength(Tt.arrows.forward);I.position.set(0,0,-Tt.arrows.below);I.position.add(t);I.position.add(e);I.quaternion.setFromAxisAngle(n,Math.PI/Tt.arrows.lean)}function Ge(t,i){var n=t.cur;var r;if(i){ie();var a="+proj=tmerc +lat_0="+n.lat+" +lon_0="+n.lon+" +k=1.000000 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs ";G=proj4(a);r=G.forward([n.lon,n.lat]);V.x=r[0];V.y=r[1];V.z=n.alt;e.needsUpdate=true}else{r=G.forward([n.lon,n.lat])}j.set(r[0],r[1],n.alt);j.sub(V);var o=new THREE.Euler(n.pitch,n.roll,n.yaw,"ZXY");W.position.copy(j);W.rotation.copy(o);if(we()){var s=T.getWorldDirection();var h=Math.atan2(s.x,s.y);var c=-n.heading;var d=c-h;if(f!=null){var m=f-d;var v=new THREE.Euler(0,0,m);var g=new THREE.Quaternion;g.setFromEuler(v);T.quaternion.premultiply(g)}}else{var y=new THREE.Vector3(0,1,0);var x=new THREE.Vector3(0,0,1);y.applyEuler(o);x.applyEuler(o);T.position.set(0,0,0);T.up.copy(x);T.lookAt(y)}T.position.copy(j);ke();I.children=[];var b={lon:n.lon,lat:n.lat,alt:n.alt};if(t.history!=null&&t.history.length>0){if(t.next==null){t.next=t.history.shift()}else if(t.prev==null){t.prev=t.history.shift()}}var M=.01;var _=new THREE.Vector3(0,1,0);var E=t.next;if(E!=null){var y=G.forward([E.lon,E.lat]);var s=new THREE.Vector3(y[0]-r[0],y[1]-r[1],0).normalize();var S=Math.atan2(s.x,s.y);var c=S*180/Math.PI;var R=new THREE.Group;I.add(R);R.rotation.set(0,0,-S);var A=ne(R,Y,E.id,16772846,ft(c));A.position.copy(_);_.z+=.01;b.next={id:E.id,heading:c}}var E=t.prev;if(E!=null){var y=G.forward([E.lon,E.lat]);var s=new THREE.Vector3(y[0]-r[0],y[1]-r[1],0).normalize();var S=Math.atan2(s.x,s.y);var c=S*180/Math.PI;var R=new THREE.Group;I.add(R);R.rotation.set(0,0,-S);var A=ne(R,Y,E.id,15663086,ft(c));A.position.copy(_);_.z+=.01;b.prev={id:E.id,heading:c}}if(t.branch!=null){b.branch=[];for(var L=0;L<t.branch.length;L++){var E=t.branch[L];if(E!=null){var S=-E.heading;var c=S*180/Math.PI;var P=Math.abs(n.heading-E.heading)*180/Math.PI;while(P>360){P-=360}if(P>150){b.back={id:E.id,heading:c};continue}var R=new THREE.Group;I.add(R);R.rotation.set(0,0,-S);var A=ne(R,Y,E.id,15658751,ft(c));A.position.copy(_);_.z+=.01;b.branch.push({id:E.id,heading:c})}}}var C=false;if(t.history!=null){if(t.history.length>0){var A=ne(I,Y,"history",16777215,dt);A.scale.set(.7,.7,.7);A.userData=[];b.history=[];for(var L=0;L<t.history.length;L++){var E=t.history[L];if(E!=null){var N=w+"train/"+E.train+"/images/"+Tt.thumb+"/"+E.image;var z=w+"train/"+E.train+"/images/"+E.image;var U={id:E.id,date:E.train,thumb:N,img:z};A.userData.push(U);var D={id:E.id,date:E.train};b.history.push(D)}}}}e.onPosition(b);if(e.needsUpdate){e.needsUpdate=false;for(var L=0;L<B.children.length;L++){var O=B.children[L];e.setLayer(O,O.userData)}}{var s=T.getWorldDirection();var c=Math.atan2(s.x,s.y)*180/Math.PI;var H=T.fov;var F=Math.atan(Math.tan(H/2)*T.aspect)*2*180/Math.PI;var k={heading:c,fovx:F};e.onEye(k)}p=n.id;var q={state:LocateState.success};e.onLocate(q);u=false;if(l){St(Rt(1))}}function Ve(t,i){d=null;if(t==""){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var r=$.parseJSON(t);if(r==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var a=r.Currentframe;if(a==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}d=r;var o=a.Imgurl;var s=o.lastIndexOf("/");var h=o.substr(0,s)+"/"+Tt.thumb+o.substr(s);We(h,o,je,r,i)}function je(t,i){var n=t.Currentframe;var r;if(i){ie();var a="+proj=tmerc +lat_0="+n.Lat+" +lon_0="+n.Lon+" +k=1.000000 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs ";G=proj4(a);r=G.forward([n.Lon,n.Lat]);V.x=r[0];V.y=r[1];V.z=n.Alt;e.needsUpdate=true}else{r=G.forward([n.Lon,n.Lat])}j.set(r[0],r[1],n.Alt);j.sub(V);var o=new THREE.Euler(n.Pitch,n.Roll,n.Yaw,"ZXY");W.position.copy(j);W.rotation.copy(o);if(we()){var s=T.getWorldDirection();var h=Math.atan2(s.x,s.y);var c=-n.Heading;var d=c-h;if(f!=null){var m=f-d;var v=new THREE.Euler(0,0,m);var g=new THREE.Quaternion;g.setFromEuler(v);T.quaternion.premultiply(g)}}else{var y=new THREE.Vector3(0,1,0);var x=new THREE.Vector3(0,0,1);y.applyEuler(o);x.applyEuler(o);T.position.set(0,0,0);T.up.copy(x);T.lookAt(y)}T.position.copy(j);ke();I.children=[];var b={lon:n.Lon,lat:n.Lat,alt:n.Alt};if(t.Historyframe!=null&&t.Historyframe.length>0){if(t.next==null){t.next=t.Historyframe.shift()}else if(t.prev==null){t.prev=t.Historyframe.shift()}}var M=.01;var _=new THREE.Vector3(0,1,0);var w=t.Nextframe;if(w!=null){var y=G.forward([w.Lon,w.Lat]);var s=new THREE.Vector3(y[0]-r[0],y[1]-r[1],0).normalize();var E=Math.atan2(s.x,s.y);var c=E*180/Math.PI;var S=new THREE.Group;I.add(S);S.rotation.set(0,0,-E);var R=ne(S,Y,w.ImgId,16772846,ft(c));R.position.copy(_);_.z+=.01;b.next={id:w.ImgId,heading:c}}var w=t.Prevframe;if(w!=null){var y=G.forward([w.Lon,w.Lat]);var s=new THREE.Vector3(y[0]-r[0],y[1]-r[1],0).normalize();var E=Math.atan2(s.x,s.y);var c=E*180/Math.PI;var S=new THREE.Group;I.add(S);S.rotation.set(0,0,-E);var R=ne(S,Y,w.ImgId,15663086,ft(c));R.position.copy(_);_.z+=.01;b.prev={id:w.ImgId,heading:c}}if(t.Branchframe!=null){b.branch=[];for(var A=0;A<t.Branchframe.length;A++){var w=t.Branchframe[A];if(w!=null){var E=-w.Heading;var c=E*180/Math.PI;var L=Math.abs(n.Heading-w.Heading)*180/Math.PI;while(L>360){L-=360}if(L>150){b.back={id:w.ImgId,heading:c};continue}var S=new THREE.Group;I.add(S);S.rotation.set(0,0,-E);var R=ne(S,Y,w.ImgId,15658751,ft(c));R.position.copy(_);_.z+=.01;b.branch.push({id:w.ImgId,heading:c})}}}var P=false;if(t.Historyframe!=null){if(t.Historyframe.length>0){var R=ne(I,Y,"history",16777215,dt);R.scale.set(.7,.7,.7);R.userData=[];b.history=[];for(var A=0;A<t.Historyframe.length;A++){var w=t.Historyframe[A];if(w!=null){var C=n.Imgurl;var y=C.lastIndexOf("/");var N=C.substr(0,y)+"/"+Tt.thumb+C.substr(y);var z={id:w.ImgId,date:w.Train,thumb:N,img:C};R.userData.push(z);var U={id:w.ImgId,date:w.Train};b.history.push(U)}}}}e.onPosition(b);if(e.needsUpdate){e.needsUpdate=false;for(var A=0;A<B.children.length;A++){var D=B.children[A];e.setLayer(D,D.userData)}}{var s=T.getWorldDirection();var c=Math.atan2(s.x,s.y)*180/Math.PI;var O=T.fov;var H=Math.atan(Math.tan(O/2)*T.aspect)*2*180/Math.PI;var F={heading:c,fovx:H};e.onEye(F)}p=n.ImgId;var k={state:LocateState.success};e.onLocate(k);u=false;if(l){St(Rt(1))}}function We(t,i,n,r,a){if(d!=null){switch(o){case-1:s=d.cur.type;break;case 0:s=d.Currentframe.Type;break;case 3:s=2;break;case 4:s=1;break}}E.load(t,function(t){var e=q.material.map;if(s==1){e=X.material.map;W.children=[];W.add(X)}else{W.children=[];W.add(q)}e.image=t.image;e.needsUpdate=true;n(r,a);if(l)return;u=true;E.load(i,function(t){var e=q.material.map;if(s==1){e=X.material.map;W.children=[];W.add(X)}else{W.children=[];W.add(q)}e.image=t.image;e.needsUpdate=true;u=false},null,function(){u=false})},null,function(){E.load(i,function(t){var e=q.material.map;if(s==1){e=X.material.map;W.children=[];W.add(X)}else{W.children=[];W.add(q)}e.image=t.image;e.needsUpdate=true;n(r,a)},null,function(){var t={state:LocateState.imageError};e.onLocate(t);if(s==1){var i=X.material.map;W.children=[];W.add(X);i.image=gt.image;i.needsUpdate=true}else{var i=q.material.map;W.children=[];W.add(q);i.image=vt.image;i.needsUpdate=true}n(r,a)})})}function qe(t,i){d=null;if(t==""){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var r=$.parseJSON(t);if(r==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var a=r.cur;if(a==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}d=r;var o=w+"train/"+a.train+"/images/"+Tt.thumb+"/"+a.image;var s=w+"train/"+a.train+"/images/"+a.image;We(o,s,Ge,r,i)}function Xe(t,i){d=null;if(t==""){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var r=$.parseJSON(t);if(r==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var a=r.Currentframe;if(a==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}d=r;var o=a.Pictureurl;var s=o.lastIndexOf("/");var h=o.substr(0,s)+"/"+Tt.thumb+o.substr(s);We(h,o,Ze,r,i)}function Ye(t,i){d=null;if(t==""){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var r=$.parseJSON(t);if(r==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}var a=r.Currentframe;if(a==null){var n={state:LocateState.dataError};e.onLocate(n);console.warn(t);u=false;return}d=r;var o=a.Pictureurl;var s=o.lastIndexOf("/");var h=o.substr(0,s)+"/"+Tt.thumb+o.substr(s);We(h,o,Qe,r,i)}function Ze(t,i,n){var r=t.Currentframe;var a;if(i){ie();var o="+proj=tmerc +lat_0="+r.Latitude+" +lon_0="+r.Longitude+" +k=1.000000 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs ";G=proj4(o);a=G.forward([r.Longitude,r.Latitude]);V.x=a[0];V.y=a[1];V.z=r.Altitude;e.needsUpdate=true}else{a=G.forward([r.Longitude,r.Latitude])}j.set(a[0],a[1],r.Altitude);j.sub(V);var s=new THREE.Euler(-r.Pitch*Math.PI/180,r.Roll*Math.PI/180,r.Yaw*Math.PI/180,"ZXY");var h=new THREE.Vector3(0,b,0);var c=new THREE.Vector3(0,0,1);h.applyEuler(s);c.applyEuler(s);if(!we()){T.position.set(0,0,0);T.up.set(c.x,c.y,c.z);T.lookAt(h)}T.position.copy(j);W.position.copy(j);W.rotation.copy(s);ke();I.children=[];var d={lon:r.Longitude,lat:r.Latitude,alt:r.Altitude};if(t.Historyframe!=null&&t.Historyframe.length>0){if(t.Nextframe==null){t.Nextframe=t.Historyframe.shift()}else if(t.Prevframe==null){t.Prevframe=t.Historyframe.shift()}}var f=new THREE.Vector3(0,1,0);var m=t.Nextframe;if(m!=null){var h=G.forward([m.Longitude,m.Latitude]);var v=new THREE.Vector3(h[0]-a[0],h[1]-a[1],0).normalize();var g=Math.atan2(v.x,v.y);var y=g*180/Math.PI;var x=new THREE.Group;I.add(x);x.rotation.set(0,0,-g);var M=ne(x,Y,m.PmId,16772846,ft(y));M.position.copy(f);f.z+=.01;d.next={id:m.PmId,heading:y}}var m=t.Prevframe;if(m!=null){var h=G.forward([m.Longitude,m.Latitude]);var v=new THREE.Vector3(h[0]-a[0],h[1]-a[1],0).normalize();var g=Math.atan2(v.x,v.y);var y=g*180/Math.PI;var x=new THREE.Group;I.add(x);x.rotation.set(0,0,-g);var M=ne(x,Y,m.PmId,15663086,ft(y));M.position.copy(f);f.z+=.01;d.prev={id:m.PmId,heading:y}}var _;if(t.Branchframe!=null){d.branch=[];for(var w=0;w<t.Branchframe.length;w++){var m=t.Branchframe[w];if(m!=null){var y=-m.Yaw;var g=y*Math.PI/180;var E=Math.abs(r.Yaw-m.Yaw);while(E>360){E-=360}if(E>150){d.back={id:m.PmId,heading:y};continue}var x=new THREE.Group;I.add(x);x.rotation.set(0,0,-g);var M=ne(x,Y,m.PmId,15658751,ft(y));M.position.copy(f);f.z+=.01;d.branch.push({id:m.PmId,heading:y})}}}var S=false;if(t.Historyframe!=null){if(t.Historyframe.length>0){var M=ne(I,Y,"history",16777215,dt);M.scale.set(.7,.7,.7);M.userData=[];d.history=[];for(var w=0;w<t.Historyframe.length;w++){var m=t.Historyframe[w];if(m!=null){var R=r.Pictureurl;var h=R.lastIndexOf("/");var A=R.substr(0,h)+"/"+Tt.thumb+R.substr(h);var L={id:m.PmId,date:m.Importtime,thumb:A,img:R};M.userData.push(L);var P={id:m.PmId,date:m.Importtime};d.history.push(P)}}}}e.onPosition(d);if(e.needsUpdate){e.needsUpdate=false;for(var w=0;w<B.children.length;w++){var C=B.children[w];e.setLayer(C,C.userData)}}{var v=T.getWorldDirection();var y=Math.atan2(v.x,v.y)*180/Math.PI;var N=T.fov;var z=Math.atan(Math.tan(N/2)*T.aspect)*2*180/Math.PI;var U={heading:y,fovx:z};e.onEye(U)}p=r.PmId;var D={state:LocateState.success};e.onLocate(D);u=false;if(l){St(Rt(1))}}function Qe(t,i,n){var r=t.Currentframe;var a;if(i){ie();var o="+proj=tmerc +lat_0="+r.Latitude+" +lon_0="+r.Longitude+" +k=1.000000 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs ";G=proj4(o);a=G.forward([r.Longitude,r.Latitude]);V.x=a[0];V.y=a[1];V.z=r.Height;e.needsUpdate=true}else{a=G.forward([r.Longitude,r.Latitude])}j.set(a[0],a[1],r.Height);j.sub(V);var s=new THREE.Euler(0,0,-(r.Heading+90)*Math.PI/180,"ZXY");W.position.copy(j);W.rotation.copy(s);var h=T.getWorldDirection();var c=Math.atan2(h.x,h.y);var d=r.Heading*Math.PI/180;var m=d-c;if(f!=null){var v=f-m;var g=new THREE.Euler(0,0,v);var y=new THREE.Quaternion;y.setFromEuler(g);T.quaternion.premultiply(y)}T.position.copy(j);ke();I.children=[];var x={lon:r.Longitude,lat:r.Latitude,alt:r.Height};if(t.Historyframe!=null&&t.Historyframe.length>0){if(t.Nextframe==null){t.Nextframe=t.Historyframe.shift()}else if(t.Prevframe==null){t.Prevframe=t.Historyframe.shift()}}var b=new THREE.Vector3(0,1,0);var M=t.Nextframe;if(M!=null){var _=G.forward([M.Longitude,M.Latitude]);var h=new THREE.Vector3(_[0]-a[0],_[1]-a[1],0).normalize();var w=Math.atan2(h.x,h.y);var d=w*180/Math.PI;var E=new THREE.Group;I.add(E);E.rotation.set(0,0,-w);var S=ne(E,Y,M.Id,16772846,ft(d));S.position.copy(b);b.z+=.01;x.next={id:M.Id,heading:d}}var M=t.Prevframe;if(M!=null){var _=G.forward([M.Longitude,M.Latitude]);var h=new THREE.Vector3(_[0]-a[0],_[1]-a[1],0).normalize();var w=Math.atan2(h.x,h.y);var d=w*180/Math.PI;var E=new THREE.Group;I.add(E);E.rotation.set(0,0,-w);var S=ne(E,Y,M.Id,15663086,ft(d));S.position.copy(b);b.z+=.01;x.prev={id:M.Id,heading:d}}var R;if(t.Branchframe!=null){x.branch=[];for(var A=0;A<t.Branchframe.length;A++){var M=t.Branchframe[A];if(M!=null){var d=-M.Heading*Math.PI/180;var w=d*Math.PI/180;var L=Math.abs(r.Heading-M.Heading);while(L>360){L-=360}if(L>150){x.back={id:M.Id,heading:d};continue}var E=new THREE.Group;I.add(E);E.rotation.set(0,0,-w);var S=ne(E,Y,M.Id,15658751,ft(d));S.position.copy(b);b.z+=.01;x.branch.push({id:M.Id,heading:d})}}}var P=false;if(t.Historyframe!=null){if(t.Historyframe.length>0){var S=ne(I,Y,"history",16777215,dt);S.scale.set(.7,.7,.7);S.userData=[];x.history=[];for(var A=0;A<t.Historyframe.length;A++){var M=t.Historyframe[A];if(M!=null){var C=r.Pictureurl;var _=C.lastIndexOf("/");var N=C.substr(0,_)+"/"+Tt.thumb+C.substr(_);var z={id:M.Id,date:M.Datetime,thumb:N,img:C};S.userData.push(z);var U={id:M.Id,date:M.Datetime};x.history.push(U)}}}}e.onPosition(x);if(e.needsUpdate){e.needsUpdate=false;for(var A=0;A<B.children.length;A++){var D=B.children[A];e.setLayer(D,D.userData)}}{var h=T.getWorldDirection();var d=Math.atan2(h.x,h.y)*180/Math.PI;var O=T.fov;var H=Math.atan(Math.tan(O/2)*T.aspect)*2*180/Math.PI;var F={heading:d,fovx:H};e.onEye(F)}p=r.Id;var k={state:LocateState.success};e.onLocate(k);u=false;if(l){St(Rt(1))}}be()}